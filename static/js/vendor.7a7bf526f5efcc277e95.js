webpackJsonp([0],{"/ocq":function(t,e,i){"use strict";
/*!
  * vue-router v3.5.3
  * (c) 2021 Evan You
  * @license MIT
  */function n(t,e){for(var i in e)t[i]=e[i];return t}var r=/[!'()*]/g,o=function(t){return"%"+t.charCodeAt(0).toString(16)},s=/%2C/g,a=function(t){return encodeURIComponent(t).replace(r,o).replace(s,",")};function h(t){try{return decodeURIComponent(t)}catch(t){0}return t}var u=function(t){return null==t||"object"==typeof t?t:String(t)};function l(t){var e={};return(t=t.trim().replace(/^(\?|#|&)/,""))?(t.split("&").forEach(function(t){var i=t.replace(/\+/g," ").split("="),n=h(i.shift()),r=i.length>0?h(i.join("=")):null;void 0===e[n]?e[n]=r:Array.isArray(e[n])?e[n].push(r):e[n]=[e[n],r]}),e):e}function c(t){var e=t?Object.keys(t).map(function(e){var i=t[e];if(void 0===i)return"";if(null===i)return a(e);if(Array.isArray(i)){var n=[];return i.forEach(function(t){void 0!==t&&(null===t?n.push(a(e)):n.push(a(e)+"="+a(t)))}),n.join("&")}return a(e)+"="+a(i)}).filter(function(t){return t.length>0}).join("&"):null;return e?"?"+e:""}var f=/\/?$/;function d(t,e,i,n){var r=n&&n.options.stringifyQuery,o=e.query||{};try{o=p(o)}catch(t){}var s={name:e.name||t&&t.name,meta:t&&t.meta||{},path:e.path||"/",hash:e.hash||"",query:o,params:e.params||{},fullPath:m(e,r),matched:t?function(t){var e=[];for(;t;)e.unshift(t),t=t.parent;return e}(t):[]};return i&&(s.redirectedFrom=m(i,r)),Object.freeze(s)}function p(t){if(Array.isArray(t))return t.map(p);if(t&&"object"==typeof t){var e={};for(var i in t)e[i]=p(t[i]);return e}return t}var g=d(null,{path:"/"});function m(t,e){var i=t.path,n=t.query;void 0===n&&(n={});var r=t.hash;return void 0===r&&(r=""),(i||"/")+(e||c)(n)+r}function v(t,e,i){return e===g?t===e:!!e&&(t.path&&e.path?t.path.replace(f,"")===e.path.replace(f,"")&&(i||t.hash===e.hash&&_(t.query,e.query)):!(!t.name||!e.name)&&(t.name===e.name&&(i||t.hash===e.hash&&_(t.query,e.query)&&_(t.params,e.params))))}function _(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!t||!e)return t===e;var i=Object.keys(t).sort(),n=Object.keys(e).sort();return i.length===n.length&&i.every(function(i,r){var o=t[i];if(n[r]!==i)return!1;var s=e[i];return null==o||null==s?o===s:"object"==typeof o&&"object"==typeof s?_(o,s):String(o)===String(s)})}function y(t){for(var e=0;e<t.matched.length;e++){var i=t.matched[e];for(var n in i.instances){var r=i.instances[n],o=i.enteredCbs[n];if(r&&o){delete i.enteredCbs[n];for(var s=0;s<o.length;s++)r._isBeingDestroyed||o[s](r)}}}}var x={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(t,e){var i=e.props,r=e.children,o=e.parent,s=e.data;s.routerView=!0;for(var a=o.$createElement,h=i.name,u=o.$route,l=o._routerViewCache||(o._routerViewCache={}),c=0,f=!1;o&&o._routerRoot!==o;){var d=o.$vnode?o.$vnode.data:{};d.routerView&&c++,d.keepAlive&&o._directInactive&&o._inactive&&(f=!0),o=o.$parent}if(s.routerViewDepth=c,f){var p=l[h],g=p&&p.component;return g?(p.configProps&&w(g,s,p.route,p.configProps),a(g,s,r)):a()}var m=u.matched[c],v=m&&m.components[h];if(!m||!v)return l[h]=null,a();l[h]={component:v},s.registerRouteInstance=function(t,e){var i=m.instances[h];(e&&i!==t||!e&&i===t)&&(m.instances[h]=e)},(s.hook||(s.hook={})).prepatch=function(t,e){m.instances[h]=e.componentInstance},s.hook.init=function(t){t.data.keepAlive&&t.componentInstance&&t.componentInstance!==m.instances[h]&&(m.instances[h]=t.componentInstance),y(u)};var _=m.props&&m.props[h];return _&&(n(l[h],{route:u,configProps:_}),w(v,s,u,_)),a(v,s,r)}};function w(t,e,i,r){var o=e.props=function(t,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(t);case"boolean":return e?t.params:void 0;default:0}}(i,r);if(o){o=e.props=n({},o);var s=e.attrs=e.attrs||{};for(var a in o)t.props&&a in t.props||(s[a]=o[a],delete o[a])}}function b(t,e,i){var n=t.charAt(0);if("/"===n)return t;if("?"===n||"#"===n)return e+t;var r=e.split("/");i&&r[r.length-1]||r.pop();for(var o=t.replace(/^\//,"").split("/"),s=0;s<o.length;s++){var a=o[s];".."===a?r.pop():"."!==a&&r.push(a)}return""!==r[0]&&r.unshift(""),r.join("/")}function C(t){return t.replace(/\/+/g,"/")}var P=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},M=F,T=R,S=function(t,e){return L(R(t,e),e)},A=L,E=H,k=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function R(t,e){for(var i,n=[],r=0,o=0,s="",a=e&&e.delimiter||"/";null!=(i=k.exec(t));){var h=i[0],u=i[1],l=i.index;if(s+=t.slice(o,l),o=l+h.length,u)s+=u[1];else{var c=t[o],f=i[2],d=i[3],p=i[4],g=i[5],m=i[6],v=i[7];s&&(n.push(s),s="");var _=null!=f&&null!=c&&c!==f,y="+"===m||"*"===m,x="?"===m||"*"===m,w=i[2]||a,b=p||g;n.push({name:d||r++,prefix:f||"",delimiter:w,optional:x,repeat:y,partial:_,asterisk:!!v,pattern:b?I(b):v?".*":"[^"+D(w)+"]+?"})}}return o<t.length&&(s+=t.substr(o)),s&&n.push(s),n}function O(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function L(t,e){for(var i=new Array(t.length),n=0;n<t.length;n++)"object"==typeof t[n]&&(i[n]=new RegExp("^(?:"+t[n].pattern+")$",z(e)));return function(e,n){for(var r="",o=e||{},s=(n||{}).pretty?O:encodeURIComponent,a=0;a<t.length;a++){var h=t[a];if("string"!=typeof h){var u,l=o[h.name];if(null==l){if(h.optional){h.partial&&(r+=h.prefix);continue}throw new TypeError('Expected "'+h.name+'" to be defined')}if(P(l)){if(!h.repeat)throw new TypeError('Expected "'+h.name+'" to not repeat, but received `'+JSON.stringify(l)+"`");if(0===l.length){if(h.optional)continue;throw new TypeError('Expected "'+h.name+'" to not be empty')}for(var c=0;c<l.length;c++){if(u=s(l[c]),!i[a].test(u))throw new TypeError('Expected all "'+h.name+'" to match "'+h.pattern+'", but received `'+JSON.stringify(u)+"`");r+=(0===c?h.prefix:h.delimiter)+u}}else{if(u=h.asterisk?encodeURI(l).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}):s(l),!i[a].test(u))throw new TypeError('Expected "'+h.name+'" to match "'+h.pattern+'", but received "'+u+'"');r+=h.prefix+u}}else r+=h}return r}}function D(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function I(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function j(t,e){return t.keys=e,t}function z(t){return t&&t.sensitive?"":"i"}function H(t,e,i){P(e)||(i=e||i,e=[]);for(var n=(i=i||{}).strict,r=!1!==i.end,o="",s=0;s<t.length;s++){var a=t[s];if("string"==typeof a)o+=D(a);else{var h=D(a.prefix),u="(?:"+a.pattern+")";e.push(a),a.repeat&&(u+="(?:"+h+u+")*"),o+=u=a.optional?a.partial?h+"("+u+")?":"(?:"+h+"("+u+"))?":h+"("+u+")"}}var l=D(i.delimiter||"/"),c=o.slice(-l.length)===l;return n||(o=(c?o.slice(0,-l.length):o)+"(?:"+l+"(?=$))?"),o+=r?"$":n&&c?"":"(?="+l+"|$)",j(new RegExp("^"+o,z(i)),e)}function F(t,e,i){return P(e)||(i=e||i,e=[]),i=i||{},t instanceof RegExp?function(t,e){var i=t.source.match(/\((?!\?)/g);if(i)for(var n=0;n<i.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return j(t,e)}(t,e):P(t)?function(t,e,i){for(var n=[],r=0;r<t.length;r++)n.push(F(t[r],e,i).source);return j(new RegExp("(?:"+n.join("|")+")",z(i)),e)}(t,e,i):function(t,e,i){return H(R(t,i),e,i)}(t,e,i)}M.parse=T,M.compile=S,M.tokensToFunction=A,M.tokensToRegExp=E;var N=Object.create(null);function Z(t,e,i){e=e||{};try{var n=N[t]||(N[t]=M.compile(t));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),n(e,{pretty:!0})}catch(t){return""}finally{delete e[0]}}function G(t,e,i,r){var o="string"==typeof t?{path:t}:t;if(o._normalized)return o;if(o.name){var s=(o=n({},t)).params;return s&&"object"==typeof s&&(o.params=n({},s)),o}if(!o.path&&o.params&&e){(o=n({},o))._normalized=!0;var a=n(n({},e.params),o.params);if(e.name)o.name=e.name,o.params=a;else if(e.matched.length){var h=e.matched[e.matched.length-1].path;o.path=Z(h,a,e.path)}else 0;return o}var c=function(t){var e="",i="",n=t.indexOf("#");n>=0&&(e=t.slice(n),t=t.slice(0,n));var r=t.indexOf("?");return r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),{path:t,query:i,hash:e}}(o.path||""),f=e&&e.path||"/",d=c.path?b(c.path,f,i||o.append):f,p=function(t,e,i){void 0===e&&(e={});var n,r=i||l;try{n=r(t||"")}catch(t){n={}}for(var o in e){var s=e[o];n[o]=Array.isArray(s)?s.map(u):u(s)}return n}(c.query,o.query,r&&r.options.parseQuery),g=o.hash||c.hash;return g&&"#"!==g.charAt(0)&&(g="#"+g),{_normalized:!0,path:d,query:p,hash:g}}var B,W=[String,Object],V=[String,Array],$=function(){},U={name:"RouterLink",props:{to:{type:W,required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:V,default:"click"}},render:function(t){var e=this,i=this.$router,r=this.$route,o=i.resolve(this.to,r,this.append),s=o.location,a=o.route,h=o.href,u={},l=i.options.linkActiveClass,c=i.options.linkExactActiveClass,p=null==l?"router-link-active":l,g=null==c?"router-link-exact-active":c,m=null==this.activeClass?p:this.activeClass,_=null==this.exactActiveClass?g:this.exactActiveClass,y=a.redirectedFrom?d(null,G(a.redirectedFrom),null,i):a;u[_]=v(r,y,this.exactPath),u[m]=this.exact||this.exactPath?u[_]:function(t,e){return 0===t.path.replace(f,"/").indexOf(e.path.replace(f,"/"))&&(!e.hash||t.hash===e.hash)&&function(t,e){for(var i in e)if(!(i in t))return!1;return!0}(t.query,e.query)}(r,y);var x=u[_]?this.ariaCurrentValue:null,w=function(t){J(t)&&(e.replace?i.replace(s,$):i.push(s,$))},b={click:J};Array.isArray(this.event)?this.event.forEach(function(t){b[t]=w}):b[this.event]=w;var C={class:u},P=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:h,route:a,navigate:w,isActive:u[m],isExactActive:u[_]});if(P){if(1===P.length)return P[0];if(P.length>1||!P.length)return 0===P.length?t():t("span",{},P)}if("a"===this.tag)C.on=b,C.attrs={href:h,"aria-current":x};else{var M=function t(e){if(e)for(var i,n=0;n<e.length;n++){if("a"===(i=e[n]).tag)return i;if(i.children&&(i=t(i.children)))return i}}(this.$slots.default);if(M){M.isStatic=!1;var T=M.data=n({},M.data);for(var S in T.on=T.on||{},T.on){var A=T.on[S];S in b&&(T.on[S]=Array.isArray(A)?A:[A])}for(var E in b)E in T.on?T.on[E].push(b[E]):T.on[E]=w;var k=M.data.attrs=n({},M.data.attrs);k.href=h,k["aria-current"]=x}else C.on=b}return t(this.tag,C,this.$slots.default)}};function J(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented||void 0!==t.button&&0!==t.button)){if(t.currentTarget&&t.currentTarget.getAttribute){var e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function q(t){if(!q.installed||B!==t){q.installed=!0,B=t;var e=function(t){return void 0!==t},i=function(t,i){var n=t.$options._parentVnode;e(n)&&e(n=n.data)&&e(n=n.registerRouteInstance)&&n(t,i)};t.mixin({beforeCreate:function(){e(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),t.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,i(this,this)},destroyed:function(){i(this)}}),Object.defineProperty(t.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(t.prototype,"$route",{get:function(){return this._routerRoot._route}}),t.component("RouterView",x),t.component("RouterLink",U);var n=t.config.optionMergeStrategies;n.beforeRouteEnter=n.beforeRouteLeave=n.beforeRouteUpdate=n.created}}var Y="undefined"!=typeof window;function X(t,e,i,n,r){var o=e||[],s=i||Object.create(null),a=n||Object.create(null);t.forEach(function(t){!function t(e,i,n,r,o,s){var a=r.path;var h=r.name;0;var u=r.pathToRegexpOptions||{};var l=function(t,e,i){i||(t=t.replace(/\/$/,""));if("/"===t[0])return t;if(null==e)return t;return C(e.path+"/"+t)}(a,o,u.strict);"boolean"==typeof r.caseSensitive&&(u.sensitive=r.caseSensitive);var c={path:l,regex:function(t,e){var i=M(t,[],e);return i}(l,u),components:r.components||{default:r.component},alias:r.alias?"string"==typeof r.alias?[r.alias]:r.alias:[],instances:{},enteredCbs:{},name:h,parent:o,matchAs:s,redirect:r.redirect,beforeEnter:r.beforeEnter,meta:r.meta||{},props:null==r.props?{}:r.components?r.props:{default:r.props}};r.children&&r.children.forEach(function(r){var o=s?C(s+"/"+r.path):void 0;t(e,i,n,r,c,o)});i[c.path]||(e.push(c.path),i[c.path]=c);if(void 0!==r.alias)for(var f=Array.isArray(r.alias)?r.alias:[r.alias],d=0;d<f.length;++d){var p=f[d];0;var g={path:p,children:r.children};t(e,i,n,g,o,c.path||"/")}h&&(n[h]||(n[h]=c))}(o,s,a,t,r)});for(var h=0,u=o.length;h<u;h++)"*"===o[h]&&(o.push(o.splice(h,1)[0]),u--,h--);return{pathList:o,pathMap:s,nameMap:a}}function K(t,e){var i=X(t),n=i.pathList,r=i.pathMap,o=i.nameMap;function s(t,i,s){var a=G(t,i,!1,e),u=a.name;if(u){var l=o[u];if(!l)return h(null,a);var c=l.regex.keys.filter(function(t){return!t.optional}).map(function(t){return t.name});if("object"!=typeof a.params&&(a.params={}),i&&"object"==typeof i.params)for(var f in i.params)!(f in a.params)&&c.indexOf(f)>-1&&(a.params[f]=i.params[f]);return a.path=Z(l.path,a.params),h(l,a,s)}if(a.path){a.params={};for(var d=0;d<n.length;d++){var p=n[d],g=r[p];if(Q(g.regex,a.path,a.params))return h(g,a,s)}}return h(null,a)}function a(t,i){var n=t.redirect,r="function"==typeof n?n(d(t,i,null,e)):n;if("string"==typeof r&&(r={path:r}),!r||"object"!=typeof r)return h(null,i);var a=r,u=a.name,l=a.path,c=i.query,f=i.hash,p=i.params;if(c=a.hasOwnProperty("query")?a.query:c,f=a.hasOwnProperty("hash")?a.hash:f,p=a.hasOwnProperty("params")?a.params:p,u){o[u];return s({_normalized:!0,name:u,query:c,hash:f,params:p},void 0,i)}if(l){var g=function(t,e){return b(t,e.parent?e.parent.path:"/",!0)}(l,t);return s({_normalized:!0,path:Z(g,p),query:c,hash:f},void 0,i)}return h(null,i)}function h(t,i,n){return t&&t.redirect?a(t,n||i):t&&t.matchAs?function(t,e,i){var n=s({_normalized:!0,path:Z(i,e.params)});if(n){var r=n.matched,o=r[r.length-1];return e.params=n.params,h(o,e)}return h(null,e)}(0,i,t.matchAs):d(t,i,n,e)}return{match:s,addRoute:function(t,e){var i="object"!=typeof t?o[t]:void 0;X([e||t],n,r,o,i),i&&i.alias.length&&X(i.alias.map(function(t){return{path:t,children:[e]}}),n,r,o,i)},getRoutes:function(){return n.map(function(t){return r[t]})},addRoutes:function(t){X(t,n,r,o)}}}function Q(t,e,i){var n=e.match(t);if(!n)return!1;if(!i)return!0;for(var r=1,o=n.length;r<o;++r){var s=t.keys[r-1];s&&(i[s.name||"pathMatch"]="string"==typeof n[r]?h(n[r]):n[r])}return!0}var tt=Y&&window.performance&&window.performance.now?window.performance:Date;function et(){return tt.now().toFixed(3)}var it=et();function nt(){return it}function rt(t){return it=t}var ot=Object.create(null);function st(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var t=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(t,""),i=n({},window.history.state);return i.key=nt(),window.history.replaceState(i,"",e),window.addEventListener("popstate",ut),function(){window.removeEventListener("popstate",ut)}}function at(t,e,i,n){if(t.app){var r=t.options.scrollBehavior;r&&t.app.$nextTick(function(){var o=function(){var t=nt();if(t)return ot[t]}(),s=r.call(t,e,i,n?o:null);s&&("function"==typeof s.then?s.then(function(t){pt(t,o)}).catch(function(t){0}):pt(s,o))})}}function ht(){var t=nt();t&&(ot[t]={x:window.pageXOffset,y:window.pageYOffset})}function ut(t){ht(),t.state&&t.state.key&&rt(t.state.key)}function lt(t){return ft(t.x)||ft(t.y)}function ct(t){return{x:ft(t.x)?t.x:window.pageXOffset,y:ft(t.y)?t.y:window.pageYOffset}}function ft(t){return"number"==typeof t}var dt=/^#\d/;function pt(t,e){var i,n="object"==typeof t;if(n&&"string"==typeof t.selector){var r=dt.test(t.selector)?document.getElementById(t.selector.slice(1)):document.querySelector(t.selector);if(r){var o=t.offset&&"object"==typeof t.offset?t.offset:{};e=function(t,e){var i=document.documentElement.getBoundingClientRect(),n=t.getBoundingClientRect();return{x:n.left-i.left-e.x,y:n.top-i.top-e.y}}(r,o={x:ft((i=o).x)?i.x:0,y:ft(i.y)?i.y:0})}else lt(t)&&(e=ct(t))}else n&&lt(t)&&(e=ct(t));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:t.behavior}):window.scrollTo(e.x,e.y))}var gt,mt=Y&&((-1===(gt=window.navigator.userAgent).indexOf("Android 2.")&&-1===gt.indexOf("Android 4.0")||-1===gt.indexOf("Mobile Safari")||-1!==gt.indexOf("Chrome")||-1!==gt.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function vt(t,e){ht();var i=window.history;try{if(e){var r=n({},i.state);r.key=nt(),i.replaceState(r,"",t)}else i.pushState({key:rt(et())},"",t)}catch(i){window.location[e?"replace":"assign"](t)}}function _t(t){vt(t,!0)}function yt(t,e,i){var n=function(r){r>=t.length?i():t[r]?e(t[r],function(){n(r+1)}):n(r+1)};n(0)}var xt={redirected:2,aborted:4,cancelled:8,duplicated:16};function wt(t,e){return Ct(t,e,xt.redirected,'Redirected when going from "'+t.fullPath+'" to "'+function(t){if("string"==typeof t)return t;if("path"in t)return t.path;var e={};return Pt.forEach(function(i){i in t&&(e[i]=t[i])}),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function bt(t,e){return Ct(t,e,xt.cancelled,'Navigation cancelled from "'+t.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function Ct(t,e,i,n){var r=new Error(n);return r._isRouter=!0,r.from=t,r.to=e,r.type=i,r}var Pt=["params","query","hash"];function Mt(t){return Object.prototype.toString.call(t).indexOf("Error")>-1}function Tt(t,e){return Mt(t)&&t._isRouter&&(null==e||t.type===e)}function St(t){return function(e,i,n){var r=!1,o=0,s=null;At(t,function(t,e,i,a){if("function"==typeof t&&void 0===t.cid){r=!0,o++;var h,u=Rt(function(e){var r;((r=e).__esModule||kt&&"Module"===r[Symbol.toStringTag])&&(e=e.default),t.resolved="function"==typeof e?e:B.extend(e),i.components[a]=e,--o<=0&&n()}),l=Rt(function(t){var e="Failed to resolve async component "+a+": "+t;s||(s=Mt(t)?t:new Error(e),n(s))});try{h=t(u,l)}catch(t){l(t)}if(h)if("function"==typeof h.then)h.then(u,l);else{var c=h.component;c&&"function"==typeof c.then&&c.then(u,l)}}}),r||n()}}function At(t,e){return Et(t.map(function(t){return Object.keys(t.components).map(function(i){return e(t.components[i],t.instances[i],t,i)})}))}function Et(t){return Array.prototype.concat.apply([],t)}var kt="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Rt(t){var e=!1;return function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];if(!e)return e=!0,t.apply(this,i)}}var Ot=function(t,e){this.router=t,this.base=function(t){if(!t)if(Y){var e=document.querySelector("base");t=(t=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else t="/";"/"!==t.charAt(0)&&(t="/"+t);return t.replace(/\/$/,"")}(e),this.current=g,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function Lt(t,e,i,n){var r=At(t,function(t,n,r,o){var s=function(t,e){"function"!=typeof t&&(t=B.extend(t));return t.options[e]}(t,e);if(s)return Array.isArray(s)?s.map(function(t){return i(t,n,r,o)}):i(s,n,r,o)});return Et(n?r.reverse():r)}function Dt(t,e){if(e)return function(){return t.apply(e,arguments)}}Ot.prototype.listen=function(t){this.cb=t},Ot.prototype.onReady=function(t,e){this.ready?t():(this.readyCbs.push(t),e&&this.readyErrorCbs.push(e))},Ot.prototype.onError=function(t){this.errorCbs.push(t)},Ot.prototype.transitionTo=function(t,e,i){var n,r=this;try{n=this.router.match(t,this.current)}catch(t){throw this.errorCbs.forEach(function(e){e(t)}),t}var o=this.current;this.confirmTransition(n,function(){r.updateRoute(n),e&&e(n),r.ensureURL(),r.router.afterHooks.forEach(function(t){t&&t(n,o)}),r.ready||(r.ready=!0,r.readyCbs.forEach(function(t){t(n)}))},function(t){i&&i(t),t&&!r.ready&&(Tt(t,xt.redirected)&&o===g||(r.ready=!0,r.readyErrorCbs.forEach(function(e){e(t)})))})},Ot.prototype.confirmTransition=function(t,e,i){var n=this,r=this.current;this.pending=t;var o,s,a=function(t){!Tt(t)&&Mt(t)&&(n.errorCbs.length?n.errorCbs.forEach(function(e){e(t)}):console.error(t)),i&&i(t)},h=t.matched.length-1,u=r.matched.length-1;if(v(t,r)&&h===u&&t.matched[h]===r.matched[u])return this.ensureURL(),t.hash&&at(this.router,r,t,!1),a(((s=Ct(o=r,t,xt.duplicated,'Avoided redundant navigation to current location: "'+o.fullPath+'".')).name="NavigationDuplicated",s));var l=function(t,e){var i,n=Math.max(t.length,e.length);for(i=0;i<n&&t[i]===e[i];i++);return{updated:e.slice(0,i),activated:e.slice(i),deactivated:t.slice(i)}}(this.current.matched,t.matched),c=l.updated,f=l.deactivated,d=l.activated,p=function(e,i){if(n.pending!==t)return a(bt(r,t));try{e(t,r,function(e){!1===e?(n.ensureURL(!0),a(function(t,e){return Ct(t,e,xt.aborted,'Navigation aborted from "'+t.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(r,t))):Mt(e)?(n.ensureURL(!0),a(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(a(wt(r,t)),"object"==typeof e&&e.replace?n.replace(e):n.push(e)):i(e)})}catch(t){a(t)}};yt([].concat(function(t){return Lt(t,"beforeRouteLeave",Dt,!0)}(f),this.router.beforeHooks,function(t){return Lt(t,"beforeRouteUpdate",Dt)}(c),d.map(function(t){return t.beforeEnter}),St(d)),p,function(){yt(function(t){return Lt(t,"beforeRouteEnter",function(t,e,i,n){return function(t,e,i){return function(n,r,o){return t(n,r,function(t){"function"==typeof t&&(e.enteredCbs[i]||(e.enteredCbs[i]=[]),e.enteredCbs[i].push(t)),o(t)})}}(t,i,n)})}(d).concat(n.router.resolveHooks),p,function(){if(n.pending!==t)return a(bt(r,t));n.pending=null,e(t),n.router.app&&n.router.app.$nextTick(function(){y(t)})})})},Ot.prototype.updateRoute=function(t){this.current=t,this.cb&&this.cb(t)},Ot.prototype.setupListeners=function(){},Ot.prototype.teardown=function(){this.listeners.forEach(function(t){t()}),this.listeners=[],this.current=g,this.pending=null};var It=function(t){function e(e,i){t.call(this,e,i),this._startLocation=jt(this.base)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var t=this;if(!(this.listeners.length>0)){var e=this.router,i=e.options.scrollBehavior,n=mt&&i;n&&this.listeners.push(st());var r=function(){var i=t.current,r=jt(t.base);t.current===g&&r===t._startLocation||t.transitionTo(r,function(t){n&&at(e,t,i,!0)})};window.addEventListener("popstate",r),this.listeners.push(function(){window.removeEventListener("popstate",r)})}},e.prototype.go=function(t){window.history.go(t)},e.prototype.push=function(t,e,i){var n=this,r=this.current;this.transitionTo(t,function(t){vt(C(n.base+t.fullPath)),at(n.router,t,r,!1),e&&e(t)},i)},e.prototype.replace=function(t,e,i){var n=this,r=this.current;this.transitionTo(t,function(t){_t(C(n.base+t.fullPath)),at(n.router,t,r,!1),e&&e(t)},i)},e.prototype.ensureURL=function(t){if(jt(this.base)!==this.current.fullPath){var e=C(this.base+this.current.fullPath);t?vt(e):_t(e)}},e.prototype.getCurrentLocation=function(){return jt(this.base)},e}(Ot);function jt(t){var e=window.location.pathname,i=e.toLowerCase(),n=t.toLowerCase();return!t||i!==n&&0!==i.indexOf(C(n+"/"))||(e=e.slice(t.length)),(e||"/")+window.location.search+window.location.hash}var zt=function(t){function e(e,i,n){t.call(this,e,i),n&&function(t){var e=jt(t);if(!/^\/#/.test(e))return window.location.replace(C(t+"/#"+e)),!0}(this.base)||Ht()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var t=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,i=mt&&e;i&&this.listeners.push(st());var n=function(){var e=t.current;Ht()&&t.transitionTo(Ft(),function(n){i&&at(t.router,n,e,!0),mt||Gt(n.fullPath)})},r=mt?"popstate":"hashchange";window.addEventListener(r,n),this.listeners.push(function(){window.removeEventListener(r,n)})}},e.prototype.push=function(t,e,i){var n=this,r=this.current;this.transitionTo(t,function(t){Zt(t.fullPath),at(n.router,t,r,!1),e&&e(t)},i)},e.prototype.replace=function(t,e,i){var n=this,r=this.current;this.transitionTo(t,function(t){Gt(t.fullPath),at(n.router,t,r,!1),e&&e(t)},i)},e.prototype.go=function(t){window.history.go(t)},e.prototype.ensureURL=function(t){var e=this.current.fullPath;Ft()!==e&&(t?Zt(e):Gt(e))},e.prototype.getCurrentLocation=function(){return Ft()},e}(Ot);function Ht(){var t=Ft();return"/"===t.charAt(0)||(Gt("/"+t),!1)}function Ft(){var t=window.location.href,e=t.indexOf("#");return e<0?"":t=t.slice(e+1)}function Nt(t){var e=window.location.href,i=e.indexOf("#");return(i>=0?e.slice(0,i):e)+"#"+t}function Zt(t){mt?vt(Nt(t)):window.location.hash=t}function Gt(t){mt?_t(Nt(t)):window.location.replace(Nt(t))}var Bt=function(t){function e(e,i){t.call(this,e,i),this.stack=[],this.index=-1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.push=function(t,e,i){var n=this;this.transitionTo(t,function(t){n.stack=n.stack.slice(0,n.index+1).concat(t),n.index++,e&&e(t)},i)},e.prototype.replace=function(t,e,i){var n=this;this.transitionTo(t,function(t){n.stack=n.stack.slice(0,n.index).concat(t),e&&e(t)},i)},e.prototype.go=function(t){var e=this,i=this.index+t;if(!(i<0||i>=this.stack.length)){var n=this.stack[i];this.confirmTransition(n,function(){var t=e.current;e.index=i,e.updateRoute(n),e.router.afterHooks.forEach(function(e){e&&e(n,t)})},function(t){Tt(t,xt.duplicated)&&(e.index=i)})}},e.prototype.getCurrentLocation=function(){var t=this.stack[this.stack.length-1];return t?t.fullPath:"/"},e.prototype.ensureURL=function(){},e}(Ot),Wt=function(t){void 0===t&&(t={}),this.app=null,this.apps=[],this.options=t,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=K(t.routes||[],this);var e=t.mode||"hash";switch(this.fallback="history"===e&&!mt&&!1!==t.fallback,this.fallback&&(e="hash"),Y||(e="abstract"),this.mode=e,e){case"history":this.history=new It(this,t.base);break;case"hash":this.history=new zt(this,t.base,this.fallback);break;case"abstract":this.history=new Bt(this,t.base);break;default:0}},Vt={currentRoute:{configurable:!0}};function $t(t,e){return t.push(e),function(){var i=t.indexOf(e);i>-1&&t.splice(i,1)}}Wt.prototype.match=function(t,e,i){return this.matcher.match(t,e,i)},Vt.currentRoute.get=function(){return this.history&&this.history.current},Wt.prototype.init=function(t){var e=this;if(this.apps.push(t),t.$once("hook:destroyed",function(){var i=e.apps.indexOf(t);i>-1&&e.apps.splice(i,1),e.app===t&&(e.app=e.apps[0]||null),e.app||e.history.teardown()}),!this.app){this.app=t;var i=this.history;if(i instanceof It||i instanceof zt){var n=function(t){i.setupListeners(),function(t){var n=i.current,r=e.options.scrollBehavior;mt&&r&&"fullPath"in t&&at(e,t,n,!1)}(t)};i.transitionTo(i.getCurrentLocation(),n,n)}i.listen(function(t){e.apps.forEach(function(e){e._route=t})})}},Wt.prototype.beforeEach=function(t){return $t(this.beforeHooks,t)},Wt.prototype.beforeResolve=function(t){return $t(this.resolveHooks,t)},Wt.prototype.afterEach=function(t){return $t(this.afterHooks,t)},Wt.prototype.onReady=function(t,e){this.history.onReady(t,e)},Wt.prototype.onError=function(t){this.history.onError(t)},Wt.prototype.push=function(t,e,i){var n=this;if(!e&&!i&&"undefined"!=typeof Promise)return new Promise(function(e,i){n.history.push(t,e,i)});this.history.push(t,e,i)},Wt.prototype.replace=function(t,e,i){var n=this;if(!e&&!i&&"undefined"!=typeof Promise)return new Promise(function(e,i){n.history.replace(t,e,i)});this.history.replace(t,e,i)},Wt.prototype.go=function(t){this.history.go(t)},Wt.prototype.back=function(){this.go(-1)},Wt.prototype.forward=function(){this.go(1)},Wt.prototype.getMatchedComponents=function(t){var e=t?t.matched?t:this.resolve(t).route:this.currentRoute;return e?[].concat.apply([],e.matched.map(function(t){return Object.keys(t.components).map(function(e){return t.components[e]})})):[]},Wt.prototype.resolve=function(t,e,i){var n=G(t,e=e||this.history.current,i,this),r=this.match(n,e),o=r.redirectedFrom||r.fullPath;return{location:n,route:r,href:function(t,e,i){var n="hash"===i?"#"+e:e;return t?C(t+"/"+n):n}(this.history.base,o,this.mode),normalizedTo:n,resolved:r}},Wt.prototype.getRoutes=function(){return this.matcher.getRoutes()},Wt.prototype.addRoute=function(t,e){this.matcher.addRoute(t,e),this.history.current!==g&&this.history.transitionTo(this.history.getCurrentLocation())},Wt.prototype.addRoutes=function(t){this.matcher.addRoutes(t),this.history.current!==g&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Wt.prototype,Vt),Wt.install=q,Wt.version="3.5.3",Wt.isNavigationFailure=Tt,Wt.NavigationFailureType=xt,Wt.START_LOCATION=g,Y&&window.Vue&&window.Vue.use(Wt),e.a=Wt},"7+uW":function(t,e,i){"use strict";(function(t){
/*!
 * Vue.js v2.6.14
 * (c) 2014-2021 Evan You
 * Released under the MIT License.
 */
var i=Object.freeze({});function n(t){return void 0===t||null===t}function r(t){return void 0!==t&&null!==t}function o(t){return!0===t}function s(t){return"string"==typeof t||"number"==typeof t||"symbol"==typeof t||"boolean"==typeof t}function a(t){return null!==t&&"object"==typeof t}var h=Object.prototype.toString;function u(t){return"[object Object]"===h.call(t)}function l(t){return"[object RegExp]"===h.call(t)}function c(t){var e=parseFloat(String(t));return e>=0&&Math.floor(e)===e&&isFinite(t)}function f(t){return r(t)&&"function"==typeof t.then&&"function"==typeof t.catch}function d(t){return null==t?"":Array.isArray(t)||u(t)&&t.toString===h?JSON.stringify(t,null,2):String(t)}function p(t){var e=parseFloat(t);return isNaN(e)?t:e}function g(t,e){for(var i=Object.create(null),n=t.split(","),r=0;r<n.length;r++)i[n[r]]=!0;return e?function(t){return i[t.toLowerCase()]}:function(t){return i[t]}}var m=g("slot,component",!0),v=g("key,ref,slot,slot-scope,is");function _(t,e){if(t.length){var i=t.indexOf(e);if(i>-1)return t.splice(i,1)}}var y=Object.prototype.hasOwnProperty;function x(t,e){return y.call(t,e)}function w(t){var e=Object.create(null);return function(i){return e[i]||(e[i]=t(i))}}var b=/-(\w)/g,C=w(function(t){return t.replace(b,function(t,e){return e?e.toUpperCase():""})}),P=w(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}),M=/\B([A-Z])/g,T=w(function(t){return t.replace(M,"-$1").toLowerCase()});var S=Function.prototype.bind?function(t,e){return t.bind(e)}:function(t,e){function i(i){var n=arguments.length;return n?n>1?t.apply(e,arguments):t.call(e,i):t.call(e)}return i._length=t.length,i};function A(t,e){e=e||0;for(var i=t.length-e,n=new Array(i);i--;)n[i]=t[i+e];return n}function E(t,e){for(var i in e)t[i]=e[i];return t}function k(t){for(var e={},i=0;i<t.length;i++)t[i]&&E(e,t[i]);return e}function R(t,e,i){}var O=function(t,e,i){return!1},L=function(t){return t};function D(t,e){if(t===e)return!0;var i=a(t),n=a(e);if(!i||!n)return!i&&!n&&String(t)===String(e);try{var r=Array.isArray(t),o=Array.isArray(e);if(r&&o)return t.length===e.length&&t.every(function(t,i){return D(t,e[i])});if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(r||o)return!1;var s=Object.keys(t),h=Object.keys(e);return s.length===h.length&&s.every(function(i){return D(t[i],e[i])})}catch(t){return!1}}function I(t,e){for(var i=0;i<t.length;i++)if(D(t[i],e))return i;return-1}function j(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}}var z="data-server-rendered",H=["component","directive","filter"],F=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],N={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:O,isReservedAttr:O,isUnknownElement:O,getTagNamespace:R,parsePlatformTagName:L,mustUseProp:O,async:!0,_lifecycleHooks:F},Z=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function G(t){var e=(t+"").charCodeAt(0);return 36===e||95===e}function B(t,e,i,n){Object.defineProperty(t,e,{value:i,enumerable:!!n,writable:!0,configurable:!0})}var W=new RegExp("[^"+Z.source+".$_\\d]");var V,$="__proto__"in{},U="undefined"!=typeof window,J="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,q=J&&WXEnvironment.platform.toLowerCase(),Y=U&&window.navigator.userAgent.toLowerCase(),X=Y&&/msie|trident/.test(Y),K=Y&&Y.indexOf("msie 9.0")>0,Q=Y&&Y.indexOf("edge/")>0,tt=(Y&&Y.indexOf("android"),Y&&/iphone|ipad|ipod|ios/.test(Y)||"ios"===q),et=(Y&&/chrome\/\d+/.test(Y),Y&&/phantomjs/.test(Y),Y&&Y.match(/firefox\/(\d+)/)),it={}.watch,nt=!1;if(U)try{var rt={};Object.defineProperty(rt,"passive",{get:function(){nt=!0}}),window.addEventListener("test-passive",null,rt)}catch(t){}var ot=function(){return void 0===V&&(V=!U&&!J&&void 0!==t&&(t.process&&"server"===t.process.env.VUE_ENV)),V},st=U&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function at(t){return"function"==typeof t&&/native code/.test(t.toString())}var ht,ut="undefined"!=typeof Symbol&&at(Symbol)&&"undefined"!=typeof Reflect&&at(Reflect.ownKeys);ht="undefined"!=typeof Set&&at(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var lt=R,ct=0,ft=function(){this.id=ct++,this.subs=[]};ft.prototype.addSub=function(t){this.subs.push(t)},ft.prototype.removeSub=function(t){_(this.subs,t)},ft.prototype.depend=function(){ft.target&&ft.target.addDep(this)},ft.prototype.notify=function(){var t=this.subs.slice();for(var e=0,i=t.length;e<i;e++)t[e].update()},ft.target=null;var dt=[];function pt(t){dt.push(t),ft.target=t}function gt(){dt.pop(),ft.target=dt[dt.length-1]}var mt=function(t,e,i,n,r,o,s,a){this.tag=t,this.data=e,this.children=i,this.text=n,this.elm=r,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=s,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=a,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},vt={child:{configurable:!0}};vt.child.get=function(){return this.componentInstance},Object.defineProperties(mt.prototype,vt);var _t=function(t){void 0===t&&(t="");var e=new mt;return e.text=t,e.isComment=!0,e};function yt(t){return new mt(void 0,void 0,void 0,String(t))}function xt(t){var e=new mt(t.tag,t.data,t.children&&t.children.slice(),t.text,t.elm,t.context,t.componentOptions,t.asyncFactory);return e.ns=t.ns,e.isStatic=t.isStatic,e.key=t.key,e.isComment=t.isComment,e.fnContext=t.fnContext,e.fnOptions=t.fnOptions,e.fnScopeId=t.fnScopeId,e.asyncMeta=t.asyncMeta,e.isCloned=!0,e}var wt=Array.prototype,bt=Object.create(wt);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(t){var e=wt[t];B(bt,t,function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];var r,o=e.apply(this,i),s=this.__ob__;switch(t){case"push":case"unshift":r=i;break;case"splice":r=i.slice(2)}return r&&s.observeArray(r),s.dep.notify(),o})});var Ct=Object.getOwnPropertyNames(bt),Pt=!0;function Mt(t){Pt=t}var Tt=function(t){var e;this.value=t,this.dep=new ft,this.vmCount=0,B(t,"__ob__",this),Array.isArray(t)?($?(e=bt,t.__proto__=e):function(t,e,i){for(var n=0,r=i.length;n<r;n++){var o=i[n];B(t,o,e[o])}}(t,bt,Ct),this.observeArray(t)):this.walk(t)};function St(t,e){var i;if(a(t)&&!(t instanceof mt))return x(t,"__ob__")&&t.__ob__ instanceof Tt?i=t.__ob__:Pt&&!ot()&&(Array.isArray(t)||u(t))&&Object.isExtensible(t)&&!t._isVue&&(i=new Tt(t)),e&&i&&i.vmCount++,i}function At(t,e,i,n,r){var o=new ft,s=Object.getOwnPropertyDescriptor(t,e);if(!s||!1!==s.configurable){var a=s&&s.get,h=s&&s.set;a&&!h||2!==arguments.length||(i=t[e]);var u=!r&&St(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var e=a?a.call(t):i;return ft.target&&(o.depend(),u&&(u.dep.depend(),Array.isArray(e)&&function t(e){for(var i=void 0,n=0,r=e.length;n<r;n++)(i=e[n])&&i.__ob__&&i.__ob__.dep.depend(),Array.isArray(i)&&t(i)}(e))),e},set:function(e){var n=a?a.call(t):i;e===n||e!=e&&n!=n||a&&!h||(h?h.call(t,e):i=e,u=!r&&St(e),o.notify())}})}}function Et(t,e,i){if(Array.isArray(t)&&c(e))return t.length=Math.max(t.length,e),t.splice(e,1,i),i;if(e in t&&!(e in Object.prototype))return t[e]=i,i;var n=t.__ob__;return t._isVue||n&&n.vmCount?i:n?(At(n.value,e,i),n.dep.notify(),i):(t[e]=i,i)}function kt(t,e){if(Array.isArray(t)&&c(e))t.splice(e,1);else{var i=t.__ob__;t._isVue||i&&i.vmCount||x(t,e)&&(delete t[e],i&&i.dep.notify())}}Tt.prototype.walk=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)At(t,e[i])},Tt.prototype.observeArray=function(t){for(var e=0,i=t.length;e<i;e++)St(t[e])};var Rt=N.optionMergeStrategies;function Ot(t,e){if(!e)return t;for(var i,n,r,o=ut?Reflect.ownKeys(e):Object.keys(e),s=0;s<o.length;s++)"__ob__"!==(i=o[s])&&(n=t[i],r=e[i],x(t,i)?n!==r&&u(n)&&u(r)&&Ot(n,r):Et(t,i,r));return t}function Lt(t,e,i){return i?function(){var n="function"==typeof e?e.call(i,i):e,r="function"==typeof t?t.call(i,i):t;return n?Ot(n,r):r}:e?t?function(){return Ot("function"==typeof e?e.call(this,this):e,"function"==typeof t?t.call(this,this):t)}:e:t}function Dt(t,e){var i=e?t?t.concat(e):Array.isArray(e)?e:[e]:t;return i?function(t){for(var e=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}(i):i}function It(t,e,i,n){var r=Object.create(t||null);return e?E(r,e):r}Rt.data=function(t,e,i){return i?Lt(t,e,i):e&&"function"!=typeof e?t:Lt(t,e)},F.forEach(function(t){Rt[t]=Dt}),H.forEach(function(t){Rt[t+"s"]=It}),Rt.watch=function(t,e,i,n){if(t===it&&(t=void 0),e===it&&(e=void 0),!e)return Object.create(t||null);if(!t)return e;var r={};for(var o in E(r,t),e){var s=r[o],a=e[o];s&&!Array.isArray(s)&&(s=[s]),r[o]=s?s.concat(a):Array.isArray(a)?a:[a]}return r},Rt.props=Rt.methods=Rt.inject=Rt.computed=function(t,e,i,n){if(!t)return e;var r=Object.create(null);return E(r,t),e&&E(r,e),r},Rt.provide=Lt;var jt=function(t,e){return void 0===e?t:e};function zt(t,e,i){if("function"==typeof e&&(e=e.options),function(t,e){var i=t.props;if(i){var n,r,o={};if(Array.isArray(i))for(n=i.length;n--;)"string"==typeof(r=i[n])&&(o[C(r)]={type:null});else if(u(i))for(var s in i)r=i[s],o[C(s)]=u(r)?r:{type:r};t.props=o}}(e),function(t,e){var i=t.inject;if(i){var n=t.inject={};if(Array.isArray(i))for(var r=0;r<i.length;r++)n[i[r]]={from:i[r]};else if(u(i))for(var o in i){var s=i[o];n[o]=u(s)?E({from:o},s):{from:s}}}}(e),function(t){var e=t.directives;if(e)for(var i in e){var n=e[i];"function"==typeof n&&(e[i]={bind:n,update:n})}}(e),!e._base&&(e.extends&&(t=zt(t,e.extends,i)),e.mixins))for(var n=0,r=e.mixins.length;n<r;n++)t=zt(t,e.mixins[n],i);var o,s={};for(o in t)a(o);for(o in e)x(t,o)||a(o);function a(n){var r=Rt[n]||jt;s[n]=r(t[n],e[n],i,n)}return s}function Ht(t,e,i,n){if("string"==typeof i){var r=t[e];if(x(r,i))return r[i];var o=C(i);if(x(r,o))return r[o];var s=P(o);return x(r,s)?r[s]:r[i]||r[o]||r[s]}}function Ft(t,e,i,n){var r=e[t],o=!x(i,t),s=i[t],a=Bt(Boolean,r.type);if(a>-1)if(o&&!x(r,"default"))s=!1;else if(""===s||s===T(t)){var h=Bt(String,r.type);(h<0||a<h)&&(s=!0)}if(void 0===s){s=function(t,e,i){if(!x(e,"default"))return;var n=e.default;0;if(t&&t.$options.propsData&&void 0===t.$options.propsData[i]&&void 0!==t._props[i])return t._props[i];return"function"==typeof n&&"Function"!==Zt(e.type)?n.call(t):n}(n,r,t);var u=Pt;Mt(!0),St(s),Mt(u)}return s}var Nt=/^\s*function (\w+)/;function Zt(t){var e=t&&t.toString().match(Nt);return e?e[1]:""}function Gt(t,e){return Zt(t)===Zt(e)}function Bt(t,e){if(!Array.isArray(e))return Gt(e,t)?0:-1;for(var i=0,n=e.length;i<n;i++)if(Gt(e[i],t))return i;return-1}function Wt(t,e,i){pt();try{if(e)for(var n=e;n=n.$parent;){var r=n.$options.errorCaptured;if(r)for(var o=0;o<r.length;o++)try{if(!1===r[o].call(n,t,e,i))return}catch(t){$t(t,n,"errorCaptured hook")}}$t(t,e,i)}finally{gt()}}function Vt(t,e,i,n,r){var o;try{(o=i?t.apply(e,i):t.call(e))&&!o._isVue&&f(o)&&!o._handled&&(o.catch(function(t){return Wt(t,n,r+" (Promise/async)")}),o._handled=!0)}catch(t){Wt(t,n,r)}return o}function $t(t,e,i){if(N.errorHandler)try{return N.errorHandler.call(null,t,e,i)}catch(e){e!==t&&Ut(e,null,"config.errorHandler")}Ut(t,e,i)}function Ut(t,e,i){if(!U&&!J||"undefined"==typeof console)throw t;console.error(t)}var Jt,qt=!1,Yt=[],Xt=!1;function Kt(){Xt=!1;var t=Yt.slice(0);Yt.length=0;for(var e=0;e<t.length;e++)t[e]()}if("undefined"!=typeof Promise&&at(Promise)){var Qt=Promise.resolve();Jt=function(){Qt.then(Kt),tt&&setTimeout(R)},qt=!0}else if(X||"undefined"==typeof MutationObserver||!at(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Jt="undefined"!=typeof setImmediate&&at(setImmediate)?function(){setImmediate(Kt)}:function(){setTimeout(Kt,0)};else{var te=1,ee=new MutationObserver(Kt),ie=document.createTextNode(String(te));ee.observe(ie,{characterData:!0}),Jt=function(){te=(te+1)%2,ie.data=String(te)},qt=!0}function ne(t,e){var i;if(Yt.push(function(){if(t)try{t.call(e)}catch(t){Wt(t,e,"nextTick")}else i&&i(e)}),Xt||(Xt=!0,Jt()),!t&&"undefined"!=typeof Promise)return new Promise(function(t){i=t})}var re=new ht;function oe(t){!function t(e,i){var n,r;var o=Array.isArray(e);if(!o&&!a(e)||Object.isFrozen(e)||e instanceof mt)return;if(e.__ob__){var s=e.__ob__.dep.id;if(i.has(s))return;i.add(s)}if(o)for(n=e.length;n--;)t(e[n],i);else for(r=Object.keys(e),n=r.length;n--;)t(e[r[n]],i)}(t,re),re.clear()}var se=w(function(t){var e="&"===t.charAt(0),i="~"===(t=e?t.slice(1):t).charAt(0),n="!"===(t=i?t.slice(1):t).charAt(0);return{name:t=n?t.slice(1):t,once:i,capture:n,passive:e}});function ae(t,e){function i(){var t=arguments,n=i.fns;if(!Array.isArray(n))return Vt(n,null,arguments,e,"v-on handler");for(var r=n.slice(),o=0;o<r.length;o++)Vt(r[o],null,t,e,"v-on handler")}return i.fns=t,i}function he(t,e,i,r,s,a){var h,u,l,c;for(h in t)u=t[h],l=e[h],c=se(h),n(u)||(n(l)?(n(u.fns)&&(u=t[h]=ae(u,a)),o(c.once)&&(u=t[h]=s(c.name,u,c.capture)),i(c.name,u,c.capture,c.passive,c.params)):u!==l&&(l.fns=u,t[h]=l));for(h in e)n(t[h])&&r((c=se(h)).name,e[h],c.capture)}function ue(t,e,i){var s;t instanceof mt&&(t=t.data.hook||(t.data.hook={}));var a=t[e];function h(){i.apply(this,arguments),_(s.fns,h)}n(a)?s=ae([h]):r(a.fns)&&o(a.merged)?(s=a).fns.push(h):s=ae([a,h]),s.merged=!0,t[e]=s}function le(t,e,i,n,o){if(r(e)){if(x(e,i))return t[i]=e[i],o||delete e[i],!0;if(x(e,n))return t[i]=e[n],o||delete e[n],!0}return!1}function ce(t){return s(t)?[yt(t)]:Array.isArray(t)?function t(e,i){var a=[];var h,u,l,c;for(h=0;h<e.length;h++)n(u=e[h])||"boolean"==typeof u||(l=a.length-1,c=a[l],Array.isArray(u)?u.length>0&&(fe((u=t(u,(i||"")+"_"+h))[0])&&fe(c)&&(a[l]=yt(c.text+u[0].text),u.shift()),a.push.apply(a,u)):s(u)?fe(c)?a[l]=yt(c.text+u):""!==u&&a.push(yt(u)):fe(u)&&fe(c)?a[l]=yt(c.text+u.text):(o(e._isVList)&&r(u.tag)&&n(u.key)&&r(i)&&(u.key="__vlist"+i+"_"+h+"__"),a.push(u)));return a}(t):void 0}function fe(t){return r(t)&&r(t.text)&&!1===t.isComment}function de(t,e){if(t){for(var i=Object.create(null),n=ut?Reflect.ownKeys(t):Object.keys(t),r=0;r<n.length;r++){var o=n[r];if("__ob__"!==o){for(var s=t[o].from,a=e;a;){if(a._provided&&x(a._provided,s)){i[o]=a._provided[s];break}a=a.$parent}if(!a)if("default"in t[o]){var h=t[o].default;i[o]="function"==typeof h?h.call(e):h}else 0}}return i}}function pe(t,e){if(!t||!t.length)return{};for(var i={},n=0,r=t.length;n<r;n++){var o=t[n],s=o.data;if(s&&s.attrs&&s.attrs.slot&&delete s.attrs.slot,o.context!==e&&o.fnContext!==e||!s||null==s.slot)(i.default||(i.default=[])).push(o);else{var a=s.slot,h=i[a]||(i[a]=[]);"template"===o.tag?h.push.apply(h,o.children||[]):h.push(o)}}for(var u in i)i[u].every(ge)&&delete i[u];return i}function ge(t){return t.isComment&&!t.asyncFactory||" "===t.text}function me(t){return t.isComment&&t.asyncFactory}function ve(t,e,n){var r,o=Object.keys(e).length>0,s=t?!!t.$stable:!o,a=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(s&&n&&n!==i&&a===n.$key&&!o&&!n.$hasNormal)return n;for(var h in r={},t)t[h]&&"$"!==h[0]&&(r[h]=_e(e,h,t[h]))}else r={};for(var u in e)u in r||(r[u]=ye(e,u));return t&&Object.isExtensible(t)&&(t._normalized=r),B(r,"$stable",s),B(r,"$key",a),B(r,"$hasNormal",o),r}function _e(t,e,i){var n=function(){var t=arguments.length?i.apply(null,arguments):i({}),e=(t=t&&"object"==typeof t&&!Array.isArray(t)?[t]:ce(t))&&t[0];return t&&(!e||1===t.length&&e.isComment&&!me(e))?void 0:t};return i.proxy&&Object.defineProperty(t,e,{get:n,enumerable:!0,configurable:!0}),n}function ye(t,e){return function(){return t[e]}}function xe(t,e){var i,n,o,s,h;if(Array.isArray(t)||"string"==typeof t)for(i=new Array(t.length),n=0,o=t.length;n<o;n++)i[n]=e(t[n],n);else if("number"==typeof t)for(i=new Array(t),n=0;n<t;n++)i[n]=e(n+1,n);else if(a(t))if(ut&&t[Symbol.iterator]){i=[];for(var u=t[Symbol.iterator](),l=u.next();!l.done;)i.push(e(l.value,i.length)),l=u.next()}else for(s=Object.keys(t),i=new Array(s.length),n=0,o=s.length;n<o;n++)h=s[n],i[n]=e(t[h],h,n);return r(i)||(i=[]),i._isVList=!0,i}function we(t,e,i,n){var r,o=this.$scopedSlots[t];o?(i=i||{},n&&(i=E(E({},n),i)),r=o(i)||("function"==typeof e?e():e)):r=this.$slots[t]||("function"==typeof e?e():e);var s=i&&i.slot;return s?this.$createElement("template",{slot:s},r):r}function be(t){return Ht(this.$options,"filters",t)||L}function Ce(t,e){return Array.isArray(t)?-1===t.indexOf(e):t!==e}function Pe(t,e,i,n,r){var o=N.keyCodes[e]||i;return r&&n&&!N.keyCodes[e]?Ce(r,n):o?Ce(o,t):n?T(n)!==e:void 0===t}function Me(t,e,i,n,r){if(i)if(a(i)){var o;Array.isArray(i)&&(i=k(i));var s=function(s){if("class"===s||"style"===s||v(s))o=t;else{var a=t.attrs&&t.attrs.type;o=n||N.mustUseProp(e,a,s)?t.domProps||(t.domProps={}):t.attrs||(t.attrs={})}var h=C(s),u=T(s);h in o||u in o||(o[s]=i[s],r&&((t.on||(t.on={}))["update:"+s]=function(t){i[s]=t}))};for(var h in i)s(h)}else;return t}function Te(t,e){var i=this._staticTrees||(this._staticTrees=[]),n=i[t];return n&&!e?n:(Ae(n=i[t]=this.$options.staticRenderFns[t].call(this._renderProxy,null,this),"__static__"+t,!1),n)}function Se(t,e,i){return Ae(t,"__once__"+e+(i?"_"+i:""),!0),t}function Ae(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n]&&"string"!=typeof t[n]&&Ee(t[n],e+"_"+n,i);else Ee(t,e,i)}function Ee(t,e,i){t.isStatic=!0,t.key=e,t.isOnce=i}function ke(t,e){if(e)if(u(e)){var i=t.on=t.on?E({},t.on):{};for(var n in e){var r=i[n],o=e[n];i[n]=r?[].concat(r,o):o}}else;return t}function Re(t,e,i,n){e=e||{$stable:!i};for(var r=0;r<t.length;r++){var o=t[r];Array.isArray(o)?Re(o,e,i):o&&(o.proxy&&(o.fn.proxy=!0),e[o.key]=o.fn)}return n&&(e.$key=n),e}function Oe(t,e){for(var i=0;i<e.length;i+=2){var n=e[i];"string"==typeof n&&n&&(t[e[i]]=e[i+1])}return t}function Le(t,e){return"string"==typeof t?e+t:t}function De(t){t._o=Se,t._n=p,t._s=d,t._l=xe,t._t=we,t._q=D,t._i=I,t._m=Te,t._f=be,t._k=Pe,t._b=Me,t._v=yt,t._e=_t,t._u=Re,t._g=ke,t._d=Oe,t._p=Le}function Ie(t,e,n,r,s){var a,h=this,u=s.options;x(r,"_uid")?(a=Object.create(r))._original=r:(a=r,r=r._original);var l=o(u._compiled),c=!l;this.data=t,this.props=e,this.children=n,this.parent=r,this.listeners=t.on||i,this.injections=de(u.inject,r),this.slots=function(){return h.$slots||ve(t.scopedSlots,h.$slots=pe(n,r)),h.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ve(t.scopedSlots,this.slots())}}),l&&(this.$options=u,this.$slots=this.slots(),this.$scopedSlots=ve(t.scopedSlots,this.$slots)),u._scopeId?this._c=function(t,e,i,n){var o=We(a,t,e,i,n,c);return o&&!Array.isArray(o)&&(o.fnScopeId=u._scopeId,o.fnContext=r),o}:this._c=function(t,e,i,n){return We(a,t,e,i,n,c)}}function je(t,e,i,n,r){var o=xt(t);return o.fnContext=i,o.fnOptions=n,e.slot&&((o.data||(o.data={})).slot=e.slot),o}function ze(t,e){for(var i in e)t[C(i)]=e[i]}De(Ie.prototype);var He={init:function(t,e){if(t.componentInstance&&!t.componentInstance._isDestroyed&&t.data.keepAlive){var i=t;He.prepatch(i,i)}else{(t.componentInstance=function(t,e){var i={_isComponent:!0,_parentVnode:t,parent:e},n=t.data.inlineTemplate;r(n)&&(i.render=n.render,i.staticRenderFns=n.staticRenderFns);return new t.componentOptions.Ctor(i)}(t,Qe)).$mount(e?t.elm:void 0,e)}},prepatch:function(t,e){var n=e.componentOptions;!function(t,e,n,r,o){0;var s=r.data.scopedSlots,a=t.$scopedSlots,h=!!(s&&!s.$stable||a!==i&&!a.$stable||s&&t.$scopedSlots.$key!==s.$key||!s&&t.$scopedSlots.$key),u=!!(o||t.$options._renderChildren||h);t.$options._parentVnode=r,t.$vnode=r,t._vnode&&(t._vnode.parent=r);if(t.$options._renderChildren=o,t.$attrs=r.data.attrs||i,t.$listeners=n||i,e&&t.$options.props){Mt(!1);for(var l=t._props,c=t.$options._propKeys||[],f=0;f<c.length;f++){var d=c[f],p=t.$options.props;l[d]=Ft(d,p,e,t)}Mt(!0),t.$options.propsData=e}n=n||i;var g=t.$options._parentListeners;t.$options._parentListeners=n,Ke(t,n,g),u&&(t.$slots=pe(o,r.context),t.$forceUpdate());0}(e.componentInstance=t.componentInstance,n.propsData,n.listeners,e,n.children)},insert:function(t){var e,i=t.context,n=t.componentInstance;n._isMounted||(n._isMounted=!0,ni(n,"mounted")),t.data.keepAlive&&(i._isMounted?((e=n)._inactive=!1,oi.push(e)):ii(n,!0))},destroy:function(t){var e=t.componentInstance;e._isDestroyed||(t.data.keepAlive?function t(e,i){if(i&&(e._directInactive=!0,ei(e)))return;if(!e._inactive){e._inactive=!0;for(var n=0;n<e.$children.length;n++)t(e.$children[n]);ni(e,"deactivated")}}(e,!0):e.$destroy())}},Fe=Object.keys(He);function Ne(t,e,s,h,u){if(!n(t)){var l=s.$options._base;if(a(t)&&(t=l.extend(t)),"function"==typeof t){var c;if(n(t.cid)&&void 0===(t=function(t,e){if(o(t.error)&&r(t.errorComp))return t.errorComp;if(r(t.resolved))return t.resolved;var i=$e;i&&r(t.owners)&&-1===t.owners.indexOf(i)&&t.owners.push(i);if(o(t.loading)&&r(t.loadingComp))return t.loadingComp;if(i&&!r(t.owners)){var s=t.owners=[i],h=!0,u=null,l=null;i.$on("hook:destroyed",function(){return _(s,i)});var c=function(t){for(var e=0,i=s.length;e<i;e++)s[e].$forceUpdate();t&&(s.length=0,null!==u&&(clearTimeout(u),u=null),null!==l&&(clearTimeout(l),l=null))},d=j(function(i){t.resolved=Ue(i,e),h?s.length=0:c(!0)}),p=j(function(e){r(t.errorComp)&&(t.error=!0,c(!0))}),g=t(d,p);return a(g)&&(f(g)?n(t.resolved)&&g.then(d,p):f(g.component)&&(g.component.then(d,p),r(g.error)&&(t.errorComp=Ue(g.error,e)),r(g.loading)&&(t.loadingComp=Ue(g.loading,e),0===g.delay?t.loading=!0:u=setTimeout(function(){u=null,n(t.resolved)&&n(t.error)&&(t.loading=!0,c(!1))},g.delay||200)),r(g.timeout)&&(l=setTimeout(function(){l=null,n(t.resolved)&&p(null)},g.timeout)))),h=!1,t.loading?t.loadingComp:t.resolved}}(c=t,l)))return function(t,e,i,n,r){var o=_t();return o.asyncFactory=t,o.asyncMeta={data:e,context:i,children:n,tag:r},o}(c,e,s,h,u);e=e||{},Mi(t),r(e.model)&&function(t,e){var i=t.model&&t.model.prop||"value",n=t.model&&t.model.event||"input";(e.attrs||(e.attrs={}))[i]=e.model.value;var o=e.on||(e.on={}),s=o[n],a=e.model.callback;r(s)?(Array.isArray(s)?-1===s.indexOf(a):s!==a)&&(o[n]=[a].concat(s)):o[n]=a}(t.options,e);var d=function(t,e,i){var o=e.options.props;if(!n(o)){var s={},a=t.attrs,h=t.props;if(r(a)||r(h))for(var u in o){var l=T(u);le(s,h,u,l,!0)||le(s,a,u,l,!1)}return s}}(e,t);if(o(t.options.functional))return function(t,e,n,o,s){var a=t.options,h={},u=a.props;if(r(u))for(var l in u)h[l]=Ft(l,u,e||i);else r(n.attrs)&&ze(h,n.attrs),r(n.props)&&ze(h,n.props);var c=new Ie(n,h,s,o,t),f=a.render.call(null,c._c,c);if(f instanceof mt)return je(f,n,c.parent,a);if(Array.isArray(f)){for(var d=ce(f)||[],p=new Array(d.length),g=0;g<d.length;g++)p[g]=je(d[g],n,c.parent,a);return p}}(t,d,e,s,h);var p=e.on;if(e.on=e.nativeOn,o(t.options.abstract)){var g=e.slot;e={},g&&(e.slot=g)}!function(t){for(var e=t.hook||(t.hook={}),i=0;i<Fe.length;i++){var n=Fe[i],r=e[n],o=He[n];r===o||r&&r._merged||(e[n]=r?Ze(o,r):o)}}(e);var m=t.options.name||u;return new mt("vue-component-"+t.cid+(m?"-"+m:""),e,void 0,void 0,void 0,s,{Ctor:t,propsData:d,listeners:p,tag:u,children:h},c)}}}function Ze(t,e){var i=function(i,n){t(i,n),e(i,n)};return i._merged=!0,i}var Ge=1,Be=2;function We(t,e,i,h,u,l){return(Array.isArray(i)||s(i))&&(u=h,h=i,i=void 0),o(l)&&(u=Be),function(t,e,i,s,h){if(r(i)&&r(i.__ob__))return _t();r(i)&&r(i.is)&&(e=i.is);if(!e)return _t();0;Array.isArray(s)&&"function"==typeof s[0]&&((i=i||{}).scopedSlots={default:s[0]},s.length=0);h===Be?s=ce(s):h===Ge&&(s=function(t){for(var e=0;e<t.length;e++)if(Array.isArray(t[e]))return Array.prototype.concat.apply([],t);return t}(s));var u,l;if("string"==typeof e){var c;l=t.$vnode&&t.$vnode.ns||N.getTagNamespace(e),u=N.isReservedTag(e)?new mt(N.parsePlatformTagName(e),i,s,void 0,void 0,t):i&&i.pre||!r(c=Ht(t.$options,"components",e))?new mt(e,i,s,void 0,void 0,t):Ne(c,i,t,s,e)}else u=Ne(e,i,t,s);return Array.isArray(u)?u:r(u)?(r(l)&&function t(e,i,s){e.ns=i;"foreignObject"===e.tag&&(i=void 0,s=!0);if(r(e.children))for(var a=0,h=e.children.length;a<h;a++){var u=e.children[a];r(u.tag)&&(n(u.ns)||o(s)&&"svg"!==u.tag)&&t(u,i,s)}}(u,l),r(i)&&function(t){a(t.style)&&oe(t.style);a(t.class)&&oe(t.class)}(i),u):_t()}(t,e,i,h,u)}var Ve,$e=null;function Ue(t,e){return(t.__esModule||ut&&"Module"===t[Symbol.toStringTag])&&(t=t.default),a(t)?e.extend(t):t}function Je(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];if(r(i)&&(r(i.componentOptions)||me(i)))return i}}function qe(t,e){Ve.$on(t,e)}function Ye(t,e){Ve.$off(t,e)}function Xe(t,e){var i=Ve;return function n(){null!==e.apply(null,arguments)&&i.$off(t,n)}}function Ke(t,e,i){Ve=t,he(e,i||{},qe,Ye,Xe,t),Ve=void 0}var Qe=null;function ti(t){var e=Qe;return Qe=t,function(){Qe=e}}function ei(t){for(;t&&(t=t.$parent);)if(t._inactive)return!0;return!1}function ii(t,e){if(e){if(t._directInactive=!1,ei(t))return}else if(t._directInactive)return;if(t._inactive||null===t._inactive){t._inactive=!1;for(var i=0;i<t.$children.length;i++)ii(t.$children[i]);ni(t,"activated")}}function ni(t,e){pt();var i=t.$options[e],n=e+" hook";if(i)for(var r=0,o=i.length;r<o;r++)Vt(i[r],t,null,t,n);t._hasHookEvent&&t.$emit("hook:"+e),gt()}var ri=[],oi=[],si={},ai=!1,hi=!1,ui=0;var li=0,ci=Date.now;if(U&&!X){var fi=window.performance;fi&&"function"==typeof fi.now&&ci()>document.createEvent("Event").timeStamp&&(ci=function(){return fi.now()})}function di(){var t,e;for(li=ci(),hi=!0,ri.sort(function(t,e){return t.id-e.id}),ui=0;ui<ri.length;ui++)(t=ri[ui]).before&&t.before(),e=t.id,si[e]=null,t.run();var i=oi.slice(),n=ri.slice();ui=ri.length=oi.length=0,si={},ai=hi=!1,function(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,ii(t[e],!0)}(i),function(t){var e=t.length;for(;e--;){var i=t[e],n=i.vm;n._watcher===i&&n._isMounted&&!n._isDestroyed&&ni(n,"updated")}}(n),st&&N.devtools&&st.emit("flush")}var pi=0,gi=function(t,e,i,n,r){this.vm=t,r&&(t._watcher=this),t._watchers.push(this),n?(this.deep=!!n.deep,this.user=!!n.user,this.lazy=!!n.lazy,this.sync=!!n.sync,this.before=n.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=i,this.id=++pi,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ht,this.newDepIds=new ht,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(t){if(!W.test(t)){var e=t.split(".");return function(t){for(var i=0;i<e.length;i++){if(!t)return;t=t[e[i]]}return t}}}(e),this.getter||(this.getter=R)),this.value=this.lazy?void 0:this.get()};gi.prototype.get=function(){var t;pt(this);var e=this.vm;try{t=this.getter.call(e,e)}catch(t){if(!this.user)throw t;Wt(t,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&oe(t),gt(),this.cleanupDeps()}return t},gi.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},gi.prototype.cleanupDeps=function(){for(var t=this.deps.length;t--;){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var i=this.depIds;this.depIds=this.newDepIds,this.newDepIds=i,this.newDepIds.clear(),i=this.deps,this.deps=this.newDeps,this.newDeps=i,this.newDeps.length=0},gi.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(t){var e=t.id;if(null==si[e]){if(si[e]=!0,hi){for(var i=ri.length-1;i>ui&&ri[i].id>t.id;)i--;ri.splice(i+1,0,t)}else ri.push(t);ai||(ai=!0,ne(di))}}(this)},gi.prototype.run=function(){if(this.active){var t=this.get();if(t!==this.value||a(t)||this.deep){var e=this.value;if(this.value=t,this.user){var i='callback for watcher "'+this.expression+'"';Vt(this.cb,this.vm,[t,e],this.vm,i)}else this.cb.call(this.vm,t,e)}}},gi.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},gi.prototype.depend=function(){for(var t=this.deps.length;t--;)this.deps[t].depend()},gi.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||_(this.vm._watchers,this);for(var t=this.deps.length;t--;)this.deps[t].removeSub(this);this.active=!1}};var mi={enumerable:!0,configurable:!0,get:R,set:R};function vi(t,e,i){mi.get=function(){return this[e][i]},mi.set=function(t){this[e][i]=t},Object.defineProperty(t,i,mi)}function _i(t){t._watchers=[];var e=t.$options;e.props&&function(t,e){var i=t.$options.propsData||{},n=t._props={},r=t.$options._propKeys=[],o=!t.$parent;o||Mt(!1);var s=function(o){r.push(o);var s=Ft(o,e,i,t);At(n,o,s),o in t||vi(t,"_props",o)};for(var a in e)s(a);Mt(!0)}(t,e.props),e.methods&&function(t,e){t.$options.props;for(var i in e)t[i]="function"!=typeof e[i]?R:S(e[i],t)}(t,e.methods),e.data?function(t){var e=t.$options.data;u(e=t._data="function"==typeof e?function(t,e){pt();try{return t.call(e,e)}catch(t){return Wt(t,e,"data()"),{}}finally{gt()}}(e,t):e||{})||(e={});var i=Object.keys(e),n=t.$options.props,r=(t.$options.methods,i.length);for(;r--;){var o=i[r];0,n&&x(n,o)||G(o)||vi(t,"_data",o)}St(e,!0)}(t):St(t._data={},!0),e.computed&&function(t,e){var i=t._computedWatchers=Object.create(null),n=ot();for(var r in e){var o=e[r],s="function"==typeof o?o:o.get;0,n||(i[r]=new gi(t,s||R,R,yi)),r in t||xi(t,r,o)}}(t,e.computed),e.watch&&e.watch!==it&&function(t,e){for(var i in e){var n=e[i];if(Array.isArray(n))for(var r=0;r<n.length;r++)Ci(t,i,n[r]);else Ci(t,i,n)}}(t,e.watch)}var yi={lazy:!0};function xi(t,e,i){var n=!ot();"function"==typeof i?(mi.get=n?wi(e):bi(i),mi.set=R):(mi.get=i.get?n&&!1!==i.cache?wi(e):bi(i.get):R,mi.set=i.set||R),Object.defineProperty(t,e,mi)}function wi(t){return function(){var e=this._computedWatchers&&this._computedWatchers[t];if(e)return e.dirty&&e.evaluate(),ft.target&&e.depend(),e.value}}function bi(t){return function(){return t.call(this,this)}}function Ci(t,e,i,n){return u(i)&&(n=i,i=i.handler),"string"==typeof i&&(i=t[i]),t.$watch(e,i,n)}var Pi=0;function Mi(t){var e=t.options;if(t.super){var i=Mi(t.super);if(i!==t.superOptions){t.superOptions=i;var n=function(t){var e,i=t.options,n=t.sealedOptions;for(var r in i)i[r]!==n[r]&&(e||(e={}),e[r]=i[r]);return e}(t);n&&E(t.extendOptions,n),(e=t.options=zt(i,t.extendOptions)).name&&(e.components[e.name]=t)}}return e}function Ti(t){this._init(t)}function Si(t){t.cid=0;var e=1;t.extend=function(t){t=t||{};var i=this,n=i.cid,r=t._Ctor||(t._Ctor={});if(r[n])return r[n];var o=t.name||i.options.name;var s=function(t){this._init(t)};return(s.prototype=Object.create(i.prototype)).constructor=s,s.cid=e++,s.options=zt(i.options,t),s.super=i,s.options.props&&function(t){var e=t.options.props;for(var i in e)vi(t.prototype,"_props",i)}(s),s.options.computed&&function(t){var e=t.options.computed;for(var i in e)xi(t.prototype,i,e[i])}(s),s.extend=i.extend,s.mixin=i.mixin,s.use=i.use,H.forEach(function(t){s[t]=i[t]}),o&&(s.options.components[o]=s),s.superOptions=i.options,s.extendOptions=t,s.sealedOptions=E({},s.options),r[n]=s,s}}function Ai(t){return t&&(t.Ctor.options.name||t.tag)}function Ei(t,e){return Array.isArray(t)?t.indexOf(e)>-1:"string"==typeof t?t.split(",").indexOf(e)>-1:!!l(t)&&t.test(e)}function ki(t,e){var i=t.cache,n=t.keys,r=t._vnode;for(var o in i){var s=i[o];if(s){var a=s.name;a&&!e(a)&&Ri(i,o,n,r)}}}function Ri(t,e,i,n){var r=t[e];!r||n&&r.tag===n.tag||r.componentInstance.$destroy(),t[e]=null,_(i,e)}!function(t){t.prototype._init=function(t){var e=this;e._uid=Pi++,e._isVue=!0,t&&t._isComponent?function(t,e){var i=t.$options=Object.create(t.constructor.options),n=e._parentVnode;i.parent=e.parent,i._parentVnode=n;var r=n.componentOptions;i.propsData=r.propsData,i._parentListeners=r.listeners,i._renderChildren=r.children,i._componentTag=r.tag,e.render&&(i.render=e.render,i.staticRenderFns=e.staticRenderFns)}(e,t):e.$options=zt(Mi(e.constructor),t||{},e),e._renderProxy=e,e._self=e,function(t){var e=t.$options,i=e.parent;if(i&&!e.abstract){for(;i.$options.abstract&&i.$parent;)i=i.$parent;i.$children.push(t)}t.$parent=i,t.$root=i?i.$root:t,t.$children=[],t.$refs={},t._watcher=null,t._inactive=null,t._directInactive=!1,t._isMounted=!1,t._isDestroyed=!1,t._isBeingDestroyed=!1}(e),function(t){t._events=Object.create(null),t._hasHookEvent=!1;var e=t.$options._parentListeners;e&&Ke(t,e)}(e),function(t){t._vnode=null,t._staticTrees=null;var e=t.$options,n=t.$vnode=e._parentVnode,r=n&&n.context;t.$slots=pe(e._renderChildren,r),t.$scopedSlots=i,t._c=function(e,i,n,r){return We(t,e,i,n,r,!1)},t.$createElement=function(e,i,n,r){return We(t,e,i,n,r,!0)};var o=n&&n.data;At(t,"$attrs",o&&o.attrs||i,null,!0),At(t,"$listeners",e._parentListeners||i,null,!0)}(e),ni(e,"beforeCreate"),function(t){var e=de(t.$options.inject,t);e&&(Mt(!1),Object.keys(e).forEach(function(i){At(t,i,e[i])}),Mt(!0))}(e),_i(e),function(t){var e=t.$options.provide;e&&(t._provided="function"==typeof e?e.call(t):e)}(e),ni(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(Ti),function(t){var e={get:function(){return this._data}},i={get:function(){return this._props}};Object.defineProperty(t.prototype,"$data",e),Object.defineProperty(t.prototype,"$props",i),t.prototype.$set=Et,t.prototype.$delete=kt,t.prototype.$watch=function(t,e,i){if(u(e))return Ci(this,t,e,i);(i=i||{}).user=!0;var n=new gi(this,t,e,i);if(i.immediate){var r='callback for immediate watcher "'+n.expression+'"';pt(),Vt(e,this,[n.value],this,r),gt()}return function(){n.teardown()}}}(Ti),function(t){var e=/^hook:/;t.prototype.$on=function(t,i){var n=this;if(Array.isArray(t))for(var r=0,o=t.length;r<o;r++)n.$on(t[r],i);else(n._events[t]||(n._events[t]=[])).push(i),e.test(t)&&(n._hasHookEvent=!0);return n},t.prototype.$once=function(t,e){var i=this;function n(){i.$off(t,n),e.apply(i,arguments)}return n.fn=e,i.$on(t,n),i},t.prototype.$off=function(t,e){var i=this;if(!arguments.length)return i._events=Object.create(null),i;if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)i.$off(t[n],e);return i}var o,s=i._events[t];if(!s)return i;if(!e)return i._events[t]=null,i;for(var a=s.length;a--;)if((o=s[a])===e||o.fn===e){s.splice(a,1);break}return i},t.prototype.$emit=function(t){var e=this,i=e._events[t];if(i){i=i.length>1?A(i):i;for(var n=A(arguments,1),r='event handler for "'+t+'"',o=0,s=i.length;o<s;o++)Vt(i[o],e,n,e,r)}return e}}(Ti),function(t){t.prototype._update=function(t,e){var i=this,n=i.$el,r=i._vnode,o=ti(i);i._vnode=t,i.$el=r?i.__patch__(r,t):i.__patch__(i.$el,t,e,!1),o(),n&&(n.__vue__=null),i.$el&&(i.$el.__vue__=i),i.$vnode&&i.$parent&&i.$vnode===i.$parent._vnode&&(i.$parent.$el=i.$el)},t.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},t.prototype.$destroy=function(){var t=this;if(!t._isBeingDestroyed){ni(t,"beforeDestroy"),t._isBeingDestroyed=!0;var e=t.$parent;!e||e._isBeingDestroyed||t.$options.abstract||_(e.$children,t),t._watcher&&t._watcher.teardown();for(var i=t._watchers.length;i--;)t._watchers[i].teardown();t._data.__ob__&&t._data.__ob__.vmCount--,t._isDestroyed=!0,t.__patch__(t._vnode,null),ni(t,"destroyed"),t.$off(),t.$el&&(t.$el.__vue__=null),t.$vnode&&(t.$vnode.parent=null)}}}(Ti),function(t){De(t.prototype),t.prototype.$nextTick=function(t){return ne(t,this)},t.prototype._render=function(){var t,e=this,i=e.$options,n=i.render,r=i._parentVnode;r&&(e.$scopedSlots=ve(r.data.scopedSlots,e.$slots,e.$scopedSlots)),e.$vnode=r;try{$e=e,t=n.call(e._renderProxy,e.$createElement)}catch(i){Wt(i,e,"render"),t=e._vnode}finally{$e=null}return Array.isArray(t)&&1===t.length&&(t=t[0]),t instanceof mt||(t=_t()),t.parent=r,t}}(Ti);var Oi=[String,RegExp,Array],Li={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Oi,exclude:Oi,max:[String,Number]},methods:{cacheVNode:function(){var t=this.cache,e=this.keys,i=this.vnodeToCache,n=this.keyToCache;if(i){var r=i.tag,o=i.componentInstance,s=i.componentOptions;t[n]={name:Ai(s),tag:r,componentInstance:o},e.push(n),this.max&&e.length>parseInt(this.max)&&Ri(t,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var t in this.cache)Ri(this.cache,t,this.keys)},mounted:function(){var t=this;this.cacheVNode(),this.$watch("include",function(e){ki(t,function(t){return Ei(e,t)})}),this.$watch("exclude",function(e){ki(t,function(t){return!Ei(e,t)})})},updated:function(){this.cacheVNode()},render:function(){var t=this.$slots.default,e=Je(t),i=e&&e.componentOptions;if(i){var n=Ai(i),r=this.include,o=this.exclude;if(r&&(!n||!Ei(r,n))||o&&n&&Ei(o,n))return e;var s=this.cache,a=this.keys,h=null==e.key?i.Ctor.cid+(i.tag?"::"+i.tag:""):e.key;s[h]?(e.componentInstance=s[h].componentInstance,_(a,h),a.push(h)):(this.vnodeToCache=e,this.keyToCache=h),e.data.keepAlive=!0}return e||t&&t[0]}}};!function(t){var e={get:function(){return N}};Object.defineProperty(t,"config",e),t.util={warn:lt,extend:E,mergeOptions:zt,defineReactive:At},t.set=Et,t.delete=kt,t.nextTick=ne,t.observable=function(t){return St(t),t},t.options=Object.create(null),H.forEach(function(e){t.options[e+"s"]=Object.create(null)}),t.options._base=t,E(t.options.components,Li),function(t){t.use=function(t){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(t)>-1)return this;var i=A(arguments,1);return i.unshift(this),"function"==typeof t.install?t.install.apply(t,i):"function"==typeof t&&t.apply(null,i),e.push(t),this}}(t),function(t){t.mixin=function(t){return this.options=zt(this.options,t),this}}(t),Si(t),function(t){H.forEach(function(e){t[e]=function(t,i){return i?("component"===e&&u(i)&&(i.name=i.name||t,i=this.options._base.extend(i)),"directive"===e&&"function"==typeof i&&(i={bind:i,update:i}),this.options[e+"s"][t]=i,i):this.options[e+"s"][t]}})}(t)}(Ti),Object.defineProperty(Ti.prototype,"$isServer",{get:ot}),Object.defineProperty(Ti.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Ti,"FunctionalRenderContext",{value:Ie}),Ti.version="2.6.14";var Di=g("style,class"),Ii=g("input,textarea,option,select,progress"),ji=function(t,e,i){return"value"===i&&Ii(t)&&"button"!==e||"selected"===i&&"option"===t||"checked"===i&&"input"===t||"muted"===i&&"video"===t},zi=g("contenteditable,draggable,spellcheck"),Hi=g("events,caret,typing,plaintext-only"),Fi=function(t,e){return Wi(e)||"false"===e?"false":"contenteditable"===t&&Hi(e)?e:"true"},Ni=g("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),Zi="http://www.w3.org/1999/xlink",Gi=function(t){return":"===t.charAt(5)&&"xlink"===t.slice(0,5)},Bi=function(t){return Gi(t)?t.slice(6,t.length):""},Wi=function(t){return null==t||!1===t};function Vi(t){for(var e=t.data,i=t,n=t;r(n.componentInstance);)(n=n.componentInstance._vnode)&&n.data&&(e=$i(n.data,e));for(;r(i=i.parent);)i&&i.data&&(e=$i(e,i.data));return function(t,e){if(r(t)||r(e))return Ui(t,Ji(e));return""}(e.staticClass,e.class)}function $i(t,e){return{staticClass:Ui(t.staticClass,e.staticClass),class:r(t.class)?[t.class,e.class]:e.class}}function Ui(t,e){return t?e?t+" "+e:t:e||""}function Ji(t){return Array.isArray(t)?function(t){for(var e,i="",n=0,o=t.length;n<o;n++)r(e=Ji(t[n]))&&""!==e&&(i&&(i+=" "),i+=e);return i}(t):a(t)?function(t){var e="";for(var i in t)t[i]&&(e&&(e+=" "),e+=i);return e}(t):"string"==typeof t?t:""}var qi={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Yi=g("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Xi=g("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Ki=function(t){return Yi(t)||Xi(t)};function Qi(t){return Xi(t)?"svg":"math"===t?"math":void 0}var tn=Object.create(null);var en=g("text,number,password,search,email,tel,url");function nn(t){if("string"==typeof t){var e=document.querySelector(t);return e||document.createElement("div")}return t}var rn=Object.freeze({createElement:function(t,e){var i=document.createElement(t);return"select"!==t?i:(e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&i.setAttribute("multiple","multiple"),i)},createElementNS:function(t,e){return document.createElementNS(qi[t],e)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,i){t.insertBefore(e,i)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},setStyleScope:function(t,e){t.setAttribute(e,"")}}),on={create:function(t,e){sn(e)},update:function(t,e){t.data.ref!==e.data.ref&&(sn(t,!0),sn(e))},destroy:function(t){sn(t,!0)}};function sn(t,e){var i=t.data.ref;if(r(i)){var n=t.context,o=t.componentInstance||t.elm,s=n.$refs;e?Array.isArray(s[i])?_(s[i],o):s[i]===o&&(s[i]=void 0):t.data.refInFor?Array.isArray(s[i])?s[i].indexOf(o)<0&&s[i].push(o):s[i]=[o]:s[i]=o}}var an=new mt("",{},[]),hn=["create","activate","update","remove","destroy"];function un(t,e){return t.key===e.key&&t.asyncFactory===e.asyncFactory&&(t.tag===e.tag&&t.isComment===e.isComment&&r(t.data)===r(e.data)&&function(t,e){if("input"!==t.tag)return!0;var i,n=r(i=t.data)&&r(i=i.attrs)&&i.type,o=r(i=e.data)&&r(i=i.attrs)&&i.type;return n===o||en(n)&&en(o)}(t,e)||o(t.isAsyncPlaceholder)&&n(e.asyncFactory.error))}function ln(t,e,i){var n,o,s={};for(n=e;n<=i;++n)r(o=t[n].key)&&(s[o]=n);return s}var cn={create:fn,update:fn,destroy:function(t){fn(t,an)}};function fn(t,e){(t.data.directives||e.data.directives)&&function(t,e){var i,n,r,o=t===an,s=e===an,a=pn(t.data.directives,t.context),h=pn(e.data.directives,e.context),u=[],l=[];for(i in h)n=a[i],r=h[i],n?(r.oldValue=n.value,r.oldArg=n.arg,mn(r,"update",e,t),r.def&&r.def.componentUpdated&&l.push(r)):(mn(r,"bind",e,t),r.def&&r.def.inserted&&u.push(r));if(u.length){var c=function(){for(var i=0;i<u.length;i++)mn(u[i],"inserted",e,t)};o?ue(e,"insert",c):c()}l.length&&ue(e,"postpatch",function(){for(var i=0;i<l.length;i++)mn(l[i],"componentUpdated",e,t)});if(!o)for(i in a)h[i]||mn(a[i],"unbind",t,t,s)}(t,e)}var dn=Object.create(null);function pn(t,e){var i,n,r=Object.create(null);if(!t)return r;for(i=0;i<t.length;i++)(n=t[i]).modifiers||(n.modifiers=dn),r[gn(n)]=n,n.def=Ht(e.$options,"directives",n.name);return r}function gn(t){return t.rawName||t.name+"."+Object.keys(t.modifiers||{}).join(".")}function mn(t,e,i,n,r){var o=t.def&&t.def[e];if(o)try{o(i.elm,t,i,n,r)}catch(n){Wt(n,i.context,"directive "+t.name+" "+e+" hook")}}var vn=[on,cn];function _n(t,e){var i=e.componentOptions;if(!(r(i)&&!1===i.Ctor.options.inheritAttrs||n(t.data.attrs)&&n(e.data.attrs))){var o,s,a=e.elm,h=t.data.attrs||{},u=e.data.attrs||{};for(o in r(u.__ob__)&&(u=e.data.attrs=E({},u)),u)s=u[o],h[o]!==s&&yn(a,o,s,e.data.pre);for(o in(X||Q)&&u.value!==h.value&&yn(a,"value",u.value),h)n(u[o])&&(Gi(o)?a.removeAttributeNS(Zi,Bi(o)):zi(o)||a.removeAttribute(o))}}function yn(t,e,i,n){n||t.tagName.indexOf("-")>-1?xn(t,e,i):Ni(e)?Wi(i)?t.removeAttribute(e):(i="allowfullscreen"===e&&"EMBED"===t.tagName?"true":e,t.setAttribute(e,i)):zi(e)?t.setAttribute(e,Fi(e,i)):Gi(e)?Wi(i)?t.removeAttributeNS(Zi,Bi(e)):t.setAttributeNS(Zi,e,i):xn(t,e,i)}function xn(t,e,i){if(Wi(i))t.removeAttribute(e);else{if(X&&!K&&"TEXTAREA"===t.tagName&&"placeholder"===e&&""!==i&&!t.__ieph){var n=function(e){e.stopImmediatePropagation(),t.removeEventListener("input",n)};t.addEventListener("input",n),t.__ieph=!0}t.setAttribute(e,i)}}var wn={create:_n,update:_n};function bn(t,e){var i=e.elm,o=e.data,s=t.data;if(!(n(o.staticClass)&&n(o.class)&&(n(s)||n(s.staticClass)&&n(s.class)))){var a=Vi(e),h=i._transitionClasses;r(h)&&(a=Ui(a,Ji(h))),a!==i._prevClass&&(i.setAttribute("class",a),i._prevClass=a)}}var Cn,Pn,Mn,Tn,Sn,An,En={create:bn,update:bn},kn=/[\w).+\-_$\]]/;function Rn(t){var e,i,n,r,o,s=!1,a=!1,h=!1,u=!1,l=0,c=0,f=0,d=0;for(n=0;n<t.length;n++)if(i=e,e=t.charCodeAt(n),s)39===e&&92!==i&&(s=!1);else if(a)34===e&&92!==i&&(a=!1);else if(h)96===e&&92!==i&&(h=!1);else if(u)47===e&&92!==i&&(u=!1);else if(124!==e||124===t.charCodeAt(n+1)||124===t.charCodeAt(n-1)||l||c||f){switch(e){case 34:a=!0;break;case 39:s=!0;break;case 96:h=!0;break;case 40:f++;break;case 41:f--;break;case 91:c++;break;case 93:c--;break;case 123:l++;break;case 125:l--}if(47===e){for(var p=n-1,g=void 0;p>=0&&" "===(g=t.charAt(p));p--);g&&kn.test(g)||(u=!0)}}else void 0===r?(d=n+1,r=t.slice(0,n).trim()):m();function m(){(o||(o=[])).push(t.slice(d,n).trim()),d=n+1}if(void 0===r?r=t.slice(0,n).trim():0!==d&&m(),o)for(n=0;n<o.length;n++)r=On(r,o[n]);return r}function On(t,e){var i=e.indexOf("(");if(i<0)return'_f("'+e+'")('+t+")";var n=e.slice(0,i),r=e.slice(i+1);return'_f("'+n+'")('+t+(")"!==r?","+r:r)}function Ln(t,e){console.error("[Vue compiler]: "+t)}function Dn(t,e){return t?t.map(function(t){return t[e]}).filter(function(t){return t}):[]}function In(t,e,i,n,r){(t.props||(t.props=[])).push(Vn({name:e,value:i,dynamic:r},n)),t.plain=!1}function jn(t,e,i,n,r){(r?t.dynamicAttrs||(t.dynamicAttrs=[]):t.attrs||(t.attrs=[])).push(Vn({name:e,value:i,dynamic:r},n)),t.plain=!1}function zn(t,e,i,n){t.attrsMap[e]=i,t.attrsList.push(Vn({name:e,value:i},n))}function Hn(t,e,i,n,r,o,s,a){(t.directives||(t.directives=[])).push(Vn({name:e,rawName:i,value:n,arg:r,isDynamicArg:o,modifiers:s},a)),t.plain=!1}function Fn(t,e,i){return i?"_p("+e+',"'+t+'")':t+e}function Nn(t,e,n,r,o,s,a,h){var u;(r=r||i).right?h?e="("+e+")==='click'?'contextmenu':("+e+")":"click"===e&&(e="contextmenu",delete r.right):r.middle&&(h?e="("+e+")==='click'?'mouseup':("+e+")":"click"===e&&(e="mouseup")),r.capture&&(delete r.capture,e=Fn("!",e,h)),r.once&&(delete r.once,e=Fn("~",e,h)),r.passive&&(delete r.passive,e=Fn("&",e,h)),r.native?(delete r.native,u=t.nativeEvents||(t.nativeEvents={})):u=t.events||(t.events={});var l=Vn({value:n.trim(),dynamic:h},a);r!==i&&(l.modifiers=r);var c=u[e];Array.isArray(c)?o?c.unshift(l):c.push(l):u[e]=c?o?[l,c]:[c,l]:l,t.plain=!1}function Zn(t,e){return t.rawAttrsMap[":"+e]||t.rawAttrsMap["v-bind:"+e]||t.rawAttrsMap[e]}function Gn(t,e,i){var n=Bn(t,":"+e)||Bn(t,"v-bind:"+e);if(null!=n)return Rn(n);if(!1!==i){var r=Bn(t,e);if(null!=r)return JSON.stringify(r)}}function Bn(t,e,i){var n;if(null!=(n=t.attrsMap[e]))for(var r=t.attrsList,o=0,s=r.length;o<s;o++)if(r[o].name===e){r.splice(o,1);break}return i&&delete t.attrsMap[e],n}function Wn(t,e){for(var i=t.attrsList,n=0,r=i.length;n<r;n++){var o=i[n];if(e.test(o.name))return i.splice(n,1),o}}function Vn(t,e){return e&&(null!=e.start&&(t.start=e.start),null!=e.end&&(t.end=e.end)),t}function $n(t,e,i){var n=i||{},r=n.number,o="$$v";n.trim&&(o="(typeof $$v === 'string'? $$v.trim(): $$v)"),r&&(o="_n("+o+")");var s=Un(e,o);t.model={value:"("+e+")",expression:JSON.stringify(e),callback:"function ($$v) {"+s+"}"}}function Un(t,e){var i=function(t){if(t=t.trim(),Cn=t.length,t.indexOf("[")<0||t.lastIndexOf("]")<Cn-1)return(Tn=t.lastIndexOf("."))>-1?{exp:t.slice(0,Tn),key:'"'+t.slice(Tn+1)+'"'}:{exp:t,key:null};Pn=t,Tn=Sn=An=0;for(;!qn();)Yn(Mn=Jn())?Kn(Mn):91===Mn&&Xn(Mn);return{exp:t.slice(0,Sn),key:t.slice(Sn+1,An)}}(t);return null===i.key?t+"="+e:"$set("+i.exp+", "+i.key+", "+e+")"}function Jn(){return Pn.charCodeAt(++Tn)}function qn(){return Tn>=Cn}function Yn(t){return 34===t||39===t}function Xn(t){var e=1;for(Sn=Tn;!qn();)if(Yn(t=Jn()))Kn(t);else if(91===t&&e++,93===t&&e--,0===e){An=Tn;break}}function Kn(t){for(var e=t;!qn()&&(t=Jn())!==e;);}var Qn,tr="__r",er="__c";function ir(t,e,i){var n=Qn;return function r(){null!==e.apply(null,arguments)&&or(t,r,i,n)}}var nr=qt&&!(et&&Number(et[1])<=53);function rr(t,e,i,n){if(nr){var r=li,o=e;e=o._wrapper=function(t){if(t.target===t.currentTarget||t.timeStamp>=r||t.timeStamp<=0||t.target.ownerDocument!==document)return o.apply(this,arguments)}}Qn.addEventListener(t,e,nt?{capture:i,passive:n}:i)}function or(t,e,i,n){(n||Qn).removeEventListener(t,e._wrapper||e,i)}function sr(t,e){if(!n(t.data.on)||!n(e.data.on)){var i=e.data.on||{},o=t.data.on||{};Qn=e.elm,function(t){if(r(t[tr])){var e=X?"change":"input";t[e]=[].concat(t[tr],t[e]||[]),delete t[tr]}r(t[er])&&(t.change=[].concat(t[er],t.change||[]),delete t[er])}(i),he(i,o,rr,or,ir,e.context),Qn=void 0}}var ar,hr={create:sr,update:sr};function ur(t,e){if(!n(t.data.domProps)||!n(e.data.domProps)){var i,o,s=e.elm,a=t.data.domProps||{},h=e.data.domProps||{};for(i in r(h.__ob__)&&(h=e.data.domProps=E({},h)),a)i in h||(s[i]="");for(i in h){if(o=h[i],"textContent"===i||"innerHTML"===i){if(e.children&&(e.children.length=0),o===a[i])continue;1===s.childNodes.length&&s.removeChild(s.childNodes[0])}if("value"===i&&"PROGRESS"!==s.tagName){s._value=o;var u=n(o)?"":String(o);lr(s,u)&&(s.value=u)}else if("innerHTML"===i&&Xi(s.tagName)&&n(s.innerHTML)){(ar=ar||document.createElement("div")).innerHTML="<svg>"+o+"</svg>";for(var l=ar.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;l.firstChild;)s.appendChild(l.firstChild)}else if(o!==a[i])try{s[i]=o}catch(t){}}}}function lr(t,e){return!t.composing&&("OPTION"===t.tagName||function(t,e){var i=!0;try{i=document.activeElement!==t}catch(t){}return i&&t.value!==e}(t,e)||function(t,e){var i=t.value,n=t._vModifiers;if(r(n)){if(n.number)return p(i)!==p(e);if(n.trim)return i.trim()!==e.trim()}return i!==e}(t,e))}var cr={create:ur,update:ur},fr=w(function(t){var e={},i=/:(.+)/;return t.split(/;(?![^(]*\))/g).forEach(function(t){if(t){var n=t.split(i);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e});function dr(t){var e=pr(t.style);return t.staticStyle?E(t.staticStyle,e):e}function pr(t){return Array.isArray(t)?k(t):"string"==typeof t?fr(t):t}var gr,mr=/^--/,vr=/\s*!important$/,_r=function(t,e,i){if(mr.test(e))t.style.setProperty(e,i);else if(vr.test(i))t.style.setProperty(T(e),i.replace(vr,""),"important");else{var n=xr(e);if(Array.isArray(i))for(var r=0,o=i.length;r<o;r++)t.style[n]=i[r];else t.style[n]=i}},yr=["Webkit","Moz","ms"],xr=w(function(t){if(gr=gr||document.createElement("div").style,"filter"!==(t=C(t))&&t in gr)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),i=0;i<yr.length;i++){var n=yr[i]+e;if(n in gr)return n}});function wr(t,e){var i=e.data,o=t.data;if(!(n(i.staticStyle)&&n(i.style)&&n(o.staticStyle)&&n(o.style))){var s,a,h=e.elm,u=o.staticStyle,l=o.normalizedStyle||o.style||{},c=u||l,f=pr(e.data.style)||{};e.data.normalizedStyle=r(f.__ob__)?E({},f):f;var d=function(t,e){var i,n={};if(e)for(var r=t;r.componentInstance;)(r=r.componentInstance._vnode)&&r.data&&(i=dr(r.data))&&E(n,i);(i=dr(t.data))&&E(n,i);for(var o=t;o=o.parent;)o.data&&(i=dr(o.data))&&E(n,i);return n}(e,!0);for(a in c)n(d[a])&&_r(h,a,"");for(a in d)(s=d[a])!==c[a]&&_r(h,a,null==s?"":s)}}var br={create:wr,update:wr},Cr=/\s+/;function Pr(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(Cr).forEach(function(e){return t.classList.add(e)}):t.classList.add(e);else{var i=" "+(t.getAttribute("class")||"")+" ";i.indexOf(" "+e+" ")<0&&t.setAttribute("class",(i+e).trim())}}function Mr(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(Cr).forEach(function(e){return t.classList.remove(e)}):t.classList.remove(e),t.classList.length||t.removeAttribute("class");else{for(var i=" "+(t.getAttribute("class")||"")+" ",n=" "+e+" ";i.indexOf(n)>=0;)i=i.replace(n," ");(i=i.trim())?t.setAttribute("class",i):t.removeAttribute("class")}}function Tr(t){if(t){if("object"==typeof t){var e={};return!1!==t.css&&E(e,Sr(t.name||"v")),E(e,t),e}return"string"==typeof t?Sr(t):void 0}}var Sr=w(function(t){return{enterClass:t+"-enter",enterToClass:t+"-enter-to",enterActiveClass:t+"-enter-active",leaveClass:t+"-leave",leaveToClass:t+"-leave-to",leaveActiveClass:t+"-leave-active"}}),Ar=U&&!K,Er="transition",kr="animation",Rr="transition",Or="transitionend",Lr="animation",Dr="animationend";Ar&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Rr="WebkitTransition",Or="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Lr="WebkitAnimation",Dr="webkitAnimationEnd"));var Ir=U?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(t){return t()};function jr(t){Ir(function(){Ir(t)})}function zr(t,e){var i=t._transitionClasses||(t._transitionClasses=[]);i.indexOf(e)<0&&(i.push(e),Pr(t,e))}function Hr(t,e){t._transitionClasses&&_(t._transitionClasses,e),Mr(t,e)}function Fr(t,e,i){var n=Zr(t,e),r=n.type,o=n.timeout,s=n.propCount;if(!r)return i();var a=r===Er?Or:Dr,h=0,u=function(){t.removeEventListener(a,l),i()},l=function(e){e.target===t&&++h>=s&&u()};setTimeout(function(){h<s&&u()},o+1),t.addEventListener(a,l)}var Nr=/\b(transform|all)(,|$)/;function Zr(t,e){var i,n=window.getComputedStyle(t),r=(n[Rr+"Delay"]||"").split(", "),o=(n[Rr+"Duration"]||"").split(", "),s=Gr(r,o),a=(n[Lr+"Delay"]||"").split(", "),h=(n[Lr+"Duration"]||"").split(", "),u=Gr(a,h),l=0,c=0;return e===Er?s>0&&(i=Er,l=s,c=o.length):e===kr?u>0&&(i=kr,l=u,c=h.length):c=(i=(l=Math.max(s,u))>0?s>u?Er:kr:null)?i===Er?o.length:h.length:0,{type:i,timeout:l,propCount:c,hasTransform:i===Er&&Nr.test(n[Rr+"Property"])}}function Gr(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max.apply(null,e.map(function(e,i){return Br(e)+Br(t[i])}))}function Br(t){return 1e3*Number(t.slice(0,-1).replace(",","."))}function Wr(t,e){var i=t.elm;r(i._leaveCb)&&(i._leaveCb.cancelled=!0,i._leaveCb());var o=Tr(t.data.transition);if(!n(o)&&!r(i._enterCb)&&1===i.nodeType){for(var s=o.css,h=o.type,u=o.enterClass,l=o.enterToClass,c=o.enterActiveClass,f=o.appearClass,d=o.appearToClass,g=o.appearActiveClass,m=o.beforeEnter,v=o.enter,_=o.afterEnter,y=o.enterCancelled,x=o.beforeAppear,w=o.appear,b=o.afterAppear,C=o.appearCancelled,P=o.duration,M=Qe,T=Qe.$vnode;T&&T.parent;)M=T.context,T=T.parent;var S=!M._isMounted||!t.isRootInsert;if(!S||w||""===w){var A=S&&f?f:u,E=S&&g?g:c,k=S&&d?d:l,R=S&&x||m,O=S&&"function"==typeof w?w:v,L=S&&b||_,D=S&&C||y,I=p(a(P)?P.enter:P);0;var z=!1!==s&&!K,H=Ur(O),F=i._enterCb=j(function(){z&&(Hr(i,k),Hr(i,E)),F.cancelled?(z&&Hr(i,A),D&&D(i)):L&&L(i),i._enterCb=null});t.data.show||ue(t,"insert",function(){var e=i.parentNode,n=e&&e._pending&&e._pending[t.key];n&&n.tag===t.tag&&n.elm._leaveCb&&n.elm._leaveCb(),O&&O(i,F)}),R&&R(i),z&&(zr(i,A),zr(i,E),jr(function(){Hr(i,A),F.cancelled||(zr(i,k),H||($r(I)?setTimeout(F,I):Fr(i,h,F)))})),t.data.show&&(e&&e(),O&&O(i,F)),z||H||F()}}}function Vr(t,e){var i=t.elm;r(i._enterCb)&&(i._enterCb.cancelled=!0,i._enterCb());var o=Tr(t.data.transition);if(n(o)||1!==i.nodeType)return e();if(!r(i._leaveCb)){var s=o.css,h=o.type,u=o.leaveClass,l=o.leaveToClass,c=o.leaveActiveClass,f=o.beforeLeave,d=o.leave,g=o.afterLeave,m=o.leaveCancelled,v=o.delayLeave,_=o.duration,y=!1!==s&&!K,x=Ur(d),w=p(a(_)?_.leave:_);0;var b=i._leaveCb=j(function(){i.parentNode&&i.parentNode._pending&&(i.parentNode._pending[t.key]=null),y&&(Hr(i,l),Hr(i,c)),b.cancelled?(y&&Hr(i,u),m&&m(i)):(e(),g&&g(i)),i._leaveCb=null});v?v(C):C()}function C(){b.cancelled||(!t.data.show&&i.parentNode&&((i.parentNode._pending||(i.parentNode._pending={}))[t.key]=t),f&&f(i),y&&(zr(i,u),zr(i,c),jr(function(){Hr(i,u),b.cancelled||(zr(i,l),x||($r(w)?setTimeout(b,w):Fr(i,h,b)))})),d&&d(i,b),y||x||b())}}function $r(t){return"number"==typeof t&&!isNaN(t)}function Ur(t){if(n(t))return!1;var e=t.fns;return r(e)?Ur(Array.isArray(e)?e[0]:e):(t._length||t.length)>1}function Jr(t,e){!0!==e.data.show&&Wr(e)}var qr=function(t){var e,i,a={},h=t.modules,u=t.nodeOps;for(e=0;e<hn.length;++e)for(a[hn[e]]=[],i=0;i<h.length;++i)r(h[i][hn[e]])&&a[hn[e]].push(h[i][hn[e]]);function l(t){var e=u.parentNode(t);r(e)&&u.removeChild(e,t)}function c(t,e,i,n,s,h,l){if(r(t.elm)&&r(h)&&(t=h[l]=xt(t)),t.isRootInsert=!s,!function(t,e,i,n){var s=t.data;if(r(s)){var h=r(t.componentInstance)&&s.keepAlive;if(r(s=s.hook)&&r(s=s.init)&&s(t,!1),r(t.componentInstance))return f(t,e),d(i,t.elm,n),o(h)&&function(t,e,i,n){for(var o,s=t;s.componentInstance;)if(s=s.componentInstance._vnode,r(o=s.data)&&r(o=o.transition)){for(o=0;o<a.activate.length;++o)a.activate[o](an,s);e.push(s);break}d(i,t.elm,n)}(t,e,i,n),!0}}(t,e,i,n)){var c=t.data,g=t.children,m=t.tag;r(m)?(t.elm=t.ns?u.createElementNS(t.ns,m):u.createElement(m,t),_(t),p(t,g,e),r(c)&&v(t,e),d(i,t.elm,n)):o(t.isComment)?(t.elm=u.createComment(t.text),d(i,t.elm,n)):(t.elm=u.createTextNode(t.text),d(i,t.elm,n))}}function f(t,e){r(t.data.pendingInsert)&&(e.push.apply(e,t.data.pendingInsert),t.data.pendingInsert=null),t.elm=t.componentInstance.$el,m(t)?(v(t,e),_(t)):(sn(t),e.push(t))}function d(t,e,i){r(t)&&(r(i)?u.parentNode(i)===t&&u.insertBefore(t,e,i):u.appendChild(t,e))}function p(t,e,i){if(Array.isArray(e))for(var n=0;n<e.length;++n)c(e[n],i,t.elm,null,!0,e,n);else s(t.text)&&u.appendChild(t.elm,u.createTextNode(String(t.text)))}function m(t){for(;t.componentInstance;)t=t.componentInstance._vnode;return r(t.tag)}function v(t,i){for(var n=0;n<a.create.length;++n)a.create[n](an,t);r(e=t.data.hook)&&(r(e.create)&&e.create(an,t),r(e.insert)&&i.push(t))}function _(t){var e;if(r(e=t.fnScopeId))u.setStyleScope(t.elm,e);else for(var i=t;i;)r(e=i.context)&&r(e=e.$options._scopeId)&&u.setStyleScope(t.elm,e),i=i.parent;r(e=Qe)&&e!==t.context&&e!==t.fnContext&&r(e=e.$options._scopeId)&&u.setStyleScope(t.elm,e)}function y(t,e,i,n,r,o){for(;n<=r;++n)c(i[n],o,t,e,!1,i,n)}function x(t){var e,i,n=t.data;if(r(n))for(r(e=n.hook)&&r(e=e.destroy)&&e(t),e=0;e<a.destroy.length;++e)a.destroy[e](t);if(r(e=t.children))for(i=0;i<t.children.length;++i)x(t.children[i])}function w(t,e,i){for(;e<=i;++e){var n=t[e];r(n)&&(r(n.tag)?(b(n),x(n)):l(n.elm))}}function b(t,e){if(r(e)||r(t.data)){var i,n=a.remove.length+1;for(r(e)?e.listeners+=n:e=function(t,e){function i(){0==--i.listeners&&l(t)}return i.listeners=e,i}(t.elm,n),r(i=t.componentInstance)&&r(i=i._vnode)&&r(i.data)&&b(i,e),i=0;i<a.remove.length;++i)a.remove[i](t,e);r(i=t.data.hook)&&r(i=i.remove)?i(t,e):e()}else l(t.elm)}function C(t,e,i,n){for(var o=i;o<n;o++){var s=e[o];if(r(s)&&un(t,s))return o}}function P(t,e,i,s,h,l){if(t!==e){r(e.elm)&&r(s)&&(e=s[h]=xt(e));var f=e.elm=t.elm;if(o(t.isAsyncPlaceholder))r(e.asyncFactory.resolved)?S(t.elm,e,i):e.isAsyncPlaceholder=!0;else if(o(e.isStatic)&&o(t.isStatic)&&e.key===t.key&&(o(e.isCloned)||o(e.isOnce)))e.componentInstance=t.componentInstance;else{var d,p=e.data;r(p)&&r(d=p.hook)&&r(d=d.prepatch)&&d(t,e);var g=t.children,v=e.children;if(r(p)&&m(e)){for(d=0;d<a.update.length;++d)a.update[d](t,e);r(d=p.hook)&&r(d=d.update)&&d(t,e)}n(e.text)?r(g)&&r(v)?g!==v&&function(t,e,i,o,s){for(var a,h,l,f=0,d=0,p=e.length-1,g=e[0],m=e[p],v=i.length-1,_=i[0],x=i[v],b=!s;f<=p&&d<=v;)n(g)?g=e[++f]:n(m)?m=e[--p]:un(g,_)?(P(g,_,o,i,d),g=e[++f],_=i[++d]):un(m,x)?(P(m,x,o,i,v),m=e[--p],x=i[--v]):un(g,x)?(P(g,x,o,i,v),b&&u.insertBefore(t,g.elm,u.nextSibling(m.elm)),g=e[++f],x=i[--v]):un(m,_)?(P(m,_,o,i,d),b&&u.insertBefore(t,m.elm,g.elm),m=e[--p],_=i[++d]):(n(a)&&(a=ln(e,f,p)),n(h=r(_.key)?a[_.key]:C(_,e,f,p))?c(_,o,t,g.elm,!1,i,d):un(l=e[h],_)?(P(l,_,o,i,d),e[h]=void 0,b&&u.insertBefore(t,l.elm,g.elm)):c(_,o,t,g.elm,!1,i,d),_=i[++d]);f>p?y(t,n(i[v+1])?null:i[v+1].elm,i,d,v,o):d>v&&w(e,f,p)}(f,g,v,i,l):r(v)?(r(t.text)&&u.setTextContent(f,""),y(f,null,v,0,v.length-1,i)):r(g)?w(g,0,g.length-1):r(t.text)&&u.setTextContent(f,""):t.text!==e.text&&u.setTextContent(f,e.text),r(p)&&r(d=p.hook)&&r(d=d.postpatch)&&d(t,e)}}}function M(t,e,i){if(o(i)&&r(t.parent))t.parent.data.pendingInsert=e;else for(var n=0;n<e.length;++n)e[n].data.hook.insert(e[n])}var T=g("attrs,class,staticClass,staticStyle,key");function S(t,e,i,n){var s,a=e.tag,h=e.data,u=e.children;if(n=n||h&&h.pre,e.elm=t,o(e.isComment)&&r(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(r(h)&&(r(s=h.hook)&&r(s=s.init)&&s(e,!0),r(s=e.componentInstance)))return f(e,i),!0;if(r(a)){if(r(u))if(t.hasChildNodes())if(r(s=h)&&r(s=s.domProps)&&r(s=s.innerHTML)){if(s!==t.innerHTML)return!1}else{for(var l=!0,c=t.firstChild,d=0;d<u.length;d++){if(!c||!S(c,u[d],i,n)){l=!1;break}c=c.nextSibling}if(!l||c)return!1}else p(e,u,i);if(r(h)){var g=!1;for(var m in h)if(!T(m)){g=!0,v(e,i);break}!g&&h.class&&oe(h.class)}}else t.data!==e.text&&(t.data=e.text);return!0}return function(t,e,i,s){if(!n(e)){var h,l=!1,f=[];if(n(t))l=!0,c(e,f);else{var d=r(t.nodeType);if(!d&&un(t,e))P(t,e,f,null,null,s);else{if(d){if(1===t.nodeType&&t.hasAttribute(z)&&(t.removeAttribute(z),i=!0),o(i)&&S(t,e,f))return M(e,f,!0),t;h=t,t=new mt(u.tagName(h).toLowerCase(),{},[],void 0,h)}var p=t.elm,g=u.parentNode(p);if(c(e,f,p._leaveCb?null:g,u.nextSibling(p)),r(e.parent))for(var v=e.parent,_=m(e);v;){for(var y=0;y<a.destroy.length;++y)a.destroy[y](v);if(v.elm=e.elm,_){for(var b=0;b<a.create.length;++b)a.create[b](an,v);var C=v.data.hook.insert;if(C.merged)for(var T=1;T<C.fns.length;T++)C.fns[T]()}else sn(v);v=v.parent}r(g)?w([t],0,0):r(t.tag)&&x(t)}}return M(e,f,l),e.elm}r(t)&&x(t)}}({nodeOps:rn,modules:[wn,En,hr,cr,br,U?{create:Jr,activate:Jr,remove:function(t,e){!0!==t.data.show?Vr(t,e):e()}}:{}].concat(vn)});K&&document.addEventListener("selectionchange",function(){var t=document.activeElement;t&&t.vmodel&&no(t,"input")});var Yr={inserted:function(t,e,i,n){"select"===i.tag?(n.elm&&!n.elm._vOptions?ue(i,"postpatch",function(){Yr.componentUpdated(t,e,i)}):Xr(t,e,i.context),t._vOptions=[].map.call(t.options,to)):("textarea"===i.tag||en(t.type))&&(t._vModifiers=e.modifiers,e.modifiers.lazy||(t.addEventListener("compositionstart",eo),t.addEventListener("compositionend",io),t.addEventListener("change",io),K&&(t.vmodel=!0)))},componentUpdated:function(t,e,i){if("select"===i.tag){Xr(t,e,i.context);var n=t._vOptions,r=t._vOptions=[].map.call(t.options,to);if(r.some(function(t,e){return!D(t,n[e])}))(t.multiple?e.value.some(function(t){return Qr(t,r)}):e.value!==e.oldValue&&Qr(e.value,r))&&no(t,"change")}}};function Xr(t,e,i){Kr(t,e,i),(X||Q)&&setTimeout(function(){Kr(t,e,i)},0)}function Kr(t,e,i){var n=e.value,r=t.multiple;if(!r||Array.isArray(n)){for(var o,s,a=0,h=t.options.length;a<h;a++)if(s=t.options[a],r)o=I(n,to(s))>-1,s.selected!==o&&(s.selected=o);else if(D(to(s),n))return void(t.selectedIndex!==a&&(t.selectedIndex=a));r||(t.selectedIndex=-1)}}function Qr(t,e){return e.every(function(e){return!D(e,t)})}function to(t){return"_value"in t?t._value:t.value}function eo(t){t.target.composing=!0}function io(t){t.target.composing&&(t.target.composing=!1,no(t.target,"input"))}function no(t,e){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),t.dispatchEvent(i)}function ro(t){return!t.componentInstance||t.data&&t.data.transition?t:ro(t.componentInstance._vnode)}var oo={model:Yr,show:{bind:function(t,e,i){var n=e.value,r=(i=ro(i)).data&&i.data.transition,o=t.__vOriginalDisplay="none"===t.style.display?"":t.style.display;n&&r?(i.data.show=!0,Wr(i,function(){t.style.display=o})):t.style.display=n?o:"none"},update:function(t,e,i){var n=e.value;!n!=!e.oldValue&&((i=ro(i)).data&&i.data.transition?(i.data.show=!0,n?Wr(i,function(){t.style.display=t.__vOriginalDisplay}):Vr(i,function(){t.style.display="none"})):t.style.display=n?t.__vOriginalDisplay:"none")},unbind:function(t,e,i,n,r){r||(t.style.display=t.__vOriginalDisplay)}}},so={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function ao(t){var e=t&&t.componentOptions;return e&&e.Ctor.options.abstract?ao(Je(e.children)):t}function ho(t){var e={},i=t.$options;for(var n in i.propsData)e[n]=t[n];var r=i._parentListeners;for(var o in r)e[C(o)]=r[o];return e}function uo(t,e){if(/\d-keep-alive$/.test(e.tag))return t("keep-alive",{props:e.componentOptions.propsData})}var lo=function(t){return t.tag||me(t)},co=function(t){return"show"===t.name},fo={name:"transition",props:so,abstract:!0,render:function(t){var e=this,i=this.$slots.default;if(i&&(i=i.filter(lo)).length){0;var n=this.mode;0;var r=i[0];if(function(t){for(;t=t.parent;)if(t.data.transition)return!0}(this.$vnode))return r;var o=ao(r);if(!o)return r;if(this._leaving)return uo(t,r);var a="__transition-"+this._uid+"-";o.key=null==o.key?o.isComment?a+"comment":a+o.tag:s(o.key)?0===String(o.key).indexOf(a)?o.key:a+o.key:o.key;var h=(o.data||(o.data={})).transition=ho(this),u=this._vnode,l=ao(u);if(o.data.directives&&o.data.directives.some(co)&&(o.data.show=!0),l&&l.data&&!function(t,e){return e.key===t.key&&e.tag===t.tag}(o,l)&&!me(l)&&(!l.componentInstance||!l.componentInstance._vnode.isComment)){var c=l.data.transition=E({},h);if("out-in"===n)return this._leaving=!0,ue(c,"afterLeave",function(){e._leaving=!1,e.$forceUpdate()}),uo(t,r);if("in-out"===n){if(me(o))return u;var f,d=function(){f()};ue(h,"afterEnter",d),ue(h,"enterCancelled",d),ue(c,"delayLeave",function(t){f=t})}}return r}}},po=E({tag:String,moveClass:String},so);function go(t){t.elm._moveCb&&t.elm._moveCb(),t.elm._enterCb&&t.elm._enterCb()}function mo(t){t.data.newPos=t.elm.getBoundingClientRect()}function vo(t){var e=t.data.pos,i=t.data.newPos,n=e.left-i.left,r=e.top-i.top;if(n||r){t.data.moved=!0;var o=t.elm.style;o.transform=o.WebkitTransform="translate("+n+"px,"+r+"px)",o.transitionDuration="0s"}}delete po.mode;var _o={Transition:fo,TransitionGroup:{props:po,beforeMount:function(){var t=this,e=this._update;this._update=function(i,n){var r=ti(t);t.__patch__(t._vnode,t.kept,!1,!0),t._vnode=t.kept,r(),e.call(t,i,n)}},render:function(t){for(var e=this.tag||this.$vnode.data.tag||"span",i=Object.create(null),n=this.prevChildren=this.children,r=this.$slots.default||[],o=this.children=[],s=ho(this),a=0;a<r.length;a++){var h=r[a];if(h.tag)if(null!=h.key&&0!==String(h.key).indexOf("__vlist"))o.push(h),i[h.key]=h,(h.data||(h.data={})).transition=s;else;}if(n){for(var u=[],l=[],c=0;c<n.length;c++){var f=n[c];f.data.transition=s,f.data.pos=f.elm.getBoundingClientRect(),i[f.key]?u.push(f):l.push(f)}this.kept=t(e,null,u),this.removed=l}return t(e,null,o)},updated:function(){var t=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";t.length&&this.hasMove(t[0].elm,e)&&(t.forEach(go),t.forEach(mo),t.forEach(vo),this._reflow=document.body.offsetHeight,t.forEach(function(t){if(t.data.moved){var i=t.elm,n=i.style;zr(i,e),n.transform=n.WebkitTransform=n.transitionDuration="",i.addEventListener(Or,i._moveCb=function t(n){n&&n.target!==i||n&&!/transform$/.test(n.propertyName)||(i.removeEventListener(Or,t),i._moveCb=null,Hr(i,e))})}}))},methods:{hasMove:function(t,e){if(!Ar)return!1;if(this._hasMove)return this._hasMove;var i=t.cloneNode();t._transitionClasses&&t._transitionClasses.forEach(function(t){Mr(i,t)}),Pr(i,e),i.style.display="none",this.$el.appendChild(i);var n=Zr(i);return this.$el.removeChild(i),this._hasMove=n.hasTransform}}}};Ti.config.mustUseProp=ji,Ti.config.isReservedTag=Ki,Ti.config.isReservedAttr=Di,Ti.config.getTagNamespace=Qi,Ti.config.isUnknownElement=function(t){if(!U)return!0;if(Ki(t))return!1;if(t=t.toLowerCase(),null!=tn[t])return tn[t];var e=document.createElement(t);return t.indexOf("-")>-1?tn[t]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:tn[t]=/HTMLUnknownElement/.test(e.toString())},E(Ti.options.directives,oo),E(Ti.options.components,_o),Ti.prototype.__patch__=U?qr:R,Ti.prototype.$mount=function(t,e){return function(t,e,i){return t.$el=e,t.$options.render||(t.$options.render=_t),ni(t,"beforeMount"),new gi(t,function(){t._update(t._render(),i)},R,{before:function(){t._isMounted&&!t._isDestroyed&&ni(t,"beforeUpdate")}},!0),i=!1,null==t.$vnode&&(t._isMounted=!0,ni(t,"mounted")),t}(this,t=t&&U?nn(t):void 0,e)},U&&setTimeout(function(){N.devtools&&st&&st.emit("init",Ti)},0);var yo=/\{\{((?:.|\r?\n)+?)\}\}/g,xo=/[-.*+?^${}()|[\]\/\\]/g,wo=w(function(t){var e=t[0].replace(xo,"\\$&"),i=t[1].replace(xo,"\\$&");return new RegExp(e+"((?:.|\\n)+?)"+i,"g")});function bo(t,e){var i=e?wo(e):yo;if(i.test(t)){for(var n,r,o,s=[],a=[],h=i.lastIndex=0;n=i.exec(t);){(r=n.index)>h&&(a.push(o=t.slice(h,r)),s.push(JSON.stringify(o)));var u=Rn(n[1].trim());s.push("_s("+u+")"),a.push({"@binding":u}),h=r+n[0].length}return h<t.length&&(a.push(o=t.slice(h)),s.push(JSON.stringify(o))),{expression:s.join("+"),tokens:a}}}var Co={staticKeys:["staticClass"],transformNode:function(t,e){e.warn;var i=Bn(t,"class");i&&(t.staticClass=JSON.stringify(i));var n=Gn(t,"class",!1);n&&(t.classBinding=n)},genData:function(t){var e="";return t.staticClass&&(e+="staticClass:"+t.staticClass+","),t.classBinding&&(e+="class:"+t.classBinding+","),e}};var Po,Mo={staticKeys:["staticStyle"],transformNode:function(t,e){e.warn;var i=Bn(t,"style");i&&(t.staticStyle=JSON.stringify(fr(i)));var n=Gn(t,"style",!1);n&&(t.styleBinding=n)},genData:function(t){var e="";return t.staticStyle&&(e+="staticStyle:"+t.staticStyle+","),t.styleBinding&&(e+="style:("+t.styleBinding+"),"),e}},To=function(t){return(Po=Po||document.createElement("div")).innerHTML=t,Po.textContent},So=g("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),Ao=g("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source"),Eo=g("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"),ko=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,Ro=/^\s*((?:v-[\w-]+:|@|:|#)\[[^=]+?\][^\s"'<>\/=]*)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,Oo="[a-zA-Z_][\\-\\.0-9_a-zA-Z"+Z.source+"]*",Lo="((?:"+Oo+"\\:)?"+Oo+")",Do=new RegExp("^<"+Lo),Io=/^\s*(\/?)>/,jo=new RegExp("^<\\/"+Lo+"[^>]*>"),zo=/^<!DOCTYPE [^>]+>/i,Ho=/^<!\--/,Fo=/^<!\[/,No=g("script,style,textarea",!0),Zo={},Go={"&lt;":"<","&gt;":">","&quot;":'"',"&amp;":"&","&#10;":"\n","&#9;":"\t","&#39;":"'"},Bo=/&(?:lt|gt|quot|amp|#39);/g,Wo=/&(?:lt|gt|quot|amp|#39|#10|#9);/g,Vo=g("pre,textarea",!0),$o=function(t,e){return t&&Vo(t)&&"\n"===e[0]};function Uo(t,e){var i=e?Wo:Bo;return t.replace(i,function(t){return Go[t]})}var Jo,qo,Yo,Xo,Ko,Qo,ts,es,is=/^@|^v-on:/,ns=/^v-|^@|^:|^#/,rs=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,os=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,ss=/^\(|\)$/g,as=/^\[.*\]$/,hs=/:(.*)$/,us=/^:|^\.|^v-bind:/,ls=/\.[^.\]]+(?=[^\]]*$)/g,cs=/^v-slot(:|$)|^#/,fs=/[\r\n]/,ds=/[ \f\t\r\n]+/g,ps=w(To),gs="_empty_";function ms(t,e,i){return{type:1,tag:t,attrsList:e,attrsMap:function(t){for(var e={},i=0,n=t.length;i<n;i++)e[t[i].name]=t[i].value;return e}(e),rawAttrsMap:{},parent:i,children:[]}}function vs(t,e){Jo=e.warn||Ln,Qo=e.isPreTag||O,ts=e.mustUseProp||O,es=e.getTagNamespace||O;var i=e.isReservedTag||O;(function(t){return!(!(t.component||t.attrsMap[":is"]||t.attrsMap["v-bind:is"])&&(t.attrsMap.is?i(t.attrsMap.is):i(t.tag)))}),Yo=Dn(e.modules,"transformNode"),Xo=Dn(e.modules,"preTransformNode"),Ko=Dn(e.modules,"postTransformNode"),qo=e.delimiters;var n,r,o=[],s=!1!==e.preserveWhitespace,a=e.whitespace,h=!1,u=!1;function l(t){if(c(t),h||t.processed||(t=_s(t,e)),o.length||t===n||n.if&&(t.elseif||t.else)&&xs(n,{exp:t.elseif,block:t}),r&&!t.forbidden)if(t.elseif||t.else)s=t,(a=function(t){var e=t.length;for(;e--;){if(1===t[e].type)return t[e];t.pop()}}(r.children))&&a.if&&xs(a,{exp:s.elseif,block:s});else{if(t.slotScope){var i=t.slotTarget||'"default"';(r.scopedSlots||(r.scopedSlots={}))[i]=t}r.children.push(t),t.parent=r}var s,a;t.children=t.children.filter(function(t){return!t.slotScope}),c(t),t.pre&&(h=!1),Qo(t.tag)&&(u=!1);for(var l=0;l<Ko.length;l++)Ko[l](t,e)}function c(t){if(!u)for(var e;(e=t.children[t.children.length-1])&&3===e.type&&" "===e.text;)t.children.pop()}return function(t,e){for(var i,n,r=[],o=e.expectHTML,s=e.isUnaryTag||O,a=e.canBeLeftOpenTag||O,h=0;t;){if(i=t,n&&No(n)){var u=0,l=n.toLowerCase(),c=Zo[l]||(Zo[l]=new RegExp("([\\s\\S]*?)(</"+l+"[^>]*>)","i")),f=t.replace(c,function(t,i,n){return u=n.length,No(l)||"noscript"===l||(i=i.replace(/<!\--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1")),$o(l,i)&&(i=i.slice(1)),e.chars&&e.chars(i),""});h+=t.length-f.length,t=f,T(l,h-u,h)}else{var d=t.indexOf("<");if(0===d){if(Ho.test(t)){var p=t.indexOf("--\x3e");if(p>=0){e.shouldKeepComment&&e.comment(t.substring(4,p),h,h+p+3),C(p+3);continue}}if(Fo.test(t)){var g=t.indexOf("]>");if(g>=0){C(g+2);continue}}var m=t.match(zo);if(m){C(m[0].length);continue}var v=t.match(jo);if(v){var _=h;C(v[0].length),T(v[1],_,h);continue}var y=P();if(y){M(y),$o(y.tagName,t)&&C(1);continue}}var x=void 0,w=void 0,b=void 0;if(d>=0){for(w=t.slice(d);!(jo.test(w)||Do.test(w)||Ho.test(w)||Fo.test(w)||(b=w.indexOf("<",1))<0);)d+=b,w=t.slice(d);x=t.substring(0,d)}d<0&&(x=t),x&&C(x.length),e.chars&&x&&e.chars(x,h-x.length,h)}if(t===i){e.chars&&e.chars(t);break}}function C(e){h+=e,t=t.substring(e)}function P(){var e=t.match(Do);if(e){var i,n,r={tagName:e[1],attrs:[],start:h};for(C(e[0].length);!(i=t.match(Io))&&(n=t.match(Ro)||t.match(ko));)n.start=h,C(n[0].length),n.end=h,r.attrs.push(n);if(i)return r.unarySlash=i[1],C(i[0].length),r.end=h,r}}function M(t){var i=t.tagName,h=t.unarySlash;o&&("p"===n&&Eo(i)&&T(n),a(i)&&n===i&&T(i));for(var u=s(i)||!!h,l=t.attrs.length,c=new Array(l),f=0;f<l;f++){var d=t.attrs[f],p=d[3]||d[4]||d[5]||"",g="a"===i&&"href"===d[1]?e.shouldDecodeNewlinesForHref:e.shouldDecodeNewlines;c[f]={name:d[1],value:Uo(p,g)}}u||(r.push({tag:i,lowerCasedTag:i.toLowerCase(),attrs:c,start:t.start,end:t.end}),n=i),e.start&&e.start(i,c,u,t.start,t.end)}function T(t,i,o){var s,a;if(null==i&&(i=h),null==o&&(o=h),t)for(a=t.toLowerCase(),s=r.length-1;s>=0&&r[s].lowerCasedTag!==a;s--);else s=0;if(s>=0){for(var u=r.length-1;u>=s;u--)e.end&&e.end(r[u].tag,i,o);r.length=s,n=s&&r[s-1].tag}else"br"===a?e.start&&e.start(t,[],!0,i,o):"p"===a&&(e.start&&e.start(t,[],!1,i,o),e.end&&e.end(t,i,o))}T()}(t,{warn:Jo,expectHTML:e.expectHTML,isUnaryTag:e.isUnaryTag,canBeLeftOpenTag:e.canBeLeftOpenTag,shouldDecodeNewlines:e.shouldDecodeNewlines,shouldDecodeNewlinesForHref:e.shouldDecodeNewlinesForHref,shouldKeepComment:e.comments,outputSourceRange:e.outputSourceRange,start:function(t,i,s,a,c){var f=r&&r.ns||es(t);X&&"svg"===f&&(i=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];Cs.test(n.name)||(n.name=n.name.replace(Ps,""),e.push(n))}return e}(i));var d,p=ms(t,i,r);f&&(p.ns=f),"style"!==(d=p).tag&&("script"!==d.tag||d.attrsMap.type&&"text/javascript"!==d.attrsMap.type)||ot()||(p.forbidden=!0);for(var g=0;g<Xo.length;g++)p=Xo[g](p,e)||p;h||(!function(t){null!=Bn(t,"v-pre")&&(t.pre=!0)}(p),p.pre&&(h=!0)),Qo(p.tag)&&(u=!0),h?function(t){var e=t.attrsList,i=e.length;if(i)for(var n=t.attrs=new Array(i),r=0;r<i;r++)n[r]={name:e[r].name,value:JSON.stringify(e[r].value)},null!=e[r].start&&(n[r].start=e[r].start,n[r].end=e[r].end);else t.pre||(t.plain=!0)}(p):p.processed||(ys(p),function(t){var e=Bn(t,"v-if");if(e)t.if=e,xs(t,{exp:e,block:t});else{null!=Bn(t,"v-else")&&(t.else=!0);var i=Bn(t,"v-else-if");i&&(t.elseif=i)}}(p),function(t){null!=Bn(t,"v-once")&&(t.once=!0)}(p)),n||(n=p),s?l(p):(r=p,o.push(p))},end:function(t,e,i){var n=o[o.length-1];o.length-=1,r=o[o.length-1],l(n)},chars:function(t,e,i){if(r&&(!X||"textarea"!==r.tag||r.attrsMap.placeholder!==t)){var n,o,l,c=r.children;if(t=u||t.trim()?"script"===(n=r).tag||"style"===n.tag?t:ps(t):c.length?a?"condense"===a&&fs.test(t)?"":" ":s?" ":"":"")u||"condense"!==a||(t=t.replace(ds," ")),!h&&" "!==t&&(o=bo(t,qo))?l={type:2,expression:o.expression,tokens:o.tokens,text:t}:" "===t&&c.length&&" "===c[c.length-1].text||(l={type:3,text:t}),l&&c.push(l)}},comment:function(t,e,i){if(r){var n={type:3,text:t,isComment:!0};0,r.children.push(n)}}}),n}function _s(t,e){var i,n;!function(t){var e=Gn(t,"key");if(e){t.key=e}}(t),t.plain=!t.key&&!t.scopedSlots&&!t.attrsList.length,(n=Gn(i=t,"ref"))&&(i.ref=n,i.refInFor=function(t){for(var e=t;e;){if(void 0!==e.for)return!0;e=e.parent}return!1}(i)),function(t){var e;"template"===t.tag?(e=Bn(t,"scope"),t.slotScope=e||Bn(t,"slot-scope")):(e=Bn(t,"slot-scope"))&&(t.slotScope=e);var i=Gn(t,"slot");i&&(t.slotTarget='""'===i?'"default"':i,t.slotTargetDynamic=!(!t.attrsMap[":slot"]&&!t.attrsMap["v-bind:slot"]),"template"===t.tag||t.slotScope||jn(t,"slot",i,Zn(t,"slot")));if("template"===t.tag){var n=Wn(t,cs);if(n){0;var r=ws(n),o=r.name,s=r.dynamic;t.slotTarget=o,t.slotTargetDynamic=s,t.slotScope=n.value||gs}}else{var a=Wn(t,cs);if(a){0;var h=t.scopedSlots||(t.scopedSlots={}),u=ws(a),l=u.name,c=u.dynamic,f=h[l]=ms("template",[],t);f.slotTarget=l,f.slotTargetDynamic=c,f.children=t.children.filter(function(t){if(!t.slotScope)return t.parent=f,!0}),f.slotScope=a.value||gs,t.children=[],t.plain=!1}}}(t),function(t){"slot"===t.tag&&(t.slotName=Gn(t,"name"))}(t),function(t){var e;(e=Gn(t,"is"))&&(t.component=e);null!=Bn(t,"inline-template")&&(t.inlineTemplate=!0)}(t);for(var r=0;r<Yo.length;r++)t=Yo[r](t,e)||t;return function(t){var e,i,n,r,o,s,a,h,u=t.attrsList;for(e=0,i=u.length;e<i;e++){if(n=r=u[e].name,o=u[e].value,ns.test(n))if(t.hasBindings=!0,(s=bs(n.replace(ns,"")))&&(n=n.replace(ls,"")),us.test(n))n=n.replace(us,""),o=Rn(o),(h=as.test(n))&&(n=n.slice(1,-1)),s&&(s.prop&&!h&&"innerHtml"===(n=C(n))&&(n="innerHTML"),s.camel&&!h&&(n=C(n)),s.sync&&(a=Un(o,"$event"),h?Nn(t,'"update:"+('+n+")",a,null,!1,0,u[e],!0):(Nn(t,"update:"+C(n),a,null,!1,0,u[e]),T(n)!==C(n)&&Nn(t,"update:"+T(n),a,null,!1,0,u[e])))),s&&s.prop||!t.component&&ts(t.tag,t.attrsMap.type,n)?In(t,n,o,u[e],h):jn(t,n,o,u[e],h);else if(is.test(n))n=n.replace(is,""),(h=as.test(n))&&(n=n.slice(1,-1)),Nn(t,n,o,s,!1,0,u[e],h);else{var l=(n=n.replace(ns,"")).match(hs),c=l&&l[1];h=!1,c&&(n=n.slice(0,-(c.length+1)),as.test(c)&&(c=c.slice(1,-1),h=!0)),Hn(t,n,r,o,c,h,s,u[e])}else jn(t,n,JSON.stringify(o),u[e]),!t.component&&"muted"===n&&ts(t.tag,t.attrsMap.type,n)&&In(t,n,"true",u[e])}}(t),t}function ys(t){var e;if(e=Bn(t,"v-for")){var i=function(t){var e=t.match(rs);if(!e)return;var i={};i.for=e[2].trim();var n=e[1].trim().replace(ss,""),r=n.match(os);r?(i.alias=n.replace(os,"").trim(),i.iterator1=r[1].trim(),r[2]&&(i.iterator2=r[2].trim())):i.alias=n;return i}(e);i&&E(t,i)}}function xs(t,e){t.ifConditions||(t.ifConditions=[]),t.ifConditions.push(e)}function ws(t){var e=t.name.replace(cs,"");return e||"#"!==t.name[0]&&(e="default"),as.test(e)?{name:e.slice(1,-1),dynamic:!0}:{name:'"'+e+'"',dynamic:!1}}function bs(t){var e=t.match(ls);if(e){var i={};return e.forEach(function(t){i[t.slice(1)]=!0}),i}}var Cs=/^xmlns:NS\d+/,Ps=/^NS\d+:/;function Ms(t){return ms(t.tag,t.attrsList.slice(),t.parent)}var Ts=[Co,Mo,{preTransformNode:function(t,e){if("input"===t.tag){var i,n=t.attrsMap;if(!n["v-model"])return;if((n[":type"]||n["v-bind:type"])&&(i=Gn(t,"type")),n.type||i||!n["v-bind"]||(i="("+n["v-bind"]+").type"),i){var r=Bn(t,"v-if",!0),o=r?"&&("+r+")":"",s=null!=Bn(t,"v-else",!0),a=Bn(t,"v-else-if",!0),h=Ms(t);ys(h),zn(h,"type","checkbox"),_s(h,e),h.processed=!0,h.if="("+i+")==='checkbox'"+o,xs(h,{exp:h.if,block:h});var u=Ms(t);Bn(u,"v-for",!0),zn(u,"type","radio"),_s(u,e),xs(h,{exp:"("+i+")==='radio'"+o,block:u});var l=Ms(t);return Bn(l,"v-for",!0),zn(l,":type",i),_s(l,e),xs(h,{exp:r,block:l}),s?h.else=!0:a&&(h.elseif=a),h}}}}];var Ss,As,Es={expectHTML:!0,modules:Ts,directives:{model:function(t,e,i){i;var n=e.value,r=e.modifiers,o=t.tag,s=t.attrsMap.type;if(t.component)return $n(t,n,r),!1;if("select"===o)!function(t,e,i){var n='var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = "_value" in o ? o._value : o.value;return '+(i&&i.number?"_n(val)":"val")+"});";n=n+" "+Un(e,"$event.target.multiple ? $$selectedVal : $$selectedVal[0]"),Nn(t,"change",n,null,!0)}(t,n,r);else if("input"===o&&"checkbox"===s)!function(t,e,i){var n=i&&i.number,r=Gn(t,"value")||"null",o=Gn(t,"true-value")||"true",s=Gn(t,"false-value")||"false";In(t,"checked","Array.isArray("+e+")?_i("+e+","+r+")>-1"+("true"===o?":("+e+")":":_q("+e+","+o+")")),Nn(t,"change","var $$a="+e+",$$el=$event.target,$$c=$$el.checked?("+o+"):("+s+");if(Array.isArray($$a)){var $$v="+(n?"_n("+r+")":r)+",$$i=_i($$a,$$v);if($$el.checked){$$i<0&&("+Un(e,"$$a.concat([$$v])")+")}else{$$i>-1&&("+Un(e,"$$a.slice(0,$$i).concat($$a.slice($$i+1))")+")}}else{"+Un(e,"$$c")+"}",null,!0)}(t,n,r);else if("input"===o&&"radio"===s)!function(t,e,i){var n=i&&i.number,r=Gn(t,"value")||"null";In(t,"checked","_q("+e+","+(r=n?"_n("+r+")":r)+")"),Nn(t,"change",Un(e,r),null,!0)}(t,n,r);else if("input"===o||"textarea"===o)!function(t,e,i){var n=t.attrsMap.type,r=i||{},o=r.lazy,s=r.number,a=r.trim,h=!o&&"range"!==n,u=o?"change":"range"===n?tr:"input",l="$event.target.value";a&&(l="$event.target.value.trim()"),s&&(l="_n("+l+")");var c=Un(e,l);h&&(c="if($event.target.composing)return;"+c),In(t,"value","("+e+")"),Nn(t,u,c,null,!0),(a||s)&&Nn(t,"blur","$forceUpdate()")}(t,n,r);else if(!N.isReservedTag(o))return $n(t,n,r),!1;return!0},text:function(t,e){e.value&&In(t,"textContent","_s("+e.value+")",e)},html:function(t,e){e.value&&In(t,"innerHTML","_s("+e.value+")",e)}},isPreTag:function(t){return"pre"===t},isUnaryTag:So,mustUseProp:ji,canBeLeftOpenTag:Ao,isReservedTag:Ki,getTagNamespace:Qi,staticKeys:function(t){return t.reduce(function(t,e){return t.concat(e.staticKeys||[])},[]).join(",")}(Ts)},ks=w(function(t){return g("type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap"+(t?","+t:""))});function Rs(t,e){t&&(Ss=ks(e.staticKeys||""),As=e.isReservedTag||O,function t(e){e.static=function(t){if(2===t.type)return!1;if(3===t.type)return!0;return!(!t.pre&&(t.hasBindings||t.if||t.for||m(t.tag)||!As(t.tag)||function(t){for(;t.parent;){if("template"!==(t=t.parent).tag)return!1;if(t.for)return!0}return!1}(t)||!Object.keys(t).every(Ss)))}(e);if(1===e.type){if(!As(e.tag)&&"slot"!==e.tag&&null==e.attrsMap["inline-template"])return;for(var i=0,n=e.children.length;i<n;i++){var r=e.children[i];t(r),r.static||(e.static=!1)}if(e.ifConditions)for(var o=1,s=e.ifConditions.length;o<s;o++){var a=e.ifConditions[o].block;t(a),a.static||(e.static=!1)}}}(t),function t(e,i){if(1===e.type){if((e.static||e.once)&&(e.staticInFor=i),e.static&&e.children.length&&(1!==e.children.length||3!==e.children[0].type))return void(e.staticRoot=!0);if(e.staticRoot=!1,e.children)for(var n=0,r=e.children.length;n<r;n++)t(e.children[n],i||!!e.for);if(e.ifConditions)for(var o=1,s=e.ifConditions.length;o<s;o++)t(e.ifConditions[o].block,i)}}(t,!1))}var Os=/^([\w$_]+|\([^)]*?\))\s*=>|^function(?:\s+[\w$]+)?\s*\(/,Ls=/\([^)]*?\);*$/,Ds=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Is={esc:27,tab:9,enter:13,space:32,up:38,left:37,right:39,down:40,delete:[8,46]},js={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]},zs=function(t){return"if("+t+")return null;"},Hs={stop:"$event.stopPropagation();",prevent:"$event.preventDefault();",self:zs("$event.target !== $event.currentTarget"),ctrl:zs("!$event.ctrlKey"),shift:zs("!$event.shiftKey"),alt:zs("!$event.altKey"),meta:zs("!$event.metaKey"),left:zs("'button' in $event && $event.button !== 0"),middle:zs("'button' in $event && $event.button !== 1"),right:zs("'button' in $event && $event.button !== 2")};function Fs(t,e){var i=e?"nativeOn:":"on:",n="",r="";for(var o in t){var s=Ns(t[o]);t[o]&&t[o].dynamic?r+=o+","+s+",":n+='"'+o+'":'+s+","}return n="{"+n.slice(0,-1)+"}",r?i+"_d("+n+",["+r.slice(0,-1)+"])":i+n}function Ns(t){if(!t)return"function(){}";if(Array.isArray(t))return"["+t.map(function(t){return Ns(t)}).join(",")+"]";var e=Ds.test(t.value),i=Os.test(t.value),n=Ds.test(t.value.replace(Ls,""));if(t.modifiers){var r="",o="",s=[];for(var a in t.modifiers)if(Hs[a])o+=Hs[a],Is[a]&&s.push(a);else if("exact"===a){var h=t.modifiers;o+=zs(["ctrl","shift","alt","meta"].filter(function(t){return!h[t]}).map(function(t){return"$event."+t+"Key"}).join("||"))}else s.push(a);return s.length&&(r+=function(t){return"if(!$event.type.indexOf('key')&&"+t.map(Zs).join("&&")+")return null;"}(s)),o&&(r+=o),"function($event){"+r+(e?"return "+t.value+".apply(null, arguments)":i?"return ("+t.value+").apply(null, arguments)":n?"return "+t.value:t.value)+"}"}return e||i?t.value:"function($event){"+(n?"return "+t.value:t.value)+"}"}function Zs(t){var e=parseInt(t,10);if(e)return"$event.keyCode!=="+e;var i=Is[t],n=js[t];return"_k($event.keyCode,"+JSON.stringify(t)+","+JSON.stringify(i)+",$event.key,"+JSON.stringify(n)+")"}var Gs={on:function(t,e){t.wrapListeners=function(t){return"_g("+t+","+e.value+")"}},bind:function(t,e){t.wrapData=function(i){return"_b("+i+",'"+t.tag+"',"+e.value+","+(e.modifiers&&e.modifiers.prop?"true":"false")+(e.modifiers&&e.modifiers.sync?",true":"")+")"}},cloak:R},Bs=function(t){this.options=t,this.warn=t.warn||Ln,this.transforms=Dn(t.modules,"transformCode"),this.dataGenFns=Dn(t.modules,"genData"),this.directives=E(E({},Gs),t.directives);var e=t.isReservedTag||O;this.maybeComponent=function(t){return!!t.component||!e(t.tag)},this.onceId=0,this.staticRenderFns=[],this.pre=!1};function Ws(t,e){var i=new Bs(e);return{render:"with(this){return "+(t?"script"===t.tag?"null":Vs(t,i):'_c("div")')+"}",staticRenderFns:i.staticRenderFns}}function Vs(t,e){if(t.parent&&(t.pre=t.pre||t.parent.pre),t.staticRoot&&!t.staticProcessed)return $s(t,e);if(t.once&&!t.onceProcessed)return Us(t,e);if(t.for&&!t.forProcessed)return qs(t,e);if(t.if&&!t.ifProcessed)return Js(t,e);if("template"!==t.tag||t.slotTarget||e.pre){if("slot"===t.tag)return function(t,e){var i=t.slotName||'"default"',n=Qs(t,e),r="_t("+i+(n?",function(){return "+n+"}":""),o=t.attrs||t.dynamicAttrs?ia((t.attrs||[]).concat(t.dynamicAttrs||[]).map(function(t){return{name:C(t.name),value:t.value,dynamic:t.dynamic}})):null,s=t.attrsMap["v-bind"];!o&&!s||n||(r+=",null");o&&(r+=","+o);s&&(r+=(o?"":",null")+","+s);return r+")"}(t,e);var i;if(t.component)i=function(t,e,i){var n=e.inlineTemplate?null:Qs(e,i,!0);return"_c("+t+","+Ys(e,i)+(n?","+n:"")+")"}(t.component,t,e);else{var n;(!t.plain||t.pre&&e.maybeComponent(t))&&(n=Ys(t,e));var r=t.inlineTemplate?null:Qs(t,e,!0);i="_c('"+t.tag+"'"+(n?","+n:"")+(r?","+r:"")+")"}for(var o=0;o<e.transforms.length;o++)i=e.transforms[o](t,i);return i}return Qs(t,e)||"void 0"}function $s(t,e){t.staticProcessed=!0;var i=e.pre;return t.pre&&(e.pre=t.pre),e.staticRenderFns.push("with(this){return "+Vs(t,e)+"}"),e.pre=i,"_m("+(e.staticRenderFns.length-1)+(t.staticInFor?",true":"")+")"}function Us(t,e){if(t.onceProcessed=!0,t.if&&!t.ifProcessed)return Js(t,e);if(t.staticInFor){for(var i="",n=t.parent;n;){if(n.for){i=n.key;break}n=n.parent}return i?"_o("+Vs(t,e)+","+e.onceId+++","+i+")":Vs(t,e)}return $s(t,e)}function Js(t,e,i,n){return t.ifProcessed=!0,function t(e,i,n,r){if(!e.length)return r||"_e()";var o=e.shift();return o.exp?"("+o.exp+")?"+s(o.block)+":"+t(e,i,n,r):""+s(o.block);function s(t){return n?n(t,i):t.once?Us(t,i):Vs(t,i)}}(t.ifConditions.slice(),e,i,n)}function qs(t,e,i,n){var r=t.for,o=t.alias,s=t.iterator1?","+t.iterator1:"",a=t.iterator2?","+t.iterator2:"";return t.forProcessed=!0,(n||"_l")+"(("+r+"),function("+o+s+a+"){return "+(i||Vs)(t,e)+"})"}function Ys(t,e){var i="{",n=function(t,e){var i=t.directives;if(!i)return;var n,r,o,s,a="directives:[",h=!1;for(n=0,r=i.length;n<r;n++){o=i[n],s=!0;var u=e.directives[o.name];u&&(s=!!u(t,o,e.warn)),s&&(h=!0,a+='{name:"'+o.name+'",rawName:"'+o.rawName+'"'+(o.value?",value:("+o.value+"),expression:"+JSON.stringify(o.value):"")+(o.arg?",arg:"+(o.isDynamicArg?o.arg:'"'+o.arg+'"'):"")+(o.modifiers?",modifiers:"+JSON.stringify(o.modifiers):"")+"},")}if(h)return a.slice(0,-1)+"]"}(t,e);n&&(i+=n+","),t.key&&(i+="key:"+t.key+","),t.ref&&(i+="ref:"+t.ref+","),t.refInFor&&(i+="refInFor:true,"),t.pre&&(i+="pre:true,"),t.component&&(i+='tag:"'+t.tag+'",');for(var r=0;r<e.dataGenFns.length;r++)i+=e.dataGenFns[r](t);if(t.attrs&&(i+="attrs:"+ia(t.attrs)+","),t.props&&(i+="domProps:"+ia(t.props)+","),t.events&&(i+=Fs(t.events,!1)+","),t.nativeEvents&&(i+=Fs(t.nativeEvents,!0)+","),t.slotTarget&&!t.slotScope&&(i+="slot:"+t.slotTarget+","),t.scopedSlots&&(i+=function(t,e,i){var n=t.for||Object.keys(e).some(function(t){var i=e[t];return i.slotTargetDynamic||i.if||i.for||Xs(i)}),r=!!t.if;if(!n)for(var o=t.parent;o;){if(o.slotScope&&o.slotScope!==gs||o.for){n=!0;break}o.if&&(r=!0),o=o.parent}var s=Object.keys(e).map(function(t){return Ks(e[t],i)}).join(",");return"scopedSlots:_u(["+s+"]"+(n?",null,true":"")+(!n&&r?",null,false,"+function(t){var e=5381,i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e>>>0}(s):"")+")"}(t,t.scopedSlots,e)+","),t.model&&(i+="model:{value:"+t.model.value+",callback:"+t.model.callback+",expression:"+t.model.expression+"},"),t.inlineTemplate){var o=function(t,e){var i=t.children[0];0;if(i&&1===i.type){var n=Ws(i,e.options);return"inlineTemplate:{render:function(){"+n.render+"},staticRenderFns:["+n.staticRenderFns.map(function(t){return"function(){"+t+"}"}).join(",")+"]}"}}(t,e);o&&(i+=o+",")}return i=i.replace(/,$/,"")+"}",t.dynamicAttrs&&(i="_b("+i+',"'+t.tag+'",'+ia(t.dynamicAttrs)+")"),t.wrapData&&(i=t.wrapData(i)),t.wrapListeners&&(i=t.wrapListeners(i)),i}function Xs(t){return 1===t.type&&("slot"===t.tag||t.children.some(Xs))}function Ks(t,e){var i=t.attrsMap["slot-scope"];if(t.if&&!t.ifProcessed&&!i)return Js(t,e,Ks,"null");if(t.for&&!t.forProcessed)return qs(t,e,Ks);var n=t.slotScope===gs?"":String(t.slotScope),r="function("+n+"){return "+("template"===t.tag?t.if&&i?"("+t.if+")?"+(Qs(t,e)||"undefined")+":undefined":Qs(t,e)||"undefined":Vs(t,e))+"}",o=n?"":",proxy:true";return"{key:"+(t.slotTarget||'"default"')+",fn:"+r+o+"}"}function Qs(t,e,i,n,r){var o=t.children;if(o.length){var s=o[0];if(1===o.length&&s.for&&"template"!==s.tag&&"slot"!==s.tag){var a=i?e.maybeComponent(s)?",1":",0":"";return""+(n||Vs)(s,e)+a}var h=i?function(t,e){for(var i=0,n=0;n<t.length;n++){var r=t[n];if(1===r.type){if(ta(r)||r.ifConditions&&r.ifConditions.some(function(t){return ta(t.block)})){i=2;break}(e(r)||r.ifConditions&&r.ifConditions.some(function(t){return e(t.block)}))&&(i=1)}}return i}(o,e.maybeComponent):0,u=r||ea;return"["+o.map(function(t){return u(t,e)}).join(",")+"]"+(h?","+h:"")}}function ta(t){return void 0!==t.for||"template"===t.tag||"slot"===t.tag}function ea(t,e){return 1===t.type?Vs(t,e):3===t.type&&t.isComment?(n=t,"_e("+JSON.stringify(n.text)+")"):"_v("+(2===(i=t).type?i.expression:na(JSON.stringify(i.text)))+")";var i,n}function ia(t){for(var e="",i="",n=0;n<t.length;n++){var r=t[n],o=na(r.value);r.dynamic?i+=r.name+","+o+",":e+='"'+r.name+'":'+o+","}return e="{"+e.slice(0,-1)+"}",i?"_d("+e+",["+i.slice(0,-1)+"])":e}function na(t){return t.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}new RegExp("\\b"+"do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments".split(",").join("\\b|\\b")+"\\b"),new RegExp("\\b"+"delete,typeof,void".split(",").join("\\s*\\([^\\)]*\\)|\\b")+"\\s*\\([^\\)]*\\)");function ra(t,e){try{return new Function(t)}catch(i){return e.push({err:i,code:t}),R}}function oa(t){var e=Object.create(null);return function(i,n,r){(n=E({},n)).warn;delete n.warn;var o=n.delimiters?String(n.delimiters)+i:i;if(e[o])return e[o];var s=t(i,n);var a={},h=[];return a.render=ra(s.render,h),a.staticRenderFns=s.staticRenderFns.map(function(t){return ra(t,h)}),e[o]=a}}var sa,aa,ha=(sa=function(t,e){var i=vs(t.trim(),e);!1!==e.optimize&&Rs(i,e);var n=Ws(i,e);return{ast:i,render:n.render,staticRenderFns:n.staticRenderFns}},function(t){function e(e,i){var n=Object.create(t),r=[],o=[],s=function(t,e,i){(i?o:r).push(t)};if(i)for(var a in i.modules&&(n.modules=(t.modules||[]).concat(i.modules)),i.directives&&(n.directives=E(Object.create(t.directives||null),i.directives)),i)"modules"!==a&&"directives"!==a&&(n[a]=i[a]);n.warn=s;var h=sa(e.trim(),n);return h.errors=r,h.tips=o,h}return{compile:e,compileToFunctions:oa(e)}})(Es),ua=(ha.compile,ha.compileToFunctions);function la(t){return(aa=aa||document.createElement("div")).innerHTML=t?'<a href="\n"/>':'<div a="\n"/>',aa.innerHTML.indexOf("&#10;")>0}var ca=!!U&&la(!1),fa=!!U&&la(!0),da=w(function(t){var e=nn(t);return e&&e.innerHTML}),pa=Ti.prototype.$mount;Ti.prototype.$mount=function(t,e){if((t=t&&nn(t))===document.body||t===document.documentElement)return this;var i=this.$options;if(!i.render){var n=i.template;if(n)if("string"==typeof n)"#"===n.charAt(0)&&(n=da(n));else{if(!n.nodeType)return this;n=n.innerHTML}else t&&(n=function(t){if(t.outerHTML)return t.outerHTML;var e=document.createElement("div");return e.appendChild(t.cloneNode(!0)),e.innerHTML}(t));if(n){0;var r=ua(n,{outputSourceRange:!1,shouldDecodeNewlines:ca,shouldDecodeNewlinesForHref:fa,delimiters:i.delimiters,comments:i.comments},this),o=r.render,s=r.staticRenderFns;i.render=o,i.staticRenderFns=s}}return pa.call(this,t,e)},Ti.compile=ua,e.a=Ti}).call(e,i("DuR2"))},DuR2:function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},"VU/8":function(t,e){t.exports=function(t,e,i,n,r,o){var s,a=t=t||{},h=typeof t.default;"object"!==h&&"function"!==h||(s=t,a=t.default);var u,l="function"==typeof a?a.options:a;if(e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0),i&&(l.functional=!0),r&&(l._scopeId=r),o?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=u):n&&(u=n),u){var c=l.functional,f=c?l.render:l.beforeCreate;c?(l._injectStyles=u,l.render=function(t,e){return u.call(e),f(t,e)}):l.beforeCreate=f?[].concat(f,u):[u]}return{esModule:s,exports:a,options:l}}},W2nU:function(t,e){var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var h,u=[],l=!1,c=-1;function f(){l&&h&&(l=!1,h.length?u=h.concat(u):c=-1,u.length&&d())}function d(){if(!l){var t=a(f);l=!0;for(var e=u.length;e;){for(h=u,u=[];++c<e;)h&&h[c].run();c=-1,e=u.length}h=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new p(t,e)),1!==u.length||l||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},mEuU:function(t,e,i){"use strict";(function(t,n){i.d(e,"a",function(){return co}),i.d(e,"c",function(){return Ja}),i.d(e,"d",function(){return ls}),i.d(e,"b",function(){return Ro});
/*!
 * maptalks v1.0.0-beta.7
 * LICENSE : BSD-3-Clause
 * (c) 2016-2021 maptalks.org
 */
var r=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],o=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(r),s=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],a=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],h={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},u=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],l=14;function c(){return Date.now()}function f(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function d(t){return null==t}function p(t){return"number"==typeof t&&!isNaN(t)}function g(t){return(0|t)===t}function m(t){return"object"==typeof t&&!!t}function v(t){return!d(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function _(t){return!d(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var y=Object.prototype.hasOwnProperty;function x(t,e){return y.call(t,e)}var w=Math.PI/180;function b(t){return t*w}function C(t){return t/w}var P="[object process]"===Object.prototype.toString.call(void 0!==t?t:0)&&!t.versions.electron&&!t.versions.nw&&!t.versions["node-webkit"],M={};if(!P){var T=navigator.userAgent.toLowerCase(),S=document.documentElement,A="ActiveXObject"in window,E=-1!==T.indexOf("webkit"),k=-1!==T.indexOf("phantom"),R=-1!==T.search("android [23]"),O=-1!==T.indexOf("chrome"),L=-1!==T.indexOf("gecko")&&!E&&!window.opera&&!A,D="undefined"!=typeof orientation||-1!==T.indexOf("mobile"),I=!window.PointerEvent&&window.MSPointerEvent,j=window.PointerEvent&&navigator.pointerEnabled||I,z=A&&"transition"in S.style,H="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!R,F="MozPerspective"in S.style,N="OTransition"in S.style,Z=(z||H||F)&&!N&&!k,G="undefined"!=typeof window&&_(window.createImageBitmap),B="undefined"!=typeof window&&_(window.ResizeObserver),W="undefined"!=typeof window&&_(window.btoa),V=0;O&&(V=T.match(/chrome\/([\d.]+)/)[1]);var $=!k&&(j||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),U="undefined"!=typeof window&&"WebGLRenderingContext"in window,J=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI;M={ie:A,ielt9:A&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:E,gecko:L,android:-1!==T.indexOf("android"),android23:R,chrome:O,chromeVersion:V,safari:!O&&-1!==T.indexOf("safari"),phantomjs:k,ie3d:z,webkit3d:H,gecko3d:F,opera12:N,any3d:Z,mobile:D,mobileWebkit:D&&E,mobileWebkit3d:D&&H,mobileOpera:D&&window.opera,mobileGecko:D&&L,touch:!!$,msPointer:!!I,pointer:!!j,retina:J>1,devicePixelRatio:J,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:A&&9===document.documentMode,ie10:A&&10===document.documentMode,webgl:U,imageBitMap:G,resizeObserver:B,btoa:W}}var q=M;function Y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function X(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var K,Q,tt=function(){function t(t,e){if(d(t)||d(e)?d(t.x)||d(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1]):(this.x=+t.x,this.y=+t.y):(this.x=+t,this.y=+e),this._isNaN())throw new Error("Position is NaN")}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},e._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},e._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},e.distanceTo=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},e.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},e.copy=function(){return new this.constructor(this.x,this.y)},e._add=function(t,e){return d(t.x)?d(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e.add=function(t,e){var i,n;return d(t.x)?d(t[0])?(i=this.x+t,n=this.y+e):(i=this.x+t[0],n=this.y+t[1]):(i=this.x+t.x,n=this.y+t.y),new this.constructor(i,n)},e._sub=function(t,e){return d(t.x)?d(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(t,e){var i,n;return d(t.x)?d(t[0])?(i=this.x-t,n=this.y-e):(i=this.x-t[0],n=this.y-t[1]):(i=this.x-t.x,n=this.y-t.y),new this.constructor(i,n)},e.substract=function(){return this.sub.apply(this,arguments)},e.multi=function(t){return new this.constructor(this.x*t,this.y*t)},e._multi=function(t){return this.x*=t,this.y*=t,this},e.div=function(t){return this.multi(1/t)},e._div=function(t){return this._multi(1/t)},e.equals=function(t){return t instanceof this.constructor&&(this.x===t.x&&this.y===t.y)},e._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},e.isZero=function(){return 0===this.x&&0===this.y},e.toArray=function(){return[this.x,this.y]},e.toFixed=function(t){return new this.constructor(this.x.toFixed(t),this.y.toFixed(t))},e.toJSON=function(){return{x:this.x,y:this.y}},t}(),et=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},i.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.unit=function(){return this.copy()._unit()},i._unit=function(){return this._div(this.mag()),this},i.perp=function(){return this.copy()._perp()},i._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},i.angleWith=function(t){return this.angleWithSep(t.x,t.y)},i.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},i._rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},i.rotate=function(t){return this.copy()._rotate(t)},e}(tt);function it(t){return t.length>4&&".svg"===t.slice(-4)?1:"data:image/svg+xml"===t.slice(0,"data:image/svg+xml".length)?2:0}function nt(t,e){P&&nt.node?nt.node(t,e):t.src=e[0]}!function(){if(P)return K=function(t){return setTimeout(t,16)},void(Q=clearTimeout);var t,e,i=1e3/30;function n(t){return setTimeout(t,i)}function r(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(t=window.requestAnimationFrame||r("RequestAnimationFrame")||n,e=window.cancelAnimationFrame||r("CancelAnimationFrame")||r("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(t=n,e=clearTimeout),K=function(e){return t(e)},Q=function(t){t&&e(t)}}();var rt=0;function ot(){return rt++}function st(t){return t&&v(t)?JSON.parse(t):t}function at(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n=0,r=i.length;n<r;n++)t.push(i[n])}return t.length}function ht(t,e){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function ut(t,e,i){if(!Array.isArray(t))return i?e.call(i,t):e(t);for(var n,r,o=[],s=0,a=t.length;s<a;s++)d(n=t[s])?o.push(null):Array.isArray(n)?o.push(ut(n,e,i)):(r=i?e.call(i,n):e(n),o.push(r));return o}function lt(t,e){return void 0===t?e:t}function ct(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):t>0?1:-1}function ft(t){if(Math.log2)return Math.log2(t);var e=Math.log(t)*Math.LOG2E,i=Math.round(e);return Math.abs(i-e)<1e-14?i:e}function dt(t,e,i){return t*(1-i)+e*i}function pt(t,e,i){if(t===i||t===e)return t;var n=i-e;return((t-e)%n+n)%n+e}function gt(t,e,i){return Math.min(i,Math.max(e,t))}function mt(t){return Array.isArray(t)&&t.length>0}var vt=/^url\((['"])(.+)\1\)$/i,_t=/^url\(([^'"].*[^'"])\)$/i;function yt(t){return v(t)?_t.test(t)?1:vt.test(t)?2:3:0}function xt(t){var e=yt(t);return 3===e?t:1===e?_t.exec(t)[1]:2===e?vt.exec(t)[2]:t}var wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function bt(t){if(q.btoa)return window.btoa(t);for(var e,i,n=String(t),r="",o=0,s=wt;n.charAt(0|o)||(s="=",o%1);r+=s.charAt(63&e>>8-o%1*8)){if((i=n.charCodeAt(o+=.75))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|i}return r}function Ct(t,e){for(var i=atob(t),n=new ArrayBuffer(i.length),r=new Uint8Array(n),o=0;o<i.length;o++)r[o]=255&i.charCodeAt(o);return new Blob([n],{type:e})}function Pt(t,e,i,n){var r=i-t,o=n-e;return Math.atan2(o,r)}var Mt="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function Tt(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var i in t)if("center"===i){if(!e[i]||!St(t[i][0],e[i][0])||!St(t[i][1],e[i][1]))return!1}else if(t[i]!==e[i])return!1;return!0}function St(t,e,i){return null==i&&(i=1e-6),t>=e-i&&t<=e+i}function At(t,e,i,n){t||(t=100),e||(e=4);var r=this;return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout(function o(){if(0===e)return r.show(),void(i&&(n?i.call(n):i()));e%2==0?r.hide():r.show(),e--,r._flashTimeout=setTimeout(o,t)},t),this}function Et(t,e){void 0===t&&(t=[]),void 0===e&&(e="_pt");for(var i=[],n=0,r=t.length;n<r;n++){var o=t[n];o[e]||(o[e]=new et(0,0));var s=o[e];s.x=0,s.y=0,i.push(s)}return i}function kt(t,e){for(var i=0;i<t.stops.length;i++)if(e===t.stops[i][0])return t.stops[i][1];return t.default}function Rt(t,e){for(var i=0;i<t.stops.length&&!(e<t.stops[i][0]);i++);return t.stops[Math.max(i-1,0)][1]}function Ot(t,e){for(var i=void 0!==t.base?t.base:1,n=0;!(n>=t.stops.length||e<=t.stops[n][0]);)n++;return 0===n?t.stops[n][1]:n===t.stops.length?t.stops[n-1][1]:function t(e,i,n,r,o,s){return"function"==typeof o?function(){var a=o.apply(void 0,arguments),h=s.apply(void 0,arguments);return t(e,i,n,r,a,h)}:o.length?function(t,e,i,n,r,o){for(var s=[],a=0;a<r.length;a++)s[a]=Dt(t,e,i,n,r[a],o[a]);return s}(e,i,n,r,o,s):Dt(e,i,n,r,o,s)}(e,i,t.stops[n-1][0],t.stops[n][0],t.stops[n-1][1],t.stops[n][1])}function Lt(t,e){return i=e,n=t.default,void 0!==i?i:void 0!==n?n:void 0!==r?r:null;var i,n,r}function Dt(t,e,i,n,r,o){var s,a=n-i,h=t-i;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function It(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function jt(t){for(var e in t)if(It(t[e]))return!0;return!1}function zt(t){return Nt(t,"exponential")}function Ht(t,e){if(!t)return null;var i=!1;if(Array.isArray(t)){for(var n,r=[],o=0;o<t.length;o++)(n=Ht(t[o],e))?(r.push(n),i=!0):r.push(t[o]);return i?r:t}var s,a={__fn_types_loaded:!0},h=[];for(s in t)t.hasOwnProperty(s)&&h.push(s);for(var u=function(t){Object.defineProperty(a,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=zt(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},l=0,c=h.length;l<c;l++)It(t[s=h[l]])?(i=!0,a["_"+s]=t[s],u(s)):a[s]=t[s];return i?a:t}function Ft(t){if(!t||!t.stops)return[];for(var e=[],i=0,n=t.stops.length;i<n;i++)e.push(t.stops[i][1]);return e}function Nt(t,e){if(!It(t))return function(){return t};var i=!0,n=!0,r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(var o=0;o<r.length;o++)if(It(r[o][1])){var s=Nt(r[o][1],e);i=i&&s.isZoomConstant,n=n&&s.isFeatureConstant,r[o]=[r[o][0],s]}var a=function t(e,i){var n,r,o;if(It(e)){var s,a=e.stops&&"object"==typeof e.stops[0][0],h=a||void 0!==e.property,u=a||!h,l=e.type||i||"exponential";if("exponential"===l)s=Ot;else if("interval"===l)s=Rt;else if("categorical"===l)s=kt;else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');s=Lt}if(a){for(var c={},f=[],d=0;d<e.stops.length;d++){var p=e.stops[d];void 0===c[p[0].zoom]&&(c[p[0].zoom]={zoom:p[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),c[p[0].zoom].stops.push([p[0].value,p[1]])}for(var g in c)f.push([c[g].zoom,t(c[g])]);n=function(t,i){var n=Ot({stops:f,base:e.base},t)(t,i);return"function"==typeof n?n(t,i):n},r=!1,o=!1}else u?(n=function(t){var i=s(e,t);return"function"==typeof i?i(t):i},r=!0,o=!1):(n=function(t,i){var n=s(e,i?i[e.property]:null);return"function"==typeof n?n(t,i):n},r=!1,o=!0)}else n=function(){return e},r=!0,o=!0;return n.isZoomConstant=o,n.isFeatureConstant=r,n}(t,e);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=n&&a.isFeatureConstant,a}var Zt=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Gt(t){return new Function("f","var p = (f && f.properties || {}); return "+Bt(t))}function Bt(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?Vt(t[1],t[2],"===",!1):"!="===e?Vt(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?Vt(t[1],t[2],e,!0):"any"===e?$t(t.slice(1),"||"):"all"===e?$t(t.slice(1),"&&"):"none"===e?qt($t(t.slice(1),"||")):"in"===e?Ut(t[1],t.slice(2)):"!in"===e?qt(Ut(t[1],t.slice(2))):"has"===e?Jt(t[1]):"!has"===e?qt(Jt(t[1])):"true")+")"}function Wt(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function Vt(t,e,i,n){var r=Wt(t),o="$type"===t?Zt.indexOf(e):JSON.stringify(e);return(n?"typeof "+r+"=== typeof "+o+"&&":"")+r+i+o}function $t(t,e){return t.map(Bt).join(e)}function Ut(t,e){"$type"===t&&(e=e.map(function(t){return Zt.indexOf(t)}));var i=JSON.stringify(e.sort(Yt)),n=Wt(t);return e.length<=200?i+".indexOf("+n+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+n+", "+i+",0,"+(e.length-1)+")"}function Jt(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function qt(t){return"!("+t+")"}function Yt(t,e){return t<e?-1:t>e?1:0}function Xt(t){var e=t._toJSON(),i=e.feature;return i.type=Zt.indexOf(i.geometry.type),i.subType=e.subType,i}function Kt(t){if(!Array.isArray(t))return Kt([t]);for(var e=[],i=0;i<t.length;i++){var n=void 0;n=!0===t[i].filter?function(){return!0}:Gt(t[i].filter),e.push(Qt({},t[i],{filter:n}))}return e}function Qt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}var te=[],ee={};function ie(t,e){return Ht(t,function(){var t=e.getMap();return function(t,e,i){return t[0]=e,t[1]=i,t}(te,t?t.getZoom():12,f({},e.getProperties(),function(t,e,i,n){return t["{bearing}"]=e,t["{pitch}"]=i,t["{zoom}"]=n,t}(ee,t&&t.getBearing()||0,t&&t.getPitch()||0,t?t.getZoom():10)))})}function ne(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function re(t,e,i){if(!t.markerPath)return null;var n=1,r=ne(t);p(t.markerOpacity)&&(n=t.markerOpacity),p(t.opacity)&&(n*=t.opacity);var o={};if(r){for(var s in r.stroke)r.stroke.hasOwnProperty(s)&&(d(r.stroke[s])||(o[s]=r.stroke[s]));for(var a in r.fill)r.fill.hasOwnProperty(a)&&(d(r.fill[a])||(o[a]=r.fill[a]))}for(var h,u=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath],l=[],c=0;c<u.length;c++)(h=f({},h=v(u[c])?{path:u[c]}:u[c],o)).d=h.path,delete h.path,l.push(h);var g=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];n<1&&g.push('opacity="'+n+'"'),t.markerPathWidth&&t.markerPathHeight&&g.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),g.push('preserveAspectRatio="none"'),e&&g.push('width="'+e+'"'),i&&g.push('height="'+i+'"'),g.push("><defs></defs>");for(var m=0;m<l.length;m++){var _="<path ";for(var y in l[m])l[m].hasOwnProperty(y)&&(_+=" "+y+'="'+l[m][y]+'"');_+="></path>",g.push(_)}return g.push("</svg>"),"data:image/svg+xml;base64,"+bt(g.join(" "))}function oe(t,e){if(!t)return[];var i=t;Array.isArray(t)||(i=[t]);for(var n,r,o,h,u=[],l=s,c=i.length-1;c>=0;c--)if(t=i[c]){e&&(t=se(t));for(var f=0;f<l.length;f++)if(It(n=t[l[f]])&&(n=Ft(n)),n){Array.isArray(n)||(n=[n]);for(var d=0;d<n.length;d++)"url("===n[d].slice(0,4)&&(n[d]=xt(n[d])),r=a[f],u.push([n[d],t[r[0]],t[r[1]]])}if("path"===t.markerType&&t.markerPath)if(o=It(t.markerWidth)?200:t.markerWidth,h=It(t.markerHeight)?200:t.markerHeight,It(t.markerPath)){n=Ft(t.markerPath);for(var p=t.markerPath,g=0;g<n.length;g++)t.markerPath=n[g],u.push([re(t),o,h]);t.markerPath=p}else u.push([re(t),o,h])}return u}function se(t){if(!t)return null;var e=t;if(P)return e;for(var i,n=s,r=0,o=n.length;r<o;r++)(i=e[n[r]])&&(e[n[r]]=ae(i));return e}function ae(t){if(It(t)){for(var e=t.stops,i=0;i<e.length;i++)e[i][1]=ae(e[i][1]);return t}return"url("===t.slice(0,4)&&(t=xt(t)),t}var he=function(){function t(t,e){p(t)&&p(e)?(this.width=t,this.height=e):p(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}var e=t.prototype;return e.copy=function(){return new t(this.width,this.height)},e.add=function(e,i){var n,r;return e instanceof t?(n=this.width+e.width,r=this.height+e.height):(n=this.width+e,r=this.height+i),new t(n,r)},e.equals=function(t){return this.width===t.width&&this.height===t.height},e.multi=function(e){return new t(this.width*e,this.height*e)},e._multi=function(t){return this.width*=t,this.height*=t,this},e._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},e.toPoint=function(){return new et(this.width,this.height)},e.toArray=function(){return[this.width,this.height]},e.toJSON=function(){return{width:this.width,height:this.height}},t}();function ue(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}var le=/[\b\t\r\v\f]/gim;function ce(t){return v(t)?t.replace(le,""):t}function fe(t){return ue(t).split(/\s+/)}var de="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function pe(t,e){return pe.node?pe.node(t,e):(de.font=e,de.measureText(t).width)}function ge(t,e,i){var n=pe(t,e);return new he(n,i||l)}function me(t,e,i,n){if(!t||0===t.length)return[{text:"",width:0}];var r=d(n)?pe(t,e):n,o=r/t.length,s=Math.floor(i/o/2);if(o>=i||s<=0)return[{text:"",width:i}];if(r<=i)return[{text:t,width:r}];for(var a=[],h=t.substring(0,s),u=o*s,l=s,c=t.length;l<c;l++){var f=t[l],p=pe(h+f);p>=i?(a.push({text:h,width:u}),h=t.substring(l,s+l),l+=s-1,u=o*s):(h+=f,u=p),l>=c-1&&(u=pe(h),a.push({text:h,width:u}))}return a}var ve=/\{([\w_]+)\}/g;function _e(t,e){return v(t)?t.replace(ve,function(t,i){if(!e)return"";var n=e[i];return d(n)?"":Array.isArray(n)?n.join():n}):t}function ye(t,e){p(t)&&(t+=""),t=t||"";var i=e.textMaxHeight||0,n=Ce(t,e);return i&&i<n.size.height&&(n.size.height=i),n}function xe(t,e,i){var n=t.width,r=t.height;return new et("left"===e?-n:"right"===e?0:-n/2,"top"===i?-r:"bottom"===i?0:-r/2)}var we="monospace";function be(t){return t.textFont?t.textFont:(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+t.textSize+"px "+(t.textFaceName?'"'===t.textFaceName[0]?t.textFaceName:'"'+t.textFaceName+'"':we)}function Ce(t,e){var i=be(e),n=e.textLineSpacing||0,r=ge(t,i,e.textSize),o=r.width,s=r.height,a=e.textWrapCharacter,h=[],u=e.textWrapWidth;(!u||u>o)&&(u=o),v(t)||(t+="");var l=0;if(a&&t.indexOf(a)>=0)for(var c=t.split(a),f=0,d=c.length;f<d;f++){var p=c[f],g=pe(p,i);if(g>u)for(var m=me(p,i,u,g),_=0,y=m.length;_<y;_++){var x=m[_].width;x>l&&(l=x),h.push({text:m[_].text,size:new he(x,s)})}else g>l&&(l=g),h.push({text:p,size:new he(g,s)})}else if(o>u)for(var w=me(t,i,u,o),b=0;b<w.length;b++){var C=w[b].width;C>l&&(l=C),h.push({text:w[b].text,size:new he(C,s)})}else o>l&&(l=o),h.push({text:t,size:r});var P=h.length;return{total:P,size:new he(l,s*P+n*(P-1)),rows:h,rawSize:r}}function Pe(t){var e=0,i=t&&t.length||0;if(!i)return e;for(var n=0;n<i;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return e}function Me(t){return t&&t.colorStops}function Te(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var i=[],n=t.colorStops.length-1;n>=0;n--)i.push(t.colorStops[n].join());e.push(i.join(","))}return e.join("_")}function Se(t,e){if(!t)return 1;var i=[];if(Array.isArray(t)){for(var n=0;n<t.length;n++)i.push(Se(t[n],e));return i.sort().join(",")}var r=Object.keys(t).sort().reduce(function(i,n){return e&&0!==n.indexOf(e)||(i[n]=t[n]),i},{});return Pe(JSON.stringify(r))}function Ae(t,e){function i(t,e){d(t.opacity)?t.opacity=e:t.opacity*=e}var n;if(Array.isArray(t)){n=[];for(var r=0;r<t.length;r++){var o=f({},t[r]);i(o,e),n.push(o)}}else i(n=f({},t),e);return n}function Ee(t){var e=Array.prototype.slice.call(arguments,1);if(e&&e.length||(e=[{}]),Array.isArray(t)){for(var i,n,r=[],o=0,s=t.length;o<s;o++){i=t[o],n={};for(var a=0,h=e.length;a<h;a++)Array.isArray(e[a])?d(e[a][o])?f(n,i||{}):f(n,i,e[a][o]):f(n,i,e[a]?e[a]:{});r.push(n)}return r}var u=[{},t];return u.push.apply(u,e),f.apply(this,u)}function ke(t){if(t.symbol&&(t=[t]),Array.isArray(t))return t;var e=t.$root,i=t.$iconset;if(t=t.style,e||i){e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),i&&"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));Re(t,function(t){return"{$root}"===t?e:"{$iconset}"===t?i:null})}return t}function Re(t,e){for(var i=0;i<t.length;i++){var n=t[i].symbol;n&&Le(n,e)}}var Oe=/(\{\$root\}|\{\$iconset\})/g;function Le(t,e){for(var i in t)t.hasOwnProperty(i)&&"textName"!==i&&(v(t[i])&&t[i].length>2?t[i]=t[i].replace(Oe,e):It(t[i])?t[i]=De(t[i],e):m(t[i])&&Le(t[i],e))}function De(t,e){var i=t.default;v(i)&&(t.default=i.replace(Oe,e));for(var n=t.stops,r=0;r<n.length;r++)Array.isArray(n[r])&&(v(n[r][1])?n[r][1]=n[r][1].replace(Oe,e):It(n[r][1])&&(n[r][1]=De(n[r][1],e)));return t}function Ie(t){void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);for(var e=t.length,i=0;i<e;i++){var n=t[i];if(n.style){var r=n.style,o=r.lineDasharray,s=r.lineWidth;if(s&&p(s)&&s>0&&o&&Array.isArray(o)&&o.length)return!0}}return!1}var je=P?function(t){return t[0]}:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1},ze=je(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),He=je(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),Fe=je(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]);je(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function Ne(t,e){var i=document.createElement(t);return e&&ei(i,e),i}function Ze(t,e,i){var n=Ne(t);return e&&Ke(n,e),i&&i.appendChild(n),n}function Ge(t){if(!t)return this;if(q.ielt9||q.ie9){var e=Ne("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function Be(t,e,i,n){if(!(t&&t.addEventListener&&e&&i))return this;for(var r=function(e){e||(e=window.event),i.call(n||t,e)},o=e.split(" "),s=o.length-1;s>=0;s--){var a=o[s];if(a)t["Z__"+a]||(t["Z__"+a]=[]),Ve(t,a,i)>=0&&We(t,a,i),t["Z__"+a].push({callback:r,src:i}),q.ie?t.addEventListener(a,r,!1):t.addEventListener(a,r,{capture:!1,passive:!1})}return this}function We(t,e,i){function n(e,i){"mousewheel"===e&&q.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,i,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),o=r.length-1;o>=0;o--){var s=r[o];if(s){if(!i&&t["Z__"+s]){for(var a=t["Z__"+s],h=0,u=a.length;h<u;h++)n(a[h].callback);return delete t["Z__"+s],this}var l=Ve(t,s,i);if(l<0)return this;n(s,t["Z__"+s][l].callback),t["Z__"+s].splice(l,1)}}return this}function Ve(t,e,i){if(!t||!t["Z__"+e]||!i)return-1;for(var n=t["Z__"+e],r=0,o=n.length;r<o;r++)if(n[r].src===i)return r;return-1}function $e(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Ue(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function Je(t){return t.onselectstart=function(){return!1},t.ondragstart=function(){return!1},t.setAttribute("unselectable","on"),this}function qe(t,e){return t?(q.any3d?ni(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function Ye(t){var e=window.getComputedStyle(t),i=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],n=t.getBoundingClientRect(),r=t.offsetWidth,o=t.offsetHeight,s=r?n.width/r:1,a=o?n.height/o:1;return t.__position=[n.left+i[0],n.top+i[1],s,a],t.__position}function Xe(t,e){t||(t=window.event);var i=e.__position;return i||(i=Ye(e)),new et((t.clientX-i[0]-e.clientLeft)/i[2],(t.clientY-i[1]-e.clientTop)/i[3])}function Ke(t,e){var i,n,r,o=t.style.cssText;return n=";",(r=(i=o).length-n.length)>=0&&i.indexOf(n,r)===r||(o+=";"),t.style.cssText=o+e,this}function Qe(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=ii(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function ti(t,e){if(void 0===t.classList||Qe(t,e)){var i=ii(t);ei(t,(i?i+" ":"")+e)}else for(var n=fe(e),r=0,o=n.length;r<o;r++)t.classList.add(n[r]);return this}function ei(t,e){return d(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function ii(t){return d(t.className.baseVal)?t.className:t.className.baseVal}function ni(t,e){var i=e||new et(0,0);return t.style[ze]=q.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)",this}function ri(t){return/<[a-z\][\s\S]*>/i.test(t)}function oi(t,e){var i=si(t);v(e)?i.innerHTML=e:i.appendChild(e);var n=new he(i.clientWidth,i.clientHeight);return Ge(i),n}function si(t){var e=document.createElement(t);return e.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(e),e}var ai=Be,hi=We,ui=function(){function t(t,e){this.max=t,this.onRemove=e,this.reset()}var e=t.prototype;return e.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},e.has=function(t){return t in this.data},e.keys=function(){return this.order},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},e.get=function(t){return this.has(t)?this.data[t]:null},e.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},e.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},t}(),li={jsonp:function(t,e){var i="_maptalks_jsonp_"+ot();t.match(/\?/)?t+="&callback="+i:t+="?callback="+i;var n=document.createElement("script");return n.type="text/javascript",n.src=t,window[i]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(n),this},get:function(t,e,i){if(_(e)){var n=i;i=e,e=n}if(P&&li.get.node)return li.get.node(t,i,e);var r=li._getClient(i);if(r.open("GET",t,!0),e){for(var o in e.headers)r.setRequestHeader(o,e.headers[o]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(null),r},post:function(t,e,i){var n;if(v(t)){if(_(e)){var r=i;i=e,e=r}n=(e=e||{}).postData}else{var o=i;n=e,t=(e=t).url,i=o}if(P&&li.post.node)return e.url=t,li.post.node(e,n,i);var s=li._getClient(i);if(s.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in s)for(var a in e.headers)e.headers.hasOwnProperty(a)&&s.setRequestHeader(a,e.headers[a]);return v(n)||(n=JSON.stringify(n)),s.send(n),s},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=li._wrapCallback(e,t),e},getArrayBuffer:function(t,e,i){if(_(e)){var n=i;i=e,e=n}return e||(e={}),e.responseType="arraybuffer",li.get(t,e,i)},getImage:function(t,e,i){return li.getArrayBuffer(e,i,function(e,i){if(e)t.onerror&&t.onerror(e);else if(i){var n=window.URL||window.webkitURL,r=t.onload;t.onload=function(){r&&r(),n.revokeObjectURL(t.src)};var o=new Blob([new Uint8Array(i.data)],{type:i.contentType});t.cacheControl=i.cacheControl,t.expires=i.expires,t.src=i.data.byteLength?n.createObjectURL(o):Mt}})},getJSON:function(t,e,i){if(_(e)){var n=i;i=e,e=n}var r=function(t,e){var n=e?st(e):null;i(t,n)};return e&&e.jsonp?li.jsonp(t,r):li.get(t,e,r)}},ci=!1,fi=null,di=Math.PI/180,pi={setHitTesting:function(t){ci=t},createCanvas:function(t,e,i){var n;return P?n=new i(t,e):((n=Ne("canvas")).width=t,n.height=e),n},prepareCanvasFont:function(t,e){t.textBaseline="top",t.font=be(e);var i=e.textFill;i||(i="#000"),t.fillStyle=pi.getRgba(i,e.textOpacity)},prepareCanvas:function(t,e,i,n){if(e){var r=e.lineWidth;d(r)||t.lineWidth===r||(t.lineWidth=r);var o=e.linePatternFile,s=e.lineColor||"#000";if(n)t.strokeStyle="#000";else if(o&&i){var a;(e.linePatternDx||e.linePatternDy)&&(a=[e.linePatternDx,e.linePatternDy]),pi._setStrokePattern(t,o,r,a,i),e.lineDasharray=[]}else Me(s)?e.lineGradientExtent?t.strokeStyle=pi._createGradient(t,s,e.lineGradientExtent):t.strokeStyle="#000":(Array.isArray(s)&&(s=pi.normalizeColorToRGBA(s)),t.strokeStyle=s);e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&mt(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var h=e.polygonPatternFile,u=e.polygonFill||"rgba(255,255,255,0)";if(n)t.fillStyle="#000";else if(h&&i){var l=vi(h),c=i.getImage([l,null,null]);if(c||(c=i.getImage([l+"-texture",null,r])),it(l)&&c instanceof Image&&(q.edge||q.ie)){var f=c.width||20,p=c.height||20,g=pi.createCanvas(f,p);pi.image(g.getContext("2d"),c,0,0,f,p),c=g}c?(t.fillStyle=t.createPattern(c,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",l)}else Me(u)?e.polygonGradientExtent?t.fillStyle=pi._createGradient(t,u,e.polygonGradientExtent):t.fillStyle="rgba(255,255,255,0)":(Array.isArray(u)&&(u=pi.normalizeColorToRGBA(u)),t.fillStyle=u)}},_createGradient:function(t,e,i){var n=null,r=e.places,o=i.getMin(),s=i.getMax(),a=i.getWidth(),h=i.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,a*r[2],o.x+r[3]*a,o.y+r[4]*h,a*r[5]]}else{var u=i.getCenter()._round();r=[u.x,u.y,Math.abs(u.x-o.x),u.x,u.y,0]}n=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,o.x+r[2]*a,o.y+r[3]*h]}else r=[o.x,o.y,s.x,o.y];n=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach(function(t){n.addColorStop.apply(n,t)}),n},_setStrokePattern:function(t,e,i,n,r){var o,s=vi(e);if(P)o=r.getImage([s,null,i]);else{var a=s+"-texture-"+i;if(!(o=r.getImage(a))){var h=r.getImage([s,null,null]);if(h){var u;u=h.width&&h.height?Math.round(h.width*i/h.height):i;var l=pi.createCanvas(u,i,t.canvas.constructor);pi.image(l.getContext("2d"),h,0,0,u,i),r.addResource([a,null,i],l),o=l}}}o?(t.strokeStyle=t.createPattern(o,"repeat"),t.strokeStyle.linePatternOffset=n):"undefined"!=typeof console&&console.warn("img not found for",s)},clearRect:function(t,e,i,n,r){t.canvas._drawn=!1,t.clearRect(e,i,n,r)},fillCanvas:function(t,e,i,n){if(ci&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=pi._isPattern(t.fillStyle),s=t.fillStyle&&t.fillStyle.polygonPatternOffset,a=s?s[0]:0,h=s?s[1]:0;d(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),o&&(i=i||0,n=n||0,t.translate(i+a,n+h)),t.fill(),o&&t.translate(-i-a,-n-h),e<1&&(t.globalAlpha=r)}},getRgba:function(t,e){return d(e)&&(e=1),"#"!==t[0]?(Array.isArray(t)&&(t=pi.normalizeColorToRGBA(t,e)),t):(7===t.length?(i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(i=17*parseInt(t.substring(1,2),16),n=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+i+","+n+","+r+","+e+")");var i,n,r},normalizeColorToRGBA:function(t,e){return void 0===e&&(e=1),"rgba("+255*t[0]+","+255*t[1]+","+255*t[2]+","+(4===t.length?t[3]:1)*e+")"},image:function(t,e,i,n,r,o){t.canvas._drawn=!0;try{p(r)&&p(o)?t.drawImage(e,i,n,r,o):t.drawImage(e,i,n)}catch(t){console&&(console.warn("error when drawing image on canvas:",t),console.warn(e))}},text:function(t,e,i,n,r){pi._textOnMultiRow(t,r.rows,n,i,r.size,r.rawSize)},_textOnMultiRow:function(t,e,i,n,r,o){for(var s,a,h=xe(r,i.textHorizontalAlignment,i.textVerticalAlignment),u=o.height+i.textLineSpacing,l=n.add(0,h.y),c=i.textMaxHeight,f=0,d=0,p=e.length;d<p&&(s=e[d].text,a=xe(e[d].size,i.textHorizontalAlignment,i.textVerticalAlignment),pi._textOnLine(t,s,l.add(a.x,d*u),i.textHaloRadius,i.textHaloFill,i.textHaloOpacity),!(c>0&&(f+=u)+o.height>=c));d++);},_textOnLine:function(t,e,i,n,r,o){ci&&(o=1);var s,a,h=0!==o&&0!==n;t.textBaseline="top";var u=t.shadowBlur,l=t.shadowOffsetX,c=t.shadowOffsetY;if(h){var f=t.globalAlpha;t.globalAlpha*=o,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*n,Array.isArray(r)&&(r=pi.normalizeColorToRGBA(r)),t.strokeStyle=r,t.strokeText(e,i.x,i.y+1),t.miterLimit=10,t.globalAlpha=f,s=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",a=t.fillStyle,t.fillStyle="#000"}u&&h&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),pi.fillText(t,e,i),s&&(t.globalCompositeOperation=s,pi.fillText(t,e,i,a),u&&(t.shadowBlur=u,t.shadowOffsetX=l,t.shadowOffsetY=c))},fillText:function(t,e,i,n){t.canvas._drawn=!0,n&&(t.fillStyle=n),t.fillText(e,i.x,i.y+1)},_stroke:function(t,e,i,n){if(ci&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=t.strokeStyle&&t.strokeStyle.linePatternOffset,s=o?o[0]:0,a=o?o[1]:0,h=pi._isPattern(t.strokeStyle)&&(!d(i)&&!d(n)||!d(s)&&!d(a));d(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),h&&(i=i||0,n=n||0,t.translate(i+s,n+a)),t.stroke(),h&&t.translate(-i-s,-n-a),e<1&&(t.globalAlpha=r)}},_path:function(t,e,i,n,r){if(mt(e))for(var o,s,a=mt(i),h=!0!==r&&pi._isPattern(t.strokeStyle),u=0,l=e.length;u<l;u++)if(o=e[u],!a||t.setLineDash)t.lineTo(o.x,o.y),h&&u>0&&(c(e[u-1],o),t.beginPath(),t.moveTo(o.x,o.y));else if(a){if(u===l-1)break;s=e[u+1],gi(t,o,s,i)}function c(e,i){var r=Pt(e.x,e.y,i.x,i.y);t.save();var o=Math.cos(r);Math.abs(o)<1e-7?t.translate(e.x-t.lineWidth/2,e.y):t.translate(e.x,e.y-t.lineWidth/2/o),t.rotate(r),pi._stroke(t,n),t.restore()}},path:function(t,e,i,n,r){mt(e)&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),pi._path(t,e,r,i),pi._stroke(t,i))},_multiClip:function(t,e){if(e&&0!==e.length)for(var i=0,n=(e=e[0]).length;i<n;i++){var r=e[i],o=r.x,s=r.y;0===i?t.moveTo(o,s):t.lineTo(o,s),i===n-1&&(o=e[0].x,s=e[0].y,t.lineTo(o,s))}},polygon:function(t,e,i,n,r,o){if(t.isMultiClip)pi._multiClip(t,e);else if(mt(e)){var s=pi._isPattern(t.strokeStyle),a=mt(r)&&!t.setLineDash||s&&!o;mt(e[0])||(e=[e]);var h,u,l,c=t;if(e.length>1&&!P&&(fi||(fi=pi.createCanvas(1,1)),t.canvas._drawn=!1,fi.width=t.canvas.width,fi.height=t.canvas.height,_i(t=fi.getContext("2d"),c)),a){for(t.save(),u=0,l=e.length;u<l;u++)mt(e[u])&&(pi._ring(t,e[u],null,0,!0),h=n,u>0&&(t.globalCompositeOperation="destination-out",h=1),pi.fillCanvas(t,h,e[u][0].x,e[u][0].y),u>0?t.globalCompositeOperation="source-over":l>1&&(t.fillStyle="#fff"),pi._stroke(t,0));t.restore()}var f=t.fillStyle;for(u=0,l=e.length;u<l;u++)mt(e[u])&&(o?(pi.paintSmoothLine(t,e[u],i,o,!0),t.closePath()):pi._ring(t,e[u],r,i),a||(h=n,u>0&&(t.globalCompositeOperation="destination-out",h=1),pi.fillCanvas(t,h,e[u][0].x,e[u][0].y),u>0?t.globalCompositeOperation="source-over":l>1&&(t.fillStyle="#fff")),pi._stroke(t,i));t.fillStyle!==f&&(t.fillStyle=f),e.length>1&&!P&&(c.drawImage(fi,0,0),c.canvas._drawn=t.canvas._drawn,_i(c,t))}},_ring:function(t,e,i,n,r){var o=pi._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),pi._path(t,e,i,n,r),o||t.closePath()},paintSmoothLine:function(t,e,i,n,r,o,s){if(e)if(e.length<=2||!n)pi.path(t,e,i);else{var a,h=e.length,u=r?h:h-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(u-=Math.max(u-o-1,0));for(var l=0;l<u;l++){var c=e[l].x,f=e[l].y,d=void 0,p=void 0,g=void 0,m=void 0,v=void 0,_=void 0;l-1<0?r?(d=e[u-1].x,p=e[u-1].y):(d=e[l+1].x,p=e[l+1].y):(d=e[l-1].x,p=e[l-1].y),l+1<h?(g=e[l+1].x,m=e[l+1].y):(g=e[l+1-h].x,m=e[l+1-h].y),l+2<h?(v=e[l+2].x,_=e[l+2].y):r?(v=e[l+2-h].x,_=e[l+2-h].y):(v=e[l].x,_=e[l].y);var y=w(d,p,c,f,g,m,v,_,n,l===u-1?s:1);if(l===u-1&&s>=0&&s<1){t.bezierCurveTo(y[0],y[1],y[2],y[3],y[4],y[5]),e.splice(u-1,h-(u-1)-1);var x=new et(y[4],y[5]);x.prevCtrlPoint=new et(y[2],y[3]),e.push(x),h=e.length}else t.bezierCurveTo(y[0],y[1],y[2],y[3],g,m);e[l].nextCtrlPoint=y.slice(0,2),e[l].prevCtrlPoint=a?a.slice(2):null,a=y}!r&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[h-1].prevCtrlPoint||(e[h-1].prevCtrlPoint=e[h-2].nextCtrlPoint),pi._stroke(t,i)}function w(t,e,i,n,r,o,s,a,h,u){var l=(t+i)/2,c=(e+n)/2,f=(i+r)/2,d=(n+o)/2,p=(r+s)/2,g=(o+a)/2,m=Math.sqrt((i-t)*(i-t)+(n-e)*(n-e)),v=Math.sqrt((r-i)*(r-i)+(o-n)*(o-n)),_=m/(m+v),y=v/(v+Math.sqrt((s-r)*(s-r)+(a-o)*(a-o))),x=l+(f-l)*_,w=c+(d-c)*_,b=f+(p-f)*y,C=d+(g-d)*y,P=x+(f-x)*h+i-x,M=w+(d-w)*h+n-w,T=b+(f-b)*h+r-b,S=C+(d-C)*h+o-C,A=[P,M,T,S];return u<1?function(t,e,i,n,r,o,s,a,h,u){var l=1-t,c=1-e,f=i*c*c+2*r*e*c+s*e*e,d=r*c*c+2*s*e*c+h*e*e,p=n*c*c+2*o*e*c+a*e*e,g=o*c*c+2*a*e*c+u*e*e;return[(i*l*l+2*r*t*l+s*t*t)*c+(r*l*l+2*s*t*l+h*t*t)*e,(n*l*l+2*o*t*l+a*t*t)*c+(o*l*l+2*a*t*l+u*t*t)*e,f*l+d*t,p*l+g*t,f*c+d*e,p*c+g*e]}(0,u,i,n,P,M,T,S,r,o):A}},_arcBetween:function(t,e,i,n){var r=n,o=e.distanceTo(i),s=o/2/Math.sin(r/2),a=Math.asin((i.y-e.y)/o);e.x>i.x&&(a=Math.PI-a);var h=a-(90*di-r/2),u=Math.cos(h)*s,l=Math.sin(h)*s,c=e.x+u,f=e.y+l,d=Math.asin((i.y-f)/s);c>i.x&&(d=Math.PI-d);var p=d+r;return t.beginPath(),t.arc(c,f,s,d,p),[c,f]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,i,n){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),pi._bezierCurveTo.apply(pi,o),pi.fillCanvas(t,n),pi._stroke(t,i)},_bezierCurveTo:function(t,e,i,n){t.bezierCurveTo(e.x,e.y,i.x,i.y,n.x,n.y)},ellipse:function(t,e,i,n,r,o,s){var a,h,u,l,c,f,d,p,g;t.beginPath(),i===n&&i===r?t.arc(e.x,e.y,i,0,2*Math.PI):t.ellipse?n!==r?(t.ellipse(e.x,e.y,i,n,0,180*di,360*di,!1),t.ellipse(e.x,e.y,i,r,0,0,180*di,!1)):t.ellipse(e.x,e.y,i,n,0,0,360*di,!1):(a=e.x,h=e.y,d=(u=i)*(f=.5522848),p=(l=n)*f,g=(c=r)*f,t.moveTo(a-u,h),t.bezierCurveTo(a-u,h-p,a-d,h-l,a,h-l),t.bezierCurveTo(a+d,h-l,a+u,h-p,a+u,h),t.bezierCurveTo(a+u,h+g,a+d,h+c,a,h+c),t.bezierCurveTo(a-d,h+c,a-u,h+g,a-u,h),t.closePath()),pi.fillCanvas(t,s,e.x-i,e.y-n),pi._stroke(t,o,e.x-i,e.y-n)},rectangle:function(t,e,i,n,r){var o=e.x,s=e.y;t.beginPath(),t.rect(o,s,i.width,i.height),pi.fillCanvas(t,r,o,s),pi._stroke(t,n,o,s)},sector:function(t,e,i,n,r,o){var s=di,a=n[0],h=n[1];function u(t,e,i,n,a,h){var u=s*-h,l=s*-a;t.beginPath(),t.moveTo(e,i),t.arc(e,i,n,u,l),t.lineTo(e,i),pi.fillCanvas(t,o,e-n,i-n),pi._stroke(t,r,e-n,i-n)}u(t,e.x,e.y,i,a,h)},_isPattern:function(t){return!(v(t)||"addColorStop"in t)},drawCross:function(t,e,i,n,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=n,t.beginPath(),t.moveTo(e-5,i),t.lineTo(e+5,i),t.moveTo(e,i-5),t.lineTo(e,i+5),t.stroke()},copy:function(t,e){var i=e||Ne("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0),i},pixelRect:function(t,e,i,n){var r=t.lineWidth,o=t.globalAlpha,s=!1;if(r>0&&i>0)s=!0,i<1&&(t.globalAlpha*=i);else{if(!(n>0))return;n<1&&(t.globalAlpha*=n)}t.canvas._drawn=!0,s?t.strokeRect(e[0],e[1],1,1):t.fillRect(e[0],e[1],1,1),t.globalAlpha!==o&&(t.globalAlpha=o)}};function gi(t,e,i,n){var r=e.x,o=e.y,s=i.x,a=i.y,h=n,u=function(t,e){return t<=e},l=function(t,e){return t>=e},c=function(t,e){return Math.min(t,e)},f=function(t,e){return Math.max(t,e)},d={thereYet:l,cap:c},p={thereYet:l,cap:c};o-a>0&&(p.thereYet=u,p.cap=f),r-s>0&&(d.thereYet=u,d.cap=f),t.moveTo(r,o);for(var g,m,v=r,_=o,y=0,x=!0;!d.thereYet(v,s)||!p.thereYet(_,a);)g=Math.atan2(a-o,s-r),m=h[y],v=d.cap(s,v+Math.cos(g)*m),_=p.cap(a,_+Math.sin(g)*m),x?t.lineTo(v,_):t.moveTo(v,_),y=(y+1)%h.length,x=!x}var mi="data:image/";function vi(t){return t.substring(0,mi.length)===mi?t:xt(t)}function _i(t,e){t.filter=e.filter,t.fillStyle=e.fillStyle,t.globalAlpha=e.globalAlpha,t.lineCap=e.lineCap,t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle}var yi="undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};function xi(t,e){return t(e={exports:{}},e.exports),e.exports}var wi=xi(function(t){!function(e){function i(t){if(t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}}function n(t,e){if("function"==typeof t.y)try{var i=t.y.call(s,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.resolve(e)}function r(t,e){if("function"==typeof t.n)try{var i=t.n.call(s,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.reject(e)}var o,s,a="fulfilled",h="undefined",u=function(){function t(){for(;i.length-n;){try{i[n]()}catch(t){e.console&&e.console.error(t)}i[n++]=s,n==r&&(i.splice(0,r),n=0)}}var i=[],n=0,r=1024,o=function(){if(typeof MutationObserver!==h){var e=document.createElement("div");return new MutationObserver(t).observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return typeof setImmediate!==h?function(){setImmediate(t)}:function(){setTimeout(t,0)}}();return function(t){i.push(t),i.length-n==1&&o()}}();i.prototype={resolve:function(t){if(this.state===o){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var e=this;if(t&&("function"==typeof t||"object"==typeof t))try{var i=!0,r=t.then;if("function"==typeof r)return void r.call(t,function(t){i&&(i=!1,e.resolve(t))},function(t){i&&(i=!1,e.reject(t))})}catch(t){return void(i&&this.reject(t))}this.state=a,this.v=t,e.c&&u(function(){for(var i=0,r=e.c.length;r>i;i++)n(e.c[i],t)})}},reject:function(t){if(this.state===o){this.state="rejected",this.v=t;var n=this.c;n?u(function(){for(var e=0,i=n.length;i>e;e++)r(n[e],t)}):!i.suppressUncaughtRejectionError&&e.console&&e.console.log("You upset Zousan. Please catch rejections: ",t,t?t.stack:null)}},then:function(t,e){var s=new i,h={y:t,n:e,p:s};if(this.state===o)this.c?this.c.push(h):this.c=[h];else{var l=this.state,c=this.v;u(function(){l===a?n(h,c):r(h,c)})}return s},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,e){e=e||"Timeout";var n=this;return new i(function(i,r){setTimeout(function(){r(Error(e))},t),n.then(function(t){i(t)},function(t){r(t)})})}},i.resolve=function(t){var e=new i;return e.resolve(t),e},i.reject=function(t){var e=new i;return e.reject(t),e},i.all=function(t){function e(e,s){e&&"function"==typeof e.then||(e=i.resolve(e)),e.then(function(e){n[s]=e,++r==t.length&&o.resolve(n)},function(t){o.reject(t)})}for(var n=[],r=0,o=new i,s=0;s<t.length;s++)e(t[s],s);return t.length||o.resolve(n),o},t.exports&&(t.exports=i),e.define&&e.define.amd&&e.define([],function(){return i}),e.Zousan=i,i.soon=u}(yi)}),bi="undefined"!=typeof Promise?Promise:wi,Ci=function(t){return function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.on=function(t,e,i){if(!t)return this;if(!v(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var n,r,o=t.toLowerCase().split(" ");i||(i=this);for(var s=0,a=o.length;s<a;s++){n=o[s],(r=this._eventMap[n])||(r=[],this._eventMap[n]=r);var h=r.length;if(h>0)for(var u=0;u<h;u++)if(e===r[u].handler&&r[u].context===i)return this;r.push({handler:e,context:i})}return this},i.addEventListener=function(){return this.on.apply(this,arguments)},i.once=function(t,e,i){if(!v(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=this._wrapOnceHandler(r,t[r],i));return this._switch("on",n)}for(var o=t.split(" "),s=0,a=o.length;s<a;s++)this.on(o[s],this._wrapOnceHandler(o[s],e,i));return this},i.off=function(t,e,i){if(!this._eventMap||!t)return this;if(!v(t))return this._switch("off",t,e);if(!e)return this;var n,r,o,s=t.split(" ");i||(i=this);for(var a=0,h=s.length;a<h;a++){if(o="Z__"+(n=s[a].toLowerCase()),!(r=this._eventMap[n]))return this;for(var u=r.length-1;u>=0;u--){var l=r[u];e!==l.handler&&e!==l.handler[o]||l.context!==i||(delete l.handler[o],r.splice(u,1))}r.length||delete this._eventMap[n]}return this},i.removeEventListener=function(){return this.off.apply(this,arguments)},i.listens=function(t,e,i){if(!this._eventMap||!v(t))return 0;var n=this._eventMap[t.toLowerCase()];if(!n||!n.length)return 0;if(!e)return n.length;for(var r=0,o=n.length;r<o;r++)if(e===n[r].handler&&(d(i)||n[r].context===i))return 1;return 0},i.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},i.copyEventListeners=function(t){var e,i=t._eventMap;if(!i)return this;for(var n in i)for(var r=0,o=(e=i[n]).length;r<o;r++)this.on(n,e[r].handler,e[r].context);return this},i.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},i._wrapOnceHandler=function(t,e,i){var n=this,r="Z__"+t,o=!1,s=function a(){o||(delete s[r],o=!0,i?e.apply(i,arguments):e.apply(this,arguments),n.off(t,a,this))};return s[r]=e,s},i._switch=function(t,e,i){for(var n in e)e.hasOwnProperty(n)&&this[t](n,e[n],i);return this},i._clearListeners=function(t){this._eventMap&&v(t)&&(this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null))},i._clearAllListeners=function(){this._eventMap=null},i._setEventParent=function(t){return this._eventParent=t,this},i._setEventTarget=function(t){return this._eventTarget=t,this},i._fire=function(t,e){if(!this._eventMap)return this;var i=this._eventMap[t.toLowerCase()];if(!i)return this;e||(e={}),e.type=t,e.target=this._eventTarget||this;for(var n,r,o=i.slice(0),s=0,a=o.length;s<a;s++)o[s]&&(n=o[s].context,!0,r=f({},e),!1===(n?o[s].handler.call(n,r):o[s].handler(r))&&e.domEvent&&Ue(e.domEvent));return this},e}(t)},Pi=Ci(function(){function t(t){this.target=t}var e=t.prototype;return e.enable=function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},e.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},e.enabled=function(){return!!this._enabled},e.remove=function(){this.disable(),delete this.target,delete this.dom},t}()),Mi=function(){function t(t){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks()}var e=t.prototype;return e.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},e.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},e.config=function(t){if(!t){var e={};for(var i in this.options)this.options.hasOwnProperty(i)&&(e[i]=this.options[i]);return e}if(2===arguments.length){var n={};n[t]=arguments[1],t=n}for(var r in t)this.options[r]=t[r],this[r]&&this[r]instanceof Pi&&(t[r]?this[r].enable():this[r].disable());return this.onConfig(t),this},e.onConfig=function(){},e._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var i=t._initHooks;if(i&&i!==e._initHooks)for(var n=0;n<i.length;n++)i[n].call(this)}},t.addInitHook=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r="function"==typeof t?t:function(){this[t].apply(this,i)},o=this.prototype,s=Object.getPrototypeOf(o);return o._initHooks&&o._initHooks!==s._initHooks||(o._initHooks=[]),o._initHooks.push(r),this},t.include=function(){for(var t=0;t<arguments.length;t++)f(this.prototype,t<0||arguments.length<=t?void 0:arguments[t]);return this},t.mergeOptions=function(t){var e=this.prototype,i=Object.getPrototypeOf(e);return e.options&&e.options!==i.options||(e.options=e.options?Object.create(e.options):{}),f(e.options,t),this},t}(),Ti={},Si=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.registerJSONType=function(t){return t?(Ti[t]=this,this):this},e.getJSONClass=function(t){return t?Ti[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in Ti)if(Ti[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},e}(t)},Ai=xi(function(t,e){t.exports=function(){function t(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function e(t,e){return t<e?-1:t>e?1:0}return function(i,n,r,o,s){!function e(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,h=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(h-a/2<0?-1:1),f=Math.max(r,Math.floor(n-h*l/a+c)),d=Math.min(o,Math.floor(n+(a-h)*l/a+c));e(i,n,f,d,s)}var p=i[n],g=r,m=o;for(t(i,r,n),s(i[o],p)>0&&t(i,r,o);g<m;){for(t(i,g,m),g++,m--;s(i[g],p)<0;)g++;for(;s(i[m],p)>0;)m--}0===s(i[r],p)?t(i,r,m):t(i,++m,o),m<=n&&(r=m+1),n<=m&&(o=m-1)}}(i,n,r||0,o||i.length-1,s||e)}}()}),Ei=Ri,ki=Ri;function Ri(t,e){if(!(this instanceof Ri))return new Ri(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function Oi(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function Li(t,e){Di(t,0,t.children.length,e,t)}function Di(t,e,i,n,r){r||(r=Gi(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o,s=e;s<i;s++)o=t.children[s],Ii(r,t.leaf?n(o):o);return r}function Ii(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function ji(t,e){return t.minX-e.minX}function zi(t,e){return t.minY-e.minY}function Hi(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Fi(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Ni(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Zi(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Gi(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Bi(t,e,i,n,r){for(var o,s=[e,i];s.length;)(i=s.pop())-(e=s.pop())<=n||(o=e+Math.ceil((i-e)/n/2)*n,Ai(t,o,e,i,r),s.push(e,o,o,i))}Ri.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!Zi(t,e))return i;for(var r,o,s,a,h=[];e;){for(r=0,o=e.children.length;r<o;r++)s=e.children[r],Zi(t,a=e.leaf?n(s):s)&&(e.leaf?i.push(s):Ni(t,a)?this._all(s,i):h.push(s));e=h.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!Zi(t,e))return!1;for(var n,r,o,s,a=[];e;){for(n=0,r=e.children.length;n<r;n++)if(o=e.children[n],Zi(t,s=e.leaf?i(o):o)){if(e.leaf||Ni(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=Gi([]),this},remove:function(t,e){if(!t)return this;for(var i,n,r,o,s=this.data,a=this.toBBox(t),h=[],u=[];s||h.length;){if(s||(s=h.pop(),n=h[h.length-1],i=u.pop(),o=!0),s.leaf&&-1!==(r=Oi(t,s.children,e)))return s.children.splice(r,1),h.push(s),this._condense(h),this;o||s.leaf||!Ni(s,a)?n?(i++,s=n.children[i],o=!1):s=null:(h.push(s),u.push(i),i=0,n=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:ji,compareMinY:zi,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,n){var r,o=i-e+1,s=this._maxEntries;if(o<=s)return Li(r=Gi(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(r=Gi([])).leaf=!1,r.height=n;var a,h,u,l,c=Math.ceil(o/s),f=c*Math.ceil(Math.sqrt(s));for(Bi(t,e,i,f,this.compareMinX),a=e;a<=i;a+=f)for(Bi(t,a,u=Math.min(a+f-1,i),c,this.compareMinY),h=a;h<=u;h+=c)l=Math.min(h+c-1,u),r.children.push(this._build(t,h,l,n-1));return Li(r,this.toBBox),r},_chooseSubtree:function(t,e,i,n){for(var r,o,s,a,h,u,l,c,f,d;n.push(e),!e.leaf&&n.length-1!==i;){for(l=c=1/0,r=0,o=e.children.length;r<o;r++)h=Hi(s=e.children[r]),f=t,d=s,(u=(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-h)<c?(c=u,l=h<l?h:l,a=s):u===c&&h<l&&(l=h,a=s);e=a||e.children[0]}return e},_insert:function(t,e,i){var n=this.toBBox,r=i?t:n(t),o=[],s=this._chooseSubtree(r,this.data,e,o);for(s.children.push(t),Ii(s,r);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)},_split:function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),s=Gi(i.children.splice(o,i.children.length-o));s.height=i.height,s.leaf=i.leaf,Li(i,this.toBBox),Li(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(t,e){this.data=Gi([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Li(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,r,o,s,a,h,u,l,c,f,d,p,g,m;for(h=u=1/0,n=e;n<=i-e;n++)r=Di(t,0,n,this.toBBox),o=Di(t,n,i,this.toBBox),c=r,f=o,void 0,void 0,void 0,void 0,d=Math.max(c.minX,f.minX),p=Math.max(c.minY,f.minY),g=Math.min(c.maxX,f.maxX),m=Math.min(c.maxY,f.maxY),s=Math.max(0,g-d)*Math.max(0,m-p),a=Hi(r)+Hi(o),s<h?(h=s,l=n,u=a<u?a:u):s===h&&a<u&&(u=a,l=n);return l},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:ji,r=t.leaf?this.compareMinY:zi;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var r,o,s=this.toBBox,a=Di(t,0,e,s),h=Di(t,i-e,i,s),u=Fi(a)+Fi(h);for(r=e;r<i-e;r++)o=t.children[r],Ii(a,t.leaf?s(o):o),u+=Fi(a);for(r=i-e-1;r>=e;r--)o=t.children[r],Ii(h,t.leaf?s(o):o),u+=Fi(h);return u},_adjustParentBBoxes:function(t,e,i){for(var n=i;n>=0;n--)Ii(e[n],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():Li(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},Ei.default=ki;var Wi={},Vi=function(){function t(){this._tree=Ei(9,["[0]","[1]","[2]","[3]"])}var e=t.prototype;return e.collides=function(t){return Wi.minX=t[0],Wi.minY=t[1],Wi.maxX=t[2],Wi.maxY=t[3],this._tree.collides(Wi)},e.insertBox=function(t){return this._tree.insert(t),this},e.bulkInsertBox=function(t){return this._tree.load(t),this},e.clear=function(){return this._tree.clear(),this},t}();function $i(t){return function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},i.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var i=this._handlers.indexOf(e);i>=0&&this._handlers.splice(i,1),this[t].remove(),delete this[t]}return this},i._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)}var Ui={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Ji={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},qi=function(t){function e(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,null)||this).dom=e,n.options=i,n}Y(e,t);var i=e.prototype;return i.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},ai(this.dom,"touchstart mousedown",this._onMouseDown,this),this):this},i.disable=function(){return this.dom?(this._offEvents(),hi(this.dom,"touchstart mousedown",this._onMouseDown),delete this._onMouseDown,this):this},i.onMouseDown=function(t){if((this.options.rightclick||2!==t.button)&&!(t.touches&&t.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(t))){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var i=t.touches?t.touches[0]:t;this.startPos=new et(i.clientX,i.clientY),ai(document,Ui[t.type],this.onMouseMove,this),ai(document,Ji[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||ai(this.dom,"mouseleave",this.onMouseUp,this),this.fire("mousedown",{domEvent:t,mousePos:new et(i.clientX,i.clientY)})}},i.onMouseMove=function(t){if(t.touches&&t.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var e=t.touches?t.touches[0]:t,i=new et(e.clientX,e.clientY).sub(this.startPos);(i.x||i.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new et(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},i.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var i={domEvent:t};p(e.clientX)&&(i.mousePos=new et(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(i.interupted=this.interupted,this.fire("dragend",i),delete this.interupted,delete this.moved),this.fire("mouseup",i)},i._offEvents=function(){var t=this.dom;if(hi(t,"mouseleave",this.onMouseUp,this),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in Ui)hi(document,Ui[e],this.onMouseMove,this),hi(document,Ji[e],this.onMouseUp,this);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},e}(Pi),Yi=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.toNumberArrays=function(t){return Array.isArray(t)?ut(t,function(t){return[t.x,t.y]}):[t.x,t.y]},e.toCoordinates=function(t){if(p(t[0])&&p(t[1]))return new e(t);if(t instanceof e)return t;for(var i=[],n=0,r=t.length;n<r;n++){var o=t[n];Array.isArray(o)?p(o[0])?i.push(new e(o)):i.push(e.toCoordinates(o)):o instanceof e?i.push(o):i.push(new e(o))}return i},e}(tt),Xi=function(){function t(t,e){this.type=t,this.properties=e}return t.createProj4=function(e){return new t("proj4",{proj:e})},t.fromProjectionCode=function(e){return e&&t[e=e.toUpperCase().replace(":","")]||null},t}();Xi.WGS84=Xi.createProj4("+proj=longlat +datum=WGS84 +no_defs"),Xi.EPSG4326=Xi.WGS84,Xi.EPSG3857=Xi.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),Xi.IDENTITY=Xi.createProj4("+proj=identity +no_defs"),Xi.CGCS2000=Xi.createProj4("+proj=longlat +datum=CGCS2000"),Xi.EPSG4490=Xi.CGCS2000,Xi.BD09LL=Xi.createProj4("+proj=longlat +datum=BD09"),Xi.GCJ02=Xi.createProj4("+proj=longlat +datum=GCJ02");var Ki,Qi=new et(0,0),tn=new Yi(0,0),en=new Yi(0,0),nn=new Yi(0,0),rn=new Yi(0,0),on=new Yi(0,0),sn=new Yi(0,0),an=new Yi(0,0),hn=new Yi(0,0),un=[],ln=[],cn=function(){function t(t,e,i,n){this._clazz=Yi;var r=arguments.length,o=r>0?arguments[r-1]:null;o&&o.unproject&&(this.projection=arguments[r-1]),this._dirty=!0,this._initialize(t,e,i,n)}var e=t.prototype;return e._initialize=function(t,e,i,n){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!d(t)){var r=this.projection;p(t)&&p(e)&&p(i)&&p(n)?r?this.set(t,e,i,n):this.set(Math.min(t,i),Math.min(e,n),Math.max(t,i),Math.max(e,n)):Array.isArray(t)?r?this.set(t[0],t[1],t[2],t[3]):this.set(Math.min(t[0],t[2]),Math.min(t[1],t[3]),Math.max(t[0],t[2]),Math.max(t[1],t[3])):p(t.x)&&p(e.x)&&p(t.y)&&p(e.y)?r?this.set(t.x,t.y,e.x,e.y):(t.x>e.x?(this.xmin=e.x,this.xmax=t.x):(this.xmin=t.x,this.xmax=e.x),t.y>e.y?(this.ymin=e.y,this.ymax=t.y):(this.ymin=t.y,this.ymax=e.y)):p(t.xmin)&&p(t.xmax)&&p(t.ymin)&&p(t.ymax)&&this.set(t.xmin,t.ymin,t.xmax,t.ymax)}},e._add=function(t){return this._dirty=!0,d(t.x)?d(t.xmin)?d(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},e.add=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._add.apply(t,arguments)},e._scale=function(t){return this._dirty=!0,this.xmin*=t,this.ymin*=t,this.xmax*=t,this.ymax*=t,this},e._sub=function(t){return this._dirty=!0,d(t.x)?d(t.xmin)?d(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._sub.apply(t,arguments)},e.substract=function(){return this.sub.apply(this,arguments)},e.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},e._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},e.getMin=function(t){return t?(t.set(this.xmin,this.ymin),t):new this._clazz(this.xmin,this.ymin)},e.getMax=function(t){return t?(t.set(this.xmax,this.ymax),t):new this._clazz(this.xmax,this.ymax)},e.getCenter=function(t){var e=(this.xmin+this.xmax)/2,i=(this.ymin+this.ymax)/2;return t?(t.set(e,i),t):new this._clazz(e,i)},e.isValid=function(){return!(d(this.xmin)||d(this.ymin)||d(this.xmax)||d(this.ymax))},e.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},e.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),i=Math.max(this.pymin,t.pymin),n=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax),o=!(e>n||i>r);return o},e.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},e.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;if(e)if(void 0!==t.x){var i=tn;Array.isArray(t)?(i.x=t[0],i.y=t[1]):(i.x=t.x,i.y=t.y),t=e.project(i,i)}else void 0!==t.xmin&&this._project(t);return(t.x||t.pxmin||0)>=this.pxmin&&(t.x||t.pxmax||0)<=this.pxmax&&(t.y||t.pymin||0)>=this.pymin&&(t.y||t.pymax||0)<=this.pymax},e.getWidth=function(){return Math.abs(this.xmax-this.xmin)},e.getHeight=function(){return Math.abs(this.ymax-this.ymin)},e.getSize=function(){return new he(this.getWidth(),this.getHeight())},e.set=function(t,e,i,n){return this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=n,this._dirty=!0,this},e.__combine=function(t){var e,i,n,r;void 0!==t.x&&(Ki.xmin=Ki.xmax=t.x,Ki.ymin=Ki.ymax=t.y,t=Ki),this._project(t),this._project(this),p(this.pxmin)?(e=Math.min(this.pxmin,t.pxmin),i=Math.min(this.pymin,t.pymin),n=Math.max(this.pxmax,t.pxmax),r=Math.max(this.pymax,t.pymax)):(e=t.pxmin,i=t.pymin,n=t.pxmax,r=t.pymax);var o=this.projection;if(o){en.set(e,i),nn.set(n,r);var s=o.unproject(en,en),a=o.unproject(nn,nn);e=s.x,i=s.y,n=a.x,r=a.y}return ln[0]=e,ln[1]=i,ln[2]=n,ln[3]=r,ln},e._combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},e.combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},e.intersection=function(t){if(!this.intersects(t))return null;rn.x=Math.max(this.pxmin,t.pxmin),rn.y=Math.max(this.pymin,t.pymin),on.x=Math.min(this.pxmax,t.pxmax),on.y=Math.min(this.pymax,t.pymax);var e=rn,i=on,n=this.projection;return n&&(e=n.unproject(e,e),i=n.unproject(i,i)),new this.constructor(e,i,n)},e.expand=function(t){var e,i;return p(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-i,this.xmax+e,this.ymax+i,this.projection)},e._expand=function(t){var e,i;return p(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=i,this.xmax+=e,this.ymax+=i,this._dirty=!0,this},e.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},e.toArray=function(t){var e=this.xmin,i=this.ymin,n=this.xmax,r=this.ymax;return t?(t[0].x=e,t[0].y=r,t[1].x=n,t[1].y=r,t[2].x=n,t[2].y=i,t[3].x=e,t[3].y=i,t[4].x=e,t[4].y=r,t):[new this._clazz([e,r]),new this._clazz([n,r]),new this._clazz([n,i]),new this._clazz([e,i]),new this._clazz([e,r])]},e.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},e.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},e.convertTo=function(t,e){if(!this.isValid())return null;var i,n=e||new this.constructor;return e&&n.set(null,null,null,null),this._clazz===Yi?i=sn:this._clazz===et&&(i=Qi),i.x=this.xmin,i.y=this.ymax,n._combine(t(i)),i.x=this.xmax,n._combine(t(i)),i.y=this.ymin,n._combine(t(i)),i.x=this.xmin,n._combine(t(i)),n},e._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){an.set(t.xmax,t.ymin),hn.set(t.xmin,t.ymax),un[0]=an,un[1]=hn;var i=e.projectCoords(un),n=i[0],r=i[1];t.pxmin=Math.min(n.x,r.x),t.pymin=Math.min(n.y,r.y),t.pxmax=Math.max(n.x,r.x),t.pymax=Math.max(n.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}else t&&(t.pxmin=t.pxmax=t.pymin=t.pymax=null)},t}();Ki=new cn(0,0,0,0);var fn,dn=function(t){function e(e,i,n,r){var o;return(o=t.call(this,e,i,n,r)||this)._clazz=et,o}return Y(e,t),e}(cn),pn=function(){function t(t){this.matrix=t}var e=t.prototype;return e.transform=function(t,e,i){var n=this.matrix[0]*(t.x-this.matrix[2])/e,r=-this.matrix[1]*(t.y-this.matrix[3])/e;return i?(i.x=n,i.y=r,i):new et(n,r)},e.untransform=function(t,e,i){var n=t.x*e/this.matrix[0]+this.matrix[2],r=t.y*e/-this.matrix[1]+this.matrix[3];return i?(i.x=n,i.y=r,i):new Yi(n,r)},t}(),gn={project:function(){},unproject:function(){},projectCoords:function(t){var e=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return ut(t,this.project,this);if(Array.isArray(t[0]))return t.map(function(t){return e.projectCoords(t)});for(var i,n,r,o,s,a,h=this.getCircum(),u=this.getSphereExtent(),l=u.sx,c=u.sy,f=t[0],d=[this.project(f)],p=1,g=t.length;p<g;p++)o=(r=t[p]).x-f.x,s=r.y-f.y,a=this.project(r),Math.abs(o)>180&&(void 0===i&&(i=r.x>f.x),i&&(a._add(-h.x*ct(o)*l,0),r._add(-360*ct(o),0))),Math.abs(s)>90&&(void 0===n&&(n=r.y<f.y),n&&(a._add(0,-h.y*ct(s)*c),r._add(0,-180*ct(s)))),f=r,d.push(a);return d},unprojectCoords:function(t){return t?Array.isArray(t)?ut(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),i=new Yi(t);return e.contains(i)||(i.x=pt(t.x,e.xmin,e.xmax),i.y=pt(t.y,e.ymin,e.ymax)),i},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new Yi(180,90)),e=this.project(new Yi(-180,-90));this.extent=new cn(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},mn={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var i=0,n=0,r=t.length;n<r-1;n++)i+=this.measureLenBetween(t[n],t[n+1]);return i}},vn=f({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(t){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i],o=null;o=i===n-1?t[0]:t[i+1],e+=r.x*o.y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,i){return t=new Yi(t.x,t.y),this._locate(t,e,i)},_locate:function(t,e,i){return t?(e||(e=0),i||(i=0),e||i?(t.x=t.x+e,t.y=t.y+i,t):t):null},rotate:function(t,e,i){return t=new Yi(t.x,t.y),this._rotate(t,e,i)},_rotate:(fn=new et(0,0),function(t,e,i){return fn.x=t.x-e.x,fn.y=t.y-e.y,fn._rotate(i*Math.PI/180),t.x=e.x+fn.x,t.y=e.y+fn.y,t})},mn),_n=function(){function t(t){this.radius=t}var e=t.prototype;return e.measureLenBetween=function(t,e){if(!t||!e)return 0;var i=b(t.y),n=b(e.y),r=i-n,o=b(t.x)-b(e.x);return i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(o/2),2))),i*=this.radius,Math.round(1e5*i)/1e5},e.measureArea=function(t){var e,i=b(this.radius),n=0,r=t,o=r.length;if(o<3)return 0;for(e=0;e<o-1;e++){var s=r[e],a=r[e+1];n+=s.x*i*Math.cos(b(s.y))*a.y*i-a.x*i*Math.cos(b(a.y))*s.y*i}return o=r[e],r=r[0],n+=o.x*i*Math.cos(b(o.y))*r.y*i-r.x*i*Math.cos(b(r.y))*o.y*i,.5*Math.abs(n)},e.locate=function(t,e,i){return t=new Yi(t.x,t.y),this._locate(t,e,i)},e._locate=function(t,e,i){if(!t)return null;if(e||(e=0),i||(i=0),!e&&!i)return t;var n,r,o=b(t.y);if(0!==i){var s=Math.abs(i);r=pt(180*(o+=2*Math.sin(s/(2*this.radius))*(i>0?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var a=Math.abs(e),h=b(t.x);n=pt(180*(h+=2*Math.sqrt(Math.pow(Math.sin(a/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(e>0?1:-1))/Math.PI,-180,180)}else n=t.x;return t.x=n,t.y=r,t},e.rotate=function(t,e,i){return t=new Yi(t),this._rotate(t,e,i)},e._rotate=function(t,e,i){var n=function(t,e,i){void 0===i&&(i={});var n;n=i.final?yn(e,t):yn(t,e);return n>180?-(360-n):n}(e,t)-i,r=this.measureLenBetween(e,t);return t.x=e.x,t.y=e.y,function(t,e,i,n){var r=e/n,o=t.x*Math.PI/180,s=b(t.y),a=b(i),h=r*Math.cos(a),u=s+h;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var l=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),c=Math.abs(l)>1e-11?h/l:Math.cos(s),f=r*Math.sin(a)/c,d=o+f;return t.x=(180*d/Math.PI+540)%360-180,t.y=180*u/Math.PI,t}(t,r,n,this.radius)},t}();function yn(t,e){var i=b(t.y),n=b(e.y),r=b(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(C(Math.atan2(r,o))+360)%360}var xn=f({measure:"EPSG:4326",sphere:new _n(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},mn),wn=f({measure:"BAIDU",sphere:new _n(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},mn),bn=xn,Cn={};function Pn(t){Cn[t.measure]=t}Pn(vn),Pn(xn),Pn(wn);var Mn={getInstance:function(t){if(!t)return bn;for(var e in Cn)if(x(Cn,e)){var i=Cn[e].measure;if(!i)continue;if(t.toLowerCase()===i.toLowerCase())return Cn[e]}return null}},Tn=f({},gn,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,e){var i=this.rad,n=this.metersPerDegree,r=this.maxLatitude,o=t.x,s=Math.max(Math.min(r,t.y),-r),a=o*n,h=(0===s?0:Math.log(Math.tan((90+s)*i/2))/i)*n;return e?(e.x=a,e.y=h,e):new Yi(a,h)},unproject:function(t,e){var i,n=this.rad,r=this.metersPerDegree,o=t.x/r,s=t.y;0===s?i=0:(i=s/r,i=(2*Math.atan(Math.exp(i*n))-Math.PI/2)/n),Math.abs(Math.abs(o)-180)<1e-7&&(o=180*ct(o)),Math.abs(Math.abs(i)-this.maxLatitude)<1e-7&&(i=ct(i)*this.maxLatitude);var a=pt(o,-180,180),h=pt(i,-this.maxLatitude,this.maxLatitude);return e?(e.x=a,e.y=h,e):new Yi(a,h)}},xn),Sn=f({},gn,{code:"EPSG:4326",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new Yi(t)},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new Yi(t)}},xn),An=f({},Sn,{code:"EPSG:4490"}),En=f({},gn,{code:"BAIDU",project:function(t,e){return this.convertLL2MC(t,e)},unproject:function(t,e){return this.convertMC2LL(t,e)}},wn,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,e){for(var i,n=0,r=this.MCBAND.length;n<r;n++)if(Math.abs(t.y)>=this.MCBAND[n]){i=this.MC2LL[n];break}return this.convertor(t,i,e)},convertLL2MC:function(t,e){var i,n,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var o=new Yi(t.x,t.y);for(n=0,r=this.LLBAND.length;n<r;n++)if(o.y>=this.LLBAND[n]){i=this.LL2MC[n];break}if(!i)for(n=this.LLBAND.length-1;n>=0;n--)if(o.y<=-this.LLBAND[n]){i=this.LL2MC[n];break}return this.convertor(t,i,e)},convertor:function(t,e,i){if(!t||!e)return null;var n=e[0]+e[1]*Math.abs(t.x),r=Math.abs(t.y)/e[9],o=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return n*=t.x<0?-1:1,o*=t.y<0?-1:1,i?(i.x=n,i.y=o,i):new Yi(n,o)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},getLoop:function(t,e,i){if(t===1/0)return i;if(t===-1/0)return e;for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}}),kn=f({},gn,{code:"IDENTITY",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()}},vn),Rn=Tn,On=Object.freeze({EPSG3857:Tn,DEFAULT:Rn,EPSG4326:Sn,EPSG4490:An,BAIDU:En,IDENTITY:kn,Common:gn}),Ln=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.registerRenderer=function(t,e){var i=this.prototype,n=Object.getPrototypeOf(i);return i._rendererClasses&&i._rendererClasses!==n._rendererClasses||(i._rendererClasses=i._rendererClasses?Object.create(i._rendererClasses):{}),i._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)},Dn=function(t){function e(e){var i;return(i=t.call(this)||this).layer=e,i._painted=!1,i._drawTime=0,i.setToRedraw(),i}Y(e,t);var i=e.prototype;return i.render=function(t){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new In),this.checkAndDraw(this._tryToDraw,t))},i.checkAndDraw=function(t){var e=this;this._toRedraw=!1;for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];if(this.checkResources){var o=this.checkResources();o.length>0?(this._loadingResource=!0,this.loadResources(o).then(function(){e._loadingResource=!1,e.layer&&(e.layer.fire("resourceload"),e.setToRedraw())})):t.call.apply(t,[this].concat(n))}else t.call.apply(t,[this].concat(n))},i.testIfNeedRedraw=function(){var t=this.getMap();return!this._loadingResource&&(!!this._toRedraw||!(t.isInteracting()&&!this.drawOnInteracting)&&!!this.needToRedraw())},i.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()&&!t.getRenderer().isViewChanged())&&!(!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},i.onSkipDrawOnInteracting=function(){},i.isLoadingResource=function(){return this._loadingResource},i.isRenderComplete=function(){return!!this._renderComplete},i.mustRenderOnInteracting=function(){return!this._painted},i.setToRedraw=function(){return this._toRedraw=!0,this},i.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},i.isCanvasUpdated=function(){return!!this._canvasUpdated},i.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,delete this.resources,delete this.layer},i.onRemove=function(){},i.onAdd=function(){},i.getMap=function(){return this.layer?this.layer.getMap():null},i.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.southWest)._add(0,-t.height);return{image:this.canvas,layer:this.layer,point:e}},i.clear=function(){this.clearCanvas()},i.isBlank=function(){return!this._painted},i.show=function(){this.setToRedraw()},i.hide=function(){this.clear(),this.setToRedraw()},i.setZIndex=function(){this.setToRedraw()},i.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown)return!1;var e=this.getMap(),i=e.getDevicePixelRatio(),n=e.getSize();if(t.x<0||t.x>n.width*i||t.y<0||t.y>n.height*i)return!1;var r=this.getImageData&&this.getImageData();if(r){var o=i*t.x,s=i*t.y*r.width*4+4*o;return r.data[s+3]>0}try{if(this.context.getImageData(i*t.x,i*t.y,1,1).data[3]>0)return!0}catch(t){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t),this._errorThrown=!0),!1}return!1},i.loadResources=function(t){this.resources||(this.resources=new In);var e=this.resources,i=[];if(mt(t))for(var n={},r=t.length-1;r>=0;r--){var o=t[r];o&&o.length&&!n[o.join("-")]&&(n[o.join("-")]=1,e.isResourceLoaded(o,!0)||i.push(new bi(this._promiseResource(o))))}return bi.all(i)},i.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t._get2DExtent(),this.southWest=t._containerPointToPoint(new et(0,t.height))},i.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),i=t.getDevicePixelRatio(),n=i*e.width,r=i*e.height;if(this.layer._canvas){var o=this.layer._canvas;o.width=n,o.height=r,o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=pi.createCanvas(n,r,t.CanvasClass);this.onCanvasCreate()}},i.onCanvasCreate=function(){},i.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=this.canvas.getContext("2d"),this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();1!==t&&this.context.scale(t,t)}},i.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},i.resizeCanvas=function(t){var e=this.canvas;if(e){var i=t||this.getMap().getSize(),n=this.getMap().getDevicePixelRatio();e.width===n*i.width&&e.height===n*i.height||(e.height=n*i.height,e.width=n*i.width,1!==n&&this.context&&this.context.scale(n,n),this.layer._canvas&&e.style&&(e.style.width=i.width+"px",e.style.height=i.height+"px"))}},i.clearCanvas=function(){this.context&&pi.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},i.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var i=this.southWest,n=this.getMap();this.southWest=n._containerPointToPoint(new et(0,n.height)),t.save();var r=n.getDevicePixelRatio();if(1!==r&&(t.save(),t.scale(r,r)),e.getGeometries){t.isMultiClip=!0;var o=e.getGeometries()||[];t.beginPath(),o.forEach(function(e){e._getMaskPainter().paint(null,t)}),t.stroke(),delete t.isMultiClip}else{e._getMaskPainter().paint(null,t)}return 1!==r&&t.restore(),t.clip(),this.southWest=i,!0},i.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},i.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},i.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},i.onZoomStart=function(){},i.onZoomEnd=function(){this.setToRedraw()},i.onZooming=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){this.setToRedraw()},i.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},i.onDragRotateStart=function(){},i.onDragRotating=function(){},i.onDragRotateEnd=function(){this.setToRedraw()},i.onSpatialReferenceChange=function(){},i.getDrawTime=function(){return this._drawTime},i._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},i._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var i=c();this.draw(t),i=c()-i,this._drawTime=e?i:i/2,e&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",t,"drawTime:",this._drawTime)}},i._promiseResource=function(t){var e=this,i=this.resources,n=this.layer.options.crossOrigin,r=this.layer.options.renderer||"";return function(o){if(i.isResourceLoaded(t,!0))o(t);else{var s=new Image;d(n)?"canvas"!==r&&(s.crossOrigin=""):s.crossOrigin=n,it(t[0])&&!P&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),s.onload=function(){e._cacheResource(t,s),o(t)},s.onabort=function(e){console&&console.warn("image loading aborted: "+t[0]),e&&console&&console.warn(e),o(t)},s.onerror=function(e){e&&"undefined"!=typeof console&&console.warn(e),i.markErrorResource(t),o(t)},nt(s,t)}}},i._cacheResource=function(t,e){if(this.layer&&this.resources){var i=t[1],n=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===it(t[0])&&(q.edge||q.ie)){d(i)&&(i=e.width||this.layer.options.defaultIconSize[0]),d(n)&&(n=e.height||this.layer.options.defaultIconSize[1]);var r=pi.createCanvas(i,n);pi.image(r.getContext("2d"),e,0,0,i,n),e=r}this.resources.addResource(t,e)}},e}(Mi),In=function(){function t(){this.resources={},this._errors={}}var e=t.prototype;return e.addResource=function(t,e){var i=this;if(this.resources[t[0]]={image:e,width:+t[1],height:+t[2],refCnt:0},e&&q.imageBitMap){if(e.src&&it(e.src))return;createImageBitmap(e).then(function(e){i.resources[t[0]].image=e})}},e.isResourceLoaded=function(t,e){if(!t)return!1;var i=this._getImgUrl(t);if(this._errors[i])return!0;var n=this.resources[i];return!!n&&!(e&&it(t[0])&&(+t[1]>n.width||+t[2]>n.height))},e.login=function(t){var e=this.resources[t];e&&e.refCnt++},e.logout=function(t){var e=this.resources[t];e&&e.refCnt--<=0&&delete this.resources[t]},e.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},e.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},e.merge=function(t){if(!t)return this;for(var e in t.resources){var i=t.resources[e];this.addResource([e,i.width,i.height],i.image)}return this},e.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)x(this.resources,e)&&t(e,this.resources[e]);return this},e._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},t}(),jn={markerWidth:10,markerHeight:10,markerLineWidth:1};var zn=new et(0,0);function Hn(t,e,i,n,r,o,s){var a,h,u,l,c,f,d=zn.set(e,i),p=t.set(d.x,d.y,d.x+o,d.y+s);return p._add(r),n&&(h=n,u=(a=p).xmin,l=a.ymin,c=a.xmax,f=a.ymax,$n.set(u,l,c,f),$n.convertTo(function(t){return t._rotate(h)},a)),p}var Fn=[];function Nn(t,e,i){var n=Wn(e,(i=i||Vn(Fn,e))[0],i[1]);return Hn(t,e.markerDx||0,e.markerDy||0,Un(e),n,i[0],i[1])}function Zn(t){return"rectangle"===t?"right":"middle"}function Gn(t){return"bar"===t||"pie"===t||"pin"===t?"top":"rectangle"===t?"bottom":"middle"}var Bn=new he(0,0);function Wn(t,e,i){var n=2*(t.shadowBlur||0)+.5;Bn.width=e,Bn.height=i;var r=t.markerType,o=xe(Bn,t.markerHorizontalAlignment||Zn(r),t.markerVerticalAlignment||Gn(r));return o.x!==-e/2&&(o.x-=ct(o.x+e/2)*n),o.y!==-i/2&&(o.y-=ct(o.y+i/2)*n),o}function Vn(t,e){var i=lt(e.markerWidth,jn.markerWidth),n=lt(e.markerHeight,jn.markerHeight),r=lt(e.markerLineWidth,jn.markerLineWidth),o=2*((e.shadowBlur||0)+Math.max(Math.abs(e.shadowOffsetX||0)+Math.abs(e.shadowOffsetY||0))),s=Math.round(i+r+o+1),a=Math.round(n+r+o+1);return t[0]=s,t[1]=a,t}var $n=new dn;function Un(t,e){void 0===e&&(e="markerRotation");var i=t[e];return p(i)?-i*Math.PI/180:0}function Jn(t,e,i){var n=e.markerFile,r=i?i.getImage(n):null,o=e.markerWidth||(r?r.width:0),s=e.markerHeight||(r?r.height:0);Bn.width=o,Bn.height=s;var a=xe(Bn,e.markerHorizontalAlignment||"middle",e.markerVerticalAlignment||"top");return Hn(t,e.markerDx||0,e.markerDy||0,Un(e),a,o,s)}function qn(t,e,i){var n=i.size,r=xe(n,e.textHorizontalAlignment,e.textVerticalAlignment);if(e.textHaloRadius){var o=e.textHaloRadius;n=n.add(2*o,2*o)}return Hn(t,e.textDx||0,e.textDy||0,Un(e,"textRotation"),r,n.width,n.height)}var Yn=new dn;function Xn(t,e,i,n){var r=t||new dn;if(Array.isArray(e)){for(var o=e,s=0;s<o.length;s++)Xn(r,o[s],i,n[s]);return r}return Kn(e)&&r._combine(qn(Yn,e,n)),Qn(e)&&r._combine(Jn(Yn,e,i)),tr(e)&&r._combine(Nn(Yn,e)),er(e)&&r._combine(Jn(Yn,e)),r}function Kn(t){return!!t&&!d(t.textName)}function Qn(t){return!!t&&!d(t.markerFile)}function tr(t){return!!t&&!(!d(t.markerFile)||d(t.markerType)||"path"===t.markerType)}function er(t){return!!t&&!(!d(t.markerFile)||"path"!==t.markerType)}var ir,nr=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation"],rr=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY"];function or(t,e,i,n){for(var r,o=[],s=0,a=0,h=t.length;a<h-1;a++)(r=sr(t[a],t[a+1],e,a,i,n))&&(o[s]=o[s]||[],o[s].push({point:r[0],index:a}),r[1]===t[a+1]&&a!==h-2||(o[s].push({point:r[1],index:a+1}),s++));return o}function sr(t,e,i,n,r,o){var s,a,h,u=n?ir:ur(t,i),l=ur(e,i);for(ir=l;;){if(!(u|l))return[t,e];if(u&l)return!1;if(o)return[t,e];h=ur(a=hr(t,e,s=u||l,i,r),i),s===u?(t=a,u=h):(e=a,l=h)}}function ar(t,e,i){var n,r,o,s,a,h,u,l,c,f=[1,4,2,8];for(r=0,u=t.length;r<u;r++)t[r]._code=ur(t[r],e);for(s=0;s<4;s++){for(l=f[s],n=[],r=0,o=(u=t.length)-1;r<u;o=r++)a=t[r],h=t[o],a._code&l?h._code&l||((c=hr(h,a,l,e,i))._code=ur(c,e),n.push(c)):(h._code&l&&((c=hr(h,a,l,e,i))._code=ur(c,e),n.push(c)),n.push(a));t=n}return t}function hr(t,e,i,n,r){var o,s,a=e.x-t.x,h=e.y-t.y,u=n.getMin(),l=n.getMax();8&i?(o=t.x+a*(l.y-t.y)/h,s=l.y):4&i?(o=t.x+a*(u.y-t.y)/h,s=u.y):2&i?(o=l.x,s=t.y+h*(l.x-t.x)/a):1&i&&(o=u.x,s=t.y+h*(u.x-t.x)/a);var c=new et(o,s);return r&&c._round(),c}function ur(t,e){var i=0;return t.x<e.getMin().x?i|=1:t.x>e.getMax().x&&(i|=2),t.y<e.getMin().y?i|=4:t.y>e.getMax().y&&(i|=8),i}function lr(t,e,i,n){t=new et(t);var r,o,s,a=Math.abs(i.x-e.x),h=Math.abs(i.y-e.y),u=Math.sqrt(Math.abs(a*a-h*h));return a>=h?(r=new et(e.x-u,e.y),o=new et(e.x+u,e.y),s=2*a):(r=new et(e.x,e.y-u),o=new et(e.x,e.y+u),s=2*h),t.distanceTo(r)+t.distanceTo(o)<=s+2*n}var cr=function(){function t(){}var e=t.prototype;return e.getMap=function(){return this.geometry.getMap()},e.getPainter=function(){return this.painter},e.isDynamicSize=function(){return!1},t.testColor=function(t){return!(!t||!v(t))&&u.indexOf(t)>=0},t}(),fr=null,dr=null,pr=null,gr=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i._prepareContext=function(t){if(It(this.symbol.opacity)?this._opacityFn||(this._opacityFn=zt(this.symbol.opacity)):delete this._opacityFn,p(this.symbol.opacity))t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var e=this.getMap();t.globalAlpha=this._opacityFn(e.getZoom())}else 1!==t.globalAlpha&&(t.globalAlpha=1)},i.prepareCanvas=function(t,e,i){t.setLineDash&&mt(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var n=this.geometry,r=this.getPainter().isHitTesting(),o=n.getSymbolHash();o&&n._painter&&1===n._painter.symbolizers.length&&pr===t&&this._layerWidth===t.canvas.width&&this._layerHeight===t.canvas.height&&o===fr&&n._layer===dr||(dr=n._layer,fr=o,pr=t,this._layerWidth=t.canvas.width,this._layerHeight=t.canvas.height,pi.prepareCanvas(t,e,i,r))},i.remove=function(){},i.setZIndex=function(){},i.show=function(){},i.hide=function(){},i._defineStyle=function(t){return ie(t,this.geometry)},e}(cr);function mr(t,e,i,n){var r,o=vr(i),s=i,a=s.markerType.toLowerCase(),h=_r(a,s.markerWidth,s.markerHeight),u=o.lineOpacity,l=o.polygonOpacity;Me(o.polygonFill)&&(Me(o.polygonFill)&&(r||(r=function(t,e,i){var n=new dn;return n._combine(t),n.xmin+=-e/2,n.ymin+=-i/2,n.xmax+=e/2,n.ymax+=i/2,n}(e,s.markerWidth,s.markerHeight)),o.polygonGradientExtent=r));pi.prepareCanvas(t,o,n);var c=s.markerWidth,f=s.markerHeight,d=s.markerLineWidth/2;if("ellipse"===a)pi.ellipse(t,e,c/2,f/2,f/2,u,l);else if("cross"===a||"x"===a){for(var p=h.length-1;p>=0;p--)h[p]._add(e);pi.path(t,h.slice(0,2),u),pi.path(t,h.slice(2,4),u)}else if("diamond"===a||"bar"===a||"square"===a||"rectangle"===a||"triangle"===a){"bar"===a?e=e.add(0,-d):"rectangle"===a&&(e=e.add(d,d));for(var g=h.length-1;g>=0;g--)h[g]._add(e);pi.polygon(t,h,u,l)}else if("pin"===a){e=e.add(0,-d);for(var m=h.length-1;m>=0;m--)h[m]._add(e);var v=t.lineCap;t.lineCap="round",pi.bezierCurveAndFill(t,h,u,l),t.lineCap=v}else{if("pie"!==a)throw new Error("unsupported markerType: "+a);e=e.add(0,-d);var _=180*Math.atan(c/2/f)/Math.PI,y=t.lineCap;t.lineCap="round",pi.sector(t,e,f,[90-_,90+_],u,l),t.lineCap=y}return t.canvas}function vr(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e}function _r(t,e,i){var n,r=i/2,o=e/2;if("triangle"===t)return[n=new et(0,0-r),new et(0-o,0+r),new et(0+o,0+r)];if("cross"===t)return[n=new et(0-o,0),new et(0+o,0),new et(0,0-r),new et(0,0+r)];if("diamond"===t)return[n=new et(0-o,0),new et(0,0-r),new et(0+o,0),new et(0,0+r)];if("square"===t)return[n=new et(0-o,0+r),new et(0+o,0+r),new et(0+o,0-r),new et(0-o,0-r)];if("rectangle"===t)return[n=new et(0,0),n.add(e,0),n.add(e,i),n.add(0,i)];if("x"===t)return[n=new et(0-o,0+r),new et(0+o,0-r),new et(0+o,0+r),new et(0-o,0-r)];if("bar"===t)return[n=new et(0-o,0-i),new et(0+o,0-i),new et(0+o,0),new et(0-o,0)];if("pin"===t||"pie"===t){var s=i*Math.atan(o/r);return[n=new et(0,0),new et(0-s,0-i),new et(0+s,0-i),new et(0,0)]}return[]}var yr,xr=new et(0,0),wr=new et(0,0),br=new et(0,0),Cr=new et(0,0),Pr=function(t){function e(e,i,n){var r;return(r=t.call(this)||this).symbol=e,r.geometry=i,r.painter=n,r}Y(e,t);var i=e.prototype;return i.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLRes(),i=new dn,n=this._getRenderPoints()[0],r=n.length-1;r>=0;r--)n[r]&&i._combine(t._pointAtResToPoint(n[r],e));return i},i.isDynamicSize=function(){var t=this.symbol;return It(t.markerWidth)||It(t.markerHeight)||It(t.textSize)},i._rotateExtent=function(t,e){return t.convertTo(function(t){return t._rotate(e)})},i._getRenderPoints=function(){var t=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(t)},i._getRenderContainerPoints=function(t){var e=this.getPainter();if(e.isSpriting())return this._getRenderPoints()[0];var i,n=this.geometry,r=this.getDxDy();if(n._cPoint&&!t){var o=t?br:Cr;o.set(n._cPoint.x,n._cPoint.y);var s=e.containerOffset;o._sub(s);var a=r.x,h=r.y;(a||h)&&o._add(a||0,h||0),i=[o]}else{var u=this._getRenderPoints()[0];i=this.painter._pointContainerPoints(u,r.x,r.y,t,!0,this.getPlacement())}if(!i||!Array.isArray(i[0]))return i;for(var l=[],c=0,f=i.length;c<f;c++)for(var d=0,p=i[c].length;d<p;d++)l.push(i[c][d]);return l},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){return Un(this.style)},i.getDxDy=function(){var t=this.style,e=t.markerDx,i=t.markerDy;return new et(e,i)},i._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var i=this._getRenderPoints()[1];if(!i||!i[t])return e;var n=this.getMap(),r=i[t][0],o=i[t][1];if(n.isTransforming()){var s=n.getGLRes();return r=n._pointAtResToContainerPoint(i[t][0],s,0,xr),o=n._pointAtResToContainerPoint(i[t][1],s,0,wr),e+Pt(r.x,r.y,o.x,o.y)}return e+-Pt(r.x,r.y,o.x,o.y)},i._rotate=function(t,e,i){if(i){var n=this.getDxDy(),r=e.sub(n);return t.save(),t.translate(r.x,r.y),t.rotate(i),n}return null},e}(gr),Mr=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.getPlacement=function(){return"point"},i.getDxDy=function(){return new et(0,0)},i.symbolize=function(t){var e=this.geometry,i=e.getLayer();if(e.options.debug||!i||i.options.debug){var n=this.getMap();if(n&&!n.isZooming()){var r=i.options.debugOutline;t.strokeStyle=r,t.fillStyle=r;var o=e.getContainerExtent().toArray();pi.polygon(t,[o],1,0);for(var s=this._getRenderContainerPoints(),a=this.geometry.getId(),h=_r("cross",10,10),u=0;u<s.length;u++){var l=s[u];d(a)||pi.fillText(t,a,l.add(8,-4),r);for(var c=[],f=0;f<h.length;f++)c.push(h[f].add(l));pi.path(t,c.slice(0,2),1),pi.path(t,c.slice(2,4),1)}}}},e}(Pr),Tr=new he(1,1),Sr=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this).style=r._defineStyle(r.translate()),r}Y(e,t),e.test=function(t){return Qn(t)};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&0!==i.markerOpacity){var n=this._getRenderContainerPoints();if(mt(n)){var r=this._getImage(e);if(r){this._prepareContext(t);var o,s=i.markerWidth,a=i.markerHeight;if(!p(s)||!p(a)){s=r.width,a=r.height,i.markerWidth=s,i.markerHeight=a;var h=i.markerFile;e.isResourceLoaded(h)||e.addResource(h,r);var u=this.getPainter();u.isSpriting()||u.removeCache()}"path"!==this.symbol.markerType&&p(i.markerOpacity)&&i.markerOpacity<1&&(o=t.globalAlpha,t.globalAlpha*=i.markerOpacity),Tr.width=s,Tr.height=a;for(var l=xe(Tr,i.markerHorizontalAlignment,i.markerVerticalAlignment),c=0,f=n.length;c<f;c++){var d=n[c],g=this.getRotation()?this._rotate(t,d,this._getRotationAt(c)):null;g&&(d=g),pi.image(t,r,d.x+l.x,d.y+l.y,s,a),g&&t.restore()}void 0!==o&&(t.globalAlpha=o)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}},i._getImage=function(t){return function(t,e){return t&&t.getImage(e)||null}(t,this.style.markerFile)},i.getFixedExtent=function(t){return this._fixedExtent=this._fixedExtent||new dn,Jn(this._fixedExtent,this.style,t)},i.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:lt(t.markerOpacity,1),markerWidth:lt(t.markerWidth,null),markerHeight:lt(t.markerHeight,null),markerRotation:lt(t.markerRotation,0),markerDx:lt(t.markerDx,0),markerDy:lt(t.markerDy,0),markerHorizontalAlignment:lt(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:lt(t.markerVerticalAlignment,"top")}},e}(Pr),Ar=new Yi(0,0),Er=new Yi(0,0),kr=function(t){function e(e,i,n){var r;return(r=t.call(this)||this).symbol=e,r.geometry=i,r.painter=n,"Point"===i.type?X(r):(r.style=r._defineStyle(r.translate()),r)}Y(e,t),e.test=function(t,e){if(!t)return!1;if(e&&"Point"===e.type)return!1;for(var i in t){var n=i.slice(0,4);if("line"===n||"poly"===n)return!0}return!1};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(0!==i.polygonOpacity||0!==i.lineOpacity||this.painter.isHitTesting()){var n=this._getPaintParams();if(n){this._prepareContext(t);var r=Me(i.lineColor),o="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!i.lineColor.places&&o||(i.lineGradientExtent=this.geometry.getContainerExtent()._expand(i.lineWidth)),Me(i.polygonFill)&&(i.polygonGradientExtent=this.geometry.getContainerExtent());var s=n[0];if("Polygon"===this.geometry.getJSONType()&&s.length>0&&Array.isArray(s[0][0])||"LineString"===this.geometry.type&&s.length>0&&Array.isArray(s[0]))for(var a=0;a<s.length;a++){this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s[a],i.lineColor);var h=[t,s[a]];n.length>1&&h.push.apply(h,n.slice(1)),h.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,h)}else{this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s,i.lineColor);var u=[t];u.push.apply(u,n),u.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,u)}t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])}}},i.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new Yi(0,0),this._extMax=new Yi(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var i=t._prjToPoint(this._extMin,void 0,Ar),n=t._prjToPoint(this._extMax,void 0,Er);return this._pxExtent?this._pxExtent.set(Math.min(i.x,n.x),Math.min(i.y,n.y),Math.max(i.x,n.x),Math.max(i.y,n.y)):this._pxExtent=new dn(i,n),this._pxExtent},i.getFixedExtent=function(){var t=this.style.lineWidth/2;return new dn(-t,-t,t,t)},i._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},i.translate=function(){var t=this.symbol,e={lineColor:lt(t.lineColor,"#000"),lineWidth:lt(t.lineWidth,2),lineOpacity:lt(t.lineOpacity,1),lineDasharray:lt(t.lineDasharray,[]),lineCap:lt(t.lineCap,"butt"),lineJoin:lt(t.lineJoin,"miter"),linePatternFile:lt(t.linePatternFile,null),lineDx:lt(t.lineDx,0),lineDy:lt(t.lineDy,0),polygonFill:lt(t.polygonFill,null),polygonOpacity:lt(t.polygonOpacity,1),polygonPatternFile:lt(t.polygonPatternFile,null),polygonPatternDx:lt(t.polygonPatternDx,0),polygonPatternDy:lt(t.polygonPatternDy,0),linePatternDx:lt(t.linePatternDx,0),linePatternDy:lt(t.linePatternDy,0)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},i._createGradient=function(t,e,i){if(Array.isArray(e)&&e.length){var n=e.length,r=t.createLinearGradient(e[0].x,e[0].y,e[n-1].x,e[n-1].y);i.colorStops.forEach(function(t){r.addColorStop.apply(r,t)}),t.strokeStyle=r}},e}(gr),Rr=function(t){function e(e,i,n){var r,o=(r=t.call(this,e,i,n)||this).translate();return r._dynamic=jt(o),r.style=r._defineStyle(o),0===r.style.textWrapWidth?X(r):(r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style)),r)}Y(e,t),e.test=function(t){return Kn(t)};var i=e.prototype;return i.symbolize=function(t,e){if(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth){var i=this._getRenderContainerPoints();if(mt(i)){var n=this.style,r=this.strokeAndFill,o=_e(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var s=this._textDesc=this._textDesc||ye(o,this.style);this._prepareContext(t),this.prepareCanvas(t,r,e),pi.prepareCanvasFont(t,n);for(var a=0,h=i.length;a<h;a++){var u=i[a],l=this.getRotation()?this._rotate(t,u,this._getRotationAt(a)):null;l&&(u=l),pi.text(t,o,u,n,s),l&&t.restore()}}}},i.getPlacement=function(){return this.symbol.textPlacement},i.getRotation=function(){var t=this.style.textRotation;return p(t)?-t*Math.PI/180:null},i.getDxDy=function(){var t=this.style;return new et(t.textDx,t.textDy)},i.getFixedExtent=function(){var t=this.geometry.getTextDesc();return Array.isArray(t)&&(t=t[this._index]),this._fixedExtent=this._fixedExtent||new dn,t?qn(this._fixedExtent,this.style,t):this._fixedExtent},i.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:lt(t.textFaceName,"monospace"),textWeight:lt(t.textWeight,"normal"),textStyle:lt(t.textStyle,"normal"),textSize:lt(t.textSize,l),textFont:lt(t.textFont,null),textFill:lt(t.textFill,"#000"),textOpacity:lt(t.textOpacity,1),textHaloFill:lt(t.textHaloFill,"#ffffff"),textHaloRadius:lt(t.textHaloRadius,0),textHaloOpacity:lt(t.textHaloOpacity,1),textWrapWidth:lt(t.textWrapWidth,null),textWrapCharacter:lt(t.textWrapCharacter,"\n"),textLineSpacing:lt(t.textLineSpacing,0),textDx:lt(t.textDx,0),textDy:lt(t.textDy,0),textHorizontalAlignment:lt(t.textHorizontalAlignment,"middle"),textVerticalAlignment:lt(t.textVerticalAlignment,"middle"),textAlign:lt(t.textAlign,"center"),textRotation:lt(t.textRotation,0),textMaxWidth:lt(t.textMaxWidth,0),textMaxHeight:lt(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},i.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},e}(Pr),Or=[],Lr=function(t){function e(e,i,n){var r,o=(r=t.call(this,e,i,n)||this).translate();return r._dynamic=jt(o),r.style=r._defineStyle(o),r.strokeAndFill=r._defineStyle(vr(r.style)),r.padding=0,r}Y(e,t),e.test=function(t){return tr(t)};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&(0!==i.polygonOpacity||0!==i.lineOpacity)){var n=this._getRenderContainerPoints();mt(n)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,n,e):this._drawMarkersWithCache(t,n,e))}},i._drawMarkers=function(t,e,i){for(var n=e.length-1;n>=0;n--){var r=e[n],o=this.getRotation()?this._rotate(t,r,this._getRotationAt(n)):null;o&&(r=o),this._drawVectorMarker(t,r,i),o&&t.restore()}},i._drawMarkersWithCache=function(t,e,i){var n=this._stampSymbol(),r=i.getImage(n);r||(r=this._createMarkerImage(t,i),i.addResource([n,r.width,r.height],r));for(var o=Wn(this.style,r.width,r.height),s=e.length-1;s>=0;s--){var a=e[s],h=this.getRotation()?this._rotate(t,a,this._getRotationAt(s)):null;h&&(a=h),pi.image(t,r,a.x+o.x,a.y+o.y),h&&t.restore()}},i._createMarkerImage=function(t,e){var i=t.canvas.constructor,n=Vn(Or,this.style),r=pi.createCanvas(n[0],n[1],i),o=this._getCacheImageAnchor(n[0],n[1]),s=r.getContext("2d");return this._drawVectorMarker(s,o,e),r},i._stampSymbol=function(){return this._stamp||(this._stamp=Pe([this.style.markerType,Me(this.style.markerFill)?Te(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,Me(this.style.markerLineColor)?Te(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},i._getCacheImageAnchor=function(t,e){var i=2*(this.symbol.shadowBlur||0)+this.padding,n=this.style.markerType;return"bar"===n||"pie"===n||"pin"===n?new et(t/2,e-i):"rectangle"===n?new et(i,i):new et(t/2,e/2)},i._getGraidentExtent=function(t){var e=new dn,i=this.getDxDy(),n=this.getFixedExtent();if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)e._combine(t[r]);else e._combine(t);return e.xmin+=n.xmin-i.x,e.ymin+=n.ymin-i.y,e.xmax+=n.xmax-i.x,e.ymax+=n.ymax-i.y,e},i._drawVectorMarker=function(t,e,i){mr(t,e,this.style,i)},i.getFixedExtent=function(){var t=this.isDynamicSize(),e=this.style.markerWidth,i=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new dn,Nn(this._fixedExtent,this.style,t?[128,128*i/e]:null)},i.translate=function(){var t=this.symbol,e={markerType:lt(t.markerType,"ellipse"),markerFill:lt(t.markerFill,"#00f"),markerFillOpacity:lt(t.markerFillOpacity,1),markerFillPatternFile:lt(t.markerFillPatternFile,null),markerLineColor:lt(t.markerLineColor,"#000"),markerLineWidth:lt(t.markerLineWidth,jn.markerLineWidth),markerLineOpacity:lt(t.markerLineOpacity,1),markerLineDasharray:lt(t.markerLineDasharray,[]),markerLinePatternFile:lt(t.markerLinePatternFile,null),markerDx:lt(t.markerDx,0),markerDy:lt(t.markerDy,0),markerWidth:lt(t.markerWidth,jn.markerWidth),markerHeight:lt(t.markerHeight,jn.markerHeight),markerRotation:lt(t.markerRotation,0),shadowBlur:lt(t.shadowBlur,0),shadowOffsetX:lt(t.shadowOffsetX,0),shadowOffsetY:lt(t.shadowOffsetY,0)},i=e.markerType,n=Zn(i),r=Gn(i);return e.markerHorizontalAlignment=lt(t.markerHorizontalAlignment,n),e.markerVerticalAlignment=lt(t.markerVerticalAlignment,r),p(t.markerOpacity)&&(p(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),p(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},e}(Pr),Dr=function(t){function e(e,i,n){var r;d(e.markerWidth)&&(e.markerWidth=80),d(e.markerHeight)&&(e.markerHeight=80),e=f(e,(r=t.call(this,e,i,n)||this).translate());var o=r.style=r._defineStyle(e);return q.gecko?r._url=[re(o,o.markerWidth,o.markerHeight),o.markerWidth,o.markerHeight]:r._url=[re(o),o.markerWidth,o.markerHeight],r}Y(e,t),e.test=function(t){return er(t)};var i=e.prototype;return i._prepareContext=function(){},i._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var i=this.painter,n=new Image;return n.onload=function(){var t=i.getLayer()&&i.getLayer().getRenderer();t&&t.setToRedraw()},n.onerror=function(i){i&&"undefined"!=typeof console&&console.warn(i),t.markErrorResource(e._url)},n.src=this._url[0],t&&t.addResource(this._url,n),n},e}(Sr),Ir={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},jr=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this).style=i.getLayer().options.drawAltitude,r.style&&m(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:e.textDx||e.markerDx,dy:e.textDy||e.markerDy}),r}Y(e,t),e.test=function(t,e){if(!e.getLayer())return!1;var i=e.getJSONType();return"Marker"===i||"LineString"===i};var i=e.prototype;return i.symbolize=function(t){var e=this.geometry.getLayer();if(e.options.drawAltitude){var i=this.geometry.getProperties();if(i&&i[e.options.altitudeProperty]){var n=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var r=this._getPaintParams(n.lineDx,n.lineDy,!1,!0);if(!r)return;var o=this.getPainter().getPaintParams(n.lineDx,n.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(t,r[0],o)}else{var s=this._getRenderContainerPoints(),a=this._getRenderContainerPoints(!0);if(!s||0===s.length)return;this._drawMarkerAltitude(t,s[0],a[0])}}}},i.getDxDy=function(){var t=this.dxdy;return new et(t.dx||0,t.dy||0)},i.get2DExtent=function(){return"LineString"===this.geometry.type?kr.prototype.get2DExtent.apply(this):t.prototype.get2DExtent.call(this)},i.getPlacement=function(){return"point"},i._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0,null,!0,"_altpt")},i._drawMarkerAltitude=function(t,e,i){var n=this._getStyle();this.prepareCanvas(t,n),pi.path(t,[e,i],n.lineOpacity,null,n.lineDasharray)},i._drawLineAltitude=function(t,e,i){var n=this._getStyle();if(e.length>0&&Array.isArray(e[0]))for(var r=0;r<e.length;r++)this._drawLine(t,e[r],i[r]);else this._drawLine(t,e,i);t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([])},i._drawLine=function(t,e,i){var n=this._getStyle();this.prepareCanvas(t,n);for(var r=0,o=e.length-1;r<o;r++)pi.polygon(t,[e[r],e[r+1],i[r+1],i[r]],n.lineOpacity,n.polygonOpacity,n.lineDasharray)},i._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return m(t)||(t=Ir),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},e}(Pr),zr=[jr,kr,Sr,Dr,Lr,Rr],Hr=new et(0,0),Fr=new dn,Nr=new dn,Zr=new dn,Gr=new dn,Br=new dn,Wr={},Vr={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},$r=function(t){function e(e){var i;return(i=t.call(this)||this).geometry=e,i.symbolizers=i._createSymbolizers(),i._altAtGL=i._getGeometryAltitude(),i}Y(e,t);var i=e.prototype;return i.getMap=function(){return this.geometry.getMap()},i.getLayer=function(){return this.geometry.getLayer()},i._createSymbolizers=function(){var t=this.getSymbol(),e=[],i=zr,n=t;Array.isArray(t)||(n=[t]);for(var r=n.length-1;r>=0;r--)for(var o=n[r],s=i.length-1;s>=0;s--)if(i[s].test(o,this.geometry)){var a=new i[s](o,this.geometry,this);a._index=r,e.push(a),a instanceof Pr&&(this._hasPoint=!0)}if(!e.length&&console){var h=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(h?":"+h:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new Mr(t,this.geometry,this),e},i.hasPoint=function(){return!!this._hasPoint},i.getRenderPoints=function(t){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},i.getPaintParams=function(t,e,i,n,r){void 0===r&&(r="_pt");var o,s,a,h,u,l=this.getLayer()._getRenderer().mapStateCache,c=this.getMap();l&&!this._hitPoint?(o=l.resolution,s=l.pitch,a=l.bearing,h=l.glScale,u=l.containerExtent):(o=c.getResolution(),s=c.getPitch(),a=c.getBearing(),h=c.getGLScale(),u=c.getContainerExtent());var f=this.geometry,d=o,g=0!==s,m=0!==a,v=this._cachedParams,_=f._paintAsPath&&f._paintAsPath();if(_&&this._unsimpledParams&&d<=this._unsimpledParams._res)v=this._unsimpledParams;else if(!v||v._res!==o||this._pitched!==g&&f._redrawWhenPitch()||this._rotated!==m&&f._redrawWhenRotate()){if(!(v=f._getPaintParams()))return null;v._res=d,!f._simplified&&_&&(this._unsimpledParams||(this._unsimpledParams=v),d>this._unsimpledParams._res&&(this._unsimpledParams._res=d)),this._cachedParams=v}if(!v)return null;this._pitched=g,this._rotated=m;var y=h,x=[],w=v[0],b=u,C=this._pointContainerPoints(w,t,e,i,n||this._hitPoint&&!b.contains(this._hitPoint),null,r);if(!C)return null;x.push(C);for(var P=1,M=v.length;P<M;P++)p(v[P])||v[P]instanceof he?p(v[P])?x.push(v[P]/y):x.push(v[P].multi(1/y)):x.push(v[P]);return x},i._pointContainerPoints=function(t,e,i,n,r,o,s){if(void 0===s&&(s="_pt"),this._aboveCamera())return null;var a,h,u,l=this.getLayer()._getRenderer(),c=l.mapStateCache,f=this.getMap(),d=this.geometry,g=this.containerOffset;c?(a=c.glRes,h=c.containerExtent):(a=f.getGLRes(),h=f.getContainerExtent());var m=this.getLayer().options.roundPoint,v=1/0,_=1/0,y=-1/0,x=-1/0,w=!r,b=l.layer.options.clipBBoxBufferSize||3,C=this.symbolizers;function P(t,n){void 0===t&&(t=[]),void 0===n&&(n=[]);for(var r=Et(t,s),o=0,u=(r=f._pointsAtResToContainerPoints(t,a,n,r)).length;o<u;o++){var l=r[o];l._sub(g),(e||i)&&l._add(e||0,i||0),m&&(l.x=Math.ceil(l.x),l.y=Math.ceil(l.y)),v=Math.min(l.x,v),_=Math.min(l.y,_),y=Math.max(l.x,y),x=Math.max(l.y,x)}if(w&&Ie(C)){if(Br.ymin=h.ymin,Br.ymin<b&&(Br.ymin=h.ymin-b),Br.xmin=h.xmin-b,Br.xmax=h.xmax+b,Br.ymax=h.ymax+b,d.getShell&&d.getHoles)return ar(r,Br);var c=or(r,Br,!1);if(c.length){var p=[];return c.forEach(function(t){for(var e=0,i=t.length;e<i;e++)p.push(t[e].point)}),p}}return r}var M=this.getAltitude();if(Array.isArray(t)){var T,S=this.geometry;!r&&S.options.enableClip?(T=this._clip(t,M)).inView&&(w=!1):T={points:t,altitude:M};var A=T.points;M=T.altitude,n&&(M=0);var E=M;u=[];for(var k=[],R=p(M),O=0,L=A.length;O<L;O++){var D=A[O];if(Array.isArray(D)){if(R){var I=P(D,M);u.push(I);continue}for(var j=[],z=0,H=D.length;z<H;z++)Array.isArray(M)&&(E=M[O]?M[O][z]:0),j.push(E);var F=P(D,j);u.push(F)}else Array.isArray(M)&&(E="vertex-last"===o?M[M.length-1-O]:"line"===o?(M[O]+M[O+1])/2:M[O]),k.push(E)}k.length&&(u=P(A,k))}else t instanceof et&&(n&&(M=0),u=f._pointAtResToContainerPoint(t,a,M)._sub(g),(e||i)&&u._add(e,i));return Vr.minx=v,Vr.miny=_,Vr.maxx=y,Vr.maxy=x,this._containerBbox=Vr,u},i._clip=function(t,e){if(p(e)&&0!==e)return{points:t,altitude:e};if(Array.isArray(e)){for(var i=!1,n=0,r=e.length;n<r;n++)if(0!==e[n]){i=!0;break}if(i)return{points:t,altitude:e}}var o=this.getMap(),s=this.geometry,a=this.getSymbol().lineWidth;p(a)||(a=4);var h,u,l,c=this.getLayer()._getRenderer().mapStateCache;c?(h=c._2DExtent,u=c.glExtent,l=c.pitch):(h=o._get2DExtent(),u=o._get2DExtentAtRes(o.getGLRes()),l=o.getPitch());var f=h._expand(a);if(l>0&&e){var d=o.cameraLookAt,g=o.cameraPosition;Hr.set(g.x,g.y),f=f._combine(Hr._add(ct(d[0]-g[0]),ct(d[1]-g[1])))}var m=t;if(this.get2DExtent(null,Gr).within(f))return{points:m,altitude:e,inView:!0};var v=u._expand(a*o._glScale);Zr.xmin=v.xmin,Zr.xmax=v.xmax,Zr.ymin=v.ymin,Zr.ymax=v.ymax;var _=s.options.smoothness;if(s.getShell&&this.geometry.getHoles&&!_){var y=v.xmin,x=v.ymin,w=v.xmax,b=v.ymax,C=Math.abs(w-y),P=Math.abs(b-x),M=Math.sqrt(C*C+P*P),T=(M-C)/2,S=(M-P)/2;if(Zr.xmin=v.xmin-T,Zr.xmax=v.xmax+T,Zr.ymin=v.ymin-S,Zr.ymax=v.ymax+S,Array.isArray(t[0])){m=[];for(var A=0;A<t.length;A++){var E=ar(t[A],Zr);E.length&&m.push(E)}}else m=ar(t,Zr)}else if("LineString"===s.getJSONType()&&!_){if(Array.isArray(t[0])){m=[];for(var k=0;k<t.length;k++)at(m,or(t[k],Zr,!1,!!_))}else m=or(t,Zr,!1,!!_);return this._interpolateSegAlt(m,t,e)}return{points:m,altitude:e}},i._interpolateSegAlt=function(t,e,i){if(!Array.isArray(i)){var n=function(t){return t.point};return{points:t.map(function(t){return Array.isArray(t)?t.map(n):t.point}),altitude:i}}var r=function t(e,i,n){if(!Array.isArray(n))return e;var r=[];for(var o=0,s=e.length;o<s;o++)if(Array.isArray(e[o]))r.push(t(e[o],i,n));else{var a=e[o];if(a.point.equals(i[a.index]))a.altitude=n[a.index],r.push(a);else{var h=void 0,u=void 0;0===a.index?(h=a.index,u=a.index+1):(h=a.index-1,u=a.index);var l=a.point.distanceTo(i[u]),c=l/(l+i[h].distanceTo(a.point)),f=dt(n[h],n[u],1-c);a.altitude=f,r.push(a)}}return r}(t,e,i);return i=[],{points:r.map(function(t){if(Array.isArray(t)){var e=[],n=t.map(function(t){return e.push(t.altitude),t.point});return i.push(e),n}return i.push(t.altitude),t.point}),altitude:i}},i.getSymbol=function(){return this.geometry._getInternalSymbol()},i.paint=function(t,e,i){if(this.symbolizers){var n=this.getLayer(),r=n._getRenderer();if(r&&(r.context||e)){var o=r.mapStateCache||{};if(this.geometry._isCheck||!t||t.intersects(this.get2DExtent(r.resources,Fr))){var s=this.getMap(),a=this.getMinAltitude(),h=s.getFrustumAltitude();if(!(a&&h&&h<a)){this.containerOffset=i||o.offset||s._pointToContainerPoint(r.southWest)._add(0,-s.height),this._beforePaint();for(var u=e||r.context,l=[u,r.resources],c=this.symbolizers.length-1;c>=0;c--)(u.shadowBlur||this.symbolizers[c].symbol.shadowBlur)&&this._prepareShadow(u,this.symbolizers[c].symbol),this.symbolizers[c].symbolize.apply(this.symbolizers[c],l);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||n.options.debug)&&this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,l)}}}}},i.getSprite=function(t,e){if("Point"!==this.geometry.type)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var i=new dn;this.symbolizers.forEach(function(e){var n=e.getFixedExtent(t);i._combine(n)});var n,r=i.getMin().multi(-1),o=e||(this.getMap()?this.getMap().CanvasClass:null),s=pi.createCanvas(i.getWidth(),i.getHeight(),o);this._renderPoints&&(n=this._renderPoints);for(var a=s.getContext("2d"),h=[a,t],u=this.symbolizers.length-1;u>=0;u--){var l=this.symbolizers[u].getDxDy();this._renderPoints={center:[[r.add(l)]]},this._prepareShadow(a,this.symbolizers[u].symbol),this.symbolizers[u].symbolize.apply(this.symbolizers[u],h)}n&&(this._renderPoints=n),this._sprite={canvas:s,offset:i.getCenter()}}return this._spriting=!1,this._sprite},i.isSpriting=function(){return!!this._spriting},i.hitTest=function(t,e){if((!e||e<.5)&&(e=.5),this._hitPoint=t.sub(e,e),!yr){var i=this.getMap()?this.getMap().CanvasClass:null;yr=pi.createCanvas(1,1,i)}pi.setHitTesting(!0),yr.width=yr.height=2*e;var n=yr.getContext("2d");try{this.paint(null,n,this._hitPoint)}catch(t){throw t}finally{pi.setHitTesting(!1)}delete this._hitPoint;for(var r=n.getImageData(0,0,yr.width,yr.height).data,o=3,s=r.length;o<s;o+=4)if(r[o]>0)return!0;return!1},i.isHitTesting=function(){return!!this._hitPoint},i._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},i._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var i=this.symbolizers.length-1;i>=0;i--)t.apply(e,[this.symbolizers[i]])}},i.get2DExtent=function(t,e){this._verifyProjection();var i=this.getMap();t=t||this.getLayer()._getRenderer().resources;var n=i.getZoom(),r=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===n&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==n&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new dn),this._extent2D._zoom=n),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new dn)))),!this._extent2D)return r&&delete this._fixedExtent,null;var o=this._fixedExtent,s=o.xmin,a=o.ymin,h=o.xmax,u=o.ymax;return r&&delete this._fixedExtent,Nr.set(s,-u,h,-a),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(Nr),e):this._extent2D.add(Nr)},i._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--){var i=this.symbolizers[e];t._combine(i.get2DExtent())}return t},i._computeFixedExtent=function(t,e){for(var i=this.symbolizers.length-1;i>=0;i--){var n=this.symbolizers[i];n.getFixedExtent&&e._combine(n.getFixedExtent(t))}return e},i._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--){if(this.symbolizers[t].isDynamicSize())return!0}return!1},i._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap().getFrustumAltitude();return t&&e&&e<t},i.getFixedExtent=function(){var t=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new dn):(this._extent2D&&this._extent2D._zoom===t||this.get2DExtent(null,Nr),this._fixedExtent)},i.setZIndex=function(t){this._eachSymbolizer(function(e){e.setZIndex(t)})},i.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer(function(t){t.show()})):this.getLayer().isCanvasRender()||this.paint()},i.hide=function(){this._eachSymbolizer(function(t){t.hide()})},i.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},i.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},i.remove=function(){this.removeCache(),this._removeSymbolizers()},i._removeSymbolizers=function(){this._eachSymbolizer(function(t){delete t.painter,t.remove()}),delete this.symbolizers},i.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},i.getAltitude=function(){return this.geometry.getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},i.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},i.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},i._getGeometryAltitude=function(){var t=this;if(!this.getMap())return 0;var e=this.geometry.getAltitude();if(this._propAlt=e,!e)return this.minAltitude=this.maxAltitude=0,0;var i=this.geometry.getCenter();return i?Array.isArray(e)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,e.map(function(e){var n=t._meterToPoint(i,e);return n<t.minAltitude&&(t.minAltitude=n),n>t.maxAltitude&&(t.maxAltitude=n),n})):(this.minAltitude=this.maxAltitude=this._meterToPoint(i,e),this.minAltitude):0},i._meterToPoint=function(t,e){var i=this.getMap(),n=i.getGLRes();return i.distanceToPointAtRes(e,0,n,t).x*ct(e)},i._verifyProjection=function(){var t=this.geometry._getProjection()||Wr;this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},i._beforePaint=function(){},i._afterPaint=function(){},e}(Mi);var Ur=new dn,Jr=function(t){function e(e,i){var n;return(n=t.call(this)||this).geometry=e,n.isMask=i,n}Y(e,t);var i=e.prototype;return i._eachPainter=function(t){for(var e,i=this.geometry.getGeometries(),n=0,r=i.length;n<r&&(!(e=this.isMask?i[n]._getMaskPainter():i[n]._getPainter())||!e||!1!==t.call(this,e));n++);},i.paint=function(t){this.geometry&&this._eachPainter(function(e){e.paint(t)})},i.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var i=e||new dn;return this._eachPainter(function(e){i=i._combine(e.get2DExtent(t,Ur))}),i},i.remove=function(){var t=arguments;this._eachPainter(function(e){e.remove.apply(e,t)})},i.setZIndex=function(){var t=arguments;this._eachPainter(function(e){e.setZIndex.apply(e,t)})},i.show=function(){var t=arguments;this._eachPainter(function(e){e.show.apply(e,t)})},i.hide=function(){var t=arguments;this._eachPainter(function(e){e.hide.apply(e,t)})},i.repaint=function(){var t=arguments;this._eachPainter(function(e){e.repaint.apply(e,t)})},i.refreshSymbol=function(){var t=arguments;this._eachPainter(function(e){e.refreshSymbol.apply(e,t)})},i.hasPoint=function(){var t=!1;return this._eachPainter(function(e){return!e.hasPoint()||(t=!0,!1)}),t},i.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter(function(i){var n=i.getMinAltitude();(t||n<e)&&(t=!1,e=n)}),e},i.getMaxAltitude=function(){var t=0;return this._eachPainter(function(e){var i=e.getMaxAltitude();i>t&&(t=i)}),t},e}(Mi),qr={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=12756274*Math.PI,i=0;i<23;i++)t[i]=e/(256*Math.pow(2,i));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<23;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{projection:"baidu",resolutions:function(){for(var t=Math.pow(2,18),e=[],i=0;i<23;i++)e[i]=t,t*=.5;return e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var t=Math.pow(2,8),e=[],i=0;i<23;i++)e[i]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=6378137*Math.PI,i=0;i<23;i++)t[i]=e/(256*Math.pow(2,i));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}}};qr["EPSG:4490"]=qr["EPSG:4326"];var Yr=function(){function t(t){void 0===t&&(t={}),this.options=t,this._initSpatialRef()}t.getPreset=function(t){return qr[t.toUpperCase()]},t.getAllPresets=function(){return Object.keys(qr)},t.getProjectionInstance=function(t){if(!t)return null;if(m(t))return t;for(var e in t=(t+"").toLowerCase(),On)if(x(On,e)){var i=On[e].code;if(i&&i.toLowerCase()===t)return On[e]}return null},t.equals=function(t,e){if(v(t)||v(e))return t===e;if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var i=t.fullExtent,n=e.fullExtent;if(i&&!n||!i&&n)return!1;if(i&&n&&(i.top!==n.top||i.bottom!==n.bottom||i.left!==n.left||i.right!==n.right))return!1;var r=t.resolutions,o=e.resolutions;if(r&&o){if(r.length!==o.length)return!1;for(var s=0;s<r.length;s++)if(r[s]!==o[s])return!1}else if(r||o)return!1;return!0};var e=t.prototype;return e._initSpatialRef=function(){var e=this.options.projection;if(!(e=e?t.getProjectionInstance(e):Rn))throw new Error("must provide a valid projection in map's spatial reference.");(e=f({},gn,e)).measureLength||f(e,Mn.DEFAULT),this._projection=e;var i,n=this.options.resolutions;if(!n&&(e.code&&(i=qr[e.code.toUpperCase()])&&(n=i.resolutions,this.isEPSG="IDENTITY"!==e.code),!n))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=n,this._pyramid=!0,this._pyramid)for(var r=0;r<n.length;r++)if(n[r]&&n[r-1]&&n[r-1]/n[r]!=2){this._pyramid=!1;break}var o=this.options.fullExtent;if(!o&&(e.code&&(i=qr[e.code.toUpperCase()])&&(o=i.fullExtent),!o))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(d(o.left)?(this._fullExtent=new cn(o),o.left=o.xmin,o.right=o.xmax,o.top=o.ymax,o.bottom=o.ymin):this._fullExtent=new cn(new Yi(o.left,o.top),new Yi(o.right,o.bottom)),d(o.top)||d(o.bottom)||d(o.left)||d(o.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");f(this._fullExtent,o),this._projection.fullExtent=o;var s=o.right>=o.left?1:-1,a=o.top>=o.bottom?-1:1;this._transformation=new pn([s,a,0,0])},e.getResolutions=function(){return this._resolutions||[]},e.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var i=this._resolutions[e];return e!==t&&t>0&&e<this._resolutions.length-1?i+(this._resolutions[e+1]-i)*(t-e):i},e.getProjection=function(){return this._projection},e.getFullExtent=function(){return this._fullExtent},e.getTransformation=function(){return this._transformation},e.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!d(this._resolutions[t]))return t;return 0},e.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!d(this._resolutions[t]))return t;return this._resolutions.length-1},e.getZoomDirection=function(){return ct(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},e.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},e.isPyramid=function(){return this._pyramid},t}(),Xr=new et(0,0),Kr=new dn,Qr=function(t){function e(e){var i,n=f({},e),r=n.symbol,o=n.properties,s=n.id;return delete n.symbol,delete n.id,delete n.properties,i=t.call(this,n)||this,r?i.setSymbol(r):i._genSizeSymbol(),o&&i.setProperties(o),d(s)||i.setId(s),i}Y(e,t);var i=e.prototype;return i.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},i.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},i.addTo=function(t,e){return t.addGeometry(this,e),this},i.getLayer=function(){return this._layer?this._layer:null},i.getMap=function(){return this._layer?this._layer.getMap():null},i.getId=function(){return this._id},i.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},i.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},i.setProperties=function(t){var e=this.properties;return this.properties=m(t)?f({},t):t,this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},i.getType=function(){return this.type},i.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?Ee(t):f({},t):null},i.setSymbol=function(t){return this._symbolUpdated=t,this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},i.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=Se(this._symbolUpdated)),this._symbolHash},i.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Parameter of updateSymbol is not an array.");for(var i=0;i<t.length;i++)Kn(t[i])&&delete this._textDesc,e[i]&&t[i]&&(e[i]=Ee(e[i],t[i]))}else{if(Array.isArray(t))throw new Error("Geometry's symbol is not an array to update.");Kn(e)&&delete this._textDesc,e=Ee(e||this._getInternalSymbol(),t)}return this._eventSymbolProperties=t,delete this._compiledSymbol,this.setSymbol(e)},i.getTextContent=function(){var t=this._getInternalSymbol();if(Array.isArray(t)){for(var e=[],i=!1,n=0;n<t.length;n++)e[n]=_e(t[n]&&t[n].textName,this.getProperties()),d(e[n])||(i=!0);return i?e:null}return _e(t&&t.textName,this.getProperties())},i.getTextDesc=function(){if(!this._textDesc){var t=this.getTextContent(),e=this._sizeSymbol,i=Array.isArray(t);Array.isArray(e)?this._textDesc=e.map(function(e,n){return ye(i?t[n]:"",e)}):this._textDesc=ye(t,e)}return this._textDesc},i.getCenter=function(){return this._computeCenter(this._getMeasurer())},i.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var i=e.unproject(new Yi(t.xmin,t.ymin)),n=e.unproject(new Yi(t.xmax,t.ymax));return new cn(i,n,e)}return this._computeExtent(this._getMeasurer())},i.getContainerExtent=function(t){var e=this.get2DExtent();if(!e||!e.isValid())return null;var i=this.getMap(),n=this.getCenter(),r=i.getGLRes(),o=this.getMinAltitude(),s=i.distanceToPointAtRes(o,0,r,n).x*ct(o),a=e.convertTo(function(t){return i._pointAtResToContainerPoint(t,r,s,Xr)},t),h=this.getMaxAltitude();if(h!==o){h=i.distanceToPointAtRes(h,0,r,n).x*ct(h);var u=e.convertTo(function(t){return i._pointAtResToContainerPoint(t,r,h,Xr)},Kr);a._combine(u)}var l=this.getLayer();if(l&&"LineString"===this.type&&h&&l.options.drawAltitude){var c=e.convertTo(function(t){return i._pointAtResToContainerPoint(t,r,0,Xr)},Kr);a._combine(c)}return a&&a._add(this._getFixedExtent()),this.options.smoothness&&a._expand(.15*a.getWidth()),a},i._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new dn);var t=this._sizeSymbol,e=(t&&t.lineWidth||1)/2;return this._fixedExtent.set(-e,-e,e,e),this._fixedExtent},i.get2DExtent=function(){var t=this.getMap();if(!t)return null;if(this._extent2d)return this._extent2d;var e=this._getPrjExtent();if(!e||!e.isValid())return null;var i=e.getMin(),n=e.getMax(),r=t.getGLRes();return t._prjToPointAtRes(i,r,i),t._prjToPointAtRes(n,r,n),this._extent2d=new dn(i,n),this._extent2d.z=t.getZoom(),this._extent2d},i.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},i.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof Yi&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},i._containsPoint=function(t,e){var i=this._getPainter();return!!i&&(d(e)&&this._hitTestTolerance&&(e=this._hitTestTolerance()),i.hitTest(t,e))},i.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},i.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,i=t.length;e<i;e++)if(d(t[e].opacity)||t[e].opacity>0)return!0;return!1}return d(t.opacity)||m(t.opacity)||p(t.opacity)&&t.opacity>0},i.getZIndex=function(){return this.options.zIndex||0},i.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},i.setZIndexSilently=function(t){return this.options.zIndex=t,this},i.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},i.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},i.translate=function(t,e){if(d(t))return this;var i=new Yi(t,e);if(0===i.x&&0===i.y)return this;var n=this.getCoordinates();if(this._silence=!0,n)if(Array.isArray(n)){var r=ut(n,function(t){return t.add(i)});this.setCoordinates(r)}else this.setCoordinates(n.add(i));return this._silence=!1,this._fireEvent("positionchange"),this},i.flash=function(t,e,i,n){return At.call(this,t,e,i,n)},i.copy=function(){var t=this.toJSON(),i=e.fromJSON(t);return i.options.visible=!0,i},i.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},i.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},i.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(d(t.geometry)||t.geometry){var i=this._exportGeoJSONGeometry();e.geometry=i}var n,r=this.getId();return d(r)||(e.id=r),(d(t.properties)||t.properties)&&(n=this._exportProperties()),e.properties=n,e},i.toJSON=function(t){t||(t={});var e=this._toJSON(t);return f(e,this._exportGraphicOptions(t)),e},i.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},i.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},i.rotate=function(t,e){if("GeometryCollection"===this.type)return this.getGeometries().forEach(function(i){return i.rotate(t,e)}),this;e=e?new Yi(e):this.getCenter();var i=this._getMeasurer(),n=this.getCoordinates();if(!Array.isArray(n)){if(e.x!==n.x||e.y!==n.y){var r=i._rotate(n,e,t);this.setCoordinates(r)}return this}return ut(n,function(n){return i._rotate(n,e,t)}),this.setCoordinates(n),this},i._getConnectPoints=function(){return[this.getCenter()]},i._initOptions=function(t){var e=f({},t),i=e.symbol,n=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),i&&this.setSymbol(i),n&&this.setProperties(n),d(r)||this.setId(r)},i._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache()},i._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(se(this._checkAndCopySymbol(t[i])));return e}return t?se(t=this._checkAndCopySymbol(t)):null},i._checkAndCopySymbol=function(t){var e={};for(var i in t)h[i]&&v(t[i])?e[i]=+t[i]:e[i]=t[i];return e},i._getSymbol=function(){return this._symbol},i._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},i._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},i._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},i._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},i._getInternalId=function(){return this._internalId},i._setInternalId=function(t){this._internalId=t},i._getMeasurer=function(){return this._getProjection()?this._getProjection():Yr.getProjectionInstance(this.options.defaultProjection)},i._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},i._getExternalResources=function(){return oe(this._getInternalSymbol())},i._getPainter=function(){var t=this.getLayer();if(!this._painter&&t)if(-1!==r.indexOf(this.type)){if(t.constructor.getCollectionPainterClass){var e=t.constructor.getCollectionPainterClass();e&&(this._painter=new e(this))}}else if(t.constructor.getPainterClass){var i=t.constructor.getPainterClass();i&&(this._painter=new i(this))}return this._painter},i._getMaskPainter=function(){return this._maskPainter?this._maskPainter:(this._maskPainter=this.getGeometries&&this.getGeometries()?new Jr(this,!0):new $r(this),this._maskPainter)},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},i._paint=function(t){if(this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var e=this._getProjection();e&&(this._pcenter=e.project(this._coordinates),this._clearCache())}this._painter.paint(t)}},i._clearCache=function(){delete this._extent,delete this._extent2d},i._clearProjection=function(){delete this._extent,delete this._extent2d},i._repaint=function(){this._painter&&this._painter.repaint()},i.onHide=function(){this.closeMenu(),this.closeInfoWindow()},i.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},i.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},i.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties?(t.properties=f({},this._eventSymbolProperties),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",t)},i._genSizeSymbol=function(){var t=this._getInternalSymbol();if(t)if(Array.isArray(t)){this._sizeSymbol=[];for(var e=!1,i=0;i<t.length;i++){var n=this._sizeSymbol[i]=this._getSizeSymbol(t[i]);!e&&n&&n._dynamic&&(e=!0)}this._sizeSymbol._dynamic=e}else this._sizeSymbol=this._getSizeSymbol(t);else delete this._sizeSymbol},i._getSizeSymbol=function(t){var e;return It(t.lineWidth)?(e=ie({lineWidth:t.lineWidth},this))._dynamic=!0:e={lineWidth:t.lineWidth},e},i._getCompiledSymbol=function(){return this._compiledSymbol?this._compiledSymbol:(this._compiledSymbol=ie(this._getInternalSymbol(),this),this._compiledSymbol)},i.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var i=!1;for(var n in t)if(t.hasOwnProperty(n)){var r=n.slice(0,5);if("arrow"===r||"smoot"===r){i=!0;break}}e?(this.setProperties(e),this._repaint()):i&&this._repaint()},i._setParent=function(t){t&&(this._parent=t)},i._getParent=function(){return this._parent},i._fireEvent=function(t,e){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e))},i._toJSON=function(t){return{feature:this.toGeoJSON(t)}},i._exportGraphicOptions=function(t){var e={};return(d(t.options)||t.options)&&(e.options=this.config()),(d(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(d(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Yi.toNumberArrays(t);return{type:this.getType(),coordinates:e}},i._exportProperties=function(){var t=null,e=this.getProperties();return d(e)||(t=m(e)?f({},e):e),t},i.getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,i=this.getProperties(),n=e.enableAltitude&&i?i[e.altitudeProperty]:0,r=t.getAltitude?t.getAltitude():0;return Array.isArray(n)?n.map(function(t){return t+r}):n+r},i._genMinMaxAlt=function(){var t=this,e=this.getAltitude();Array.isArray(e)?(this._minAlt=Number.MAX_VALUE,this._maxAlt=Number.MIN_VALUE,e.forEach(function(e){var i=e;i<t._minAlt&&(t._minAlt=i),i>t._maxAlt&&(t._maxAlt=i)})):this._minAlt=this._maxAlt=e},i.getMinAltitude=function(){return void 0===this._minAlt&&this._genMinMaxAlt(),this._minAlt?this._minAlt:0},i.getMaxAltitude=function(){return void 0===this._maxAlt&&this._genMinMaxAlt(),this._maxAlt?this._maxAlt:0},e}(Si(Ci($i(Mi))));Qr.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,defaultProjection:"EPSG:4326"});var to={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!q.mobile},eo=function(t){function e(e,i){var n,r;return i&&(r=i.canvas,delete i.canvas),(n=t.call(this,i)||this)._canvas=r,n.setId(e),i&&(n.setZIndex(i.zIndex),i.mask&&n.setMask(Qr.fromJSON(i.mask))),n}Y(e,t);var i=e.prototype;return i.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();d(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},i.getId=function(){return this._id},i.setId=function(t){var e=this._id;return d(t)||(t+=""),this._id=t,this.fire("idchange",{old:e,new:t}),this},i.addTo=function(t){return t.addLayer(this),this},i.setZIndex=function(t){return this._zIndex=t,d(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},i.getZIndex=function(){return this._zIndex||0},i.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},i.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),d(e)?1/0:e):e},i.getOpacity=function(){return this.options.opacity},i.setOpacity=function(t){return this.config("opacity",t),this},i.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof Dn},i.getMap=function(){return this.map?this.map:null},i.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i+1),this},i.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i-1),this},i.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var i=this.getMap();e&&i?i.once("renderend",function(){t.fire("show")}):this.fire("show")}return this},i.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var i=this.getMap();e&&i?i.once("renderend",function(){t.fire("hide")}):this.fire("hide")}return this},i.isVisible=function(){if(p(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!d(this.options.maxZoom)&&this.options.maxZoom<e||!d(this.options.minZoom)&&this.options.minZoom>e)return!1}return d(this.options.visible)&&(this.options.visible=!0),this.options.visible},i.remove=function(){return this.map&&this.map.removeLayer(this),this},i.getMask=function(){return this._mask},i.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type||"MultiPolygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),"Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},i.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},i.onLoad=function(){return!0},i.onLoadEnd=function(){},i.isLoaded=function(){return!!this._loaded},i.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new Vi),this._collisionIndex;var t=this.getMap();return t?t.getCollisionIndex():null},i.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},i.getRenderer=function(){return this._getRenderer()},i.onConfig=function(t){if(p(t.opacity)||t.cssFilter){var e=this.getRenderer();e&&e.setToRedraw()}},i.onAdd=function(){},i.onRendererCreate=function(){},i.onCanvasCreate=function(){},i.onRemove=function(){},i._bindMap=function(t,e){t&&(this.map=t,d(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},i._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},i._doRemove=function(){this._loaded=!1,this.onRemove(),this._switchEvents("off",this),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},i._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()[t](e.getEvents(),e)},i._getRenderer=function(){return this._renderer},i._getLayerList=function(){return this.map?this.map._layers:[]},i._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},e}(Si(Ci(Ln(Mi))));eo.mergeOptions(to);var io=eo.prototype.fire;eo.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={}),e.type=t,e.target=this,this.map._onLayerEvent(e)),io.apply(this,arguments)};var no,ro,oo,so,ao,ho,uo=new Yi(0,0),lo={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!P,zoomAnimationDuration:330,panAnimation:!P,panAnimationDuration:600,zoomable:!0,enableInfoWindow:!0,hitDetect:!q.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0},co=function(t){function e(i,n){var r;if(!n)throw new Error("Invalid options when creating map.");if(!n.center)throw new Error("Invalid center when creating map.");var o=f({},n),s=o.zoom;delete o.zoom;var a=new Yi(o.center);delete o.center;var h=o.baseLayer;delete o.baseLayer;var u=o.layers;return delete o.layers,(r=t.call(this,o)||this).VERSION=e.VERSION,Object.defineProperty(X(X(r)),"id",{value:ot(),writable:!1}),r._loaded=!1,r._initContainer(i),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=s,r._center=a,r.setSpatialReference(o.spatialReference||o.view),r.setMaxExtent(o.maxExtent),r._mapViewPoint=new et(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),h&&r.setBaseLayer(h),u&&r.addLayer(u),r._Load(),r}Y(e,t),e.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(i),this};var i=e.prototype;return i.isLoaded=function(){return!!this._loaded},i.getContainer=function(){return this._containerDOM},i.getSpatialReference=function(){return this._spatialReference},i.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&Yr.equals(e,t)?this:(this._updateSpatialReference(t,e),this)},i._updateSpatialReference=function(t,e){if(v(t)&&(t=Yr.getPreset(t)),t=f({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new Yr(t),this.options.spatialReference&&_(this.options.spatialReference.projection)){var i=this._spatialReference.getProjection();this.options.spatialReference.projection=i.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:f({},this.options.spatialReference)}),this},i.onConfig=function(t){var e=t.spatialReference||t.view;return d(e)||this._updateSpatialReference(e,null),this},i.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},i.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},i.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},i.resetCursor=function(){return this.setCursor(null)},i.getCenter=function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},i.setCenter=function(t){if(!t)return this;t=new Yi(t);var e=this.getProjection().project(t);return this._verifyExtent(e)?this._loaded?(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},i.getSize=function(){return d(this.width)||d(this.height)?this._getContainerDomSize():new he(this.width,this.height)},i.getContainerExtent=function(){var t=this.height,e=this.getPitch(),i=this.options.maxVisualPitch;return i&&e>i&&(t=this._getVisualHeight(i)),new dn(0,this.height-t,this.width,this.height)},i._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,i=this.getFov()*Math.PI/180;t*=Math.PI/180;var n=this.cameraCenterDistance/this.getGLScale(),r=Math.tan(i/2),o=n*r/(1/Math.tan(t)-r)/Math.sin(t),s=n*(Math.sin(e)*o/(n+Math.cos(e)*o));return this.height/2+s},i.getExtent=function(){return this._pointToExtent(this._get2DExtent())},i.getProjExtent=function(){var t=this._get2DExtent();return new cn(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},i.getPrjExtent=function(){return this.getProjExtent()},i.getMaxExtent=function(){return this.options.maxExtent?new cn(this.options.maxExtent,this.getProjection()):null},i.setMaxExtent=function(t){if(t){var e=new cn(t,this.getProjection());this.options.maxExtent=e,this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent().getCenter());var i=this.getProjection();this._prjMaxExtent=e.convertTo(function(t){return i.project(t)})}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},i.getZoom=function(){return this._zoomLevel},i.getZoomForScale=function(t,e,i){var n=this.getZoom();if(d(e)&&(e=n),1===t&&e===n)return n;var r=this._getResolution(e)/t,o=this.getZoomFromRes(r);if(i)return o;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(o-1e-6):Math.floor(o+1e-6)},i.getZoomFromRes=function(t){var e=this._getResolutions(),i=this._getResolution(this.getMinZoom()),n=this._getResolution(this.getMaxZoom());if(i<=n){if(t<=i)return this.getMinZoom();if(t>=n)return this.getMaxZoom()}else{if(t>=i)return this.getMinZoom();if(t<=n)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var s=e[o+1]-e[o],a=t-e[o];if(ct(s)===ct(a)&&Math.abs(s)>=Math.abs(a))return o+a/s}return r-1},i.setZoom=function(t,e){return void 0===e&&(e={animation:!0}),isNaN(t)||d(t)?this:(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t),this)},i.getMaxZoom=function(){return d(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},i.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),null!==t&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},i.getMinZoom=function(){return d(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},i.setMinZoom=function(t){if(null!==t){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},i.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},i.getGLRes=function(){if(this._glRes)return this._glRes;var t=this.getSpatialReference().getFullExtent();return this._glRes=(t.right-t.left)/Math.pow(2,19),this._glRes},i.getGLScale=function(t){return d(t)&&(t=this.getZoom()),this._getResolution(t)/this.getGLRes()},i.zoomIn=function(){return this.setZoom(this.getZoom()+1)},i.zoomOut=function(){return this.setZoom(this.getZoom()-1)},i.isZooming=function(){return!!this._zooming},i.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},i.setCenterAndZoom=function(t,e){return d(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},i.getFitZoom=function(t,e){var i=this;if(!(t&&t instanceof cn))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var n=this.getSize(),r=t.convertTo(function(t){return i.coordToPoint(t)}),o=r.getWidth(),s=r.getHeight(),a=n.width/o,h=n.height/s,u=this.getSpatialReference().getZoomDirection()<0?Math.max(a,h):Math.min(a,h);return this.getZoomForScale(u,null,e)},i.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},i.setView=function(t){return t?(t.center&&this.setCenter(t.center),null===t.zoom||isNaN(+t.zoom)||this.setZoom(+t.zoom,{animation:!1}),null===t.pitch||isNaN(+t.pitch)||this.setPitch(+t.pitch),null===t.pitch||isNaN(+t.bearing)||this.setBearing(+t.bearing),this):this},i.getResolution=function(t){return this._getResolution(t)},i.getScale=function(t){var e=d(t)?this.getZoom():t,i=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/i},i.fitExtent=function(t,e,i,n){if(void 0===i&&(i={}),!t)return this;t=new cn(t,this.getProjection());var r=this.getFitZoom(t)+(e||0),o=t.getCenter();return void 0===i.animation||i.animation?this._animateTo({center:o,zoom:r},{duration:i.duration||this.options.zoomAnimationDuration,easing:i.easing||"out"},n):this.setCenterAndZoom(o,r)},i.getBaseLayer=function(){return this._baseLayer},i.setBaseLayer=function(t){var e=!1;if(this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!t)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;return this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))},this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},i.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},i.getLayers=function(t){return this._getLayers(function(e){return!(e===this._baseLayer||e.getId().indexOf("_maptalks__internal_layer_")>=0)&&(!t||t(e))})},i.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var i=this.getBaseLayer();return i&&i.getId()===t?i:null},i.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,i=0,n=t.length;i<n;i++){var r=t[i],o=r.getId();if(d(o))throw new Error("Invalid id for the layer: "+o);if(r.getMap()!==this){if(this._layerCache[o])throw new Error("Duplicate layer id in the map: "+o);this._layerCache[o]=r,r._bindMap(this),e.push(r),this._loaded&&r.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},i.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];if(r instanceof eo||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var s=r.getId();this._layerCache&&delete this._layerCache[s]}}}if(e.length>0){var a=this.getRenderer();a&&a.setLayerCanvasUpdated(),this.once("frameend",function(){e.forEach(function(t){t.fire("remove")})})}return this._fireEvent("removelayer",{layers:t}),this},i.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],i=Number.MAX_VALUE,n=0,r=t.length;n<r;n++){var o=t[n];if(v(t[n])&&(o=this.getLayer(o)),!(o instanceof eo&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<i&&(i=o.getZIndex()),e.push(o)}for(var s=0,a=e.length;s<a;s++)e[s].setZIndex(i+s);return this},i.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var i=t.save,n=this._getRenderer();if(n&&n.toDataURL){var r=t.fileName;r||(r="export");var o=n.toDataURL(e,t.quality||.92);if(i&&o){var s;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var a=Ct(o.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),e);s=URL.createObjectURL(a)}else s=o;var h=document.createElement("a");h.download=r,h.href=s,document.body.appendChild(h),h.click(),document.body.removeChild(h)}return o}return null},i.coordToPoint=function(t,e,i){return this.coordinateToPoint(t,e,i)},i.coordToPointAtRes=function(t,e,i){return this.coordinateToPointAtRes(t,e,i)},i.pointToCoord=function(t,e,i){return this.pointToCoordinate(t,e,i)},i.pointAtResToCoord=function(t,e,i){return this.pointAtResToCoordinate(t,e,i)},i.coordToViewPoint=function(t,e,i){return this.coordinateToViewPoint(t,e,i)},i.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},i.coordToContainerPoint=function(t,e,i){return this.coordinateToContainerPoint(t,e,i)},i.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},i.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},i.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},i.checkSize=function(){var t=c()-this._initTime<1500&&0===this.width||0===this.height,e=this._getContainerDomSize(),i=this.height,n=this.width;if(e.width===n&&e.height===i)return this;Ye(this._containerDOM);var r=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(e);else{var o=this._getVisualHeight(this.getPitch()),s=new et(0,this.height-o),a=this._containerPointToPrj(s);this._updateMapSize(e);var h=this._getVisualHeight(this.getPitch()),u=new et(0,this.height-h);this._setPrjCoordAtContainerPoint(a,u),this._mapViewCoord=this._getPrjCenter()}var l=0===e.width||0===e.height||0===n||0===i;return(t||l)&&(this._eventSilence=!0,this.setCenter(r),delete this._eventSilence),this._fireEvent("resize"),this},i.locate=function(t,e,i){return this.getProjection()._locate(new Yi(t),e,i)},i.getMainPanel=function(){return this._getRenderer().getMainPanel()},i.getPanels=function(){return this._panels},i.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),i=0;i<e.length;i++)e[i].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter(function(t){return"maptalks-wrapper"===t.className}).forEach(function(e){return t._containerDOM.removeChild(e)}),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},i.isRemoved=function(){return!this._containerDOM},i.isMoving=function(){return!!this._moving},i.onMoveStart=function(t){var e=this._getPrjCenter();this._originCenter&&!this._verifyExtent(e)||(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},i.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},i.onMoveEnd=function(t){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this._getPrjCenter())&&this._originCenter){var e=this._originCenter;this._panTo(e)}},i.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},i.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},i.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},i.isDragRotating=function(){return!!this._dragRotating},i.isOffscreen=function(t,e){void 0===e&&(e=0);var i=this.width+e,n=this.height+e,r=t.xmin,o=t.ymin,s=t.xmax,a=t.ymax;return Array.isArray(t)&&(r=t[0],o=t[1],s=t[2],a=t[3]),s<e||r>=i||a<e||o>n},i.getRenderer=function(){return this._getRenderer()},i.getDevicePixelRatio=function(){return this.options.devicePixelRatio||q.devicePixelRatio||1},i._initContainer=function(t){if(v(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,P&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},i._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},i._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},i._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},i._removeLayer=function(t,e){if(t&&e){var i=e.indexOf(t);i>-1&&e.splice(i,1)}},i._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t,this._layers[t].sortLayersByZIndex&&this._layers[t].sortLayersByZIndex();this._layers.sort(function(t,e){var i=t.getZIndex()-e.getZIndex();return 0===i?t._order-e._order:i})}},i._fireEvent=function(t,e){this._eventSilence||(this.fire("_"+t,e),this.fire(t,e))},i._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=c()},i._initRenderer=function(){var t=this.options.renderer,i=e.getRendererClass(t);this._renderer=new i(this),this._renderer.load()},i._getRenderer=function(){return this._renderer},i._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer(function(t){t&&t.load()},this.getLayers())},i._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,i=[],n=0;n<e.length;n++)t&&!t.call(this,e[n])||i.push(e[n]);return i},i._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var i=[],n=0,r=e.length;n<r;n++)i=i.concat(e[n]);for(var o=0,s=i.length;o<s;o++)t.call(t,i[o])}},i._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},i._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),i=this._spatialReference.getMaxZoom(),n=this._spatialReference.getMinZoom();(d(t)||-1===t||t>i)&&this.setMaxZoom(i),(d(e)||-1===e||e<n)&&this.setMinZoom(n),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(d(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var r=this.getProjection();this._prjCenter=r.project(this._center),this._calcMatrices();var o=this._getRenderer();o&&o.resetContainer()},i._getContainerDomSize=function(){if(!this._containerDOM)return null;var t,e,i=this._containerDOM;if(d(i.width)||d(i.height)){if(d(i.clientWidth)||d(i.clientHeight))throw new Error("can not get size of container");t=parseInt(i.clientWidth,0),e=parseInt(i.clientHeight,0)}else{t=i.width,e=i.height;var n=this.getDevicePixelRatio();1!==n&&i.layer&&(t/=n,e/=n)}return new he(t,e)},i._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},i._getPrjCenter=function(){return this._prjCenter},i._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},i._setPrjCoordAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var i=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),n=this._pointToPrj(this._prjToPoint(t).sub(i));return this._setPrjCenter(n),this},i._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return!e||e.contains(t)},i._offsetCenterByPixel=function(t){var e=new et(this.width/2-t.x,this.height/2-t.y),i=this._containerPointToPrj(e);return this._setPrjCenter(i),i},i.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},i.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},i._resetMapViewPoint=function(){this._mapViewPoint=new et(0,0),this._mapViewCoord=this._getPrjCenter()},i._getResolution=function(t){return void 0!==t&&t!==this._zoomLevel||void 0===this._mapRes?(d(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t)):this._mapRes},i._getResolutions=function(){return this._spatialReference.getResolutions()},i._prjToPoint=function(t,e,i){e=d(e)?this.getZoom():e;var n=this._getResolution(e);return this._prjToPointAtRes(t,n,i)},i._prjToPointAtRes=function(t,e,i){return this._spatialReference.getTransformation().transform(t,e,i)},i._prjsToPointsAtRes=function(t,e,i){void 0===i&&(i=[]);for(var n=this._spatialReference.getTransformation(),r=[],o=0,s=t.length;o<s;o++){var a=n.transform(t[o],e,i[o]);r.push(a)}return r},i._pointToPrj=function(t,e,i){e=d(e)?this.getZoom():e;var n=this._getResolution(e);return this._pointToPrjAtRes(t,n,i)},i._pointToPrjAtRes=function(t,e,i){return this._spatialReference.getTransformation().untransform(t,e,i)},i._pointToPoint=function(t,e,i){return d(e)?(i?(i.x=t.x,i.y=t.y):i=t.copy(),i):this._pointAtResToPoint(t,this._getResolution(e),i)},i._pointAtResToPoint=function(t,e,i){return i?(i.x=t.x,i.y=t.y):i=t.copy(),i._multi(e/this._getResolution())},i._pointToPointAtRes=function(t,e,i){return i?(i.x=t.x,i.y=t.y):i=t.copy(),i._multi(this._getResolution()/e)},i._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},i._callOnLoadHooks=function(){var t=e.prototype;if(t._onLoadHooks)for(var i=0,n=t._onLoadHooks.length;i<n;i++)t._onLoadHooks[i].call(this)},e}($i(Ci(Ln(Mi))));co.include({coordinateToPoint:function(t,e,i){var n=this._getResolution(e);return this.coordinateToPointAtRes(t,n,i)},coordinateToPointAtRes:(ho=new Yi(0,0),function(t,e,i){var n=this.getProjection().project(t,ho);return this._prjToPointAtRes(n,e,i)}),pointToCoordinate:function(){var t=new Yi(0,0);return function(e,i,n){var r=this._pointToPrj(e,i,t);return this.getProjection().unproject(r,n)}}(),pointAtResToCoordinate:function(){var t=new Yi(0,0);return function(e,i,n){var r=this._pointToPrjAtRes(e,i,t);return this.getProjection().unproject(r,n)}}(),coordinateToViewPoint:function(){var t=new Yi(0,0);return function(e,i,n){return this._prjToViewPoint(this.getProjection().project(e,t),i,n)}}(),viewPointToCoordinate:function(){var t=new Yi(0,0);return function(e,i){return this.getProjection().unproject(this._viewPointToPrj(e,t),i)}}(),coordinateToContainerPoint:function(t,e,i){var n=this._getResolution(e);return this.coordinateToContainerPointAtRes(t,n,i)},coordinateToContainerPointAtRes:function(){var t=new Yi(0,0);return function(e,i,n){var r=this.getProjection().project(e,t);return this._prjToContainerPointAtRes(r,i,n)}}(),coordinatesToContainerPoints:function(t,e){var i=this._getResolution(e);return this.coordinatesToContainerPointsAtRes(t,i)},coordinatesToContainerPointsAtRes:function(t,e){for(var i=[],n=this._spatialReference.getTransformation(),r=e/this._getResolution(),o=this.getProjection(),s=new Yi(0,0),a=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,uo),u=0,l=t.length;u<l;u++){var c=o.project(t[u],s),f=n.transform(c,e);f=f._multi(r),this._toContainerPoint(f,a,r,0,h),i.push(f)}return i},containerPointToCoordinate:function(){var t=new Yi(0,0);return function(e,i){var n=this._containerPointToPrj(e,t);return this.getProjection().unproject(n,i)}}(),containerToExtent:(so=new et(0,0),ao=new et(0,0),function(t){var e=new dn(this._containerPointToPoint(t.getMin(so),void 0,so),this._containerPointToPoint(t.getMax(ao),void 0,ao));return this._pointToExtent(e)}),distanceToPixel:function(){var t=new et(0,0),e=new et(0,0);return function(i,n,r){var o=this.getProjection();if(!o)return null;var s=this.getScale()/this.getScale(r),a=this.getCenter(),h=o.locate(a,i,n),u=this.coordToContainerPoint(a,void 0,t),l=this.coordToContainerPoint(h,void 0,e);return l._sub(u)._multi(s)._abs(),new he(l.x,l.y)}}(),distanceToPoint:function(t,e,i,n){var r=this._getResolution(i);return this.distanceToPointAtRes(t,e,r,n)},distanceToPointAtRes:(oo=new et(0,0),function(t,e,i,n){var r=this.getProjection();if(!r)return null;var o=n||this.getCenter(),s=r.locate(o,t,e),a=this.coordToPointAtRes(o,i,oo),h=this.coordToPointAtRes(s,i);return h._sub(a)._abs(),h}),pixelToDistance:(no=new Yi(0,0),ro=new Yi(0,0),function(t,e){var i=this.getProjection();if(!i)return null;var n=this.getFullExtent(),r=n.top>n.bottom?-1:1,o=no.set(this.width/2+t,this.height/2+r*e),s=this.containerPointToCoord(o,ro);return i.measureLength(this.getCenter(),s)}),pointToDistance:function(t,e,i){var n=this.getResolution(i);return this.pointAtResToDistance(t,e,n)},pointAtResToDistance:function(){var t=new et(0,0),e=new Yi(0,0);return function(i,n,r){var o=this.getProjection();if(!o)return null;var s=this._prjToPointAtRes(this._getPrjCenter(),r,t);s._add(i,n);var a=this.pointAtResToCoord(s,r,e);return o.measureLength(this.getCenter(),a)}}(),locateByPoint:function(){var t=new et(0,0);return function(e,i,n){var r=this.coordToContainerPoint(e,void 0,t);return this.containerPointToCoord(r._add(i,n))}}(),_get2DExtent:function(t,e){var i;if(void 0!==t&&t!==this._zoomLevel||!this._mapExtent2D||(i=this._mapExtent2D),i)return e?(e.set(i.xmin,i.ymin,i.xmax,i.ymax),e):i.copy();var n=this._getResolution(t);return this._get2DExtentAtRes(n,e)},_get2DExtentAtRes:function(){var t=new et(0,0);return function(e,i){var n=this;return e===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo(function(i){return n._containerPointToPointAtRes(i,e,t)},i)}}(),_pointToExtent:function(){var t=new Yi(0,0),e=new Yi(0,0);return function(i){var n=i.getMin(),r=i.getMax(),o=this.getFullExtent(),s=!o||o.left<=o.right?[n.x,r.x]:[r.x,n.x],a=s[0],h=s[1],u=!o||o.top>o.bottom?[r.y,n.y]:[n.y,r.y],l=u[0],c=u[1],f=n.set(a,c),d=r.set(h,l);return new cn(this.pointToCoord(f,void 0,t),this.pointToCoord(d,void 0,e),this.getProjection())}}(),_getViewPointFrameOffset:function(){var t=new et(0,0);return function(){if(this.isZooming())return null;var e=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(e)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(e,void 0,t)):null}}(),_viewPointToPrj:function(){var t=new et(0,0);return function(e,i){return this._containerPointToPrj(this.viewPointToContainerPoint(e,t),i)}}(),_prjToContainerPoint:function(t,e,i,n){var r=this._getResolution(e);return this._prjToContainerPointAtRes(t,r,i,n)},_prjToContainerPointAtRes:function(){var t=new et(0,0);return function(e,i,n,r){return this._pointAtResToContainerPoint(this._prjToPointAtRes(e,i,t),i,r||0,n)}}(),_prjToViewPoint:function(){var t=new et(0,0);return function(e,i,n){var r=this._prjToContainerPoint(e,void 0,t,n);return this.containerPointToViewPoint(r,i)}}(),_viewPointToPoint:function(){var t=new et(0,0);return function(e,i,n){return this._containerPointToPoint(this.viewPointToContainerPoint(e,t),i,n)}}(),_pointToViewPoint:function(){var t=new Yi(0,0);return function(e,i,n){return this._prjToViewPoint(this._pointToPrj(e,i,t),n)}}()}),co.mergeOptions(lo);var fo=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},i.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},i._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var i=e.getZoom(),n=t.domEvent.shiftKey?Math.ceil(i)-1:Math.floor(i)+1;e._zoomAnimation(n,t.containerPoint)}},e}(Pi);co.mergeOptions({doubleClickZoom:!0}),co.addOnLoadHook("addHandler","doubleClickZoom",fo);var po=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.addHooks=function(){var t=this.target;if(t){var e=t._panels.mapWrapper||t._containerDOM;this._dragHandler=new qi(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},i.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},i._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},i._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t))},i._onMouseDown=function(t){delete this.startDragTime,delete this._mode,2===t.domEvent.button||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),$e(t.domEvent)},i._onDragStart=function(t){this.startDragTime=c(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},i._onDragging=function(t){this.target._isEventOutMap(t.domEvent)||("move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t))},i._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},i._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY},i._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var i=Xe(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e._containerPointToPrj(i)},i._moving=function(t){if(this.startDragTime){var e=this.target,i=Xe(e._getActualEvent(t.domEvent),e.getContainer());e._setPrjCoordAtContainerPoint(this.startPrjCoord,i),e.onMoving(t)}},i._moveEnd=function(t){if(this.startDragTime){var e=this.target,i=c()-this.startDragTime,n=t.mousePos.x,r=t.mousePos.y,o=n-this.startX,s=r-this.startY;this._clear(),e.options.panAnimation&&!t.interupted&&e._verifyExtent(e._getPrjCenter())&&i<280&&Math.abs(s)+Math.abs(o)>5?(i=5*i*(Math.abs(o)+Math.abs(s))/500,e.panBy(new et(o,s),{duration:i})):e.onMoveEnd(t)}},i._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},i._rotating=function(t){var e=this.target,i=t.mousePos.x,n=t.mousePos.y,r=e.getPitch(),o=e.getBearing(),s=Math.abs(i-this.preX),a=Math.abs(n-this.preY);if(this._rotateMode||(e.options.dragRotatePitch?this._rotateMode="rotate_pitch":this._rotateMode=s>a?"rotate":s<a?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&a<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var h=0;h=e.options.dragPitch||s>a?-.6*(this.preX-i):i>e.width/2?.6*(this.preY-n):-.6*(this.preY-n);var u=e.getBearing()+h;this._db=this._db||0,this._db+=h,e.setBearing(u)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e.setPitch(e.getPitch()+.4*(this.preY-n)),this.preX=i,this.preY=n,e.getBearing()===o&&e.getPitch()===r||e.onDragRotating(t)}},i._rotateEnd=function(t){var e=this.target,i=e.getBearing();this._clear();var n=c()-this.startDragTime;if(e.onDragRotateEnd(t),Math.abs(i-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&n<400){var r=e.getBearing();e._animateTo({bearing:r+this._db/2},{easing:"out",duration:800})}},i._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(Pi);co.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),co.addOnLoadHook("addHandler","draggable",po);var go="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",mo=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.addHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;ai(e,go,this._identifyGeometryEvents,this)},i.removeHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;hi(e,go,this._identifyGeometryEvents,this)},i._identifyGeometryEvents=function(t,e){var i=this.target;if(!i.isInteracting()&&!i._ignoreEvent(t)){var n=null,r=e||t.type,o="mousedown"===r||"touchstart"===r&&t.touches&&1===t.touches.length;if(o)this._mouseDownTime=c();else if(("click"===r||"touchend"===r)&&this._mouseDownTime){var s=this._mouseDownTime;if(delete this._mouseDownTime,c()-s>300){if("click"===r)return}else"touchend"===r&&(n="click")}var a=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(a){var h=Xe(a,i._containerDOM);"touchstart"===r&&$e(t);for(var u=null,l=this.target.getRenderer().getTopElements(),f=(o||"click"===r)&&2!==t.button,d=0;d<l.length;d++)if(l[d].hitTest(h)){var p=l[d].options.cursor;if(p&&(u=p),f||l[d].events&&l[d].events.indexOf(r)>=0){var g={target:i,type:r,domEvent:t,containerPoint:h};if(f)return i._setPriorityCursor(u),void l[d].mousedown(g);l[d].onEvent(g)}}var m=i._getLayers(function(t){return!(!t.identify||!t.options.geometryEvents)});if(i._setPriorityCursor(u),m.length){var v={includeInternals:!0,filter:function(e){if(!(e instanceof Qr))return!1;var i=e._getEventTypeToFire(t);if("mousemove"===r){if(!u&&e.options.cursor&&(u=e.options.cursor),!e.listens("mousemove")&&!e.listens("mouseover")&&!e.listens("mouseenter"))return!1}else if(!e.listens(i)&&!e.listens(n))return!1;return!0},count:1,containerPoint:h,onlyVisible:i.options.onlyVisibleGeometryEvents,layers:m},_=function(e){var o=!0;if("mousemove"===r){var s={};if(e.length>0)for(var a=e.length-1;a>=0;a--){var h=e[a];if(h instanceof Qr){var l=h._getInternalId();s[l]=h,h._onEvent(t),this._prevOverGeos&&this._prevOverGeos.geomap[l]||h._onEvent(t,"mouseenter"),o=h._onEvent(t,"mouseover")}}i._setPriorityCursor(u);var c=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:e,geomap:s},c&&c.length>0)for(var f=c.length-1;f>=0;f--){var d=c[f];if(d instanceof Qr){var p=c[f]._getInternalId();s[p]||(o=d._onEvent(t,"mouseout"))}}}else{if(!e||!e.length)return;for(var g=e.length-1;g>=0;g--)if(e[g]instanceof Qr){o=e[g]._onEvent(t),n&&e[g]._onEvent(t,n);break}}!1===o&&Ue(t)}.bind(this);"mousemove"===r||"touchmove"===r?this._queryIdentifyTimeout=i.getRenderer().callInNextFrame(function(){i.isInteracting()||i.identifyAtPoint(v,_)}):i.identifyAtPoint(v,_)}}}},e}(Pi);co.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),co.addOnLoadHook("addHandler","geometryEvents",mo);var vo=.01,_o=1/450,yo=function(t){function e(e){var i;return(i=t.call(this,e)||this)._thisScrollZoom=i._scrollZoom.bind(X(X(i))),i._wheelZoomRate=_o,i._defaultZoomRate=vo,i._delta=0,i}Y(e,t);var i=e.prototype;return i.addHooks=function(){Be(this.target._containerDOM,"wheel",this._onWheelScroll,this)},i.removeHooks=function(){We(this.target._containerDOM,"wheel",this._onWheelScroll)},i._onWheelScroll=function(t){$e(t),Ue(t);var e=this.target;if(e._ignoreEvent(t)||!e.options.zoomable)return!1;var i=e._containerDOM,n=e._checkZoomOrigin(Xe(t,i));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,n)):this._interval(t,n)},i._seamless=function(t,e){var i=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*t.deltaY:t.deltaY;if(i%4.000244140625!=0&&(this._ensureTrackpad||(Math.abs(i)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(i*=14)),t.shiftKey&&i&&(i/=4),this._lastWheelEvent=t,this._delta-=i,!this._zooming&&this._delta){var n=this.target;this._zoomOrigin=e,n.onZoomStart(null,e)}this._start()},i._start=function(){if(this._delta){this._zooming=!0;var t=this.target;this._active||(t.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},i._scrollZoom=function(){var t=this;if(this._active=!1,this._delta){var e=Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);var n=this.target,r=n.getZoom(),o=n.getZoomForScale(i,r,!0);this._delta=0,n.onZooming(o,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){t._zooming=!1,delete t._timeout,n.onZoomEnd(n.getZoom(),t._zoomOrigin)},210)}},i._interval=function(t,e){var i=this,n=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(t.deltaY?-1*t.deltaY:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(r*=-1);var o=n.getZoom(),s=o+r;if((s=n._checkZoom(r>0?Math.ceil(s):Math.floor(s)))===o)return!1;this._zooming=!0,this._delta||(n.onZoomStart(null,e),this._origin=e,this._delta=r,this._startZoom=n.getZoom());return n._animateTo({zoom:s-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},function(e){"finished"===e.state.playState?i._requesting<1||Math.abs(s-i._startZoom)>2||s===n.getMaxZoom()||s===n.getMinZoom()?(n._animateTo({zoom:s,around:i._origin},{continueOnViewChanged:!0,duration:100},function(t){"running"!==t.state.playState&&(delete i._zooming,delete i._requesting)}),delete i._startZoom,delete i._origin,delete i._delta,i._requesting=0):d(i._requesting)||(delete i._zooming,i._onWheelScroll(t)):"running"!==e.state.playState&&(delete i._zooming,delete i._requesting)}),!1},e}(Pi);co.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),co.addOnLoadHook("addHandler","scrollWheelZoom",yo);var xo=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.addHooks=function(){Be(this.target.getContainer(),"touchstart",this._onTouchStart,this)},i.removeHooks=function(){We(this.target.getContainer(),"touchstart",this._onTouchStart)},i._onTouchStart=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var i=e.getContainer(),n=Xe(t.touches[0],i),r=Xe(t.touches[1],i);this.preY=n.y,this._startP1=n,this._startP2=r,this._startDist=n.distanceTo(r),this._startVector=n.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),hi(document,"touchmove",this._onTouchMove,this),hi(document,"touchend",this._onTouchEnd,this),Be(document,"touchmove",this._onTouchMove,this),Be(document,"touchend",this._onTouchEnd,this),$e(t),e._fireEvent("touchactstart")}},i._onTouchMove=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var i=e.getContainer(),n=Xe(t.touches[0],i),r=Xe(t.touches[1],i),o=n.sub(this._startP1),s=r.sub(this._startP2),a=n.sub(r),h=n.distanceTo(r)/this._startDist,u=180*a.angleWith(this._startVector)/Math.PI,l=.4*((this.preY||n.y)-n.y);this.preY=n.y;var c={domEvent:t,mousePos:[n,r]};if(this.mode||(e.options.touchRotate&&Math.abs(u)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&o.y*s.y>0&&Math.abs(o.y)>10&&Math.abs(s.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-h)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(c)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=h;var f=e._getResolution(this._startZoom)/h,d=e.getZoomFromRes(f);e.onZooming(d,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e.setBearing(this._startBearing+u),e.onDragRotating(c)):"pitch"===this.mode&&(e.setPitch(e.getPitch()+l),e.onDragRotating(c)),e._fireEvent("touchactinging")}},i._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var i=e.getSize();this._Origin=new et(i.width/2,i.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},i._onTouchEnd=function(t){delete this.preY;var e=this.target;if(hi(document,"touchmove",this._onTouchMove,this),hi(document,"touchend",this._onTouchEnd,this),"zoom"===this.mode||"rotate_zoom"===this.mode){var i=this._scale,n=e._getResolution(this._startZoom)/i,r=e.getZoomFromRes(n);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(Pi);co.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),co.addOnLoadHook("addHandler","touchGesture",xo);var wo="__anim_player",bo={in:function(t){return Math.pow(t,2)},out:function(t){return 1-bo.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?bo.inAndOut(2*t):1-bo.inAndOut(2*(t-.5))}},Co=function(t,e){this.state=t,this.styles=e},Po=function(t,e,i,n){this._animation=t,this.options=e,this._onFrame=i,this.playState="idle",this.ready=!0,this.finished=!1,this.target=n},Mo={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return Mo._resolveStyles(t);for(var e=[],i=[],n=[],r=0;r<t.length;r++){var o=Mo._resolveStyles(t[r]);o&&(e.push(o[0]),i.push(o[1]),n.push(o[2]))}return e.length?[e,i,n]:null}function i(t){var e,i=t;Array.isArray(t)||(i=p(t)?[0,t]:t instanceof et||t instanceof Yi?[new(e=t.constructor)(0,0),t]:[t,t]);var n=i[0],r=i[1];return p(n)&&p(r)?n===r?null:[n,r-n,r]:Array.isArray(n)&&p(n[0])||n instanceof Yi||n instanceof et?(Array.isArray(n)?(n=new Yi(n),r=new Yi(r)):(n=new(e=n.constructor)(n),r=new e(r)),n.equals(r)?null:[n,r.sub(n),r]):[n,r,r]}var n,r={},o={},s={};for(var a in t)if(t.hasOwnProperty(a)){var h=t[a];if(!h)continue;if(Array.isArray(h)&&(d(h[0])||d(h[1])))continue;var u=void 0;n=h,(u=!Array.isArray(n)&&n.constructor===Object||Array.isArray(n)&&n[0].constructor===Object?e(h):i(h))&&(o[a]=u[0],r[a]=u[1],s[a]=u[2])}return[o,r,s]},framing:function(t,e){e||(e={});var i,n,r,o=e.easing?bo[e.easing]:bo.linear;o||(o=bo.linear),(t=Mo._resolveStyles(t))&&(n=t[0],i=t[1],r=t[2]);return function(t,e){var s,a;if(t<0)s={playState:"idle",delta:0},a=n;else if(t<e){var h=o(t/e);s={playState:"running",delta:h},a=function t(e,i,n){if(!i||!n)return null;var o={};for(var s in n)if(n.hasOwnProperty(s)){if(i[s]===r[s]){o[s]=i[s];continue}var a=i[s],h=n[s];if(p(h))o[s]=a+e*h;else if(Array.isArray(h)){for(var u=[],l=0;l<h.length;l++)u.push(t(e,a[l],h[l]));o[s]=u}else h.constructor===Object?o[s]=t(e,a,h):o[s]=a instanceof et||a instanceof Yi?a.add(h.multi(e)):h}return o}(h,n,i)}else s={playState:"finished",delta:1},a=r;return s.startStyles=n,s.destStyles=r,s.progress=t,s.remainingMs=e-t,new Co(s,a)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=K(Mo._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]();this._frameQueue.length?this._animationFrameId=K(Mo._frameFn):delete this._animationFrameId}},animate:function(t,e,i,n){e||(e={});var r=Mo.framing(t,e);return new Po(r,e,i,n)}};Mo._frameFn=Mo._run.bind(Mo),f(Po.prototype,{_prepare:function(){var t=this.options,e=t.speed||t.duration;v(e)&&((e=Mo.speed[e])||(e=+e)),e||(e=Mo.speed.normal),this.duration=e,this._framer=t.framer||Mo._requestAnimFrame.bind(Mo)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[wo])return this;this.target&&(this.target[wo]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=c();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return"paused"===this.playState?this:(this.playState="paused",this._run(),this)},cancel:function(){return"idle"===this.playState?this:(this.playState="idle",this.finished=!1,this._run(),this)},finish:function(){return"finished"===this.playState?this:(this.playState="finished",this.finished=!0,this._run(),this)},reverse:function(){},_run:function(){var t=this,e=this._onFrame,i=c(),n=i-this._playStartTime;if(this.options.repeat&&n>=this.duration&&(this._playStartTime=i,n=0),"running"===this.playState){var r=this._animation(n,this.duration);this.playState=r.state.playState,"running"!==this.playState&&this.target&&delete this.target[wo],"idle"===this.playState?this.startTime>i&&setTimeout(this._run.bind(this),this.startTime-i):"running"===this.playState?this._framer(function(){"running"===t.playState&&(t.currentTime=n,e&&e(r),t._run())}):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(this.target&&delete this.target[wo],e){"finished"===this.playState?n=this.duration:"idle"===this.playState&&(n=0);var o=this._animation(n,this.duration);o.state.playState=this.playState,e(o)}}});var To=xi(function(t){!function(){function e(t,e,i){var n=e.x,r=e.y,o=i.x-n,s=i.y-r;if(0!==o||0!==s){var a=((t.x-n)*o+(t.y-r)*s)/(o*o+s*s);a>1?(n=i.x,r=i.y):a>0&&(n+=o*a,r+=s*a)}return(o=t.x-n)*o+(s=t.y-r)*s}function i(t,i){var n=t.length-1,r=[t[0]];return function t(i,n,r,o,s){for(var a,h=o,u=n+1;u<r;u++){var l=e(i[u],i[n],i[r]);l>h&&(a=u,h=l)}h>o&&(a-n>1&&t(i,n,a,o,s),s.push(i[a]),r-a>1&&t(i,a,r,o,s))}(t,0,n,i,r),r.push(t[n]),r}function n(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return t=i(t=n?t:function(t,e){for(var i,n,r,o,s,a=t[0],h=[a],u=1,l=t.length;u<l;u++)i=t[u],r=a,o=(n=i).x-r.x,s=n.y-r.y,o*o+s*s>e&&(h.push(i),a=i);return a!==i&&h.push(i),h}(t,r),r)}t.exports=n,t.exports.default=n}()}),So=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.animateShow=function(t,e){var i=this;void 0===t&&(t={}),this._showPlayer&&this._showPlayer.finish(),_(t)&&(e=t={});var n=this.getCoordinates();if(0===n.length)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var r=!!this.getShell?this.getShell().concat(this.getShell()[0]):n,o=this._getProjection(),s=o.projectCoords(r);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=o.unproject(this._prjAniShowCenter);var a=t.duration||1e3,h=t.easing||"out";this.setCoordinates([]);var u=0;s.length&&(s[0]._distance=0);for(var l=1;l<s.length;l++){var c=s[l].distanceTo(s[l-1]);s[l]._distance=c,u+=c}this._tempCoord=new Yi(0,0),this._tempPrjCoord=new et(0,0);var f=this._showPlayer=Mo.animate({t:a},{duration:a,easing:h},function(t){if(i.getMap()){var o=i._drawAnimShowFrame(t.styles.t,a,u,r,s);"finished"===t.state.playState&&(delete i._showPlayer,delete i._aniShowCenter,delete i._prjAniShowCenter,delete i._animIdx,delete i._animLenSoFar,delete i._animTailRatio,delete i._tempCoord,delete i._tempPrjCoord,i.setCoordinates(n)),e&&e(t,o)}else if("finished"!==f.playState&&(f.finish(),e)){var h=i.getCoordinates();e(t,h[h.length-1])}},this);return f.play(),f},i._drawAnimShowFrame=function(t,e,i,n,r){if(0===t)return n[0];var o,s,a=t/e*i,h=0;for(o=this._animIdx+1,s=r.length;o<s&&(h=r[o]._distance,!(this._animLenSoFar+h>a));o++)this._animLenSoFar+=h;if(this._animIdx=o-1,this._animIdx>=s-1)return this.setCoordinates(n),n[n.length-1];var u=this._animIdx,l=r[u],c=r[u+1],f=(a-this._animLenSoFar)/h;this._animTailRatio=f;var d=l.x+(c.x-l.x)*f,p=l.y+(c.y-l.y)*f;this._tempPrjCoord.x=d,this._tempPrjCoord.y=p;var g=this._tempPrjCoord,m=n[u],v=n[u+1],_=m.x+(v.x-m.x)*f,y=m.y+(v.y-m.y)*f;this._tempCoord.x=_,this._tempCoord.y=y;var x=this._tempCoord,w=!!this.getShell;if(!w&&this.options.smoothness>0){var b=n.slice(0,this._animIdx+3);this.setCoordinates(b);var C=r.slice(0,this._animIdx+3);this._setPrjCoordinates(C)}else{var P=n.slice(0,this._animIdx+1);P.push(x);var M=r.slice(0,this._animIdx+1);M.push(g),w?(this.setCoordinates([this._aniShowCenter].concat(P)),this._setPrjCoordinates([this._prjAniShowCenter].concat(M))):(this.setCoordinates(P),this._setPrjCoordinates(M))}return x},i._getCenterInExtent=function(t,e,i){var n=this.getExtent();if(!t.intersects(n))return null;var r=i(e,t);if(0===r.length)return null;var o=0,s=0,a=0;r.forEach(function(t){Array.isArray(t)?t.forEach(function(t){t.point&&(t=t.point),o+=t.x,s+=t.y,a++}):(t.point&&(t=t.point),o+=t.x,s+=t.y,a++)});var h=new Yi(o,s)._multi(1/a);return h.count=a,h},i._getPath2DPoints=function(t,e,i){if(!mt(t))return[];var n=this.getMap(),r=!e&&this._shouldSimplify(),o=this.options.simplifyTolerance*n._getResolution(),s=Array.isArray(t[0]);if(delete this._simplified,r&&!s){var a=t.length;t=To(t,o,!1),this._simplified=t.length<a}if(i||(i=n._getResolution()),Array.isArray(t)){var h=[];if(!Array.isArray(t[0]))return h=Et(t,"_glPt"),n._prjsToPointsAtRes(t,i,h);for(var u=[],l=0,c=t.length;l<c;l++){var f=t[l];h=Et(f,"_glPt");var d=n._prjsToPointsAtRes(f,i,h);u.push(d)}return u}return n._prjToPointAtRes(t,i)},i._shouldSimplify=function(){var t=this.getLayer(),e=this.getProperties(),i=e&&t.options.enableAltitude&&!d(e[t.options.altitudeProperty])&&0!==e[t.options.altitudeProperty];return t&&t.options.enableSimplify&&!i&&this.options.enableSimplify&&!this._showPlayer},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},i._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},i._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},i._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t):[]},i._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},i._computeCenter=function(){var t=this._coordinates;if(!mt(t))return null;for(var e=0,i=0,n=0,r=t.length,o=0;o<r;o++)t[o]&&p(t[o].x)&&p(t[o].y)&&(e+=t[o].x,i+=t[o].y,n++);return new Yi(e/n,i/n)},i._computeExtent=function(){var t=this._coordinates;if(!mt(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},i._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},i._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,i=1,n=t.length;i<n;i++)e+=t[i].distanceTo(t[i-1]);return e},i._hitTestTolerance=function(){var t,e=this._getInternalSymbol();if(Array.isArray(e)){t=0;for(var i=0;i<e.length;i++)p(e[i].lineWidth)&&e[i].lineWidth>t&&(t=e[i].lineWidth)}else t=e.lineWidth;return p(t)?t/2:1.5},i._coords2Extent=function(t,e){if(!t||0===t.length||Array.isArray(t[0])&&0===t[0].length)return null;for(var i=new cn(e),n=0,r=t.length;n<r;n++)for(var o=0,s=t[n].length;o<s;o++)i._combine(t[n][o]);return i},e}(Qr);So.mergeOptions({smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var Ao=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="Polygon",e&&n.setCoordinates(e),n}Y(e,t);var i=e.prototype;return i.getOutline=function(){return this._getPainter()?new e(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},i.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=Yi.toCoordinates(t),i=e.length;if(Array.isArray(e[0])){if(this._coordinates=this._trimRing(e[0]),i>1){for(var n=[],r=1;r<i;r++)e[r]&&n.push(this._trimRing(e[r]));this._holes=n}}else this._coordinates=this._trimRing(e);return this._projectRings(),this},i.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],i=0,n=t.length;i<n;i++)e.push(this._copyAndCloseRing(t[i]));return e},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),ar)},i.getShell=function(){return this._coordinates||[]},i.getHoles=function(){return this._holes||[]},i.hasHoles=function(){return this.getHoles().length>0},i._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},i._checkRing=function(t){if(this._cleanRing(t),!t||!mt(t))return!1;var e=t[t.length-1],i=!0;return t[0].x===e.x&&t[0].y===e.y||(i=!1),i},i._trimRing=function(t){var e=this._checkRing(t);return mt(t)&&e&&t.splice(t.length-1,1),t},i._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return mt(t)&&!e?(t.push(t[0].copy()),t):t},i._getPrjShell=function(){return"Polygon"===this.getJSONType()?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this.getShell())),this._prjShell)},i._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},i._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!mt(e))return 0;for(var i=0,n=0,r=e.length;n<r;n++)i+=t.measureLength(e[n]);return i},i._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!mt(e))return 0;for(var i=t.measureArea(e[0]),n=1,r=e.length;n<r;n++)i-=t.measureArea(e[n]);return i},i._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},i._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},i._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(So);function Eo(t){return function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){var e=t instanceof Yi?t:new Yi(t);if(e.equals(this._coordinates))return this;if(this._coordinates=e,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},i._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var i=this._getPrjCoordinates();return i?(t||(t=e._getResolution()),e._prjToPointAtRes(i,t)):null},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pcenter&&t&&this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter},i._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},i._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},i._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)}Ao.registerJSONType("Polygon");var ko=new dn,Ro=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="Point",e&&n.setCoordinates(e),n}Y(e,t);var i=e.prototype;return i.getOutline=function(){var t=this.getCoordinates(),i=this.getContainerExtent(),n=this.getMap().coordToContainerPoint(t);return new e(t,{symbol:{markerType:"square",markerWidth:i.getWidth(),markerHeight:i.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:i.xmin-(n.x-i.getWidth()/2),markerDy:i.ymin-(n.y-i.getHeight()/2)}})},i.setSymbol=function(){var e;delete this._fixedExtent;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.prototype.setSymbol).call.apply(e,[this].concat(n))},i._getSizeSymbol=function(t){for(var e,i={},n=!1,r=!1,o=0;o<nr.length;o++){var s=t[nr[o]];d(s)||(!n&&It(s)&&(n=!0,r=!0),i[nr[o]]=s)}for(var a=0;a<rr.length;a++){var h=t[rr[a]];d(h)||(!n&&It(h)&&(n=!0),i[rr[a]]=h)}return n?(e=ie(i,this),r&&(e._dynamic=!0)):e=i,e},i._setExternSymbol=function(e){return this._symbol||delete this._fixedExtent,t.prototype._setExternSymbol.call(this,e)},i._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},i._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new dn,this._fixedExtent.set(null,null,null,null);var t=this._sizeSymbol;if(!t)return this._fixedExtent;var e=this.getLayer()&&this.getLayer().getRenderer(),i=e&&e.resources,n=this.getTextDesc();if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]&&this._fixedExtent._combine(Xn(ko,t[r],i,n&&n[r]));else this._fixedExtent=Xn(this._fixedExtent,t,i,n);return this._fixedExtent},i._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&tr(t)},i._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(tr(t)||er(t)||Qn(t))},i._containsPoint=function(e,i){var n=this.getContainerExtent();return i&&(n=n.expand(i)),!!n.contains(e)&&(!this.options.hitTestForEvent||t.prototype._containsPoint.call(this,e,i))},i._computeExtent=function(){return Oo.call(this,"getCenter")},i._computePrjExtent=function(){return Oo.call(this,"_getPrjCoordinates")},i._computeGeodesicLength=function(){return 0},i._computeGeodesicArea=function(){return 0},i._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new $r(this).getSprite(t,e)},e}(Eo(Qr));function Oo(t){var e=this[t]();return e?new cn(e,e,this._getProjection()):null}Ro.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1}),Ro.registerJSONType("Marker");var Lo=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="LineString",e&&n.setCoordinates(e),n}Y(e,t);var i=e.prototype;return i.getOutline=function(){return Ao.prototype.getOutline.call(this)},i.setCoordinates=function(t){return t?(this._coordinates=Yi.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},i.getCoordinates=function(){return this._coordinates||[]},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),or)},i._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},i._computeGeodesicArea=function(){return 0},e}(So);Lo.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),Lo.registerJSONType("LineString");var Do=new dn,Io=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="GeometryCollection",n.setGeometries(e),n}Y(e,t);var i=e.prototype;return i.getContainerExtent=function(t){var e=t||new dn;return this.forEach(function(t){e._combine(t.getContainerExtent(Do))}),e},i.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),i=this._getSymbol(),n=this.config(),r=e.length-1;r>=0;r--)e[r]._initOptions(n),e[r]._setParent(this),e[r]._setEventParent(this),i&&e[r].setSymbol(i);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},i.getGeometries=function(){return this._geometries||[]},i.forEach=function(t,e){for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n]&&(e?t.call(e,i[n],n):t(i[n],n));return this},i.filter=function(t,i){if(!t)return new e;var n=[],r=_(t),o=r?t:Gt(t);return this.forEach(function(t){var e=r?t:Xt(t);(i?o.call(i,e):o(e))&&n.push(t)},this),new e(n)},i.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach(function(t){t&&t.translate&&t.translate.apply(t,e)}),this},i.isEmpty=function(){return!mt(this.getGeometries())},i.remove=function(){return this.forEach(function(t){t._unbind()}),Qr.prototype.remove.apply(this,arguments)},i.show=function(){return this.options.visible=!0,this.forEach(function(t){t.show()}),this},i.hide=function(){return this.options.visible=!1,this.forEach(function(t){t.hide()}),this},i.onConfig=function(t){this.forEach(function(e){e.config(t)})},i.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var i=[],n=!1;this.forEach(function(t){t.getSymbol()&&!n&&(n=!0),i.push(t.getSymbol())}),n&&(e={children:i})}return e},i.setSymbol=function(t){if(t&&t.children)this._symbol=null,this.forEach(function(e,i){e.setSymbol(t.children[i])});else{var e=this._prepareSymbol(t);this._symbol=e,this.forEach(function(t){t.setSymbol(e)})}return this.onSymbolChanged(),this},i._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach(function(e){e._setExternSymbol(t)}),this.onSymbolChanged(),this},i._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},i._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach(function(e){e._bindLayer(t)})},i._checkGeometries=function(t){if(t&&!Array.isArray(t)){if(t instanceof Qr)return[t];throw new Error("The geometry added to collection is invalid.")}for(var e=0,i=t.length;e<i;e++)if(!this._checkGeo(t[e]))throw new Error("The geometry added to collection is invalid. Index: "+e);return t},i._checkGeo=function(t){return t instanceof Qr},i._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach(function(t){t&&t._updateCache&&t._updateCache()})},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach(function(t){t._removePainter()})},i._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,i=0,n=0,r=this.getGeometries(),o=0,s=r.length;o<s;o++)if(r[o]){var a=r[o]._computeCenter(t);a&&(e+=a.x,i+=a.y,n++)}return 0===n?null:new Yi(e/n,i/n)},i._containsPoint=function(t,e){if(this.isEmpty())return!1;for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)if(i[n]._containsPoint(t,e))return!0;return!1},i._computeExtent=function(t){return jo.call(this,t,"_computeExtent")},i._computePrjExtent=function(t){return jo.call(this,t,"_computePrjExtent")},i._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicLength(t));return i},i._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicArea(t));return i},i._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),i=0,n=e.length;i<n;i++)e[i]&&t.push(e[i]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},i._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e]&&t[e]._clearProjection()},i._getConnectPoints=function(){var t=this.getExtent();return[new Yi(t.xmin,t.ymax),new Yi(t.xmax,t.ymin),new Yi(t.xmin,t.ymin),new Yi(t.xmax,t.ymax)]},i._getExternalResources=function(){if(this.isEmpty())return[];for(var t,e,i=this.getGeometries(),n=[],r={},o=0,s=i.length;o<s;o++)if(i[o])for(var a=0,h=(t=oe(i[o]._getInternalSymbol())).length;a<h;a++)r[e=t[a].join()]||(n.push(t[a]),r[e]=1);return n},i.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n].startEdit(t);return this._editing=!0,this.hide(),setTimeout(function(){e.fire("editstart")},1),this},i.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},i.isEditing=function(){return!!this._editing},e}(Qr);function jo(t,e){if(this.isEmpty())return null;for(var i=this.getGeometries(),n=null,r=0,o=i.length;r<o;r++){var s=i[r];if(s){var a=s[e](t);a&&(n=a.combine(n))}}return n}Io.registerJSONType("GeometryCollection");var zo=function(t){function e(e,i,n,r){var o;return(o=t.call(this,null,r)||this).GeometryType=e,o.type=i,o._initData(n),o}Y(e,t);var i=e.prototype;return i.getCoordinates=function(){for(var t=[],e=this.getGeometries(),i=0,n=e.length;i<n;i++){var r=e[i];t.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return t},i.setCoordinates=function(t){for(var e=[],i=0,n=(t=t||[]).length;i<n;i++){var r=new this.GeometryType(t[i],this.config());e.push(r)}return this.setGeometries(e),this},i._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},i._checkGeo=function(t){return t instanceof this.GeometryType},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Yi.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e}(Io),Ho=function(t){function e(e,i){return t.call(this,Ro,"MultiPoint",e,i)||this}return Y(e,t),e.prototype.findClosest=function(t){if(!t)return null;var e=null,i=1/0;return this.getCoordinates().forEach(function(n){var r,o,s,a,h=(r=n,s=(o=t).x-r.x,a=o.y-r.y,Math.sqrt(s*s+a*a));h<i&&(e=n,i=h)}),e},e}(zo);Ho.registerJSONType("MultiPoint");var Fo=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.prototype.getCenterInExtent=function(t){var e=0,i=0,n=0;return this.getGeometries().forEach(function(r){var o=r.getCenterInExtent(t);o&&(e+=o.x*o.count,i+=o.y*o.count,n+=o.count)}),0===n?null:new Yi(e,i)._multi(1/n)},e}(zo),No=function(t){function e(e,i){return t.call(this,Lo,"MultiLineString",e,i)||this}return Y(e,t),e}(Fo);No.registerJSONType("MultiLineString");var Zo=function(t){function e(e,i){return t.call(this,Ao,"MultiPolygon",e,i)||this}return Y(e,t),e}(Fo);Zo.registerJSONType("MultiPolygon");var Go={Marker:Ro,LineString:Lo,Polygon:Ao,MultiPoint:Ho,MultiLineString:No,MultiPolygon:Zo},Bo={toGeometry:function(t,e){if(v(t)&&(t=st(t)),Array.isArray(t)){for(var i=[],n=0,r=t.length;n<r;n++){var o=Bo._convert(t[n],e);Array.isArray(o)?at(i,o):i.push(o)}return i}return Bo._convert(t,e)},_convert:function(t,e){if(!t||d(t.type))return null;var i=t.type;if("Feature"===i){var n=t.geometry,r=Bo._convert(n);return r?(r.setId(t.id),r.setProperties(t.properties),e&&e(r),r):null}if("FeatureCollection"===i){var o=t.features;return o?Bo.toGeometry(o,e):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(i)>=0){var s=new Go["Point"===i?"Marker":i](t.coordinates);return e&&e(s),s}if("GeometryCollection"===i){var a=t.geometries;if(!mt(a)){var h=new Io;return e&&e(h),h}for(var u=[],l=a.length,c=0;c<l;c++)u.push(Bo._convert(a[c]));var f=new Io(u);return e&&e(f),f}return null}},Wo=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,e&&r.setCoordinates(e),r._radius=i,r}Y(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.radius,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getRadius=function(){return this._radius},i.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getRadius(),a=[],h=0,u=o-1;h<u;h++){t=360*h/u*Math.PI/180,e=s*Math.cos(t),i=s*Math.sin(t);var l=n.locate(r,e,i);a.push(l)}return a.push(a[0]),a},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,i){var n=this.getMap();if(n.getPitch())return t.prototype._containsPoint.call(this,e,i);var r=n._pointToContainerPoint(this._getCenter2DPoint()),o=this.getSize(),s=d(i)?this._hitTestTolerance():i;return lr(e,r,r.add(o.width/2,o.height/2),s)},i._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var i=this._getPrjCoordinates(),n=e.map(function(e){return t.project(e)}),r=n[0].x-i.x,o=n[1].x-i.x,s=n[2].y-i.y,a=n[3].y-i.y;return new cn(i.add(r,s),i.add(o,a))},i._computeExtent=function(t){var e=this._getMinMax(t);return e?new cn(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},i._getMinMax=function(t){if(!t||!this._coordinates||d(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},i._computeGeodesicLength=function(){return d(this._radius)?0:2*Math.PI*this._radius},i._computeGeodesicArea=function(){return d(this._radius)?0:Math.PI*Math.pow(this._radius,2)},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Yi.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=this.getCenter(),i=f({},t);i.geometry=!1;var n=this.toGeoJSON(i);return n.geometry={type:"Polygon"},{feature:n,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},e}(Eo(Ao));Wo.mergeOptions({numberOfShellPoints:60}),Wo.registerJSONType("Circle");var Vo=function(t){function e(e,i,n,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o.width=i,o.height=n,o}Y(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getWidth=function(){return this.width},i.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},i.getHeight=function(){return this.height},i.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n,r=this._getMeasurer(),o=this.getCoordinates(),s=this.options.numberOfShellPoints,a=this.getWidth(),h=this.getHeight(),u=[],l=Math.pow(a/2,2)*Math.pow(h/2,2),c=Math.pow(a/2,2),f=Math.pow(h/2,2),d=0;d<s;d++){e=(t=360*d/s)*Math.PI/180,i=Math.sqrt(l/(c*Math.pow(Math.tan(e),2)+f)),n=Math.sqrt(l/(f*Math.pow(1/Math.tan(e),2)+c)),t>90&&t<270&&(i*=-1),t>180&&t<360&&(n*=-1);var p=r.locate(o,i,n);u.push(p)}return u},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=n.getProjection(),o=d(i)?this._hitTestTolerance():i,s=r.projectCoords([this._coordinates,n.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)]);return lr(e,n._prjToContainerPoint(s[0]),n._prjToContainerPoint(s[1]),o)},i._computePrjExtent=function(){return Wo.prototype._computePrjExtent.apply(this,arguments)},i._computeExtent=function(){return Wo.prototype._computeExtent.apply(this,arguments)},i._getMinMax=function(t){if(!t||!this._coordinates||d(this.width)||d(this.height))return null;var e=this.getWidth(),i=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-i/2),t.locate(this._coordinates,0,i/2)]},i._computeGeodesicLength=function(){if(d(this.width)||d(this.height))return 0;var t=this.width>this.height?this.width:this.height;return 2*Math.PI*t/2-4*Math.abs(this.width-this.height)},i._computeGeodesicArea=function(){return d(this.width)||d(this.height)?0:Math.PI*this.width*this.height/4},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Yi.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=f({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Ellipse",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},e}(Eo(Ao));Vo.mergeOptions({numberOfShellPoints:80}),Vo.registerJSONType("Ellipse");var $o=function(t){function e(e,i,n,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o._width=i,o._height=n,o}Y(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){if(this._coordinates=t instanceof Yi?t:new Yi(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},i.getShell=function(){var t=this._getMeasurer(),e=this._coordinates,i=this.getMap(),n=1,r=-1;if(i){var o=i.getFullExtent();o.left>o.right&&(n=-1),o.bottom>o.top&&(r=1)}var s=[];return s.push(e),s.push(t.locate(e,n*this._width,0)),s.push(t.locate(e,n*this._width,r*this._height)),s.push(t.locate(e,0,r*this._height)),s.push(e),s},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},i._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},i._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this),i=this._getProjection();if(!i.isSphere())return e;for(var n=i.getSphereExtent(),r=n.sx,o=n.sy,s=this._getProjection().getCircum(),a=e[0],h=1,u=e.length;h<u;h++){var l=e[h],c=0,f=0;r*(a.x-l.x)>0&&(c=s.x*r),o*(a.y-l.y)<0&&(f=s.y*o),e[h]._add(c,f)}return e},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},i._clearProjection=function(){this._pnw=null,t.prototype._clearProjection.call(this)},i._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=d(i)?this._hitTestTolerance():i,o=n._getResolution()*r,s=this._getPrjExtent().expand(o),a=n._containerPointToPrj(e);return s.contains(a)},i._computePrjExtent=function(t){var e=this._getSouthEast(t);if(!e)return null;var i=t.projectCoords([new Yi(this._coordinates.x,e.y),new Yi(e.x,this._coordinates.y)]);return new cn(i[0],i[1])},i._computeExtent=function(t){var e=this._getSouthEast(t);return e?new cn(this._coordinates,e,this._getProjection()):null},i._getSouthEast=function(t){if(!t||!this._coordinates||d(this._width)||d(this._height))return null;var e=this.getWidth(),i=-this.getHeight();if(t.fullExtent){var n=t.fullExtent;e*=n.right>n.left?1:-1,i*=n.top>n.bottom?1:-1}var r=t.locate(this._coordinates,e,0),o=t.locate(this._coordinates,0,i);return r.y=o.y,r},i._computeGeodesicLength=function(){return d(this._width)||d(this._height)?0:2*(this._width+this._height)},i._computeGeodesicArea=function(){return d(this._width)||d(this._height)?0:this._width*this._height},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Yi.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=f({},t),i=this.getCoordinates();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Rectangle",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},e}(Ao);$o.registerJSONType("Rectangle");var Uo=function(t){function e(e,i,n,r,o){var s;return(s=t.call(this,e,i,o)||this).startAngle=n,s.endAngle=r,s}Y(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getStartAngle=function(){return this.startAngle},i.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},i.getEndAngle=function(){return this.endAngle},i.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints-2,s=this.getRadius(),a=[r.copy()],h=this.getStartAngle(),u=this.getEndAngle()-h,l=0;l<o;l++){t=(u*l/(o-1)+h)*Math.PI/180,e=s*Math.cos(t),i=s*Math.sin(t);var c=n.locate(r,e,i);a.push(c)}return a.push(r.copy()),a},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=n._pointToContainerPoint(this._getCenter2DPoint()),o=d(i)?this._hitTestTolerance():i,s=this.getSize(),a=r,h=e,u=h.x-a.x,l=a.y-h.y,c=Math.atan2(l,u),f=c<0?360*(c+2*Math.PI)/(2*Math.PI):360*c/(2*Math.PI),p=this.startAngle%360,g=this.endAngle%360,m=!1;return m=p>g?!(f>g&&f<p):f>=p&&f<=g,h.distanceTo(a)<=s.width/2+o&&m},i._computeGeodesicLength=function(){return d(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},i._computeGeodesicArea=function(){return d(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},i._toJSON=function(t){var e=f({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Sector",coordinates:[i.x,i.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},e}(Wo);Uo.mergeOptions({numberOfShellPoints:60}),Uo.registerJSONType("Sector");var Jo=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i._arc=function(t,e,i){for(var n=this.options.arcDegree*Math.PI/180,r=1,o=e.length;r<o;r++){var s=pi._arcBetween(t,e[r-1],e[r],n),a=[e[r-1].x+e[r].x-s[0],e[r-1].y+e[r].y-s[1]];e[r-1].nextCtrlPoint=a,e[r].prevCtrlPoint=a,pi._stroke(t,i)}},i._quadraticCurve=function(t,e){if(e.length<=2)pi._path(t,e);else{var i,n;for(i=2,n=e.length;i<n;i+=2)t.quadraticCurveTo(e[i-1].x,e[i-1].y,e[i].x,e[i].y);if((i-=1)<n)for(;i<n;i++)t.lineTo(e[i].x,e[i].y)}},i._bezierCurve=function(t,e){if(e.length<=3)pi._path(t,e);else{var i,n;for(i=1,n=e.length;i+2<n;i+=3)t.bezierCurveTo(e[i].x,e[i].y,e[i+1].x,e[i+1].y,e[i+2].x,e[i+2].y);if(i<n)for(;i<n;i++)t.lineTo(e[i].x,e[i].y)}},i._getCurveArrowPoints=function(t,e,i,n,r,o){var s,a=e.length;for(s=o;s<a;s+=o){var h=this._getArrowShape(e[s-1],e[s],i,n,r);h&&t.push(h)}if((s-=o)<a-1)for(s+=1;s<a;s++){var u=this._getArrowShape(e[s-1],e[s],i,n,r);u&&t.push(u)}},e}(Lo);Jo.mergeOptions({enableSimplify:!1,enableClip:!1});var qo=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},i._paintOn=function(t,e,i){t.beginPath(),this._arc(t,e,i),pi._stroke(t,i),this._paintArrow(t,e,i)},e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n},e}(Jo);qo.registerJSONType("ArcCurve"),qo.mergeOptions({arcDegree:90});var Yo=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},i._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),pi._stroke(t,i),this._paintArrow(t,e,i)},i._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,3)},e}(Jo);Yo.registerJSONType("CubicBezierCurve");var Xo=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},i._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,i),pi._stroke(t,i),this._paintArrow(t,e,i)},i._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,2)},e}(Jo);Xo.registerJSONType("QuadBezierCurve");var Ko={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},Qo={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},ts=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.getContent=function(){return this._content},i.setContent=function(t){var e=this._content;return this._content=ce(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},i.onAdd=function(){this._refresh()},i.toJSON=function(){var e=t.prototype.toJSON.call(this);return delete e.symbol,e},i.setSymbol=function(e){if(this._refreshing||!e)return t.prototype.setSymbol.call(this,e);var i=this._parseSymbol(e);if(this.setTextStyle){var n=this.getTextStyle()||{};n.symbol=i[0],this.setTextStyle(n)}else this.setTextSymbol&&this.setTextSymbol(i[0]);if(this.setBoxStyle){var r=this.getBoxStyle()||{};r.symbol=i[1],this.setBoxStyle(r)}else this.setBoxSymbol&&this.setBoxSymbol(i[1]);return this},i._parseSymbol=function(t){var e={},i={};for(var n in t)x(t,n)&&(0===n.indexOf("text")?e[n]=t[n]:i[n]=t[n]);return[e,i]},i._getTextSize=function(t){return Ce(this._content,t).size},i._getInternalSymbol=function(){return this._symbol},i._getDefaultTextSymbol=function(){return f({},Ko)},i._getDefaultBoxSymbol=function(){return f({},Qo)},i._getDefaultPadding=function(){return[12,8]},e}(Ro),es=function(t){function e(e,i,n,r,o){var s;return void 0===o&&(o={}),(s=t.call(this,i,o)||this)._content=ce(e),s._width=d(n)?100:n,s._height=d(r)?40:r,o.boxSymbol&&s.setBoxSymbol(o.boxSymbol),o.textStyle&&s.setTextStyle(o.textStyle),s._refresh(),s}Y(e,t);var i=e.prototype;return i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this._refresh(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this._refresh(),this},i.getBoxSymbol=function(){return f({},this.options.boxSymbol)},i.setBoxSymbol=function(t){return this.options.boxSymbol=t?f({},t):t,this.getSymbol()&&this._refresh(),this},i.getTextStyle=function(){return this.options.textStyle?f({},this.options.textStyle):null},i.setTextStyle=function(t){return this.options.textStyle=t?f({},t):t,this.getSymbol()&&this._refresh(),this},e.fromJSON=function(t){var i=t.feature,n=new e(t.content,i.geometry.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n.setId(i.id),t.symbol&&n.setSymbol(t.symbol),n},i._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},i._refresh=function(){var t=this.getTextStyle()||{},e=t.padding||[12,8],i=this._width-2*e[0],n=this._height-2*e[1],r=f({},t.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:i,textMaxHeight:n});t.wrap&&!r.textWrapWidth&&(r.textWrapWidth=i);var o=t.horizontalAlignment;r.textDx=r.markerDx||0;var s=r.markerWidth/2-e[0];"left"===o?(r.textHorizontalAlignment="right",r.textDx=r.textDx-s):"right"===o&&(r.textHorizontalAlignment="left",r.textDx=r.textDx+s);var a=t.verticalAlignment;r.textDy=r.markerDy||0;var h=r.markerHeight/2-e[1];"top"===a?(r.textVerticalAlignment="bottom",r.textDy-=h):"bottom"===a&&(r.textVerticalAlignment="top",r.textDy+=h),this._refreshing=!0,this.updateSymbol(r),delete this._refreshing},e}(ts);es.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),es.registerJSONType("TextBox");var is=function(t){function e(e,i,n){var r;return void 0===n&&(n={}),r=t.call(this,i,n)||this,n.textSymbol&&r.setTextSymbol(n.textSymbol),n.boxStyle&&r.setBoxStyle(n.boxStyle),r._content=ce(e),r._refresh(),r}Y(e,t);var i=e.prototype;return i.getBoxStyle=function(){return this.options.boxStyle?f({},this.options.boxStyle):null},i.setBoxStyle=function(t){return this.options.boxStyle=t?f({},t):t,this._refresh(),this},i.getTextSymbol=function(){return f({},this._getDefaultTextSymbol(),this.options.textSymbol)},i.setTextSymbol=function(t){return this.options.textSymbol=t?f({},t):t,this._refresh(),this},e.fromJSON=function(t){var i=t.feature,n=new e(t.content,i.geometry.coordinates,t.options);return n.setProperties(i.properties),n.setId(i.id),t.symbol&&n.setSymbol(t.symbol),n},i._canEdit=function(){return!1},i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},i._refresh=function(){var t=f({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){f(t,e.symbol);var i=this._getBoxSize(t),n=i[1],r=e.padding||this._getDefaultPadding(),o=i[0];t.markerWidth=o.width,t.markerHeight=o.height;var s=t.textDx||0,a=t.textDy||0,h=xe(n,t.textHorizontalAlignment,t.textVerticalAlignment)._add(s,a),u=e.horizontalAlignment||"middle";t.markerDx=h.x,"left"===u?t.markerDx+=t.markerWidth/2-r[0]:"right"===u?t.markerDx-=t.markerWidth/2-n.width-r[0]:t.markerDx+=n.width/2;var l=e.verticalAlignment||"middle";t.markerDy=h.y,"top"===l?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===l?t.markerDy-=t.markerHeight/2-n.height-r[1]:t.markerDy+=n.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},i._getBoxSize=function(t){t.markerType||(t.markerType="square");var e,i,n=this.getBoxStyle(),r=this._getTextSize(t),o=n.padding||this._getDefaultPadding();return e=r.width+2*o[0],i=r.height+2*o[1],n.minWidth&&(!e||e<n.minWidth)&&(e=n.minWidth),n.minHeight&&(!i||i<n.minHeight)&&(i=n.minHeight),[new he(e,i),r]},e}(ts);is.mergeOptions({boxStyle:null,textSymbol:null}),is.registerJSONType("Label");var ns=function(t){return function(t){function e(){return t.apply(this,arguments)||this}Y(e,t),e._hasConnectors=function(t){return!d(t.__connectors)&&t.__connectors.length>0},e._getConnectors=function(t){return t.__connectors};var i=e.prototype;return i.getConnectSource=function(){return this._connSource},i.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},i.getConnectTarget=function(){return this._connTarget},i.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},i._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e,i,n=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),o=0,s=this.getCoordinates(),a=0,h=n.length;a<h;a++)for(var u=n[a],l=0,c=r.length;l<c;l++){var f=r[l],d=t.computeLength(u,f);0===a&&0===l?(e=u,i=f,o=d):d<o&&(e=u,i=f)}mt(s)&&s[0].equals(e)&&s[1].equals(i)||this.setCoordinates([e,i])}},i.onAdd=function(){this._registerEvents(),this._updateCoordinates()},i.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&ht(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(ht(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof Qr&&this._connTarget instanceof Qr)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},i._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},i._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof Qr&&this._connTarget instanceof Qr)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},rs={showOn:"always"},os=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,1===arguments.length&&(n=e,e=null,i=null),r._connSource=e,r._connTarget=i,r}return Y(e,t),e}(ns(Lo));os.mergeOptions(rs),os.registerJSONType("ConnectorLine");var ss=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,1===arguments.length&&(n=e,e=null,i=null),r._connSource=e,r._connTarget=i,r}return Y(e,t),e}(ns(qo));ss.mergeOptions(rs),ss.registerJSONType("ArcConnectorLine");var as=function(t){function e(e,i,n){var r;i&&!(i instanceof Qr)&&!Array.isArray(i)&&o.indexOf(i.type)<0&&(n=i,i=null),(r=t.call(this,e,n)||this)._maxZIndex=0,r._minZIndex=0,r._initCache(),i&&r.addGeometry(i);var s=r.options.style;return s&&r.setStyle(s),r}Y(e,t);var i=e.prototype;return i.getGeometryById=function(t){return d(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},i.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var i,n=[],r=0,o=this._geoList.length;r<o;r++)i=this._geoList[r],(e?t.call(e,i):t(i))&&n.push(i);return n},i.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},i.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},i.getCount=function(){return this._geoList.length},i.getExtent=function(){if(0===this.getCount())return null;var t=new cn(this.getProjection());return this.forEach(function(e){t._combine(e.getExtent())}),t},i.forEach=function(t,e){for(var i=this._geoList.slice(0),n=0,r=i.length;n<r;n++)e?t.call(e,i[n],n):t(i[n],n);return this},i.filter=function(t,e){var i=[],n=_(t),r=n?t:Gt(t);return this.forEach(function(t){var o=n?t:Xt(t);(e?r.call(e,o):r(o))&&i.push(t)},this),i},i.isEmpty=function(){return!this._geoList.length},i.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(Bo.toGeometry(t),e);if(!Array.isArray(t)){var i=arguments.length,n=arguments[i-1];return t=Array.prototype.slice.call(arguments,0,i-1),e=n,n&&m(n)&&("type"in n||n instanceof Qr)&&(t.push(n),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;var r;this._initCache(),e&&(r=new cn),this._toSort=this._maxZIndex>0;for(var o=[],s=0,a=t.length;s<a;s++){var h=t[s];if(!h)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+s);if(!(h instanceof Qr)&&(h=Qr.fromJSON(h),Array.isArray(h)))for(var u=0,l=h.length;u<l;u++)this._add(h[u],r,s),o.push(h[u]);Array.isArray(h)||(this._add(h,r,s),o.push(h))}var c=this.getMap();if(c&&(this._getRenderer().onGeometryAdd(o),r&&!d(r.xmin))){var p=r.getCenter(),g=c.getFitZoom(r);if(m(e)){var v=_(e.step)?e.step:function(){};c.animateTo({center:p,zoom:g},f({duration:c.options.zoomAnimationDuration,easing:"out"},e),v)}else!0===e&&c.setCenterAndZoom(p,g)}return this.fire("addgeo",{geometries:t}),this},i.getGeoMinZIndex=function(){return this._minZIndex},i.getGeoMaxZIndex=function(){return this._maxZIndex},i._add=function(t,e,i){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var n=t.getId();if(!d(n)){if(!d(this._geoMap[n]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+n+", at index:"+i);this._geoMap[n]=t}var r=ot();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},i.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof Qr||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},i.clear=function(){this._clearing=!0,this.forEach(function(t){t.remove()}),this._geoMap={};var t=this._geoList;this._geoList=[];var e=this._getRenderer();return e&&(e.onGeometryRemove(t),e.clearImageData&&e.clearImageData()),this._clearing=!1,this.fire("clear"),this},i.onRemoveGeometry=function(t){if(t&&!this._clearing&&(this===t.getLayer()&&!d(t._getInternalId()))){var e=t.getId();d(e)||delete this._geoMap[e];var i=this._findInList(t);i>=0&&this._geoList.splice(i,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},i.getStyle=function(){return this.options.style?this.options.style:null},i.setStyle=function(t){return this.options.style=t,t=ke(t),this._cookedStyles=Kt(t),this.forEach(function(t){this._styleGeometry(t)},this),this.fire("setstyle",{style:t}),this},i._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=Xt(t),i=0,n=this._cookedStyles.length;i<n;i++)if(!0===this._cookedStyles[i].filter(e))return t._setExternSymbol(this._cookedStyles[i].symbol),!0;return!1},i.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach(function(t){t._setExternSymbol(null)},this),this.fire("removestyle"),this):this},i.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},i.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return eo.prototype.hide.call(this)},i._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},i._updateZIndex=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},i._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort(function(e,i){return t._updateZIndex(e.getZIndex(),i.getZIndex()),t._compare(e,i)}),this._toSort=!1)},i._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},i._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;this._sortGeometries();for(var i,n=0,r=e-1;n<=r;){if(i=Math.floor((n+r)/2),this._geoList[i]===t)return i;this._compare(this._geoList[i],t)>0?r=i-1:n=i+1}return-1},i._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},i._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!d(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}d(t.old)||t.new===t.old||delete this._geoMap[t.old]}},i._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},i._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},i._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},i._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},i._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},i._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},i._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},e}(eo);as.mergeOptions({drawImmediate:!1});var hs=new dn,us={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:q.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3},ls=function(t){function e(e,i,n){return t.call(this,e,i,n)||this}Y(e,t);var i=e.prototype;return i.onConfig=function(e){if(t.prototype.onConfig.call(this,e),e.enableAltitude||e.drawAltitude||e.altitudeProperty){var i=this.getRenderer();i&&i.setToRedraw&&i.setToRedraw()}},i.identify=function(t,e){void 0===e&&(e={});var i=this.getRenderer();t instanceof Yi||(t=new Yi(t));var n=this.getMap().coordToContainerPoint(t);return e.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(n,e):this._hitGeos(this._geoList,n,e)},i.identifyAtPoint=function(t,e){void 0===e&&(e={});var i=this.getRenderer();return t instanceof et||(t=new et(t)),e.onlyVisible&&i&&i.identifyAtPoint?i.identifyAtPoint(t,e):this._hitGeos(this._geoList,t,e)},i._hitGeos=function(t,e,i){void 0===i&&(i={});var n=i.filter,r=i.tolerance,o=[],s=this.getMap(),a=this.getRenderer(),h=a&&a.getImageData&&a.getImageData();if(h){var u=s.getDevicePixelRatio();h.r=u;var l=Math.round(e.x*u),c=Math.round(e.y*u)*h.width*4+4*l;if(0===h.data[c+3])return o}for(var f=t.length-1;f>=0;f--){var d=t[f];if(d&&d.isVisible()&&d._getPainter()&&d.options.interactive){if(!(d instanceof Lo&&(d._getArrowStyle()||d instanceof Jo))){var p=d.getContainerExtent(hs);if(r&&(p=p._expand(r)),!p||!p.contains(e))continue}if(d._containsPoint(e,r)&&(!n||n(d))&&(o.push(d),i.count&&o.length>=i.count))break}}return o},i.getAltitude=function(){return this.options.altitude||0},i.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(d(t.geometries)||t.geometries){var i;if(t.clipExtent){var n=this.getMap(),r=n?n.getProjection():null;i=new cn(t.clipExtent,r)}for(var o=[],s=this.getGeometries(),a=0,h=s.length;a<h;a++){var u=s[a],l=u.getExtent();if(l&&(!i||i.intersects(l))){var c=u.toJSON(t.geometries);o.push(c)}}e.geometries=o}return e},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var i=new e(t.id,t.options),n=t.geometries,r=[],o=0;o<n.length;o++){var s=Qr.fromJSON(n[o]);s&&r.push(s)}return i.addGeometry(r),i},e.getPainterClass=function(){return $r},e.getCollectionPainterClass=function(){return Jr},e}(as);ls.mergeOptions(us),ls.registerJSONType("VectorLayer");var cs="_map_tool",fs=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.addTo=function(t){return t?(this._map=t,t[cs]&&t[cs].disable(),this.onAdd&&this.onAdd(),this.enable(),t[cs]=this,this._fireEvent("add"),this):this},i.getMap=function(){return this._map},i.enable=function(){return!this._map||this._enabled?this:(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable"),this)},i.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},i.isEnabled=function(){return!!this._enabled},i.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[cs],delete this._map),this._fireEvent("remove"),this):this},i._registerEvents=function(){this._switchEvents("on")},i._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},i._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(Ci(Mi)),ds={},ps=function(t){function e(e){var i;return(i=t.call(this,e)||this)._checkMode(),i._events={click:i._clickHandler,"mousemove touchmove":i._mouseMoveHandler,dblclick:i._doubleClickHandler,"mousedown touchstart":i._mouseDownHandler,"mouseup touchend":i._mouseUpHandler,mousemove:i._mouseMoveHandler,mousedown:i._mouseDownHandler,mouseup:i._mouseUpHandler},i}Y(e,t),e.registerMode=function(t,e){ds[t.toLowerCase()]=e},e.getRegisterMode=function(t){return ds[t.toLowerCase()]};var i=e.prototype;return i.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},i.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},i.getSymbol=function(){var t=this.options.symbol;return Ee(t||this.options.symbol)},i.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},i.getCurrentGeometry=function(){return this._geometry},i.onAdd=function(){this._checkMode()},i.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var t=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})),this._geometryEvents=t.options.geometryEvents,this.options.blockGeometryEvents&&t.config("geometryEvents",!1),this},i.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw(),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&t.config("geometryEvents",this._geometryEvents),this},i.undo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||!this._historyPointer)return this;var i=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),i,this._geometry),this},i.redo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||d(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var i=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),i,this._geometry),this},i._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},i._checkMode=function(){this._getRegisterMode()},i._saveMapCfg=function(){var t=this.getMap();this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom});for(var e=this._getRegisterMode().action,i=!1,n=0;n<e.length;n++)if(e[n].indexOf("mousedown")>=0||e[n].indexOf("touchstart")>=0){i=!0;break}if(i){var r=this.getMap();this._mapDraggable=r.options.draggable,r.config({draggable:!1})}},i._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),d(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},i._loadResources=function(){var t=oe(this.getSymbol());t.length>0&&this._drawToolLayer._getRenderer().loadResources(t)},i._getProjection=function(){return this._map.getProjection()},i._getRegisterMode=function(){var t=this.getMode(),i=e.getRegisterMode(t);if(!i)throw new Error(t+" is not a valid mode of DrawTool.");return i},i.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var i=0;i<t.length;i++)e[t[i]]=this._events[t[i]];return e}return null},i._mouseDownHandler=function(t){this._createGeometry(t)},i._mouseUpHandler=function(t){this.endDraw(t)},i._clickHandler=function(t){var e=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var i=this._clickCoords.length,n=this.getMap()._pointToPrj(t.point2d);if(this._clickCoords[i-1].equals(n))return}if(this._geometry){var r=this.getMap()._pointToPrj(t.point2d);d(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._clickCoords.push(r),this._historyPointer=this._clickCoords.length,t.drawTool=this,e.update(this.getMap().getProjection(),this._clickCoords,this._geometry,t),this._clickCoords.length<=1?this._fireEvent("drawstart",t):this._fireEvent("drawvertex",t),e.clickLimit&&e.clickLimit===this._historyPointer&&this.endDraw(t)}else this._createGeometry(t)},i._createGeometry=function(t){var e=this.getMode(),i=this._getRegisterMode(),n=this.getMap()._pointToPrj(t.point2d),r=this.getSymbol();this._geometry||(this._clickCoords=[n],t.drawTool=this,this._geometry=i.create(this.getMap().getProjection(),this._clickCoords,t),r&&"point"!==e?this._geometry.setSymbol(r):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t)),"point"===e&&this.endDraw(t)},i._mouseMoveHandler=function(t){var e=this.getMap();if(this._geometry&&e&&!e.isInteracting()){var i=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(i)){var n=this.getMap()._pointToPrj(t.point2d),r=e.getProjection();t.drawTool=this;var o=this._getRegisterMode();if(this._shouldRecordHistory(o.action)){var s=this._clickCoords.slice(0,this._historyPointer);if(s&&s.length>0&&n.equals(s[s.length-1]))return;o.update(r,s.concat([n]),this._geometry,t)}else o.update(r,n,this._geometry,t);this._fireEvent("mousemove",t)}}},i._doubleClickHandler=function(t){if(this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var i=this._getRegisterMode(),n=this._clickCoords;if(!(n.length<2)){var r=this.getMode();if(!(r&&r.indexOf("polygon")>-1&&n.length<3)){for(var o=this.getMap().getProjection(),s=[n[0]],a=1,h=n.length;a<h;a++)n[a].x===n[a-1].x&&n[a].y===n[a-1].y||s.push(n[a]);s.length<2||this._geometry&&this._geometry instanceof Ao&&s.length<3||(t.drawTool=this,i.update(o,s,this._geometry,t),this.endDraw(t))}}}}},i._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},i.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this},i._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},i._getMouseContainerPoint=function(t){var e=this._getRegisterMode().action;return(e[0].indexOf("mousedown")>=0||e[0].indexOf("touchstart")>=0)&&Ue(t.domEvent),t.containerPoint},i._isValidContainerPoint=function(t){var e=this._map.getSize(),i=e.width,n=e.height;return!(t.x<0||t.y<0)&&!(t.x>i||t.y>n)},i._getDrawLayer=function(){var t="_maptalks__internal_layer_drawtool",e=this._map.getLayer(t);return e||(e=new ls(t,{enableSimplify:!1}),this._map.addLayer(e)),e},i._fireEvent=function(t,e){e||(e={}),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this})),fs.prototype._fireEvent.call(this,t,e)},e}(fs);ps.mergeOptions({symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1});var gs=function(t){function e(e){var i;return(i=t.call(this,e)||this).drawTool=new ps({mode:"boxZoom",ignoreMouseleave:!1}),i}Y(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},i.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},i._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},i._boxZoom=function(t){var e=this.target;this.drawTool.remove();var i=t.geometry,n=i.getCenter(),r=i.getSymbol(),o=r.markerWidth,s=r.markerHeight,a=new cn(n,e.locateByPoint(n,o,s),e.getProjection()),h=e.getFitZoom(a);e._animateTo({center:a.getCenter(),zoom:h})},e}(Pi);co.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),co.addOnLoadHook("addHandler","boxZoom",gs);var ms=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},i.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},i._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var i=t.containerPoint,n=e.getContainerExtent();if(n){var r,o=i.x,s=i.y,a=n.xmax,h=n.ymax;o<30&&(r=[Math.abs(o-30),0]),s<30&&(r=[0,Math.abs(s-30)]),o+30>a&&(r=[-Math.abs(o+30-a),0]),s+30>h&&(r=[0,-Math.abs(s+30-h)]),r&&e.panBy(r,{duration:1})}}},e}(Pi);function vs(t,e,i){return t*(1-i)+e*i}co.mergeOptions({autoPanAtEdge:!1}),co.addOnLoadHook("addHandler","autoPanAtEdge",ms),co.include({animateTo:function(t,e,i){var n=this;void 0===e&&(e={}),_(e)&&(i=e,e={});var r=this.getProjection(),o=this.getView(),s={},a=!0;for(var h in t)if(x(t,h)&&!d(t[h])&&("prjCenter"===h||!d(o[h])))if(a=!1,"center"===h){var u=new Yi(o[h]).toFixed(7),l=new Yi(t[h]).toFixed(7);u.equals(l)||(s.center=[u,l])}else if("prjCenter"===h){var c=new Yi(this._getPrjCenter()),f=new Yi(t[h]);c.equals(f)||(s.prjCenter=[c,f])}else o[h]!==t[h]&&"around"!==h&&(s[h]=[o[h],t[h]]);if(a)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var p=t.around||new et(this.width/2,this.height/2),g=this._getRenderer(),m=this._animPlayer=Mo.animate(s,{easing:e.easing||"out",duration:e.duration||this.options.zoomAnimationDuration,framer:function(t){g.callInNextFrame(t)}},function(t){if(n.isRemoved())m.finish();else{if("running"===m.playState){if(t.styles.center){var o=t.styles.center;n._setPrjCenter(r.project(o)),n.onMoving(n._parseEventFromCoord(n.getCenter()))}else if(t.styles.prjCenter){var a=t.styles.prjCenter;n._setPrjCenter(a),n.onMoving(n._parseEventFromCoord(n.getCenter()))}d(t.styles.zoom)||n.onZooming(t.styles.zoom,p),d(t.styles.pitch)||n.setPitch(t.styles.pitch),d(t.styles.bearing)||n.setBearing(t.styles.bearing),n._fireEvent("animating")}else"paused"===m.playState&&m!==n._mapAnimPlayer||(m._interupted||(s.center?n._setPrjCenter(r.project(s.center[1])):s.prjCenter&&n._setPrjCenter(s.prjCenter[1]),d(s.pitch)||n.setPitch(s.pitch[1]),d(s.bearing)||n.setBearing(s.bearing[1])),n._endAnim(m,s,p,e));i&&i(t)}},this);return this._startAnim(s,p),m},_animateTo:function(t,e,i){return void 0===e&&(e={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,e,i),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(t,e,i){var n=this;void 0===e&&(e={}),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),_(e)&&(i=e,e={}),e=f({curve:1.42},e);var r=this;function o(t,e){return r.getResolution(e)/r.getResolution(t)}var s=t.around||new et(this.width/2,this.height/2),a=this.getMinZoom(),h=this.getMaxZoom(),u=this.getProjection(),l=this.getView(),c=l.zoom,d=l.bearing,p=l.pitch,g="zoom"in t?gt(+t.zoom,a,h):c,m="bearing"in t?+t.bearing:d,v="pitch"in t?+t.pitch:p,y=u.project(t.center&&new Yi(t.center)||this.getCenter()),x=o(g,c),w=u.project(this.getCenter()),b=y.sub(w),C=e.curve,P=Math.max(this.width,this.height),M=P/x,T=b.mag();if("minZoom"in e){var S=gt(Math.min(e.minZoom,c,g),a,h),A=P/o(S,c);C=Math.sqrt(A/T*2)}var E=C*C;function k(t){var e=(M*M-P*P+(t?-1:1)*E*E*T*T)/(2*(t?M:P)*E*T);return Math.log(Math.sqrt(e*e+1)-e)}function R(t){return(Math.exp(t)-Math.exp(-t))/2}function O(t){return(Math.exp(t)+Math.exp(-t))/2}var L=k(0),D=function(t){return O(L)/O(L+C*t)},I=function(t){return P*((O(L)*(R(e=L+C*t)/O(e))-R(L))/E)/T;var e},j=(k(1)-L)/C;if(Math.abs(T)<1e-6||!isFinite(j)){if(Math.abs(P-M)<1e-6)return this.animateTo(t,e,i);var z=M<P?-1:1;j=Math.abs(Math.log(M/P))/C,I=function(){return 0},D=function(t){return Math.exp(z*C*t)}}var H=this._getRenderer(),F=this._animPlayer=Mo.animate({k:[0,1]},{easing:e.easing||"out",duration:e.duration||8,framer:function(t){H.callInNextFrame(t)}},function(r){if(n.isRemoved())F.finish();else{var o=r.styles.k,a=o*j,h=1/D(a),u={};if(t.center){var l=1===o?y:w.add(b.multi(I(a)));u.prjCenter=[y,l]}if(c!==g){var f=1===o?g:n.getZoomForScale(h,c,!0);u.zoom=[c,f]}if(p!==v){var _=vs(p,v,o);u.pitch=[v,_]}if(d!==m){var x=vs(d,m,o);u.bearing=[m,x]}if("running"===F.playState){if(u.prjCenter){var C=u.prjCenter;n._setPrjCenter(C[1]),n.onMoving(n._parseEventFromCoord(n.getCenter()))}u.zoom&&n.onZooming(u.zoom[1],s),u.pitch&&n.setPitch(u.pitch[1]),u.bearing&&n.setBearing(u.bearing[1]),n._fireEvent("animating")}else"paused"===F.playState&&F!==n._mapAnimPlayer||(F._interupted||(u.prjCenter&&n._setPrjCenter(u.prjCenter[1]),u.pitch&&n.setPitch(u.pitch[1]),u.bearing&&n.setBearing(u.bearing[1])),n._endAnim(F,u,s,e));i&&i(r)}});return this._startAnim({center:t.center,zoom:t.zoom!==c,pitch:v!==p,bearing:m!==d},s),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,i,n){delete this._animRotating;var r,o=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,e.center)r=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(r));else if(e.prjCenter){var s;s=t._interupted?this._getPrjCenter():e.prjCenter[1];var a=this._parseEventFromCoord(this.getProjection().unproject(s));a.point2d=this._prjToPoint(s),this.onMoveEnd(a)}d(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom(),i):n.wheelZoom?this.onZooming(e.zoom[1],i):this.onZoomEnd(e.zoom[1],i)),o&&this._fireEvent(o),d(e.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),n.wheelZoom||this._resumePrev(t)},_startAnim:function(t,e){this._animPlayer&&(t.center&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&(delete this._animRotating,"finished"!==t.playState&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(t){if(this._prevAnimPlayer){var e=this._prevAnimPlayer;"paused"!==e.playState&&delete this._prevAnimPlayer,t!==e&&(this._animPlayer=e,e.play())}}});var _s="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";function ys(t,e,i,n,r){var o=1/Math.tan(e/2),s=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*s,t[15]=0,t}function xs(t,e,i){var n,r,o,s,a,h,u,l,c,f,d,p,g=i[0],m=i[1],v=i[2];return e===t?(t[12]=e[0]*g+e[4]*m+e[8]*v+e[12],t[13]=e[1]*g+e[5]*m+e[9]*v+e[13],t[14]=e[2]*g+e[6]*m+e[10]*v+e[14],t[15]=e[3]*g+e[7]*m+e[11]*v+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],f=e[9],d=e[10],p=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=f,t[10]=d,t[11]=p,t[12]=n*g+a*m+c*v+e[12],t[13]=r*g+h*m+f*v+e[13],t[14]=o*g+u*m+d*v+e[14],t[15]=s*g+l*m+p*v+e[15]),t}function ws(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function bs(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],f=e[9],d=e[10],p=e[11],g=e[12],m=e[13],v=e[14],_=e[15],y=i[0],x=i[1],w=i[2],b=i[3];return t[0]=y*n+x*a+w*c+b*g,t[1]=y*r+x*h+w*f+b*m,t[2]=y*o+x*u+w*d+b*v,t[3]=y*s+x*l+w*p+b*_,y=i[4],x=i[5],w=i[6],b=i[7],t[4]=y*n+x*a+w*c+b*g,t[5]=y*r+x*h+w*f+b*m,t[6]=y*o+x*u+w*d+b*v,t[7]=y*s+x*l+w*p+b*_,y=i[8],x=i[9],w=i[10],b=i[11],t[8]=y*n+x*a+w*c+b*g,t[9]=y*r+x*h+w*f+b*m,t[10]=y*o+x*u+w*d+b*v,t[11]=y*s+x*l+w*p+b*_,y=i[12],x=i[13],w=i[14],b=i[15],t[12]=y*n+x*a+w*c+b*g,t[13]=y*r+x*h+w*f+b*m,t[14]=y*o+x*u+w*d+b*v,t[15]=y*s+x*l+w*p+b*_,t}function Cs(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],f=e[10],d=e[11],p=e[12],g=e[13],m=e[14],v=e[15],_=i*a-n*s,y=i*h-r*s,x=i*u-o*s,w=n*h-r*a,b=n*u-o*a,C=r*u-o*h,P=l*g-c*p,M=l*m-f*p,T=l*v-d*p,S=c*m-f*g,A=c*v-d*g,E=f*v-d*m,k=_*E-y*A+x*S+w*T-b*M+C*P;return k?(k=1/k,t[0]=(a*E-h*A+u*S)*k,t[1]=(r*A-n*E-o*S)*k,t[2]=(g*C-m*b+v*w)*k,t[3]=(f*b-c*C-d*w)*k,t[4]=(h*T-s*E-u*M)*k,t[5]=(i*E-r*T+o*M)*k,t[6]=(m*x-p*C-v*y)*k,t[7]=(l*C-f*x+d*y)*k,t[8]=(s*A-a*T+u*P)*k,t[9]=(n*T-i*A-o*P)*k,t[10]=(p*b-g*x+v*_)*k,t[11]=(c*x-l*b-d*_)*k,t[12]=(a*M-s*S-h*P)*k,t[13]=(i*S-n*M+r*P)*k,t[14]=(g*y-p*w-m*_)*k,t[15]=(l*w-c*y+f*_)*k,t):null}function Ps(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ms(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ts(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function Ss(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function As(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function Es(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function ks(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],h=i[2];return t[0]=r*h-o*a,t[1]=o*s-n*h,t[2]=n*a-r*s,t}function Rs(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.hypot?Math.hypot(i,n,r):function(){var t=0,e=arguments.length;for(;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}(i,n,r)}function Os(t,e,i){var n=e[0],r=e[1],o=e[2],s=1/(i[3]*n+i[7]*r+i[11]*o+i[15]);return t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])*s,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])*s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])*s,t}co.include({_registerDomEvents:function(){Be(this._panels.mapWrapper||this._containerDOM,_s,this._handleDOMEvent,this)},_removeDomEvents:function(){We(this._panels.mapWrapper||this._containerDOM,_s,this._handleDOMEvent)},_handleDOMEvent:function(t){var e=t.type,i="mousedown"===e||"touchstart"===e&&(!t.touches||1===t.touches.length);i&&(this._domMouseDownTime=c(),this._domMouseDownView=this.getView());var n="contextmenu"===e&&function(t){if(!t._domMouseDownView)return!0;var e=t.getView(),i=t._domMouseDownView;return e.bearing!==i.bearing||e.pitch!==i.pitch}(this);if("contextmenu"===e){$e(t);var r=this._domMouseDownTime;c()-r<=300&&!n&&this._fireDOMEvent(this,t,"dom:"+t.type)}else this._fireDOMEvent(this,t,"dom:"+t.type);if(!this._ignoreEvent(t)){var o,s=!1;if(i)this._mouseDownTime=c();else if("click"===e||"touchend"===e||"contextmenu"===e){if(!this._mouseDownTime)return;var a=this._mouseDownTime;if(delete this._mouseDownTime,c()-a>300){if("click"===e||"contextmenu"===e)return}else if("contextmenu"===e){if(n)return}else"touchend"===e&&(s=!0)}s&&(this._clickTime&&c()-this._clickTime<=300?(delete this._clickTime,o="dblclick",this._fireDOMEvent(this,t,"dom:dblclick")):(this._clickTime=c(),o="click",this._fireDOMEvent(this,t,"dom:click"))),this._ignoreEvent(t)||(this._fireDOMEvent(this,t,e),o&&this._fireDOMEvent(this,t,o))}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;if(this._isEventOutMap(t))return!0;var e,i=t.srcElement||t.target;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&e&&!e.eventsPropagation))return!0;e=i,i=i.parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var e=Xe(this._getActualEvent(t),this._containerDOM);if(!this.getContainerExtent().contains(e))return!0}return!1},_parseEvent:function(t,e){if(!t)return null;var i={domEvent:t};if("keypress"!==e){var n=this._getActualEvent(t);if(n){var r=Xe(n,this._containerDOM);i=f(i,{containerPoint:r,viewPoint:this.containerPointToViewPoint(r)});var o=this.options.maxVisualPitch;(this.getPitch()<=o||r.y>=this.height-this._getVisualHeight(o))&&(i=f(i,{coordinate:this.containerPointToCoord(r),point2d:this._containerPointToPoint(r)}))}}return i},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,i){if(!this.isRemoved()){var n=this._parseEvent(e,i);this._fireEvent(i,n)}}}),co.addOnLoadHook("_registerDomEvents"),co.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullscreen)t.requestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}}),co.include({panTo:function(t,e,i){if(void 0===e&&(e={}),!t)return this;if(_(e)&&(i=e,e={}),t=new Yi(t),void 0===e.animation||e.animation){var n=this.getProjection().project(t);return this._panAnimation(n,e.duration,i)}return this.setCenter(t),this},_panTo:function(t,e){return void 0===e&&(e={}),void 0===e.animation||e.animation?this._panAnimation(t,e.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,e,i){if(void 0===e&&(e={}),!t)return this;if(_(e)&&(i=e,e={}),t=new et(t),this.getContainerExtent().ymin>0&&t.y>30){var n=t.y;t.y=30,t.x=30*t.x/n,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(this.onMoveStart(),void 0===e.animation||e.animation){t=t.multi(-1);var r=this._containerPointToPrj(new et(this.width/2+t.x,this.height/2+t.y));this._panAnimation(r,e.duration,i)}else this._offsetCenterByPixel(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(t,e,i){return this._animateTo({prjCenter:t},{duration:e||this.options.panAnimationDuration},i)}}),Qr.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var r=Qr.fromJSON(t[i]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}return t&&!t.feature?Bo.toGeometry(t):(t.subType?(o=Qr.getJSONClass(t.subType).fromJSON(t),d(t.feature.id)||o.setId(t.feature.id)):(o=Bo.toGeometry(t.feature),t.options&&o.config(t.options)),t.symbol&&o.setSymbol(t.symbol),t.infoWindow&&o.setInfoWindow(t.infoWindow),o);var o},eo.fromJSON=function(t){if(!t)return null;var e=t.type,i=eo.getJSONClass(e);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+e);return i.fromJSON(t)},co.include({JSON_VERSION:"1.0",toJSON:function(t){t||(t={});var e={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom(),e.options.bearing=this.getBearing(),e.options.pitch=this.getPitch();var i=this.getBaseLayer();(d(t.baseLayer)||t.baseLayer)&&i&&(e.baseLayer=i.toJSON(t.baseLayer));var n={};t.clipExtent&&(!0===t.clipExtent?n.clipExtent=this.getExtent():n.clipExtent=t.clipExtent);var r=[];if(d(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var o=this.getLayers(),s=0,a=o.length;s<a;s++)if(o[s].toJSON){var h=f({},m(t.layers)?t.layers:{},n);r.push(o[s].toJSON(h))}e.layers=r}else if(mt(t.layers)){for(var u=t.layers,l=0;l<u.length;l++){var c=u[l],p=this.getLayer(c.id);if(p.toJSON){var g=f({},c.options,n);r.push(p.toJSON(g))}}e.layers=r}else e.layers=[];return e}}),co.fromJSON=function(t,e,i){if(!t||!e)return null;i||(i={});var n=new co(t,e.options);if(d(i.baseLayer)||i.baseLayer){var r=eo.fromJSON(e.baseLayer);r&&n.setBaseLayer(r)}if(d(i.layers)||i.layers){for(var o=[],s=e.layers,a=0;a<s.length;a++){var h=eo.fromJSON(s[a]);o.push(h)}n.addLayer(o)}return n},co.include({computeLength:function(t,e){if(!this.getProjection())return null;var i=new Yi(t),n=new Yi(e);return i.equals(n)?0:this.getProjection().measureLength(i,n)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,e){var i=new Yi((t=t||{}).coordinate);return this._identify(t,e,function(e){return e.identify(i,t)})},identifyAtPoint:function(t,e){var i=new et((t=t||{}).containerPoint),n=this.containerPointToCoord(i);return this._identify(t,e,function(e){return e.identifyAtPoint?e.identifyAtPoint(i,t):n?e.identify(n,t):[]})},_identify:function(t,e,i){var n=t.layers;if(!mt(n))return this;for(var r=[],o=0,s=n.length;o<s;o++)v(n[o])?r.push(this.getLayer(n[o])):r.push(n[o]);for(var a=[],h=r.length-1;h>=0&&!(t.count&&a.length>=t.count);h--){var u=r[h];if(u&&u.getMap()&&(t.includeInvisible||u.isVisible())&&(t.includeInternals||!(u.getId().indexOf("_maptalks__internal_layer_")>=0))){var l=i(u);l&&(Array.isArray(l)?at(a,l):a.push(l))}}return e.call(this,a),this}}),co.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,i){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,i)))},_checkZoomOrigin:function(t){return t&&!this.options.zoomInCenter||(t=new et(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new et(this.options.zoomOrigin)),t},_startZoomAnim:function(t,e,i){d(i)&&(i=1);var n=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(n-i)/Math.abs(n-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,i){if(this.options.zoomable&&this._frameZoom!==t){d(i)&&(i=1),this._zoomTo(t,e);var n=this.getResolution(t),r=this.getResolution(this._startZoomVal)/n/i,o=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),s=this.getViewPoint();if(!this.isRotating()&&!o.equals(e)&&1!==r){var a=this.getPitch(),h=o._sub(e)._multi(1/(1-r));a&&(h.y/=Math.cos(a*Math.PI/180)),e=e.add(h)}var u={view:[r,0,0,r,(e.x-s.x)*(1-r),(e.y-s.y)*(1-r)]},l=this.getDevicePixelRatio();1!==l&&(e=e.multi(l)),u.container=[r,0,0,r,e.x*(1-r),e.y*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:e,matrix:u}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var i=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:i,to:t}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,e){this._zoomLevel=t,this._calcMatrices(),e&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,e)},_checkZoom:function(t){var e=this.getMaxZoom(),i=this.getMinZoom();return t<i&&(t=i),t>e&&(t=e),t}});var Ls,Ds,Is,js,zs,Hs,Fs,Ns,Zs,Gs=Math.PI/180,Bs=new Yi(0,0);function Ws(){return Ps(new Array(16))}co.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/Gs},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*Gs,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/Gs:0},setBearing:function(t){if(q.ie9)throw new Error("map can't rotate in IE9.");var e=-pt(t,-180,180)*Gs;if(this._angle===e)return this;var i=this.getBearing();return this._fireEvent("rotatestart",{from:i,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:i,to:e}),this._fireEvent("rotateend",{from:i,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){if(q.ie9)throw new Error("map can't tilt in IE9.");var e=gt(t,0,this.options.maxPitch)*Gs;if(this._pitch===e)return this;var i=this.getPitch();return this._fireEvent("pitchstart",{from:i,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:i,to:e}),this._fireEvent("pitchend",{from:i,to:e}),this},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,i=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return i;e=Math.PI*e/180;var n=new et(this.cameraPosition).distanceTo(new et(this.cameraLookAt)),r=i*Math.tan(2*e);return i+Math.tan(e)*(n+r)},_pointToContainerPoint:function(t,e,i,n){void 0===i&&(i=0);var r=this._getResolution(e);return this._pointAtResToContainerPoint(t,r,i,n)},_pointAtResToContainerPoint:function(t,e,i,n){void 0===i&&(i=0),n||(n=new et(0,0)),t=this._pointAtResToPoint(t,e,n);var r,o=this.isTransforming(),s=e/this._getResolution();return o||i||(r=this._prjToPoint(this._getPrjCenter(),void 0,Bs)),this._toContainerPoint(n,o,s,i,r),n},_pointsAtResToContainerPoints:function(t,e,i,n){void 0===i&&(i=[]),void 0===n&&(n=[]);var r=this.getPitch(),o=this.getBearing();if(0===r&&0===o){var s=this._get2DExtent(),a=s.xmin,h=s.ymin,u=s.xmax,l=s.ymax;if(u>a&&l>h){for(var c=e/this._getResolution(),f=this.getSize(),d=f.width,p=f.height,g=(u-a)/d,m=(l-h)/p,v=0,_=t.length;v<_;v++)if(t[v]){var y=n[v];y.x=t[v].x,y.y=t[v].y,y._multi(c),y.x=(y.x-a)*g,y.y=p-(y.y-h)*m}else n[v]=null;return n}}for(var x=Array.isArray(i),w=this.isTransforming(),b=e/this._getResolution(),C=this._prjToPoint(this._getPrjCenter(),void 0,Bs),P=0,M=t.length;P<M;P++)if(t[P]){var T=n[P];T.x=t[P].x,T.y=t[P].y,T._multi(b);var S=x?i[P]||0:i;this._toContainerPoint(T,w,b,S,C)}else n[P]=null;return n},_toContainerPoint:(Zs=[0,0,0],function(t,e,i,n,r){var o=this.width/2,s=this.height/2;if(e||n){n*=i;var a=this._glScale;Ts(Zs,t.x*a,t.y*a,n*a);var h=this._projIfBehindCamera(Zs,this.cameraPosition,this.cameraForward);Os(h,h,this.projViewMatrix),t.x=h[0]*o+o,t.y=-h[1]*s+s}else t._sub(r.x,r.y),t.set(t.x,-t.y),t._add(o,s)}),_projIfBehindCamera:(Hs=new Array(3),Fs=new Array(3),Ns=new Array(3),function(t,e,i){Ss(Hs,t,e);var n,r,o=(r=Hs,(n=i)[0]*r[0]+n[1]*r[1]+n[2]*r[2]);return o<=0&&(function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(Fs,i,1.01*o),function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(t,e,Ss(Ns,Hs,Fs))),t}),_containerPointToPoint:function(t,e,i){var n=this._getResolution(e);return this._containerPointToPointAtRes(t,n,i)},_containerPointToPointAtRes:(Is=[0,0,0],js=[0,0,0,1],zs=[0,0,0,1],function(t,e,i){if(this.isTransforming()){var n=this.width/2||1,r=this.height/2||1;Ts(Is,(t.x-n)/n,(r-t.y)/r,0),Ts(js,Is[0],Is[1],0),Ts(zs,Is[0],Is[1],1),js[3]=zs[3]=1,Os(js,js,this.projViewMatrixInverse),Os(zs,zs,this.projViewMatrixInverse);var o=js[0],s=zs[0],a=js[1],h=zs[1],u=js[2],l=zs[2],c=u===l?0:(0-u)/(l-u),f=dt(o,s,c),d=dt(a,h,c);return i?(i.x=f,i.y=d):i=new et(f,d),i._multi(1/this._glScale),this._getResolution()===e?i:this._pointToPointAtRes(i,e,i)}var p=this._prjToPointAtRes(this._getPrjCenter(),e,i),g=this._getResolution()/e,m=g*(t.x-this.width/2),v=g*(t.y-this.height/2);return p._add(m,-v)}),_calcMatrices:(Ds=Ws(),function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var t=this.getSize(),e=t.width||1,i=t.height||1;this._glScale=this.getGLScale();var n=this._getCameraWorldMatrix(),r=this.getFov()*Math.PI/180,o=this._getCameraFar(r,this.getPitch());this.cameraFar=o,this.cameraNear=Math.max(this.cameraCenterDistance/10,.1);var s=this.projMatrix||Ws();ys(s,r,e/i,this.cameraNear,o),this.projMatrix=s,this.viewMatrix=Cs(this.viewMatrix||Ws(),n),this.projViewMatrix=bs(this.projViewMatrix||Ws(),s,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=bs(this.projViewMatrixInverse||Ws(),n,Cs(Ds,s)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtentAtRes(this._mapGlRes)}),_getCameraFar:function(t,e){var i=this.cameraCenterDistance=Rs(this.cameraPosition,this.cameraLookAt),n=i,r=4*i;if(e>0&&(e=e*Math.PI/180,2/Math.PI-e>t/2)){var o=Math.tan(t/2),s=Math.tan(e);r=Math.max(i*o/(1/s-o),r)}return(n+=r)+1},_calcCascadeMatrixes:function(){var t=Ws();function e(e,i,n){var r=this.width,o=this.height,s=this.getFov()*Math.PI/180,a=this._getCameraFar(s,i),h=this.cameraCenterDistance;a=h+(a-h)/Math.cos((90-i)*Math.PI/180)*Math.cos((90-e)*Math.PI/180),ys(t,s,r/o,.1,a);var u=this.viewMatrix;return bs(n,t,u)}return function(){var t=this.getPitch(),i=this.options.cascadePitches[0],n=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||Ws(),o=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||Ws();t>i?e.call(this,t,i,r):Ms(this.cascadeFrustumMatrix0,this.projViewMatrix),t>n?e.call(this,t,n,o):Ms(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var t=Ws(),e=Ws(),i=[1,-1,1],n=[0,0,0];return function(){var r,o,s,a,h,u,l,c,f,d,p,g,m,v=this.width||1,_=this.height||1,y=.5/Math.tan(this._fov/2)*_;return ws(t,this.projMatrix,i),xs(t,t,Ts(n,0,0,-y)),this._pitch&&(r=t,o=t,s=this._pitch,a=Math.sin(s),h=Math.cos(s),u=o[4],l=o[5],c=o[6],f=o[7],d=o[8],p=o[9],g=o[10],m=o[11],o!==r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15]),r[4]=u*h+d*a,r[5]=l*h+p*a,r[6]=c*h+g*a,r[7]=f*h+m*a,r[8]=d*h-u*a,r[9]=p*h-l*a,r[10]=g*h-c*a,r[11]=m*h-f*a),this._angle&&function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],u=e[4],l=e[5],c=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*n,t[1]=s*r+l*n,t[2]=a*r+c*n,t[3]=h*r+f*n,t[4]=u*r-o*n,t[5]=l*r-s*n,t[6]=c*r-a*n,t[7]=f*r-h*n}(t,t,this._angle),Ps(e),ws(e,e,Ts(n,v/2,-_/2,1)),bs(this.domCssMatrix||Ws(),e,t)}}(),_getFovZ:function(t){var e=this.getGLScale(t),i=this._getFovRatio();return e*(this.height||1)/2/i},_getCameraWorldMatrix:(Ls={},function(){var t=this.getGLRes(),e=this._prjToPointAtRes(this._prjCenter,t);this.cameraLookAt=Ts(this.cameraLookAt||[0,0,0],e.x,e.y,0);var i=this.getPitch()*Gs,n=this.getBearing()*Gs,r=this._getFovZ(),o=r*Math.cos(i),s=Math.sin(i)*r,a=e.x-s*Math.sin(n),h=e.y-s*Math.cos(n);this.cameraPosition=Ts(this.cameraPosition||[0,0,0],a,h,o),this.cameraToCenterDistance=Rs(this.cameraPosition,this.cameraLookAt);var u=s||1,l=this.cameraUp=Ts(this.cameraUp||[0,0,0],Math.sin(n)*u,Math.cos(n)*u,0),c=this.cameraWorldMatrix=this.cameraWorldMatrix||Ws();!function(t,e,i,n){var r=[0,0,0],o=[0,0,0],s=[0,0,0];Ss(s,e,i),0===As(s)&&(s[2]=1),Es(s,s),ks(r,n,s),0===As(s)&&(1===Math.abs(n[2])?s[0]+=1e-4:s[2]+=1e-4,Es(s,s),ks(r,n,s)),Es(r,r),ks(o,s,r),t[0]=r[0],t[4]=o[0],t[8]=s[0],t[1]=r[1],t[5]=o[1],t[9]=s[1],t[2]=r[2],t[6]=o[2],t[10]=s[2]}(c,this.cameraPosition,this.cameraLookAt,l);var f,d,p,g=this.cameraForward||[0,0,0];return Ss(g,this.cameraLookAt,this.cameraPosition),this.cameraForward=Es(g,g),function(t,e){var i,n=e[0],r=e[4],o=e[8],s=e[1],a=e[5],h=e[9],u=e[2],l=e[6],c=e[10],f=n+a+c;f>0?(i=.5/Math.sqrt(f+1),t.w=.25/i,t.x=(l-h)*i,t.y=(o-u)*i,t.z=(s-r)*i):n>a&&n>c?(i=2*Math.sqrt(1+n-a-c),t.w=(l-h)/i,t.x=.25*i,t.y=(r+s)/i,t.z=(o+u)/i):a>c?(i=2*Math.sqrt(1+a-n-c),t.w=(o-u)/i,t.x=(r+s)/i,t.y=.25*i,t.z=(h+l)/i):(i=2*Math.sqrt(1+c-n-a),t.w=(s-r)/i,t.x=(o+u)/i,t.y=(h+l)/i,t.z=.25*i)}(Ls,c),function(t,e){var i=t,n=e.x,r=e.y,o=e.z,s=e.w,a=n+n,h=r+r,u=o+o,l=n*a,c=n*h,f=n*u,d=r*h,p=r*u,g=o*u,m=s*a,v=s*h,_=s*u;i[0]=1-(d+g),i[4]=c-_,i[8]=f+v,i[1]=c+_,i[5]=1-(l+g),i[9]=p-m,i[2]=f-v,i[6]=p+m,i[10]=1-(l+d),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1}(c,Ls),f=c,d=this.cameraPosition,(p=f)[12]=d[0],p[13]=d[1],p[14]=d[2],c}),_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*Gs)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach(function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}})}}),co.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),i=this._viewHistory.length-1;i>=0;i--)if(Tt(t,this._viewHistory[i]))return this._viewHistoryPointer=i,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var n=this.options.viewHistoryCount;n>0&&this._viewHistory.length>n&&this._viewHistory.splice(0,this._viewHistory.length-n),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(t){if(void 0===t&&(t={}),!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(t){if(void 0===t&&(t={}),!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,e){var i=this,n=this.getView();e.animation?this._animateTo(t,{duration:e.duration},function(e){"finished"===e.state.playState&&i._fireViewChange(n,t)}):(this.setView(t),this._fireViewChange(n,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e})},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),co.mergeOptions({viewHistory:!0,viewHistoryCount:10}),co.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new Vi,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this}});var Vs=function(t){function e(e){var i;return(i=t.call(this,e)||this).on("enable",i._afterEnable,X(X(i))).on("disable",i._afterDisable,X(X(i))),i._measureLayers=[],i}Y(e,t);var i=e.prototype;return i.clear=function(){if(mt(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},i.getMeasureLayers=function(){return this._measureLayers},i.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},i.undo=function(){t.prototype.undo.call(this);var e=this._historyPointer;if(e!==this._vertexes.length)for(var i=e;i<this._vertexes.length;i++)this._vertexes[i].label&&this._vertexes[i].label.remove(),this._vertexes[i].marker.remove();return this},i.redo=function(){t.prototype.redo.call(this);var e=this._historyPointer-1;return this._vertexes[e]&&(this._vertexes[e].marker.getLayer()||(this._vertexes[e].label&&this._vertexes[e].label.addTo(this._measureMarkerLayer),this._vertexes[e].marker.addTo(this._measureMarkerLayer))),this},i._measure=function(t){var e,i,n=this.getMap();t instanceof Qr?e=n.computeGeometryLength(t):Array.isArray(t)&&(e=n.getProjection().measureLength(t)),this._lastMeasure=e,i="zh-CN"===this.options.language?[" 米"," 公里"," 英尺"," 英里"]:[" m"," km"," feet"," mile"];var r="";return this.options.metric&&(r+=e<1e3?e.toFixed(0)+i[0]:(e/1e3).toFixed(2)+i[1]),this.options.imperial&&(e*=3.2808399,r.length>0&&(r+="\n"),r+=e<5280?e.toFixed(0)+i[2]:(e/5280).toFixed(2)+i[3]),r},i._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},i._afterEnable=function(){this._registerMeasureEvents()},i._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},i._msOnDrawStart=function(t){var e=this.getMap(),i=e._pointToPrj(t.point2d),n=ot(),r="distancetool_"+n,o="distancetool_markers_"+n;e.getLayer(r)?(this._measureLineLayer=e.getLayer(r),this._measureMarkerLayer=e.getLayer(o)):(this._measureLineLayer=new ls(r).addTo(e),this._measureMarkerLayer=new ls(o).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer);var s=new Ro(t.coordinate,{symbol:this.options.vertexSymbol});s._setPrjCoordinates(i);var a="zh-CN"===this.options.language?"起点":"start",h=new is(a,t.coordinate,this.options.labelOptions);h._setPrjCoordinates(i),this._lastVertex=h,this._addVertexMarker(s,h)},i._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var i=Ee(this.options.vertexSymbol);i.markerWidth/=2,i.markerHeight/=2,this._tailMarker=new Ro(t.coordinate,{symbol:i}).addTo(this._measureMarkerLayer),this._tailLabel=new is(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var n=this._geometry._getPrjCoordinates(),r=n[n.length-1];this._tailMarker.setCoordinates(t.coordinate),this._tailMarker._setPrjCoordinates(r),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(t.coordinate),this._tailLabel._setPrjCoordinates(r)},i._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this._geometry._getPrjCoordinates(),i=e[e.length-1],n=t.geometry,r=new Ro(t.coordinate,{symbol:this.options.vertexSymbol}),o=this._measure(n),s=new is(o,t.coordinate,this.options.labelOptions);this._addVertexMarker(r,s),s._setPrjCoordinates(i),r._setPrjCoordinates(i),this._lastVertex=s},i._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:e,marker:t}),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},i._msOnDrawEnd=function(t){if(this._clearTailMarker(),t.geometry._getPrjCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var e=this._lastVertex.getSize();e||(e=new he(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var i=t.geometry.copy();i._setPrjCoordinates(t.geometry._getPrjCoordinates()),i.addTo(this._measureLineLayer),this._lastMeasure=i.getLength()},i._addClearMarker=function(t,e,i){var n=this.options.clearButtonSymbol,r={markerDx:(n.markerDx||0)+i,textDx:(n.textDx||0)+i};Array.isArray(n)&&(r=n.map(function(t){return t?{markerDx:(t.markerDx||0)+i,textDx:(t.textDx||0)+i}:null})),n=Ee(n,r);var o=new Ro(t,{symbol:n}),s=this._measureLineLayer,a=this._measureMarkerLayer;o.on("click",function(){return s.remove(),a.remove(),!1},this),o.addTo(this._measureMarkerLayer),o._setPrjCoordinates(e)},i._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},i._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},e}(ps);Vs.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});(function(t){function e(e){var i;return(i=t.call(this,e)||this).on("enable",i._afterEnable,X(X(i))).on("disable",i._afterDisable,X(X(i))),i._measureLayers=[],i}Y(e,t);var i=e.prototype;return i._measure=function(t){var e,i,n=this.getMap();t instanceof Qr?e=n.computeGeometryArea(t):Array.isArray(t)&&(e=n.getProjection().measureArea(t)),this._lastMeasure=e,i="zh-CN"===this.options.language?[" 平方米"," 平方公里"," 平方英尺"," 平方英里"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];var r="";if(this.options.metric&&(r+=e<1e6?e.toFixed(0)+i[0]:(e/1e6).toFixed(2)+i[1]),this.options.imperial){e*=3.2808399,r.length>0&&(r+="\n");r+=e<27878400?e.toFixed(0)+i[2]:(e/27878400).toFixed(2)+i[3]}return r},i._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this.getMap()._pointToPrj(t.point2d),i=new Ro(t.coordinate,{symbol:this.options.vertexSymbol});i._setPrjCoordinates(e),this._measure(t.geometry),this._lastVertex=i,this._addVertexMarker(i)},i._msOnDrawEnd=function(t){var e;if(this._clearTailMarker(),t.point2d)e=this.getMap()._pointToPrj(t.point2d);else{var i=t.geometry._getPrjCoordinates();i=i.slice(0,i.length-1),t.geometry._setPrjCoordinates(i),e=i[i.length-1]}if(t.geometry._getPrjCoordinates().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var n=this._measure(t.geometry),r=this.getMap().getProjection().unproject(e),o=new is(n,r,this.options.labelOptions).addTo(this._measureMarkerLayer);o._setPrjCoordinates(e);var s=o.getSize();s||(s=new he(10,10)),this._addClearMarker(r,e,s.width);var a=t.geometry.copy();a._setPrjCoordinates(t.geometry._getPrjCoordinates()),a.addTo(this._measureLineLayer),this._lastMeasure=a.getArea()},e})(Vs).mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}});var $s={create:function(t,e){var i=t.unproject(e[0]),n=new Wo(i,0);return n._setPrjCoordinates(e[0]),n},update:function(t,e,i){var n=i.getMap(),r=Array.isArray(e)?e[e.length-1]:e,o=t.unproject(r),s=n.computeLength(i.getCenter(),o);i.setRadius(s)},generate:function(t){return t}};ps.registerMode("circle",f({clickLimit:2,action:["click","mousemove","click"]},$s)),ps.registerMode("freeHandCircle",f({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},$s));var Us={create:function(t,e){var i=t.unproject(e[0]),n=new Vo(i,0,0);return n._setPrjCoordinates(e[0]),n},update:function(t,e,i){var n=i.getMap(),r=i.getCenter(),o=Array.isArray(e)?e[e.length-1]:e,s=t.unproject(o),a=n.computeLength(r,new Yi({x:s.x,y:r.y})),h=n.computeLength(r,new Yi({x:r.x,y:s.y}));i.setWidth(2*a),i.setHeight(2*h)},generate:function(t){return t}};ps.registerMode("ellipse",f({clickLimit:2,action:["click","mousemove","click"]},Us)),ps.registerMode("freeHandEllipse",f({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Us));var Js={create:function(t,e){var i=new Ao([]);return i._firstClick=e[0],i},update:function(t,e,i,n){var r=i.getMap(),o=n.containerPoint,s=r._prjToContainerPoint(i._firstClick),a=[[s.x,s.y],[o.x,s.y],[o.x,o.y],[s.x,o.y]];i.setCoordinates(a.map(function(t){return r.containerPointToCoord(new et(t))})),i._setPrjCoordinates(a.map(function(t){return r._containerPointToPrj(new et(t))}))},generate:function(t){return t}};ps.registerMode("rectangle",f({clickLimit:2,action:["click","mousemove","click"]},Js)),ps.registerMode("freeHandRectangle",f({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Js)),ps.registerMode("point",{clickLimit:1,action:["click"],create:function(t,e){var i=t.unproject(e[0]),n=new Ro(i);return n._setPrjCoordinates(e[0]),n},generate:function(t){return t}});var qs={create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new Lo(i);return n._setPrjCoordinates(e),n},update:function(t,e,i){var n,r=i.getSymbol();Array.isArray(e)?n=e:(n=i._getPrjCoordinates()).push(e);var o=n.map(function(e){return t.unproject(e)});i.setCoordinates(o),i._setPrjCoordinates(n);var s=i.getLayer();if(s){var a=s.getGeometryById("polygon");if(!a&&n.length>=3){if(a=new Ao([o],{id:"polygon"}),r){var h=Ee(r,{lineOpacity:0});a.setSymbol(h)}a.addTo(s)}a&&a._setPrjCoordinates(n)}},generate:function(t){var e=new Ao(t.getCoordinates(),{symbol:t.getSymbol()});return e._setPrjCoordinates(t._getPrjCoordinates()),e._projCode=t._projCode,e}};ps.registerMode("polygon",f({action:["click","mousemove","dblclick"]},qs)),ps.registerMode("freeHandPolygon",f({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},qs));var Ys={create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new Lo(i);return n._setPrjCoordinates(e),n},update:function(t,e,i){var n;Array.isArray(e)?n=e:(n=i._getPrjCoordinates()).push(e);var r=n.map(function(e){return t.unproject(e)});i.setCoordinates(r),i._setPrjCoordinates(n)},generate:function(t){return t}};function Xs(t){for(var e=t.tileInfo,i=[e.cols,e.rows],n=[],r=e.lods,o=0,s=r.length;o<s;o++)n.push(r[o].resolution);var a=t.fullExtent,h=e.origin,u=[1,-1,h.x,h.y];return delete a.spatialReference,{spatialReference:{resolutions:n,fullExtent:a},tileSystem:u,tileSize:i}}function Ks(t,e){return void 0===e&&(e=[]),e.forEach(function(e){var i=e[0],n=e[1];t=t.replace(i,n)}),t}function Qs(t){var e=t.projection,i=t.isArcgis,n=t.isGeoServer,r=t.isSuperMap,o=.0002645833333333333;return(i||n||r)&&(o=28e-5),e&&e.indexOf("4326")>-1&&(o=2.3767925226029154e-9,(i||r)&&(o=2.518101729011901e-9),n&&(o=2.51528279553466e-9)),o}function ta(t,e){for(var i=0;i<t.length;i++){var n=t[i];if((n=n.getElementsByTagName("ows:Identifier")[0])&&n.textContent===e)return t[i]}return null}function ea(t,e){void 0===e&&(e={});var i,n,r,o=t.getElementsByTagName("TileMatrix"),s=[],a=[],h=[],u=!1;if(!i){var l=t.getElementsByTagName("ows:SupportedCRS")[0];l&&(i=function(t){var e=t.indexOf("EPSG")>-1?t:"EPSG:"+t;return e=Ks(e,[["4490","4326"],["102100","3857"],["900913","3857"]])}(i=function(t){for(var e="",i=t.split(""),n=i.length-1;n>=0&&!isNaN(i[n]);n--)e=i[n]+e;return e}(i=(i=l.textContent).split("EPSG")[1])))}n||(n=t.getElementsByTagName("ows:Identifier")[0])&&(n=n.textContent),e.projection=i;for(var c=1/0,f=0;f<o.length;f++){var d=o[f],p=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(p))?(r=p.substr(0,p.lastIndexOf(":")),p=(p=p.split(":"))[p.length-1],p=parseInt(p),u=!0,e.isGeoServer=!0):p=parseInt(p),c=Math.min(c,p);var g=d.getElementsByTagName("ScaleDenominator")[0].textContent,m=d.getElementsByTagName("TopLeftCorner")[0].textContent,v=d.getElementsByTagName("TileWidth")[0].textContent,_=d.getElementsByTagName("TileHeight")[0].textContent;if(0===h.length&&h.push(parseInt(v),parseInt(_)),0===a.length){var y=m.split(" ").filter(function(t){return""!==t}).map(function(t){return parseFloat(t)}),x=y[0],w=y[1];x>0?a.push(1,-1,w,x):a.push(1,-1,x,w)}var b=Qs(e),C=parseFloat(g)*b;s.push(C)}if(c>0)for(var P=s[0],M=c-1;M>=0;M--)P*=2,s.splice(0,0,P);return{resolutions:s,tileSize:h,tileSystem:a,projection:i,TileMatrixSet:n,isGeoServer:u,levelStr:r}}ps.registerMode("linestring",f({action:["click","mousemove","dblclick"]},Ys)),ps.registerMode("freeHandLinestring",f({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Ys)),ps.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new qo(i);return n._setPrjCoordinates(e),n},update:Ys.update,generate:function(t){return t}}),ps.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new Xo(i);return n._setPrjCoordinates(e),n},update:Ys.update,generate:function(t){return t}}),ps.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map(function(e){return t.unproject(e)}),n=new Yo(i);return n._setPrjCoordinates(e),n},update:Ys.update,generate:function(t){return t}}),ps.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t,e){e=e[0];var i=t.unproject(e),n=new Ro(i);return n._firstClick=e,n},update:function(t,e,i,n){var r=i.getMap(),o=r._prjToContainerPoint(i._firstClick),s=n.containerPoint;e=r._containerPointToPrj(new Yi(Math.min(o.x,s.x),Math.min(o.y,s.y)));var a=t.unproject(e);i.setCoordinates(a)._setPrjCoordinates(e),i.updateSymbol({markerWidth:Math.abs(o.x-s.x),markerHeight:Math.abs(o.y-s.y)})},generate:function(t){return t}}),Yr.loadArcgis=function(t,e,i){if(void 0===i&&(i={jsonp:!0}),v(t)&&"{"!==t.substring(0,1))li.getJSON(t,function(t,i){if(t)e(t);else{var n=Xs(i);e(null,n)}},i);else{v(t)&&(t=st(t));var n=Xs(t);e(null,n)}return this},Yr.loadWMTS=function(t,e,i){return void 0===i&&(i={jsonp:!0}),v(t)&&li.get(t,function(n,r){if(n)e(n);else{var o=function(t,e,i){null==i.isArcgis&&(i.isArcgis=t.indexOf("arcgis")>-1),null==i.isSuperMap&&(i.isSuperMap=t.indexOf("supermap")>-1);var n=(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("Contents")[0];if(!n)return[];var r=n.getElementsByTagName("Layer");if(!r.length)return[];for(var o=[],s=0,a=n.childNodes.length;s<a;s++)"TileMatrixSet"===n.childNodes[s].nodeName&&o.push(n.childNodes[s]);if(!o.length)return[];for(var h=[],u=0,l=r.length;u<l;u++){var c=r[u],f=c.querySelectorAll("Style")[0];f&&(f=f.getElementsByTagName("ows:Identifier")[0])&&(f=f.textContent);var d=c.getElementsByTagName("ows:Identifier")[0];d&&(d=d.textContent);var p=c.getElementsByTagName("TileMatrixSetLink");if(0!==p.length)for(var g=0,m=p.length;g<m;g++){var v=p[g];(v=v.getElementsByTagName("TileMatrixSet")[0])&&(v=v.textContent);var _=ta(o,v);if(_){var y=c.querySelectorAll("ResourceURL")[0],x="";y&&(x=y.attributes.template.value);var w=ea(_,i),b=w.resolutions,C=w.tileSize,P=w.tileSystem,M=w.projection,T=w.TileMatrixSet,S=w.isGeoServer,A=w.levelStr;x.length||(x=e.substr(0,e.lastIndexOf("?")),x+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var E=Ks(x,[["{LAYER}",d],["{Layer}",d],["{layer}",d],["{STYLE}",f],["{Style}",f],["{style}",f],["{TileMatrixSet}",T],["{TileMatrix}",S?A+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",S?"image/png":"tiles"]]);h.push({tileSize:C,tileSystem:P,spatialReference:{resolutions:b,projection:M},urlTemplate:E,info:{layerName:d,TileMatrixSet:T,style:f,tileSize:C,tileSystem:P,resolutions:b,projection:M,urlTemplate:E}})}}}return h}(r,t,i);e(null,o)}},i),this};var ia=function(t){function e(e){return t.call(this,e)||this}Y(e,t);var i=e.prototype;return i.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i.show=function(t){var e=this.getMap();if(!e)return this;this.options.visible=!0,this._mapEventsOn||this._switchMapEvents("on"),t=t||this._coordinate||this._owner.getCenter();var i=this.isVisible();this.fire("showstart");var n=this._getUIContainer();this._coordinate=t,this._removePrevDOM();var r=this.__uiDOM=this.buildOn(e);if(r.eventsPropagation=this.options.eventsPropagation,!r)return this.fire("showend"),this;this._measureSize(r),this._singleton()&&(e[this._uiDomKey()]=r),this._setPosition(),r.style[Fe]=null,n.appendChild(r);var o=this._getAnimation();if(i&&(o.ok=!1),o.ok&&(o.fade&&(r.style.opacity=0),o.scale)){if(this.getTransformOrigin){var s=this.getTransformOrigin();r.style[He]=s}r.style[ze]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(r.style.display=""),this.options.eventsToStop&&ai(r,this.options.eventsToStop,Ue),this.options.autoPan&&this._autoPan();var a=o.transition;return o.ok&&a&&(r.offsetHeight,a&&(r.style[Fe]=a),o.fade&&(r.style.opacity=1),o.scale&&(r.style[ze]=this._toCSSTranslate(this._pos)+" scale(1)")),this.fire("showend"),this},i.hide=function(){var t=this;if(!this.getDOM())return this;this.options.visible=!1;var e=this._getAnimation(),i=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(i.offsetHeight,i.style[Fe]=e.transition,setTimeout(function(){i.style.display="none",t.fire("hide")},this.options.animationDuration)):(i.style.display="none",this.fire("hide")),e.fade&&(i.style.opacity=0),e.scale&&(i.style[ze]=this._toCSSTranslate(this._pos)+" scale(0)"),this},i.isVisible=function(){if(!this.options.visible)return!1;var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},i.remove=function(){return delete this._mapEventsOn,this._owner?(this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this):this},i.getSize=function(){return this._size?this._size.copy():null},i.getOwner=function(){return this._owner},i.getDOM=function(){return this.__uiDOM},i._roundPoint=function(t){return this.options.roundPoint&&(t=t._round()),t},i.getPosition=function(){if(!this.getMap())return null;var t=this._roundPoint(this._getViewPoint());if(this.getOffset){var e=this._roundPoint(this.getOffset());e&&t._add(e)}return t},i._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],i=0;i<e.length;i++){var n=ue(e[i]);"fade"===n?t.fade=!0:"scale"===n&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=ze+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},i._getViewPoint=function(){var t=0;if(this._owner&&this._owner.getAltitude){var e=this._owner.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},i._meterToPoint=function(t,e){return this.getMap().distanceToPoint(e,0,void 0,t).x*ct(e)},i._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!t.isMoving()){var i=this._getViewPoint()._round(),n=t.width,r=t.height,o=t.viewPointToContainerPoint(i),s=this.getOffset(),a=o.add(s),h=t._viewPointToPrj(i),u=parseInt(e.clientWidth),l=parseInt(e.clientHeight),c=0,f=0;if(a.x<0?c=50-a.x:a.x+u>n&&(c=-(a.x+u-n)-50),a.y<0?f=50-a.y:a.y+l>r&&(f=r-(a.y+l)-50),0!==f||0!==c){var d=o.add(c,f),p=t._containerPointToPoint(d)._sub(t._prjToPoint(t._getPrjCenter())),g=t._pointToPrj(t._prjToPoint(h).sub(p));t._panAnimation(g)}}},i._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute",t.style.left="-99999px";var i=t.style.bottom?"bottom":"top";return t.style[i]="-99999px",t.style.display="",e.appendChild(t),this._size=new he(t.clientWidth,t.clientHeight),t.style.display="none",t.style.left="0px",t.style[i]="0px",this._size},i._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),i=this._uiDomKey();e[i]&&(t&&hi(e[i],t,Ue),Ge(e[i]),delete e[i]),delete this.__uiDOM}else this.__uiDOM&&(t&&hi(this.__uiDOM,t,Ue),Ge(this.__uiDOM),delete this.__uiDOM)},i._uiDomKey=function(){return"__ui_"+this._getClassName()},i._singleton=function(){return this.options.single},i._getUIContainer=function(){return this.getMap()._panels.ui},i._getClassName=function(){return"UIComponent"},i._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var i=this._getDefaultEvents();if(this.getEvents&&f(i,this.getEvents()),i)for(var n in i)i.hasOwnProperty(n)&&e[t](n,i[n],this)}},i._switchEvents=function(t){this._switchMapEvents(t);var e=this._getOwnerEvents();if(this._owner)for(var i in e)e.hasOwnProperty(i)&&this._owner[t](i,e[i],this)},i._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,resize:this.onResize}},i._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof Qr&&(t.positionchange=this.onGeometryPositionChange),this.getOwnerEvents&&f(t,this.getOwnerEvents()),t},i.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&this.show(t.target.getCenter())},i.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.onEvent=function(){this.isVisible()&&this._updatePosition()},i.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.onResize=function(){this.isVisible()&&this._setPosition()},i._updatePosition=function(){this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this))},i._setPosition=function(){var t=this.getDOM();if(t){t.style[Fe]=null;var e=this.getPosition();this._pos=e,t.style[ze]=this._toCSSTranslate(e)+" scale(1)"}},i._toCSSTranslate=function(t){if(!t)return"";if(q.any3d){var e=this.getMap(),i=e?e.getBearing():0,n=e?e.getPitch():0,r="";return this.options.pitchWithMap&&n&&(r+=" rotateX("+Math.round(n)+"deg)"),this.options.rotateWithMap&&i&&(r+=" rotateZ("+Math.round(-i)+"deg)"),"translate3d("+t.x+"px,"+t.y+"px, 0px)"+r}return"translate("+t.x+"px,"+t.y+"px)"},i.isSupportZoomFilter=function(){return!1},e.isSupport=function(t){return!!(t&&_(t.on)&&_(t.off)&&_(t.getCenter))},e}(Ci(Mi));ia.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!0,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1});var na="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",ra=function(t){function e(e,i){var n;return(n=t.call(this,i)||this)._markerCoord=new Yi(e),n}Y(e,t);var i=e.prototype;return i._getClassName=function(){return"UIMarker"},i.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition()),this},i.getCoordinates=function(){return this._markerCoord},i.getCenter=function(){return this.getCoordinates()},i.getAltitude=function(){return this.options.altitude||0},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},i.getContent=function(){return this.options.content},i.onAdd=function(){this.show()},i.show=function(){return t.prototype.show.call(this,this._markerCoord)},i.flash=function(t,e,i,n){return At.call(this,t,e,i,n)},i.buildOn=function(){var t;return v(this.options.content)?(t=Ne("div")).innerHTML=this.options.content:t=this.options.content,this.options.containerClass&&(t.className=this.options.containerClass),this._registerDOMEvents(t),t},i.getOffset=function(){var t=this.getSize();return new et(-t.width/2,-t.height/2)},i.getTransformOrigin=function(){return"center center"},i.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},i.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},i._registerDOMEvents=function(t){ai(t,na,this._onDomEvents,this)},i._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type);this.fire(t.type,e)},i._removeDOMEvents=function(t){hi(t,na,this._onDomEvents,this)},i._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),i=this.getSize(),n=i.width,r=i.height;return[t.containerPointToCoordinate(e.add(-n/2,0)),t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},i._getViewPoint=function(){var t=0;if(this._owner){var e=this.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},i._getDefaultEvents=function(){return f({},t.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},i._setPosition=function(){this.onZoomFilter(),t.prototype._setPosition.call(this)},i.onZoomFilter=function(){var t=this.getDOM();t&&(this.isVisible()||"none"===t.style.display?this.isVisible()&&"none"===t.style.display&&(t.style.display=""):t.style.display="none")},i.isVisible=function(){var t=this.getMap();if(!t)return!1;if(!this.options.visible)return!1;var e=t.getZoom(),i=this.options,n=i.minZoom,r=i.maxZoom;return!(!d(n)&&e<n||!d(r)&&e>r)&&(this.getDOM()&&!0)},i.isSupportZoomFilter=function(){return!0},e}($i(ia));ra.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null});var oa=q.touch?"touchstart mousedown":"mousedown",sa=function(t){function e(e){return t.call(this,e)||this}Y(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on(oa,this._startDrag,this)},i.removeHooks=function(){this.target.off(oa,this._startDrag,this)},i._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},i._prepareDragHandler=function(){this._dragHandler=new qi(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},i._onMouseDown=function(t){Ue(t.domEvent)},i._dragging=function(t){var e=this.target,i=e.getMap()._parseEvent(t.domEvent),n=i.domEvent;if(!(n.touches&&n.touches.length>1))if(this._isDragging){var r=i.coordinate,o=i.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=o);var s=r.sub(this._lastCoord),a=o.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=o,this.target.setCoordinates(this.target.getCoordinates().add(s)),i.coordOffset=s,i.pointOffset=a,e.fire("dragging",i)}else this._isDragging=!0},i._endDrag=function(t){var e=this.target,i=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,i){var n=i._parseEvent(t.domEvent);e.fire("dragend",n)}},i.isDragging=function(){return!!this._isDragging},e}(Pi);ra.addInitHook("addHandler","draggable",sa);var aa=/\{ *([\w_]+) *\}/g,ha=new he(0,0),ua=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i._getClassName=function(){return"InfoWindow"},i.addTo=function(e){return e instanceof Qr&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),t.prototype.addTo.call(this,e)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getContent=function(){return this.options.content},i.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getTitle=function(){return this.options.title},i.buildOn=function(){if(this.options.custom){if(v(this.options.content)){var t=Ne("div");return t.innerHTML=this.options.content,this._replaceTemplate(t),t}return this._replaceTemplate(this.options.content),this.options.content}var e=Ne("div");this.options.containerClass&&(e.className=this.options.containerClass),e.style.width=this._getWindowWidth()+"px",e.style.bottom="0px";var i='<em class="maptalks-ico"></em>';this.options.title&&(i+="<h2>"+this.options.title+"</h2>"),i+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',e.innerHTML=i,this._replaceTemplate(e);var n=e.querySelector(".maptalks-msgContent");return v(this.options.content)?n.innerHTML=this.options.content:n.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this),Be(e.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),this._replaceTemplate(n),e},i._replaceTemplate=function(t){if(this.options.enableTemplate&&this._owner&&this._owner.getProperties&&t&&t.innerHTML){var e=this._owner.getProperties()||{};if(m(e)){var i=t.innerHTML;t.innerHTML=i.replace(aa,function(t,i){return e[i]})}}return this},i.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},i.getOffset=function(){var t=this.getSize(),e=new et(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var i=this.getOwner();if(i instanceof Ro||i instanceof Ho){var n,r;if(i instanceof Ro)n=i._getPainter(),r=i.getSize();else{var o=i.getGeometries();if(!o||!o.length)return e;n=o[0]._getPainter(),r=o[0].getSize()}if(r||(r=ha),n){var s=n.getFixedExtent();e._add(s.xmax-r.width/2,s.ymin)}else e._add(0,-r.height)}return e},i.show=function(e){return this.getMap()&&this.getMap().options.enableInfoWindow?t.prototype.show.call(this,e):this},i.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},i.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},i.onRemove=function(){this.onDomRemove()},i.onDomRemove=function(){this._onCloseBtnClick&&(We(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},i._onAutoOpen=function(t){var e=this,i=this.getOwner();setTimeout(function(){i instanceof Ro||i instanceof ia?e.show(i.getCoordinates()):i instanceof Ho?e.show(i.findClosest(t.coordinate)):i instanceof Lo||i instanceof No?(e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(i,t.coordinate)),e.show(t.coordinate)):e.show(t.coordinate)},1)},i._rectifyMouseCoordinte=function(t,e){var i=this;return t instanceof Lo?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof No?t.getGeometries().map(function(t){return i._rectifyLineStringMouseCoordinate(t,e)}).sort(function(t,e){return t.dis-e.dis})[0].coordinate:e},i._rectifyLineStringMouseCoordinate=function(t,e){for(var i=this,n=t.getCoordinates().map(function(t){return i.getMap().coordToContainerPoint(t)}),r=this.getMap().coordToContainerPoint(e),o=1/0,s=-1,a=0,h=n.length;a<h;a++){var u=n[a],l=r.distanceTo(u);l<o&&(o=l,s=a)}var c=[];0===s?c.push(n[0],n[1]):s===n.length-1?c.push(n[s-1],n[s]):c.push(n[s-1],n[s],n[s+1]);for(var f=[],d=this.getMap().getSize(),p=d.width,g=d.height,m=0,v=c.length-1;m<v;m++){var _=c[m],y=c[m+1];if(_.x===y.x)for(var x=Math.max(0,Math.min(_.y,y.y)),w=Math.min(g,Math.max(_.y,y.y)),b=x;b<=w;b++)f.push(new et(_.x,b));else for(var C=(y.y-_.y)/(y.x-_.x),P=Math.max(0,Math.min(_.x,y.x)),M=Math.min(p,Math.max(_.x,y.x)),T=P;T<=M;T++){var S=C*(T-_.x)+_.y;f.push(new et(T,S))}}for(var A=1/0,E=-1,k=0,R=f.length;k<R;k++){var O=f[k],L=r.distanceTo(O);L<A&&(A=L,E=k)}return{dis:A,coordinate:E<0?e:this.getMap().containerPointToCoord(f[E])}},i._getWindowWidth=function(){var t=this.options.width;return t||(t=300),t},e}(ia);ua.mergeOptions({containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:300,minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1});var la="remove hide shapechange positionchange dragend animatestart",ca=function(t){Y(i,t);var e=i.prototype;function i(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,i)||this)._content=e,n}return e._getClassName=function(){return"ToolTip"},e.addTo=function(e){if(i.isSupport(e))return e.on("mousemove",this.onMouseMove,this),e.on("mouseout",this.onMouseOut,this),e.on(la,this.hideDom,this),t.prototype.addTo.call(this,e);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},e.setStyle=function(t){return this.options.containerClass=t,this},e.getStyle=function(){return this.options.containerClass},e.getContent=function(){return this._content},e.buildOn=function(){var t=Ne("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var i=e.containerClass||e.cssName;return!i&&e.height&&(t.style.lineHeight=e.height+"px"),t.innerHTML='<div class="'+i+'">'+this._content+"</div>",t},e.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM()},e.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var i=this.getMap();if(i){var n=i.locateByPoint(t.coordinate,-5,25);0===this.options.showTimeout?this.show(n):this._timeout=setTimeout(function(){i&&e.show(n)},this.options.showTimeout)}},e.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(la,this.hideDom,this))},e.hideDom=function(){return this.hide()},e.onEvent=function(){return t.prototype.onEvent.call(this),this.hideDom(),this},e._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},i}(ia);ca.mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var fa=function(t){function e(e){return t.call(this,e)||this}Y(e,t);var i=e.prototype;return i._getClassName=function(){return"Menu"},i.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,this._owner=t,ia.prototype.addTo.apply(this,arguments)},i.setItems=function(t){return this.options.items=t,this},i.getItems=function(){return this.options.items||[]},i.buildOn=function(){if(this.options.custom){if(v(this.options.items)){var t=Ne("div");return t.innerHTML=this.options.items,t}return this.options.items}var e=Ne("div");this.options.containerClass&&ti(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var i=this._createMenuItemDom();return e.appendChild(i),ai(e,"contextmenu",$e),e},i.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),i=this.getSize(),n=0,r=0;return e.x+i.width>t.width&&(n=-i.width),e.y+i.height>t.height&&(r=-i.height),new et(n,r)},i.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},i.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i._createMenuItemDom=function(){var t=this,e=this.getMap(),i=Ne("ul");ti(i,"maptalks-menu-items");var n,r,o=this.getItems();function s(i){return function(n){var r=e._parseEvent(n,"click");r.target=t,r.owner=t._owner,r.index=i,!1!==this._callback(r)&&(t.hide(),t._owner&&t._owner.fire("closemenu"))}}for(var a=0,h=o.length;a<h;a++){if("-"===(n=o[a])||"_"===n)ti(r=Ne("li"),"maptalks-menu-splitter");else{r=Ne("li");var u=n.item;_(u)&&(u=u({owner:this._owner,index:a})),r.innerHTML=u,r._callback=n.click,ai(r,"click",s(a))}i.appendChild(r)}var l=this.options.maxHeight||0;return l>0&&Ke(i,"max-height: "+l+"px; overflow-y: auto;"),i},i._getMenuWidth=function(){return this.options.width||160},e}(ia);fa.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var da={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(t){var e=this instanceof co?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(this._menuOptions),this._menu.show(t)),this.fire("openmenu",{coordinate:t}),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(t){return this._menu=new fa(t),this._menu.addTo(this),this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.openMenu(t.coordinate),!1}};co.include(da),Qr.include(da);var pa=function(t){function e(e){return e&&e.position&&!v(e.position)&&(e.position=f({},e.position)),t.call(this,e)||this}Y(e,t);var i=e.prototype;return i.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t._panels.control;return this.__ctrlContainer=Ne("div"),Ke(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},i.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.getMap=function(){return this._map},i.getPosition=function(){return f({},this._parse(this.options.position))},i.setPosition=function(t){return v(t)?this.options.position=t:this.options.position=f({},t),this._updatePosition(),this},i.getContainerPoint=function(){var t,e,i=this.getPosition(),n=this.getMap().getSize();return d(i.left)?d(i.right)||(t=n.width-parseInt(i.right)):t=parseInt(i.left),d(i.top)?d(i.bottom)||(e=n.height-parseInt(i.bottom)):e=parseInt(i.top),new et(t,e)},i.getContainer=function(){return this.__ctrlContainer},i.getDOM=function(){return this._controlDom},i.show=function(){return this.__ctrlContainer.style.display="",this},i.hide=function(){return this.__ctrlContainer.style.display="none",this},i.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},i.remove=function(){return this._map?(Ge(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},i._parse=function(t){var i=t;return v(t)&&(i=e.positions[i]),i},i._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)t.hasOwnProperty(e)&&(t[e]=parseInt(t[e]),this.__ctrlContainer.style[e]=t[e]+"px");this.fire("positionchange",{position:f({},t)})},e}(Ci(Mi));pa.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},co.mergeOptions({control:!0}),co.include({addControl:function(t){return this._containerDOM.getContext?this:(t.addTo(this),this)},removeControl:function(t){return t&&t.getMap()===this?(t.remove(),this):this}});var ga="addlayer removelayer setbaselayer baselayerremove",ma=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.buildOn=function(){return this._attributionContainer=Ne("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},i.onAdd=function(){this.getMap().on(ga,this._update,this)},i.onRemove=function(){this.getMap().off(ga,this._update,this)},i._update=function(){var t=this.getMap();if(t){var e=t._getLayers(function(t){return t.options.attribution}).reverse().map(function(t){return t.options.attribution}),i=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+i+"</span>"}},e}(pa);ma.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),co.mergeOptions({attribution:!0}),co.addOnLoadHook(function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new ma(t),this.addControl(this.attributionControl))});var va=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.buildOn=function(){var t=this.container=Ne("div",this.options.containerClass),e=this.panel=Ne("div","panel"),i=this.button=Ne("button");return t.appendChild(i),t.appendChild(e),t},i.onAdd=function(){ai(this.button,"mouseover",this._show,this),ai(this.panel,"mouseleave",this._hide,this),ai(this.getMap(),"click",this._hide,this)},i.onRemove=function(){this.panel&&(hi(this.button,"mouseover",this._show,this),hi(this.panel,"mouseleave",this._hide,this),hi(this.getMap(),"click",this._hide,this),Ge(this.panel),Ge(this.button),delete this.panel,delete this.button,delete this.container)},i._show=function(){Qe(this.container,"shown")||(ti(this.container,"shown"),this._createPanel())},i._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||ei(this.container,this.options.containerClass)},i._createPanel=function(){this.panel.innerHTML="";var t=Ne("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},i._renderLayers=function(t,e){var i=t.getBaseLayer(),n=t.getLayers(),r=n.length;if(i){var o=i.layers||[i],s=Ne("li","group"),a=Ne("ul"),h=Ne("label");h.innerHTML=this.options.baseTitle,s.appendChild(h);for(var u=0,l=o.length;u<l;u++){var c=o[u];this._isExcluded(c)&&(a.appendChild(this._renderLayer(o[u],!0)),s.appendChild(a),e.appendChild(s))}}if(r){var f=Ne("li","group"),d=Ne("ul"),p=Ne("label");p.innerHTML=this.options.overlayTitle,f.appendChild(p);for(var g=0;g<r;g++){var m=n[g];this._isExcluded(m)&&d.appendChild(this._renderLayer(m))}f.appendChild(d),e.appendChild(f)}},i._isExcluded=function(t){var e=t.getId(),i=this.options.excludeLayers;return!(i.length&&i.indexOf(e)>=0)},i._renderLayer=function(t,e){var i=this,n=Ne("li","layer"),r=Ne("label"),o=Ne("input"),s=this.getMap(),a=t.options.visible;t.options.visible=!0;var h=t.isVisible();return t.options.visible=a,n.className="layer",e?(o.type="radio",o.name="base"):o.type="checkbox",o.checked=a&&h,h||o.setAttribute("disabled","disabled"),o.onchange=function(e){if("radio"===e.target.type){var n=s.getBaseLayer(),r=n.layers;if(r)for(var o=0,a=r.length;o<a;o++){var h=r[o];h[h===t?"show":"hide"]()}else n.isVisible()||n.show();s._fireEvent("setbaselayer")}else t[e.target.checked?"show":"hide"]();i.fire("layerchange",{target:t})},n.appendChild(o),r.innerHTML=t.getId(),n.appendChild(r),n},e}(pa);va.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),co.mergeOptions({layerSwitcherControl:!1}),co.addOnLoadHook(function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new va(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))});var _a=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=Ne("div"),i=this.mapContainer=Ne("div");i.style.width=t[0]+"px",i.style.height=t[1]+"px",i.className=this.options.containerClass;var n=this.button=Ne("div");return n.className=this.options.buttonClass,e.appendChild(i),e.appendChild(n),e},i.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),ai(this.button,"click",this._onButtonClick,this),this._updateButtonText()},i.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),hi(this.button,"click",this._onButtonClick,this)},i.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},i.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},i.getOverviewMap=function(){return this._overview},i._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},i._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},i._createOverview=function(){var t=this.getMap(),e=this.mapContainer,i=t.config();f(i,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new co(e,i),this._updateBaseLayer(),this._perspective=new Ao(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new ls("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},i._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),i=t.getMinZoom(),n=this.options.level;if(n>0){for(var r=n;r>0;r--)if(e-r>=i)return e-r}else for(var o=n;o<0;o++)if(e-o>=i)return e-o;return e},i._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},i._getPerspectiveCoords=function(){var t=this.getMap();return t.getContainerExtent().toArray().map(function(e){return t.containerPointToCoordinate(e)})},i._update=function(){if(this._overview){Ye(this._overview._containerDOM);var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},i._updateSpatialReference=function(){if(this._overview){var t=this.getMap().options.spatialReference;this._overview.setSpatialReference(t)}},i._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,i=0;if(e)for(var n=0,r=e.length;n<r;n++){if(e[n].isVisible()){i=n;break}}var o=t.toJSON(),s=null;e?(s=o.layers[i].options).visible=!0:s=o.options,this._overview.setMinZoom(s.minZoom||null).setMaxZoom(s.maxZoom||null),delete s.minZoom,delete s.maxZoom,delete o.options.canvas,o.options.visible=!0,o.options.renderer="canvas";var a=eo.fromJSON(o);for(var h in t)_(t[h])&&t.hasOwnProperty(h)&&t[h]!==t.constructor.prototype[h]&&(a[h]=t[h]);this._overview.setBaseLayer(a)}else this._overview.setBaseLayer(null)}},e}(pa);_a.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),co.mergeOptions({overviewControl:!1}),co.addOnLoadHook(function(){this.options.overviewControl&&(this.overviewControl=new _a(this.options.overviewControl),this.addControl(this.overviewControl))});var ya=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.buildOn=function(){var t;if(this.options.custom)v(this.options.content)?(t=Ne("div")).innerHTML=this.options.content:t=this.options.content;else{if(t=Ne("div","maptalks-panel"),this.options.closeButton){var e=Ne("a","maptalks-close");e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var i=Ne("div","maptalks-panel-content");i.innerHTML=this.options.content,t.appendChild(i)}return this.draggable=new qi(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},i.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),pa.prototype.update.call(this)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},i.getContent=function(){return this.options.content},i._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},i._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=f({},this.getPosition()),this.fire("dragstart",t)},i._onDragging=function(t){var e=t.mousePos.sub(this._startPos),i=this._startPosition,n=this.getPosition();d(n.top)||(n.top=parseInt(i.top)+e.y),d(n.bottom)||(n.bottom=parseInt(i.bottom)-e.y),d(n.left)||(n.left=parseInt(i.left)+e.x),d(n.right)||(n.right=parseInt(i.right)-e.x),this.setPosition(n),this.fire("dragging",t)},i._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},i._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),i=this.getDOM(),n=parseInt(i.clientWidth),r=parseInt(i.clientHeight);return[t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(n,r/2)),t.containerPointToCoordinate(e.add(n/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(pa);ya.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var xa=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.buildOn=function(t){return this._map=t,this._scaleContainer=Ne("div",this.options.containerClass),this._addScales(),t.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},i.onRemove=function(){this.getMap().off("zoomend",this._update,this)},i._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=Ze("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=Ze("div",this.options.containerClass?null:t,this._scaleContainer))},i._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},i._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},i._updateMetric=function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},i._updateImperial=function(t){var e,i,n,r=3.2808399*t;r>5280?(e=r/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mile",i/e)):(n=this._getRoundNum(r),this._updateScale(this._iScale,n+" feet",n/r))},i._updateScale=function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},i._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)},e}(pa);xa.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),co.mergeOptions({scaleControl:!1}),co.addOnLoadHook(function(){this.options.scaleControl&&(this.scaleControl=new xa(this.options.scaleControl),this.addControl(this.scaleControl))});var wa=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.buildOn=function(t){this._map=t;var e=Ne("div"),i=Ne("ul","maptalks-toolbar-hx");e.appendChild(i),this.options.vertical?ti(e,"maptalks-toolbar-vertical"):ti(e,"maptalks-toolbar-horizonal");var n=this;function r(t,e,i,r){var o=n._getItems()[e];return function(n){return Ue(n),t({target:o,index:e,childIndex:i,dom:r})}}var o=this.options.items;if(mt(o))for(var s=0,a=o.length;s<a;s++){var h=o[s],u=Ne("li");if(28!==this.options.height&&(u.style.lineHeight=this.options.height+"px"),u.style.height=this.options.height+"px",u.style.cursor="pointer",ri(h.item)){u.style.textAlign="center";var l=oi("div",h.item);u.innerHTML='<div style="margin-top:'+(this.options.height-l.height)/2+'px;">'+h.item+"</div>"}else u.innerHTML=h.item;if(h.click&&ai(u,"click",r(h.click,s,null,u)),mt(h.children)){var c=this._createDropMenu(s);u.appendChild(c),u._menu=c,ai(u,"mouseover",function(){this._menu.style.display=""}),ai(u,"mouseout",function(){this._menu.style.display="none"})}i.appendChild(u)}return e},i._createDropMenu=function(t){var e=this;function i(t,i,n){var r=e._getItems()[i].children[n];return function(e){return Ue(e),t({target:r,index:i,childIndex:n})}}var n=Ne("div","maptalks-dropMenu"),r=this._getItems(),o=r.length,s=Ne("ul"),a=r[t].children;t===o-1&&a&&(n.style.cssText="right: 0px;",s.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(s.style.bottom=0)),n.appendChild(Ne("em","maptalks-ico"));for(var h=0,u=0,l=a.length;u<l;u++){var c=ge(a[u].item,"12px");c.width>h&&(h=c.width)}for(var f=0,d=a.length;f<d;f++){var p=a[f],g=Ne("li");g.innerHTML='<a href="javascript:;">'+p.item+"</a>",g.style.cursor="pointer",g.style.width=h+24+"px",ai(g.childNodes[0],"click",i(p.click,t,f)),s.appendChild(g)}if(this.options.vertical){var m=h<95?95:h;this.options.reverseMenu?n.style.right=-(m+20)+"px":n.style.left=-(m+20)+"px"}else this.options.reverseMenu?n.style.bottom="28px":n.style.top="28px";return n.appendChild(s),n.style.display="none",n},i._getItems=function(){return this.options.items||[]},e}(pa);wa.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}});var ba=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.buildOn=function(t){var e=this.options,i=Ne("div","maptalks-zoom");if(e.zoomLevel){var n=Ne("span","maptalks-zoom-zoomlevel");i.appendChild(n),this._levelDOM=n}var r=Ne("div","maptalks-zoom-slider"),o=Ne("a","maptalks-zoom-zoomin");if(o.href="javascript:;",o.innerHTML="+",r.appendChild(o),this._zoomInButton=o,e.slider){var s=Ne("div","maptalks-zoom-slider-box"),a=Ne("div","maptalks-zoom-slider-ruler"),h=Ne("span","maptalks-zoom-slider-reading"),u=Ne("span","maptalks-zoom-slider-dot");a.appendChild(h),s.appendChild(a),s.appendChild(u),r.appendChild(s),this._sliderBox=s,this._sliderRuler=a,this._sliderReading=h,this._sliderDot=u}var l=Ne("a","maptalks-zoom-zoomout");return l.href="javascript:;",l.innerHTML="-",r.appendChild(l),this._zoomOutButton=l,i.appendChild(r),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),i},i.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&hi(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&hi(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(hi(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger.disable(),delete this.dotDragger)},i._update=function(){var t=this.getMap();if(this._sliderBox){var e=10*(t.getMaxZoom()-t.getMinZoom());this._sliderBox.style.height=e+16+"px",this._sliderRuler.style.height=e+8+"px",this._sliderRuler.style.cursor="pointer";var i=10*(t.getMaxZoom()-t.getZoom());this._sliderReading.style.height=10*(t.getZoom()-t.getMinZoom()+1)+"px",this._sliderDot.style.top=i+"px"}this._updateText()},i._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();g(t)||(t=Math.floor(10*t)/10),this._levelDOM.innerHTML=t}},i._registerDomEvents=function(){this._zoomInButton&&ai(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&ai(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(ai(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new qi(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},i._onZoomInClick=function(t){$e(t),this.getMap().zoomIn()},i._onZoomOutClick=function(t){$e(t),this.getMap().zoomOut()},i._onClickRuler=function(t){$e(t);var e=this.getMap(),i=Xe(t,this._sliderRuler).y,n=e.getMaxZoom(),r=Math.floor(n-i/10);e.setZoom(r)},i._onDotDragstart=function(t){$e(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5);e.onZoomStart(e.getZoom(),i)},i._onDotDrag=function(t){$e(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5),n=Xe(t.domEvent,this._sliderRuler),r=e.getMaxZoom(),o=e.getMinZoom(),s=n.y,a=r-s/10;r<a?(a=r,s=0):o>a&&(a=o,s=10*(r-o)),"dragging"===t.type?e.onZooming(a,i,1):"dragend"===t.type&&(this.options.seamless?e.onZoomEnd(a,i):e.onZoomEnd(Math.round(a),i)),this._sliderDot.style.top=s+"px",this._sliderReading.style.height=10*(e.getZoom()-o+1)+"px",this._updateText()},e}(pa);ba.mergeOptions({position:"top-left",slider:!0,zoomLevel:!0,seamless:!1}),co.mergeOptions({zoomControl:!1}),co.addOnLoadHook(function(){this.options.zoomControl&&(this.zoomControl=new ba(this.options.zoomControl),this.addControl(this.zoomControl))});var Ca=function(){function t(t,e,i,n){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:i,y:n})}return t.getDefault=function(t){return"baidu"===t.code.toLowerCase()?"baidu":t.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":"identity"===t.code.toLowerCase()?[1,-1,0,0]:"web-mercator"},t}(),Pa=6378137*Math.PI;f(Ca,{"web-mercator":new Ca([1,-1,-Pa,Pa]),"tms-global-mercator":new Ca([1,1,-Pa,-Pa]),"tms-global-geodetic":new Ca([1,1,-180,-90]),baidu:new Ca([1,1,0,0])});for(var Ma=function(){function t(t,e,i,n){this.map=t,this.tileSize=n,this.fullExtent=i,this.prepareTileInfo(e,i),this._xScale=i.right>=i.left?1:-1,this._yScale=i.top>=i.bottom?1:-1;var r=t.getGLRes();this._pointOrigin=t._prjToPointAtRes(new et(this.tileSystem.origin),r),this._glRes=r}var e=t.prototype;return e.prepareTileInfo=function(t,e){if(v(t)?t=Ca[t.toLowerCase()]:Array.isArray(t)&&(t=new Ca(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t;var i=e.right>e.left?1:-1,n=e.top>e.bottom?-1:1,r=t.origin.x,o=t.origin.y;this.transformation=new pn([i,n,r,o])},e._getTileNum=function(t,e){var i=this.tileSystem,n=this.tileSize,r=Math.floor(1e-7*i.scale.x+t.x/(n.width*e)),o=Math.ceil(1e-7*i.scale.y+t.y/(n.height*e));return{x:i.scale.x*r,y:i.scale.y*o}},e.getTileIndex=function(t,e,i){var n=this.tileSystem,r=this.transformation.transform(t,1),o=this._getTileNum(r,e);return n.scale.x<0&&(o.x-=1),n.scale.y>0&&(o.y-=1),this.getNeighorTileIndex(o.x,o.y,0,0,e,i)},e.getNeighorTileIndex=function(t,e,i,n,r,o){var s=this.tileSystem,a=t+s.scale.x*i,h=e-s.scale.y*n,u=!1,l=a,c=h,f=this._getTileFullIndex(r);return o&&(!0!==o&&"x"!==o||(f.xmax===f.xmin?a=f.xmin:a<f.xmin?(a=f.xmax-(f.xmin-a)%(f.xmax-f.xmin))===f.xmax&&(a=f.xmin):a>=f.xmax&&(a=f.xmin+(a-f.xmin)%(f.xmax-f.xmin))),!0!==o&&"y"!==o||(f.ymax===f.ymin?h=f.ymin:h>=f.ymax?h=f.ymin+(h-f.ymin)%(f.ymax-f.ymin):h<f.ymin&&(h=f.ymax-(f.ymin-h)%(f.ymax-f.ymin))===f.ymax&&(h=f.ymin))),(a<f.xmin||a>f.xmax||h>f.ymax||h<f.ymin)&&(u=!0),{x:a,y:h,idx:l,idy:c,out:u}},e._getTileFullIndex=function(t){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[t])return this._tileFullIndex[t];var e=this.fullExtent,i=this.transformation,n=this._getTileNum(i.transform(new Yi(e.left,e.top),1),t),r=this._getTileNum(i.transform(new Yi(e.right,e.bottom),1),t),o=this.tileSystem;return o.scale.x<0&&(n.x-=1,r.x-=1),o.scale.y>0&&(n.y-=1,r.y-=1),this._tileFullIndex[t]=new cn(n,r),this._tileFullIndex[t]},e.getTilePrjNW=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+this._yScale*n.scale.y*(e+(1===n.scale.y?1:0))*i*r.height,s=n.origin.x+this._xScale*n.scale.x*(t+(1===n.scale.x?0:1))*i*r.width;return new Yi(s,o)},e.getTilePointNW=function(t,e,i){var n=this._glRes/i,r=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*n+this._yScale*r.scale.y*(e+(1===r.scale.y?1:0))*o.height,a=this._pointOrigin.x*n+this._xScale*r.scale.x*(t+(1===r.scale.x?0:1))*o.width;return new et(a,s)},e.getTilePrjSE=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+this._yScale*n.scale.y*(e+(1===n.scale.y?0:1))*i*r.height,s=n.origin.x+this._xScale*n.scale.x*(t+(1===n.scale.x?1:0))*i*r.width;return new Yi(s,o)},e.getTilePointSE=function(t,e,i){var n=this._glRes/i,r=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*n+this._yScale*r.scale.y*(e+(1===r.scale.y?0:1))*o.height,a=this._pointOrigin.x*n+this._xScale*r.scale.x*(t+(1===r.scale.x?1:0))*o.width;return new et(a,s)},e.getTilePrjExtent=function(t,e,i){var n=this.getTilePrjNW(t,e,i),r=this.getTilePrjSE(t,e,i);return new cn(n,r)},t}(),Ta=[],Sa=0;Sa<6;Sa++)Ta[Sa]=[];var Aa=[];function Ea(t,e,i){var n,r,o,s,a,h,u,l,c,f,d,p,g,m,v,_,y;r=(n=t)[0],o=n[1],s=n[2],a=n[3],h=n[4],u=n[5],l=n[6],c=n[7],f=n[8],d=n[9],p=n[10],g=n[11],m=n[12],v=n[13],_=n[14],y=n[15],Ra(Ta[0],a-r,c-h,g-f,y-m),Ra(Ta[1],a+r,c+h,g+f,y+m),Ra(Ta[2],a+o,c+u,g+d,y+v),Ra(Ta[3],a-o,c-u,g-d,y-v),Ra(Ta[4],a-s,c-l,g-p,y-_),Ra(Ta[5],a+s,c+l,g+p,y+_);for(var x=0;x<6;x++)if(!i||"0"!==i.charAt(x)){var w=Ta[x];if(Aa[0]=w[0]>0?e[1][0]:e[0][0],Aa[1]=w[1]>0?e[1][1]:e[0][1],Aa[2]=w[2]>0?e[1][2]:e[0][2],Oa(w,Aa)<0)return!1}return!0}var ka=1/6;function Ra(t,e,i,n,r){return t[0]=e*ka,t[1]=i*ka,t[2]=n*ka,t[3]=r*ka,t}function Oa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}var La=new et(0,0),Da="undefined"!=typeof Set,Ia=function(){function t(){this._table=Da?new Set:{}}var e=t.prototype;return e.add=function(t){Da?this._table.add(t):this._table[t]=!0},e.has=function(t){return Da?this._table.has(t):this._table[t]},e.reset=function(){Da?this._table.clear():this._table={}},t}(),ja={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!P,debug:!1,spatialReference:null,maxCacheSize:256,renderer:q.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1},za=/\{ *([\w_]+) *\}/g,Ha=new et(0,0),Fa=new et(0,0),Na=new et(0,0),Za=new et(0,0),Ga=new et(0,0),Ba=new et(0,0),Wa=[[0,0,0],[0,0,0]],Va=[0,0,0],$a=[0,0,0],Ua=[],Ja=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null};var i=e.prototype;return i.getTileSize=function(){if(this._tileSize)return this._tileSize;var t=this.options.tileSize;return p(t)&&(t=[t,t]),this._tileSize=new he(t),this._tileSize},i.getTiles=function(t,e){this._coordCache={};var i=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&i&&i.isPyramid()?this._getPyramidTiles(t,e):this._getCascadeTiles(t,e)},i._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var t=this.getSpatialReference(),e=t.getFullExtent(),i=t.getResolution(0),n=this.getMap();return this._tileFullExtent=e.convertTo(function(t){return n._prjToPointAtRes(t,i,La)}),this._tileFullExtent},i._getRootNodes=function(t){var e=this.getMap();if(this._rootNodes){var i=this._rootNodes,n=i.tiles,r=i.mapWidth,o=i.mapHeight;if(e.width!==r||e.height!==o){for(var s=this._getRootError(),a=0;a<n.length;a++)n[a].error=s;this._rootNodes.mapWidth=e.width,this._rootNodes.mapHeight=e.height}for(var h=0;h<n.length;h++)n[h].offset[0]=t[0],n[h].offset[1]=t[1];return this._rootNodes}var u=this.getSpatialReference(),l=u.getResolution(0),c=this._getTileConfig(),f=u.getFullExtent(),d=c.tileSystem,p=d.origin,g=d.scale,m=c.getTilePrjExtent(0,0,l),v=m.getWidth(),_=m.getHeight(),y=Math.abs((p.x-f.left)/v);y=Math.ceil(y-1e-5);var x=Math.abs((f.right-p.x)/v);x=Math.ceil(x-1e-5);var w=Math.ceil(Math.abs(f.top-p.y)/_);w=Math.ceil(w-1e-5);var b=Math.ceil(Math.abs(f.bottom-p.y)/_);if((x+y)*((b=Math.ceil(b-1e-5))+w)>32)return{status:0,error:"Too many root nodes"};for(var C=this._getRootError(),P=[],M=-y;M<x;M++)for(var T=-w;T<b;T++){var S=g.y<0?T:-(T+1);P.push({x:M,y:S,z:0,idx:M,idy:S,extent2d:c.getTilePrjExtent(M,S,l).convertTo(function(t){return e._prjToPointAtRes(t,l,La)}),id:this._getTileId(M,S,0),url:this.getTileUrl(M,S,0+this.options.zoomOffset),offset:[0,0],error:C})}return this._rootNodes={status:1,tiles:P,mapWidth:e.width,mapHeight:e.height},this._getRootNodes(t)},i._getRootError=function(){var t=this.getMap(),e=b(t.getFov()),i=t.width/t.height,n=t.cameraPosition[2],r=n*Math.tan(.5*e),o=r*i,s=Math.sqrt(n*n+r*r+o*o);return t._getFovZ(0)*(s/n)*this.getSpatialReference().getResolution(0)/t.getResolution(0)},i._getPyramidTiles=function(t,e){var i=this.getMap();isNaN(+t)&&(t=this._getTileZoom(i.getZoom()));var n,r=this.getSpatialReference(),o=Math.min(t,this.getMaxZoom()),s=i.projViewMatrix,a=this._getTileFullExtent(),h=this._getTileOffset(0);if(this.options.repeatWorld){var u=i.getContainerExtent(),l=this._convertToExtent2d(u),c=r.getResolution(0)/i.getResolution();if(l.within(a.copy()._scale(c))){var f=this._getRootNodes(h);if(1!==f.status)return console.warn(f.error),this._disablePyramid=!0,this.getTiles(t,e);n=f.tiles.concat()}else{var d=i.getPitch(),p=i.options.cascadePitches[1],g=Math.floor(i._getVisualHeight(p)),m=d<=p?u:new dn(0,i.height-g,i.width,i.height);this._visitedTiles=new Ia;var v=this._getTiles(0,m,2,e&&e.getRenderer(),!0),_=this._getRootError();v.tiles.forEach(function(t){t.error=_}),n=v.tiles}}else{var y=this._getRootNodes(h);if(1!==y.status)return console.warn(y.error),this._disablePyramid=!0,this.getTiles(t,e);n=y.tiles.concat()}for(var x=i.getGLRes(),w={0:h},b=new dn,C=[];n.length>0;){var P=n.pop();P.z!==o?(w[P.z+1]||(w[P.z+1]=this._getTileOffset(P.z+1)),this._splitNode(P,s,n,C,b,o,w[P.z+1],e&&e.getRenderer(),x)):(b._combine(P.extent2d),C.push(P))}return{tileGrids:[{extent:b,count:C.length,tiles:C,offset:[0,0],zoom:t}],count:C.length}},i._splitNode=function(t,e,i,n,r,o,s,a,h){for(var u=this._getTileConfig().tileSystem.scale.y,l=t.z+1,c=this.getSpatialReference(),f=t.x,d=t.y,p=t.extent2d,g=t.idx,m=t.idy,v=p.getWidth()/2*2,_=p.getHeight()/2*2,y=2*p.xmin,x=2*p.ymax,w=2*p.ymin,b=a||this.getRenderer(),C=!1,P=[],M=c.getResolution(l)/h,T=0;T<4;T++){var S=T%2,A=T>>1,E=(f<<1)+S,k=(d<<1)+A,R=(g<<1)+S,O=(m<<1)+A,L=this._getTileId(R,O,l),D=b.isTileCachedOrLoading(L),I=void 0;if(!D)if(u<0){var j=y+S*v,z=x-A*_;I=new dn(j,z-_,j+v,z)}else{var H=y+S*v,F=w+A*_;I=new dn(H,F,H+v,F+_)}var N=D&&D.info;N||(N={x:E,y:k,idx:R,idy:O,z:l,extent2d:I,error:t.error/2,id:L,url:this.getTileUrl(E,k,l+this.options.zoomOffset),offset:s},a&&(N.layer=this.getId())),N.error=t.error/2,N.offset[0]=s[0],N.offset[1]=s[1];var Z=this._isTileVisible(N,e,M,o,s);if(1===Z)C=!0;else{if(-1===Z)continue;if(0===Z&&l!==o)return n.push(t),void r._combine(t.extent2d)}P.push(N)}l===o?C?i.push.apply(i,P):(n.push(t),r._combine(t.extent2d)):i.push.apply(i,P)},i._isTileVisible=function(t,e,i,n,r){if(0===t.z)return 1;if(!this._isTileInFrustum(t,e,i,r))return-1;var o=this.options.maxError;return d(o)&&(o=1),this._getScreenSpaceError(t,i,n,r)>=o?1:0},i._isTileInFrustum=function(t,e,i,n){var r=t.extent2d,o=r.xmin,s=r.ymin,a=r.xmax,h=r.ymax;return Wa[0][0]=(o-n[0])*i,Wa[0][1]=(s-n[1])*i,Wa[1][0]=(a-n[0])*i,Wa[1][1]=(h-n[1])*i,Ea(e,Wa)},i._getScreenSpaceError=function(t,e,i,n){var r=t.error,o=this.getMap(),s=t.extent2d,a=s.xmin,h=s.ymin,u=s.xmax,l=s.ymax;Va[0]=(a-n[0])*e,Va[1]=(h-n[1])*e,$a[0]=(u-n[0])*e,$a[1]=(l-n[1])*e;var c,f,d,p,g,m,v=(c=Va,f=$a,d=o.cameraPosition,p=Math.max(c[0]-d[0],0,d[0]-f[0]),g=Math.max(c[1]-d[1],0,d[1]-f[1]),m=Math.max(c[2]-d[2],0,d[2]-f[2]),Math.sqrt(p*p+g*g+m*m)),_=Math.max(Math.abs(v),1e-7),y=Math.abs(t.z-i);return r*(o.height<1e3?1:y<=1?1:y<=2?.7:.605)/_},i._getCascadeTiles=function(t,e){var i=this.getMap(),n=i.getPitch(),r=e&&e.getRenderer(),o=i.getContainerExtent(),s=[],a=0,h=this.getMinZoom(),u=i.options.cascadePitches[0],l=i.options.cascadePitches[1],c=Math.floor(i._getVisualHeight(l)),f=d(t)?this._getTileZoom(i.getZoom()):t;if(this._visitedTiles=new Ia,!d(t)||!this.options.cascadeTiles||n<=u||!d(h)&&f<=h){var p=n<=l?o:new dn(0,i.height-c,i.width,i.height),g=this._getTiles(f,p,2,r);return g&&(a+=g.tiles.length,s.push(g)),{tileGrids:s,count:a}}var m=Math.floor(i._getVisualHeight(u)),v=new dn(0,i.height-m,i.width,i.height),_=this._getTiles(f,v,0,r);a+=_?_.tiles.length:0,s.push(_);var y,x,w=v.ymin,b=i.getSpatialReference().getZoomDirection(),C=b;if(n>l){f-C<=h&&(C=0);var P=new dn(0,i.height-c,i.width,w);a+=(y=this._getTiles(f-C,P,1,r))?y.tiles.length:0,w=P.ymin,C+=4*b}if(f-C>=h){var M=new dn(0,o.ymin,i.width,w);a+=(x=this._getTiles(f-C,M,2,r))?x.tiles.length:0,s.push(x)}return y&&x&&(s[1]=x,s[2]=y),{tileGrids:s,count:a}},i.getTileUrl=function(t,e,i){var n=this.options.urlTemplate,r="";if(this.options.subdomains){var o=this.options.subdomains;if(mt(o)){var s=(t+e)%o.length;s<0&&(s=0),r=o[s]}}if(_(n))return n(t,e,i,r);var a={x:t,y:e,z:i,s:r};return this.options.token&&(a.token=this.options.token),n.replace(za,function(t,e){var i=a[e];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(a)),i})},i.clear=function(){return this._renderer&&this._renderer.clear(),this.fire("clear"),this},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},i.getSpatialReference=function(){var t=this.getMap();if(t&&(!this.options.spatialReference||Yr.equals(this.options.spatialReference,t.options.spatialReference)))return t.getSpatialReference();if(this._sr)return this._sr;var e=this.options.spatialReference;if(v(e)&&!(e=Yr.getPreset(e)))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+Yr.getAllPresets().join());return this._sr=new Yr(e),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==t.getSpatialReference().toJSON().projection,this._sr},i.getMinZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(t.prototype.getMinZoom.call(this),this._srMinZoom):t.prototype.getMinZoom.call(this)},i.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(t.prototype.getMaxZoom.call(this),this._srMaxZoom):t.prototype.getMaxZoom.call(this)},i._getTileZoom=function(t){if(!this._hasOwnSR){var e=this.getMap().getResolution(t),i=this.getSpatialReference().getResolution(t);t+=Math.log(i/e)*Math.LOG2E}var n=this.options.maxAvailableZoom;return!d(n)&&t>n&&(t=n),g(t)||(t=Math.round(t)),t=Math.max(0,t)},i._getTiles=function(t,e,i,n,r){var o=this.getMap(),s=t,a=o.projViewMatrix;i<2&&(0===i&&(s-=1),a=0===i?o.cascadeFrustumMatrix0:1===i?o.cascadeFrustumMatrix1:o.projViewMatrix);var h=s+this.options.zoomOffset,u=this._getTileOffset(h),l=u[0]||u[1],c={zoom:s,extent:null,offset:u,tiles:[]};if(h<0)return c;if(!(o&&this.isVisible()&&o.width&&o.height))return c;if(!r){var f=this.getMinZoom(),p=this.getMaxZoom();if(!d(f)&&s<f||!d(p)&&s>p)return c}var g=this._getTileConfig();if(!g)return c;var m,v={zoom:u},_=this.getSpatialReference().getResolution(h);m=this._hasOwnSR?o.getGLScale(s):_/o.getGLRes();var y=!this._hasOwnSR&&this.options.repeatWorld,x=this._convertToExtent2d(e),w=this._getMask2DExtent();if(w){var b=w.intersection(x);if(!b)return c;e=b.convertTo(function(t){return o._pointToContainerPoint(t,void 0,0,La)})}var C,P=o._containerPointToPrj(e.getCenter(),Ha),M=o._prjToPoint(P,h,Fa);C=l?this._project(o._pointToPrj(M._add(u),h,Fa),Fa):this._project(P,Fa);var T=o.getGLScale()/o.getGLScale(h);Na.x=x.xmin*T,Na.y=x.ymax*T,Za.x=x.xmax*T,Za.y=x.ymin*T;for(var S=this._project(o._pointToPrj(Na._add(u),h,Na),Na),A=this._project(o._pointToPrj(Za._add(u),h,Za),Za),E=g.getTileIndex(C,_,y),k=g.getTileIndex(S,_,y),R=g.getTileIndex(A,_,y),O=Math.ceil(Math.abs(E.idy-k.idy)),L=Math.ceil(Math.abs(E.idx-k.idx)),D=Math.ceil(Math.abs(E.idy-R.idy)),I=Math.ceil(Math.abs(E.idx-R.idx)),j=(O+D+1)*(L+I+1),z=this.getTileSize(),H=this.getRenderer()||n,F=this._getTileConfig().tileSystem.scale,N=[],Z=new dn,G=new et(0,0),B=-O;B<=D;B++)for(var W=-L,V=-1/0,$=!1;W>=V&&W<=I;){var U=g.getNeighorTileIndex(E.idx,E.idy,W,B,_,y);V===-1/0?W++:W--;var J=this._getTileId(U.idx,U.idy,s);if(!(U.out||this._visitedTiles&&this._visitedTiles.has(J))){var q=H&&H.isTileCachedOrLoading(J);q&&(q=q.info);var Y=void 0;if(q){var X=q.extent2d;G.set(X.xmin,X.ymax),Y=G}else if(this._hasOwnSR){var K=g.getTilePrjNW(U.x,U.y,_);Y=o._prjToPoint(this._unproject(K,Za),s)}else Y=g.getTilePointNW(U.x,U.y,_);var Q=void 0,tt=void 0;if(this._hasOwnSR){var it=void 0;if(this._hasOwnSR){var nt=g.getTilePrjSE(U.x,U.y,_);it=o._prjToPoint(this._unproject(nt,Za),s,Za)}else it=g.getTilePointSE(U.x,U.y,_);Q=Math.ceil(Math.abs(it.x-Y.x)),tt=Math.ceil(Math.abs(it.y-Y.y))}else Q=z.width,tt=z.height;var rt=F.x*(U.idx-U.x)*Q,ot=F.y*(U.idy-U.y)*tt;q||!rt&&!ot||Y._add(rt,ot);var st=q&&q.extent2d||new dn(Y.x,Y.y-tt,Y.x+Q,Y.y);(j<=4||$||this._isTileInExtent(a,st,u,m))&&(this._visitedTiles&&0===i&&this._visitedTiles.add(J),0===i?(this._splitTiles(a,N,H,U,s+1,st,rt,ot,v,n),Z._combine(st)):(q?(q.offset[0]=u[0],q.offset[1]=u[1]):(q={z:s,x:U.x,y:U.y,idx:U.idx,idy:U.idy,extent2d:st,offset:u,id:J,url:this.getTileUrl(U.x,U.y,s)},n&&(q.layer=this.getId())),N.push(q),Z._combine(st)),V===-1/0?(V=W,W=I):$||($=!0))}}if(N.length){var at=o._containerPointToPoint(e.getCenter(),s,La)._add(u),ht=new et(0,0),ut=new et(0,0);N.sort(function(t,e){return ht.set((t.extent2d.xmin+t.extent2d.xmax)/2,(t.extent2d.ymin+t.extent2d.ymax)/2),ut.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),ht.distanceTo(at)-ut.distanceTo(at)})}return{offset:u,zoom:t,extent:Z,tiles:N}},i._convertToExtent2d=function(t){var e=this,i=this.getMap();return t.convertTo(function(t){if(t.y>0&&t.y<i.height){var n=(0===t.x?0:1)+t.y;e._coordCache[n]||(e._coordCache[n]=i._containerPointToPoint(t)),e._coordCache[n]}return i._containerPointToPoint(t,void 0,La)})},i._splitTiles=function(t,e,i,n,r,o,s,a,h,u){var l=this._getTileConfig().tileSystem.scale.y,c=this.getMap().getGLScale(r),f=Ga.set(2*o.xmin,l<0?2*o.ymax:2*o.ymin),d=o.getWidth(),p=o.getHeight(),g=2*n.idx,m=2*n.idy,v=2*n.x,_=2*n.y,y=this._checkAndAddTile(t,i,g,m,v,_,r,0,0,d,p,f,c,h,u);y&&e.push(y),(y=this._checkAndAddTile(t,i,g,m,v,_,r,0,1,d,p,f,c,h,u))&&e.push(y),(y=this._checkAndAddTile(t,i,g,m,v,_,r,1,0,d,p,f,c,h,u))&&e.push(y),(y=this._checkAndAddTile(t,i,g,m,v,_,r,1,1,d,p,f,c,h,u))&&e.push(y)},i._checkAndAddTile=function(t,e,i,n,r,o,s,a,h,u,l,c,f,d,p){var g=this._getTileId(i+a,n+h,s);if(this._visitedTiles&&this._visitedTiles.has(g))return null;var m=d[s];m||(m=d[s]=this._getTileOffset(s));var v=this._getTileConfig().tileSystem.scale.y,_=new dn(c.x+a*u,c.y+v*h*l,c.x+(a+1)*u,c.y+v*(h+1)*l);if(!this._isSplittedTileInExtent(t,_,m,f))return null;var y=e&&e.isTileCachedOrLoading(g);return y?y=y.info:(y={z:s,x:r+a,y:o+h,extent2d:_,id:g,offset:m,url:this.getTileUrl(r+a,o+h,s+this.options.zoomOffset)},p&&(y.layer=this.getId())),y},i._getTileOffset=function(t){var e=this.options.offset;return _(e)&&(e=e(t)),e},i._getTileId=function(t,e,i,n){return(n||this.getId())+"_"+e+"_"+t+"_"+i},i._project=function(t,e){if(this._hasOwnSR){var i=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(i.unproject(t,e),e)}return t},i._unproject=function(t,e){if(this._hasOwnSR){var i=this.getMap(),n=this.getSpatialReference(),r=i.getProjection(),o=n.getProjection();return r.project(o.unproject(t,e),e)}return t},i._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),i=this.getSpatialReference(),n=i.getProjection(),r=i.getFullExtent();this._defaultTileConfig=new Ma(t,Ca.getDefault(n),r,e),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new Ma(t,this.options.tileSystem,r,e)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},i._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},i._bindMap=function(e){var i=e.getBaseLayer();return i===this&&(i.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),this._onSpatialReferenceChange(),t.prototype._bindMap.apply(this,arguments)},i._isTileInExtent=function(t,e,i,n){var r,o,s,a,h,u,l,c,f=this.getMap();if(t!==f.projViewMatrix){var d=e.getCenter(Ba)._sub(i[0],i[1])._multi(n);Ts(Ua,d.x,d.y,0),r=(o=Ua,s=Ua,a=f.projViewMatrix,h=s[0],u=s[1],l=s[2],c=(c=a[3]*h+a[7]*u+a[11]*l+a[15])||1,o[0]=(a[0]*h+a[4]*u+a[8]*l+a[12])/c,o[1]=(a[1]*h+a[5]*u+a[9]*l+a[13])/c,o[2]=(a[2]*h+a[6]*u+a[10]*l+a[14])/c,o)[1]<0?f.projViewMatrix:t}else r=f.projViewMatrix;return Wa[0][0]=(e.xmin-i[0])*n,Wa[0][1]=(e.ymin-i[1])*n,Wa[1][0]=(e.xmax-i[0])*n,Wa[1][1]=(e.ymax-i[1])*n,Ea(r,Wa)},i._isSplittedTileInExtent=function(t,e,i,n){var r=this.getMap();return Wa[0][0]=(e.xmin-i[0])*n,Wa[0][1]=(e.ymin-i[1])*n,Wa[1][0]=(e.xmax-i[0])*n,Wa[1][1]=(e.ymax-i[1])*n,Ea(r.projViewMatrix,Wa)},i.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},i._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR;var t=this.getRenderer();t&&t.clear()},e}(eo);Ja.registerJSONType("TileLayer"),Ja.mergeOptions(ja);var qa=new he(256,256),Ya=function(t){function e(e,i,n){var r;return(r=t.call(this,e,n)||this).layers=i||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}Y(e,t),e.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var i=t.layers.map(function(t){return eo.fromJSON(t)});return new e(t.id,i,t.options)};var i=e.prototype;return i.getLayers=function(){return this.layers},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map(function(t){return t.toJSON()}),options:this.config()}},i.getTileSize=function(t){var e=this.getLayer(t);return e?e.getTileSize():qa},i.getTiles=function(t){for(var e=this.layers,i=[],n=0,r=0,o=e.length;r<o;r++){var s=e[r];if(s.options.visible){var a=s.getTiles(t,this);a&&0!==a.count&&(n+=a.count,at(i,a.tileGrids))}}return{count:n,tileGrids:i}},i.onAdd=function(){var e=this,i=this.getMap();this.layers.forEach(function(t){e.layerMap[t.getId()]=t,t.getChildLayer&&e._groupChildren.push(t),t._bindMap(i),t.on("show hide",e._onLayerShowHide,e)}),t.prototype.onAdd.call(this)},i.onRemove=function(){var e=this;this.layers.forEach(function(t){t._doRemove(),t.off("show hide",e._onLayerShowHide,e)}),this.layerMap={},this._groupChildren=[],t.prototype.onRemove.call(this)},i.getLayer=function(t){return this.getChildLayer(t)},i.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var i=0;i<this._groupChildren.length;i++){var n=this._groupChildren[i].getChildLayer(t);if(n)return n}return null},i._onLayerShowHide=function(){var t=this.getRenderer();t&&t.setToRedraw()},i.isVisible=function(){if(!t.prototype.isVisible.call(this))return!1;for(var e=this.layers,i=0,n=e.length;i<n;i++)if(e[i].isVisible())return!0;return!1},i._checkChildren=function(){var t=this,e={};this.layers.forEach(function(i){var n=i.getId();if(e[n])throw new Error("Duplicate child layer id ("+n+") in the GroupTileLayer ("+t.getId()+")");e[n]=1})},e}(Ja);Ya.registerJSONType("GroupTileLayer"),Ya.mergeOptions({maxCacheSize:1024});var Xa={crs:null,uppercase:!1,detectRetina:!1},Ka={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},Qa=function(t){function e(e,i){var n;n=t.call(this,e)||this;var r=f({},Ka);for(var o in i)o in n.options||(r[o]=i[o]);n.setOptions(i),n.setZIndex(i.zIndex);var s=n.getTileSize();return r.width=s.width,r.height=s.height,n.wmsParams=r,n._wmsVersion=parseFloat(r.version),n}Y(e,t);var i=e.prototype;return i.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),i=Xa.detectRetina?e:1;this.wmsParams.width*=i,this.wmsParams.height*=i;var n=this.options.crs||this.getMap().getProjection().code,r=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[r]=n,t.prototype.onAdd.call(this)},i.getTileUrl=function(e,i,n){var r=this.getSpatialReference().getResolution(n),o=this._getTileConfig().getTilePrjExtent(e,i,r),s=o.getMax(),a=o.getMin(),h=(this._wmsVersion>=1.3&&"EPSG:4326"===this.wmsParams.crs?[a.y,a.x,s.y,s.x]:[a.x,a.y,s.x,s.y]).join(","),u=t.prototype.getTileUrl.call(this,e,i,n);return u+function(t,e,i){var n=[];for(var r in t)n.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}(this.wmsParams,u,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},i.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new e(t.id,t.options):null},e}(Ja);Qa.registerJSONType("WMSTileLayer"),Qa.mergeOptions(Xa);var th=function(t){function e(e,i){var n;return(n=t.call(this,e,i)||this).options.hasOwnProperty("forceRenderOnMoving")||(n.options.forceRenderOnMoving=!1),n}Y(e,t);var i=e.prototype;return i.drawTile=function(){},i.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new e(t.id,t.options):null},e}(Ja);function eh(t,e,i){var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+r)}return n}function ih(t,e,i){var n=eh(t,t.VERTEX_SHADER,e),r=eh(t,t.FRAGMENT_SHADER,i);if(!n||!r)return null;var o=t.createProgram();return o?(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),{program:o,vertexShader:n,fragmentShader:r}):null}function nh(t,e,i){if(Array.isArray(i[0])){for(var n=Float32Array.BYTES_PER_ELEMENT,r=0,o=0;o<i.length;o++)r+=i[o][1]||0;for(var s=0,a=0;a<i.length;a++){var h=t.getAttribLocation(e,i[a][0]);if(h<0)throw new Error("Failed to get the storage location of "+i[a][0]);t.vertexAttribPointer(h,i[a][1],t[i[a][2]||"FLOAT"],!1,n*r,n*s),s+=i[a][1]||0,t.enableVertexAttribArray(h)}}else{var u=t.getAttribLocation(e,i[0]);t.vertexAttribPointer(u,i[1],t[i[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(u)}}th.registerJSONType("CanvasTileLayer");var rh="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",oh="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n        }\n    ",sh=[0,0],ah=[0,0,0],hh=new Array(16),uh=new et(20,20),lh=function(t){var e,i=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.drawGLImage=function(t,e,i,n,r,o,s,a){this.gl.program!==this.program&&this.useProgram(this.program);var h=this.gl;this.loadTexture(t),ah[0]=e||0,ah[1]=i||0;var u=Ps(hh);xs(u,u,ah),ws(u,u,[o,o,1]),bs(u,this.getMap().projViewMatrix,u),h.uniformMatrix4fv(this.program.u_matrix,!1,u),h.uniform1f(this.program.u_opacity,s),h.uniform1f(this.program.u_debug_line,0);var l=t.glBuffer;!l||l.width===n&&l.height===r||(this.saveImageBuffer(l),delete t.glBuffer),t.glBuffer?h.bindBuffer(h.ARRAY_BUFFER,l):t.glBuffer=this.bufferTileData(0,0,n,r),sh[0]="a_position",sh[1]=2,sh[2]=t.glBuffer.type,this.enableVertexAttrib(sh),h.drawArrays(h.TRIANGLE_STRIP,0,4),a&&this.drawDebug(u,sh,0,0,n,r,a)},i.drawDebug=function(t,e,i,n,r,o,s){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),a.bufferData(a.ARRAY_BUFFER,new Float32Array([i,n,i+r,n,i+r,n-o,i,n-o,i,n]),a.DYNAMIC_DRAW),a.uniformMatrix4fv(this.program.u_matrix,!1,t),a.uniform1f(this.program.u_debug_line,1),a.drawArrays(a.LINE_STRIP,0,5);var h=this._debugInfoCanvas;if(!h){var u=this.getMap().getDevicePixelRatio()>1?2:1;(h=this._debugInfoCanvas=document.createElement("canvas")).width=256*u,h.height=32*u;var l=h.getContext("2d");l.font="20px monospace",l.scale(u,u)}var c=h.getContext("2d");c.clearRect(0,0,h.width,h.height);var f=this.layer.options.debugOutline;pi.fillText(c,s,uh,f),this.loadTexture(h),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,h);var d=i,p=i+(r=256),g=n,m=n-(o=32);a.bufferData(a.ARRAY_BUFFER,this.set8(d,g,d,m,p,g,p,m),a.DYNAMIC_DRAW),a.uniform1f(this.program.u_debug_line,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)},i.bufferTileData=function(t,e,i,n,r){var o,s=t,a=t+i,h=e,u=e-n;o=g(s)&&g(a)&&g(h)&&g(u)?this.set8Int(s,h,s,u,a,h,a,u):this.set8(s,h,s,u,a,h,a,u);var l=this.loadImageBuffer(o,r);return l.width=i,l.height=n,l.type=o instanceof Int16Array?"SHORT":"FLOAT",l},i.drawTinImage=function(t,e,i,n,r){var o=this.gl;this.loadTexture(t),o.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),o.uniform1f(this.program.u_opacity,r),o.bindBuffer(o.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(i),o.DYNAMIC_DRAW),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),o.DYNAMIC_DRAW),o.drawElements(o.TRIANGLES,n.length,o.UNSIGNED_SHORT,0)},i.createCanvas2=function(){this.canvas2=pi.createCanvas(this.canvas.width,this.canvas.height)},i.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=function(t,e){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},n=["webgl","experimental-webgl"],r=null,o=0;o<n.length;++o){try{r=t.getContext(n[o],e||i)}catch(t){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var t=this.gl;t.clearColor(0,0,0,0),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(rh,this.layer.options.fragmentShader||oh),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),t.bufferData(t.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},i.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},i.clearGLCanvas=function(){this.gl&&this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)},i.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},i._createTexture=function(t){var e=this.gl,i=this.getTexture()||e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),g(ft(t.width))&&g(ft(t.width))&&e.generateMipmap(e.TEXTURE_2D),i},i.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&t.length>0?t.pop():null},i.saveTexture=function(t){this._textures.push(t)},i.loadTexture=function(t){var e=this.gl,i=t.texture;return i||(i=this._createTexture(t),t.texture=i),e.bindTexture(e.TEXTURE_2D,i),i},i.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&t.length>0?t.pop():null},i.saveImageBuffer=function(t){this._imageBuffers.push(t)},i.loadImageBuffer=function(t,e){var i=this.gl,n=e||this.createImageBuffer();return i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW),n},i.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},i.removeGLCanvas=function(){var t=this.gl;if(t){if(this._debugBuffer&&(t.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach(function(e){t.deleteBuffer(e)}),delete this._buffers),this._textures&&(this._textures.forEach(function(e){return t.deleteTexture(e)}),delete this._textures),this._debugInfoCanvas){var e=this._debugInfoCanvas.texture;e&&t.deleteTexture(e),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var i=t.program;t.deleteShader(i.fragmentShader),t.deleteShader(i.vertexShader),t.deleteProgram(i),delete this.gl,delete this.canvas2}},i.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},i.enableVertexAttrib=function(t){nh(this.gl,this.gl.program,t)},i.createProgram=function(t,e){for(var i=this.gl,n=ih(i,t,e),r=n.program,o=n.vertexShader,s=n.fragmentShader,a=i.getProgramParameter(r,35718),h=[],u=0;u<a;++u){var l=i.getActiveUniform(r,u);h.push(l.name)}return r.vertexShader=o,r.fragmentShader=s,this._initUniforms(r,h),r},i.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},i.enableSampler=function(t,e){var i=this.gl,n=this._getUniform(i.program,t);return e||(e=0),i.uniform1i(n,e),n},i._initUniforms=function(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=e[i],o=n.indexOf("[");o>=0&&(n=n.substring(0,o),P||(r=r.substring(0,o))),t[n]=this._getUniform(t,r)}},i._getUniform=function(t,e){var i=this.gl.getUniformLocation(t,e);if(!i)throw new Error("Failed to get the storage location of "+e);return i},e}(t);return f(i.prototype,{set8:(e=q.ie9?null:new Float32Array(8),function(t,i,n,r,o,s,a,h){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=h,e}),set8Int:function(){var t=q.ie9?null:new Int16Array(8);return function(e,i,n,r,o,s,a,h){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t}}()}),i},ch={renderer:q.webgl?"gl":"canvas",crossOrigin:null},fh=new et(0,0),dh=function(t){function e(e,i,n){var r;return!i||Array.isArray(i)||i.url||(n=i,i=null),(r=t.call(this,e,n)||this)._images=i,r}Y(e,t);var i=e.prototype;return i.onAdd=function(){this._prepareImages(this._images)},i.setImages=function(t){return this._images=t,this._prepareImages(t),this},i.getImages=function(){return this._images},i._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap(),i=e.getGLRes();this._imageData=t.map(function(t){var n=new cn(t.extent);return f({},t,{extent:n,extent2d:n.convertTo(function(t){return e.coordToPointAtRes(t,i)})})}),this._images=t;var n=this.getRenderer();n&&n.refreshImages()},e}(eo);dh.mergeOptions(ch);var ph=[],gh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},i.checkResources=function(){var t=this;if(this._imageLoaded)return ph;var e=this.layer._imageData.map(function(t){return[t.url,null,null]});if(this.resources){var i=[],n=new In;e.forEach(function(e){if(t.resources.isResourceLoaded(e)){var r=t.resources.getImage(e);n.addResource(e,r)}else i.push(e)}),this.resources.forEach(function(e,i){n.isResourceLoaded(e)||t.retireImage(i.image)}),this.resources=n,e=i}return this._imageLoaded=!0,e},i.retireImage=function(){},i.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},i.draw=function(){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},i._drawImages=function(){var t=this.layer._imageData,e=this.getMap(),i=e._get2DExtentAtRes(e.getGLRes());if(t&&t.length)for(var n=0;n<t.length;n++){var r=t[n].extent2d,o=this.resources&&this.resources.getImage(t[n].url);o&&i.intersects(r)&&(this._painted=!0,this._drawImage(o,r,t[n].opacity||1))}},i._drawImage=function(t,e,i){var n=0,r=this.context;i<1&&(n=r.globalAlpha,r.globalAlpha=i);var o=this.getMap(),s=fh.set(e.xmin,e.ymax),a=o._pointAtResToContainerPoint(s,o.getGLRes()),h=a.x,u=a.y,l=o.getBearing();l&&(r.save(),r.translate(h,u),l&&r.rotate(-l*Math.PI/180),h=u=0);var c=o.getGLScale();r.drawImage(t,h,u,e.getWidth()/c,e.getHeight()/c),l&&r.restore(),n&&(r.globalAlpha=n)},i.drawOnInteracting=function(){this.draw()},e}(Dn),mh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.isDrawable=function(){return!0},i._drawImage=function(t,e,i){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,i)},i.createContext=function(){this.createGLContext()},i.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.retireImage=function(t){this.disposeImage(t)},i.onRemove=function(){this.removeGLCanvas(),t.prototype.onRemove.call(this)},e}(lh(gh));dh.registerRenderer("canvas",gh),dh.registerRenderer("gl",mh);var vh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.getPrepareParams=function(){return[]},i.getDrawParams=function(){return[]},i.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=pi.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},i.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&t.prototype.needToRedraw.call(this)},i.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this._drawLayerOnInteracting()},i.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var i=e.image;this.buffer.width===i.width&&this.buffer.height===i.height||(this.buffer.width=i.width,this.buffer.height=i.height);var n=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(n,this.context);(void 0===r||r)&&(pi.image(n,i,0,0),e.image=this.buffer)}return e},i.remove=function(){return delete this._drawContext,t.prototype.remove.call(this)},i.onZoomStart=function(e){this.layer.onZoomStart(e),t.prototype.onZoomStart.call(this,e)},i.onZooming=function(e){this.layer.onZooming(e),t.prototype.onZooming.call(this,e)},i.onZoomEnd=function(e){this.layer.onZoomEnd(e),t.prototype.onZoomEnd.call(this,e)},i.onMoveStart=function(e){this.layer.onMoveStart(e),t.prototype.onMoveStart.call(this,e)},i.onMoving=function(e){this.layer.onMoving(e),t.prototype.onMoving.call(this,e)},i.onMoveEnd=function(e){this.layer.onMoveEnd(e),t.prototype.onMoveEnd.call(this,e)},i.onResize=function(e){this.layer.onResize(e),t.prototype.onResize.call(this,e)},i.prepareDrawContext=function(){if(!this._predrawed){var t=_h(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},i._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],i=_h(this.getDrawParams());return e.push.apply(e,i),e.push.apply(e,this._drawContext),e},i._drawLayer=function(){var t=this._prepareDrawParams();t&&(this.layer.draw.apply(this.layer,t),this.completeRender())},i._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var t=this._prepareDrawParams();t&&(this.layer.drawOnInteracting.apply(this.layer,t),this.completeRender())}},e}(Dn);function _h(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var yh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.isCanvasRender=function(){return!0},i.prepareToDraw=function(){},i.draw=function(){},i.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},i.play=function(){return this.config("animation",!0),this},i.pause=function(){return this.config("animation",!1),this},i.isPlaying=function(){return this.options.animation},i.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},i.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},i.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},i.onCanvasCreate=function(){return this},i.onZoomStart=function(){},i.onZooming=function(){},i.onZoomEnd=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){},i.onResize=function(){},i.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},e}(eo);yh.mergeOptions({doubleBuffer:!1,animation:!1}),yh.registerRenderer("canvas",vh);var xh=new et(0,0),wh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.getParticles=function(){},i.draw=function(t,e){var i=this.getParticles(c());if(i&&0!==i.length){var n=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo(function(t){return n._pointToContainerPoint(t,void 0,0,xh)});for(var o=2*Math.PI,s=0,a=i.length;s<a;s++){var h=i[s].point;if(r.contains(h)){var u=i[s].color||this.options.lineColor||"#fff",l=i[s].r;t.fillStyle!==u&&(t.fillStyle=u),l<=2?t.fillRect(h.x-l/2,h.y-l/2,l,l):(t.beginPath(),t.arc(h.x,h.y,l/2,0,o),t.fill())}}this._fillCanvas(t)}else{this._getRenderer()&&(this._getRenderer()._shouldClear=!0)}},i._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var i=this.options.trail||30;t.fillStyle="rgba(0, 0, 0, "+1/i+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}(yh);wh.mergeOptions({animation:!0}),wh.registerRenderer("canvas",function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},i.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(vh));var bh,Ch,Ph=new In,Mh=function(t){function e(e,i,n){var r;(r=t.call(this,n)||this).target=e,e.once("remove",r.delete,X(X(r)));var o=r.options.symbol,s=o.markerLineWidth||1;return r.w=o.markerWidth+s,r.h=o.markerHeight+s,r.dx=o.markerDx||0,r.dy=o.markerDy||0,r.opacity=o.opacity||1,r.map=i,r.events=n.events,r._fetchImage(),r.addTo(i),r}Y(e,t);var i=e.prototype;return i.getCursor=function(){return this.options.cursor||"default"},i._fetchImage=function(){var t=this.map,e=this.options.symbol,i=e.markerFile;this.url=i||Se(e);var n=Ph.getImage(this.url);if(!n){var r=this.w,o=this.h;if(i)(n=new Image).onload=function(){var e=t.getRenderer();e&&e.setToRedraw()},n.src=this.url;else{var s=document.createElement("canvas");s.width=r,s.height=o,n=mr(s.getContext("2d"),{x:r/2,y:o/2},e,Ph)}Ph.addResource([this.url,r,o],n)}Ph.login(this.url),this._img=n},i.setContainerPoint=function(t){this._point=t,this._point._sub(this.w/2,this.h/2)},i.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},i.offset=function(t){this._point._add(t)},i.render=function(t){if(!this._img)return!1;var e=this.map,i=this._point,n=i.x,r=i.y,o=this.w,s=this.h;if(n+o>0&&n<e.width&&r+s>0&&r<e.height){var a=e.getDevicePixelRatio();return t.globalAlpha=this.opacity,t.drawImage(this._img,Math.round((n+this.dx)*a)+this.dx,Math.round((r+this.dy)*a),Math.round(o*a),Math.round(s*a)),!0}return!1},i.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}Ph.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},i.hitTest=function(t){var e=this.w,i=this.h,n=this._point.x+this.dx,r=this._point.y+this.dy;return t.x>=n&&t.x<=n+e&&t.y>=r&&t.y<=r+i},i.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},i.onEvent=function(t){this.fire(t.type,t)},i.mousedown=function(t){var e=t.target,i=this.options.cursor;i&&e.setCursor(i),this.onDragstart(t)},i.onDragstart=function(t){var e=t.containerPoint,i=t.target,n=i._panels.mapWrapper||i._containerDOM,r=this._dragger=new qi(n);r.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),r.type="handle",r.onMouseDown(t.domEvent),bh=e.x,Ch=e.y,this.fire("dragstart",{containerPoint:e})},i.onDragging=function(t){if(this._dragger){var e=this.map,i=Xe(t.domEvent,e._containerDOM),n={x:i.x-bh,y:i.y-Ch},r=e.containerPointToCoord(new et(bh,Ch)),o=e.containerPointToCoord(i);bh=i.x,Ch=i.y,this.offset(n),this.fire("dragging",{containerPoint:i,coordOffset:o._sub(r)})}},i.onDragend=function(t){if(this._dragger){var e=this.map;e.resetCursor();var i=Xe(t.domEvent,e._containerDOM),n={x:i.x-bh,y:i.y-Ch};this.offset(n),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:i})}},e}(Ci(Mi)),Th=function(){function t(t,e){this.target=t,t.once("remove",this.delete,this),this.map=e,this.addTo(e)}var e=t.prototype;return e.setPoints=function(t){this.points=t;var e=t.map(function(t){return t.x}),i=t.map(function(t){return t.y});this.xmin=Math.min.apply(Math,e),this.xmax=Math.max.apply(Math,e),this.ymin=Math.min.apply(Math,i),this.ymax=Math.max.apply(Math,i)},e.hitTest=function(){return!1},e.render=function(t){var e=this.map;if(!(this.xmax<=0||this.xmin>=e.width||this.ymax<=0||this.ymin>=e.height)){var i=e.getDevicePixelRatio(),n=.5;t.lineWidth=1,t.strokeStyle="#000",t.globalAlpha=1,t.beginPath();var r=this.points;t.moveTo(s(r[0].x),s(r[0].y));for(var o=1;o<this.points.length;o++)t.lineTo(s(r[o].x),s(r[o].y));t.closePath(),t.stroke()}function s(t){return Math.round(t)*i+n}},e.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},e.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}},t}();function Sh(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}var Ah={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:Sh("ellipse",1),vertexHandleSymbol:Sh("square",1),newVertexHandleSymbol:Sh("square",.4)},Eh=function(t){function e(e,i){var n;return(n=t.call(this,i)||this)._geometry=e,n._geometry?n:X(n)}Y(e,t);var i=e.prototype;return i.getMap=function(){return this._geometry.getMap()},i.prepare=function(){var t=this.getMap();t&&(t.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},i._prepareEditStageLayer=function(){var t=this._geometry.getLayer();if("canvas"===t.options.renderer){var e=this.getMap(),i="_maptalks__internal_layer__edit_stage_"+ot()+"_shadow";if(this._shadowLayer=e.getLayer(i),!this._shadowLayer){var n=t.constructor;this._shadowLayer=new n(i),e.addLayer(this._shadowLayer)}}},i.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var t,e=this._geometry,i="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=e.options.draggable,i?(e.config("draggable",!1),(t=e.copy()).setSymbol(e._getInternalSymbol()),t.copyEventListeners(e),e._getParent()&&t.copyEventListeners(e._getParent()),t._setEventTarget(e),t.setId(null).config({draggable:!1}),this._shadow=t,e.hide()):e instanceof Ro&&e.config("draggable",!0),this._switchGeometryEvents("on"),(e instanceof Ro||e instanceof Wo||e instanceof $o||e instanceof Vo)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(t),e instanceof Ro?t&&(t.config("draggable",!0),t.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),e instanceof Ro&&!1!==this.options.resize?this.createMarkerEditor():e instanceof Wo?this.createCircleEditor():e instanceof $o?this.createEllipseOrRectEditor():e instanceof Vo?this.createEllipseOrRectEditor():e instanceof Uo||(e instanceof Ao||e instanceof Lo)&&this.createPolygonEditor()}},i.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},i.isEditing=function(){return!d(this.editing)&&this.editing},i._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},i._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var i in e)this._geometry[t](i,e[i],this)}},i._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},i._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},i._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;e||(this._editOutline=new Th(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var i=this._editOutline.points;if(t instanceof Ro)this._editOutline.setPoints(t.getContainerExtent().toArray(i));else{var n=this.getMap();(i=t._getPrjExtent().toArray(i)).forEach(function(t){return n._prjToContainerPoint(t,null,t)}),this._editOutline.setPoints(i)}return e},i._createCenterHandle=function(){var t,e=this,i=this.getMap(),n=this.options.centerHandleSymbol;this._geometry instanceof Lo&&(n.markerDx=5);var r=i.coordToContainerPoint(this._geometry.getCenter()),o=this.createHandle(r,{symbol:n,cursor:"move",onDown:function(){if(e._shadow){var i=Ae((t=e._shadow.copy())._getInternalSymbol(),.5);t.setSymbol(i).addTo(e._geometry.getLayer())}},onMove:function(i){var n=i.coordOffset;t?t.translate(n):e._geometry.translate(n)},onUp:function(){var i=t||e._geometry;e._update("setCoordinates",Yi.toNumberArrays(i.getCoordinates())),t&&t.remove()}});this._addRefreshHook(function(){var t=e._geometry.getCenter();o.setContainerPoint(i.coordToContainerPoint(t))})},i._createHandleInstance=function(t,e){var i=this.getMap(),n=Ht(e.symbol,function(){return[i.getZoom(),{"{bearing}":i.getBearing(),"{pitch}":i.getPitch(),"{zoom}":i.getZoom()}]}),r=this.options.removeVertexOn,o=new Mh(this,i,{symbol:n,cursor:e.cursor,events:r});return o.setContainerPoint(t),o},i.createHandle=function(t,e){e||(e={});var i=this._createHandleInstance(t,e),n=this;return i.on("dragstart",function(t){return this._updating=!0,e.onDown&&(this._geometry.fire("handledragstart"),e.onDown.call(n,t.containerPoint,t)),!1},this),i.on("dragging",function(t){return n._hideContext(),e.onMove&&(this._geometry.fire("handledragging"),e.onMove.call(n,t)),!1},this),i.on("dragend",function(t){return e.onUp&&(this._geometry.fire("handledragend"),e.onUp.call(n,t)),this._updating=!1,!1},this),e.onRefresh&&(i.refresh=e.onRefresh),i},i._createResizeHandles=function(t,e,i){var n=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],o=[null,"y",null,"x","x",null,"y",null],s=this._geometry,a=s instanceof Ro;t||(t=[]);var h=this,u=[],l={},c=this.getMap(),f=this.options.vertexHandleSymbol,d=function(){for(var d=function(){if(a){var t=s.getContainerExtent();return[new et(t.xmin,t.ymin),new et((t.xmax+t.xmin)/2,t.ymin),new et(t.xmax,t.ymin),new et(t.xmin,(t.ymin+t.ymax)/2),new et(t.xmax,(t.ymin+t.ymax)/2),new et(t.xmin,t.ymax),new et((t.xmax+t.xmin)/2,t.ymax),new et(t.xmax,t.ymax)]}var e=s._getPrjExtent();return[new et(e.xmin,e.ymax),new et((e.xmax+e.xmin)/2,e.ymax),new et(e.xmax,e.ymax),new et(e.xmin,(e.ymax+e.ymin)/2),new et(e.xmax,(e.ymax+e.ymin)/2),new et(e.xmin,e.ymin),new et((e.xmax+e.xmin)/2,e.ymin),new et(e.xmax,e.ymin)]}(),p=function(p){if(Array.isArray(t)&&t.some(function(t){return t===p}))return"continue";var g,m=d[p],v=a?m:c._prjToContainerPoint(m);if(u.length<d.length-t.length){var _=n.createHandle(v,{symbol:f,cursor:r[p],axis:o[p],onMove:(g=p,function(t){h._updating=!0,e(t.containerPoint,g),s.fire("resizing")}),onUp:function(){h._updating=!1,i()}});l[p]=u.length,u.push(_)}else u[l[p]].setContainerPoint(v)},g=0;g<d.length;g++)p(g)};return d(),this._addRefreshHook(d),u},i.createMarkerEditor=function(){var t=this,e=this._shadow||this._geometry,i=this.getMap();if(e._canEdit()){this._history||this._recordHistory(d());var n=e._getInternalSymbol(),r=new et(0,0);p(n.markerDx)&&(r.x=n.markerDx),p(n.markerDy)&&(r.y=n.markerDy);var o=null,s="middle",a="middle";if(Lr.test(n)){var h=n.markerType;"pin"===h||"pie"===h||"bar"===h?(o=[5,6,7],s="bottom"):"rectangle"===h&&(o=[0,1,2,3,5],s="top",a="left")}else(Sr.test(n)||Dr.test(n))&&(s="bottom",o=[5,6,7]);var u,l=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var c=e.getSize();u=c.width/c.height}var f=this._createResizeHandles(o,function(n,h){if(o&&o.indexOf(h)>=0){var c=i.containerPointToCoordinate(n.sub(r)),d=e.getCoordinates();c.x=d.x,e.setCoordinates(c),t._updateCoordFromShadow(!0),n=f[f.length-1-h].getContainerPoint()}var p=i.coordToContainerPoint(e.getCoordinates()).add(r),g=e._getInternalSymbol(),m=n.sub(p);"bottom"===s&&n.y>p.y&&(m.y=0);var v="middle"===s?2:1,_="left"===a?1:2,y=Math.abs(m.x)*_,x=Math.abs(m.y)*v;u&&(x=(y=Math.max(y,x*u))/u);var w=l[h];e instanceof es?((u||0===w||2===w)&&(e.setWidth(y),e!==t._geometry&&t._geometry.setWidth(y)),(u||1===w||2===w)&&(e.setHeight(x),e!==t._geometry&&t._geometry.setHeight(x))):((u||0===w||2===w)&&(g.markerWidth=Math.min(y,t._geometry.options.maxMarkerWidth||1/0)),(u||1===w||2===w)&&(g.markerHeight=Math.min(x,t._geometry.options.maxMarkerHeight||1/0)),e.setSymbol(g),e!==t._geometry&&t._geometry.setSymbol(g))},function(){t._update(d())})}else console&&console.warn("A marker can't be resized with symbol:",e.getSymbol());function d(){var t=[["setCoordinates",e.getCoordinates().toArray()]];return e instanceof es?(t.push(["setWidth",e.getWidth()]),t.push(["setHeight",e.getHeight()])):t.push(["setSymbol",e.getSymbol()]),t}},i.createCircleEditor=function(){var t=this,e=this._shadow||this._geometry,i=this.getMap();this._history||this._recordHistory([["setCoordinates",e.getCoordinates().toArray()],["setRadius",e.getRadius()]]),this._createResizeHandles(null,function(n){var r=e.getCenter(),o=i.containerPointToCoord(n),s=new Lo([[r.x,r.y],[o.x,r.y]]),a=new Lo([[r.x,r.y],[r.x,o.y]]),h=Math.max(i.computeGeometryLength(s),i.computeGeometryLength(a));e.setRadius(h),e!==t._geometry&&t._geometry.setRadius(h)},function(){t._update("setRadius",e.getRadius())})},i.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],i=this._shadow||this._geometry;this._history||this._recordHistory(a());var n,r=this.getMap(),o=this._geometry instanceof $o;this.options.fixAspectRatio&&(n=i.getWidth()/i.getHeight());var s=this._createResizeHandles(null,function(a,h){var u,l,c,f=o?1:2,d=s[h].getContainerPoint(),p=e[h];if(o){var g=s[7-h].getContainerPoint(),m=(u=d.sub(g)).abs();l=r.pixelToDistance(m.x,0),c=r.pixelToDistance(0,m.y);var v=i.getSize(),_=i.getCoordinates(),y=i.getWidth(),x=i.getHeight(),w=r.containerPointToCoord(a),b=r.containerPointToCoord(g),C=new Lo([[b.x,b.y],[w.x,b.y]]),P=new Lo([[b.x,b.y],[b.x,w.y]]);if(l=r.computeGeometryLength(C),c=r.computeGeometryLength(P),0===p)if(n&&(m.y=m.x/n,v.height=Math.abs(m.y),c=l/n),d.y=g.y-v.height/2,w.y=_.y,4===h)w.x=Math.min(w.x,_.x);else{var M=r.locate(_,y,0);w.x=r.locate(new Yi(M.x,w.y),-l,0).x}else if(1===p)n&&(m.x=m.y*n,v.width=Math.abs(m.x),l=c*n),d.x=g.x-v.width/2,w.x=_.x,w.y=Math.max(w.y,b.y);else{if(n&&(l>c*n?(c=l/n,d.y=g.y+m.x*ct(u.y)/n):(l=c*n,d.x=g.x+m.y*ct(u.x)*n)),0===h||5===h){var T=0===h?r.locate(_,y,0):r.locate(_,y,-x);w.x=r.locate(new Yi(T.x,w.y),-l,0).x}else w.x=Math.min(w.x,b.x);w.y=Math.max(w.y,b.y)}i.setCoordinates(w),t._updateCoordFromShadow(!0)}else{var S=i.getCenter(),A=r.containerPointToCoord(d),E=new Lo([[S.x,S.y],[A.x,S.y]]),k=new Lo([[S.x,S.y],[S.x,A.y]]);l=r.computeGeometryLength(E),c=r.computeGeometryLength(k),n&&(c=(l=Math.max(l,c*n))/n)}(n||0===p||2===p)&&(i.setWidth(l*f),i!==t._geometry&&t._geometry.setWidth(l*f)),(n||1===p||2===p)&&(i.setHeight(c*f),i!==t._geometry&&t._geometry.setHeight(c*f))},function(){t._update(a())});function a(){return[["setCoordinates",i.getCoordinates().toArray()],["setWidth",i.getWidth()],["setHeight",i.getHeight()]]}},i.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow||this._geometry,i=this;this._history||this._recordHistory("setCoordinates",Yi.toNumberArrays(e.getCoordinates()));var n=e instanceof Ao?3:2,r="maptalks--editor-vertex-index",o={0:[]},s={0:[]};function a(t){if(void 0===t&&(t=0),e instanceof Ao){var i=e.getCoordinates()[t]||[];return i.slice(0,i.length-1)}return e.getCoordinates()}function h(t){return void 0===t&&(t=0),0===t?e._getPrjCoordinates():e._getPrjHoles()[t-1]}function u(){for(var t in o){for(var e=o[t].length-1;e>=0;e--)o[t][e][r]=e;for(var n=s[t].length-1;n>=0;n--)s[t][n][r]=n}i._updateCoordFromShadow()}function l(t){i._updating=!0;var a=t.target,l=a[r],c=p(a._ringIndex)?a._ringIndex:0,f=h(c);if(!(f.length<=n)){var d,g=e instanceof Lo&&(0===l||l===f.length-1);f.splice(l,1),c>0?e._prjHoles[c-1]=f:e._setPrjCoordinates(f),e._updateCache(),o[c].splice(l,1)[0].delete(),l<s[c].length&&s[c].splice(l,1)[0].delete(),d=0===l?s[c].length-1:l-1,s[c].splice(d,1)[0].delete(),g||s[c].splice(d,0,v.call(i,d,c)),u(),i._updating=!1}}function c(n,r,o){void 0===o&&(o=0);var a,u=h(o),l=t._containerPointToPrj(n.sub(d())),c=u[r];c.x=l.x,c.y=l.y,e._updateCache(),e.onShapeChanged(),i._updateCoordFromShadow(!0),a=0===r?s[o].length-1:r-1,s[o][r]&&s[o][r].refresh(),s[o][a]&&s[o][a].refresh()}var f=new et(0,0);function d(){var t=e._getCompiledSymbol();return f.x=t.lineDx||0,f.y=t.lineDy||0,f}function g(e,n){void 0===n&&(n=0);var o=a(n)[e],s=i.createHandle(t.coordToContainerPoint(o)._add(d()),{symbol:i.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){c(s.getContainerPoint(),s[r],n)},onRefresh:function(){o=a(n)[s[r]];var e=t.coordToContainerPoint(o);s.setContainerPoint(e._add(d()))},onUp:function(){i._updateCoordFromShadow()},onDown:function(t,e){!e||!e.domEvent||e.domEvent.button}});return s[r]=e,s._ringIndex=n,s.on(i.options.removeVertexOn,l),s}var m=!1;function v(n,l){void 0===l&&(l=0);var f,p=a(l);f=n+1>=p.length?p[0]:p[n+1];var _=p[n].add(f).multi(.5),y=i.createHandle(_,{symbol:i.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(n,o){if(!o||!o.domEvent||2!==o.domEvent.button){var a=h(l),u=y[r],c=y.getContainerPoint(),f=t._containerPointToPrj(c);a.splice(u+1,0,f),l>0?e._prjHoles[l-1]=a:e._setPrjCoordinates(a),e._updateCache(),y.opacity=1,s[l].splice(u,0,v.call(i,u,l),v.call(i,u+1,l)),m=!0}},onMove:function(){c(y.getContainerPoint(),y[r]+1,l)},onUp:function(t){if(t&&t.domEvent&&2===t.domEvent.button)m=!1;else{var e=y[r];ht(y,s[l]),y.delete(),o[l].splice(e+1,0,g.call(i,e+1,l)),u(),i._updateCoordFromShadow(),m=!1}},onRefresh:function(e){p=a(e);var i,n=y[r];i=n===p.length-1?0:n+1;var o=p[n].add(p[i]).multi(.5),s=t.coordToContainerPoint(o);y.setContainerPoint(s._add(d()))}});return y[r]=n,y}if(e instanceof Ao)for(var _=e.getHoles().length+1,y=0;y<_;y++){o[y]=[],s[y]=[];for(var x=a(y),w=0,b=x.length;w<b;w++)o[y].push(g.call(this,w,y)),w<b-1&&s[y].push(v.call(this,w,y));s[y].push(v.call(this,x.length-1,y))}else for(var C=0,P=a(0).length;C<P;C++)o[0].push(g.call(this,C,0)),C<P-1&&s[0].push(v.call(this,C,0));this._addRefreshHook(function(){if(!m){for(var t in s)for(var e=s[t].length-1;e>=0;e--)s[t][e].refresh(t);for(var i in o)for(var n=o[i].length-1;n>=0;n--)o[i][n].refresh(i)}})},i._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},i._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},i._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},i._update=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this._exeHistory([t,i]),this._recordHistory.apply(this,[t].concat(i))},i._updateCoordFromShadow=function(t){var e=(this._shadow||this._geometry).getCoordinates(),i=this._geometry,n=this._updating;this._updating=!0,i.setCoordinates(e),t||this._recordHistory("setCoordinates",Yi.toNumberArrays(i.getCoordinates())),this._updating=n},i._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(this._history.length){var r=this._history[this._history.length-1];if(r[0]===t&&JSON.stringify(r[1])===JSON.stringify(i))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,i]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},i.cancel=function(){if(!this._history||0===this._historyPointer)return this;this._historyPointer=0;var t=this._history[0];return this._exeAndReset(t),this},i.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},i.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},i._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,i=this._historyPointer;this.stop(),this._history=e,this._historyPointer=i,this.start()}},i._onDragStart=function(){this._updating=!0},i._onDragEnd=function(){this._updating=!1},i._exeHistory=function(t){if(Array.isArray(t)){var e=this._updating;this._updating=!0;var i=this._shadow||this._geometry,n=this._geometry;Array.isArray(t[0])?t[0].forEach(function(t){var e=t[0],r=t.slice(1);i[e].apply(i,r),i!==n&&n[e].apply(n,r)}):(i[t[0]].apply(i,t[1]),i!==n&&n[t[0]].apply(n,t[1])),this._updating=e}},e}(Ci(Mi));Eh.mergeOptions(Ah);var kh={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),hi(this._textEditor,"mousedown dblclick",Ue),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var i=this._getEditorOffset();this._editUIMarker=new ra(this.getCoordinates(),{animation:null,content:e,dx:i.dx,dy:i.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,i=0,n=t.textHorizontalAlignment;return"middle"===n||d(n)?(e=(t.textDx||0)-2,i=(t.textDy||0)-2):(e=(t.markerDx||0)-2,i=(t.markerDy||0)-2),{dx:e,dy:i}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),i=this._getInternalSymbol()||{},n=e.width,r=i.textFill||"#000000",o=i.textSize||12,s=e.height,a=i.markerLineColor||"#000",h=i.markerFill||"#3398CC",u=i.textLineSpacing||0,l=Ne("div");return l.contentEditable=!0,l.style.cssText="background:"+h+"; border:1px solid "+a+";\n            color:"+r+";font-size:"+o+"px;width:"+(n-2)+"px;height:"+(s-2)+"px;margin: auto;\n            line-height:"+(o+u)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",l.innerText=t,ai(l,"mousedown dblclick",Ue),l.onkeyup=function(t){var e=l.style.height||0;13===t.keyCode&&(l.style.height=parseInt(e)+o/2+"px")},l},_setCursorToLast:function(t){var e;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}};ts.include(kh),Qr.include({animate:function(t,e,i){var n=this;this._animPlayer&&this._animPlayer.finish(),_(e)&&(i=e),e||(e={});var r,o=this.getMap(),s=this._getProjection(),a=this.getSymbol()||{},h=this._prepareAnimationStyles(t),u=e.focus;if(delete this._animationStarted,o){var l=o._getRenderer();e.framer=function(t){l.callInNextFrame(t)}}var c=Mo.animate(h,e,function(t){if(o&&o.isRemoved())c.finish();else{o&&!n._animationStarted&&u&&o.onMoveStart();var e=t.styles;for(var h in e)if("symbol"!==h&&"translate"!==h&&e.hasOwnProperty(h)){var l="set"+h[0].toUpperCase()+h.slice(1);n[l](e[h])}var f=e.translate;if(f){var d=f;r&&(d=f.sub(r)),r=f,n.translate(d)}var p=e.symbol;if(p&&n.setSymbol(Ee(a,p)),o&&u){var g=s.project(n.getCenter());o._setPrjCenter(g);var m=o._parseEventFromCoord(s.unproject(g));"running"!==c.playState?o.onMoveEnd(m):o.onMoving(m)}n._fireAnimateEvent(c.playState),i&&i(t)}},this);return this._animPlayer=c,this._animPlayer.play()},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),i={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if("translate"!==n&&"symbol"!==n){var o=this["get"+n[0].toUpperCase()+n.substring(1)]();i[n]=[o,r]}else if("symbol"===n){var s=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");s=[];for(var a=t.symbol,h=0;h<a.length;h++)if(a[h]){var u={};for(var l in a[h])a[h].hasOwnProperty(l)&&(u[l]=[e[h][l],a[h][l]]);s.push(u)}else s.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var c in s={},r)r.hasOwnProperty(c)&&(s[c]=[e[c],r[c]])}i.symbol=s}else"translate"===n&&(i.translate=new Yi(r))}return i},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var Rh=q.touch?"touchstart mousedown":"mousedown",Oh=function(t){function e(e){return t.call(this,e)||this}Y(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on(Rh,this._startDrag,this)},i.removeHooks=function(){this._endDrag(),this.target.off(Rh,this._startDrag,this),delete this.container},i._prepareDragHandler=function(){this._dragHandler=new qi(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i._prepareShadow=function(){var t=this,e=this.target;if("canvas"===e.getLayer().options.renderer){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var i=this._shadow=e.copy();if(i.getGeometries){var n=i.getGeometries(),r=e.getGeometries();n.forEach(function(e,i){t._updateShadowSymbol(e,r[i])})}else this._updateShadowSymbol(i,e);i.setId(null),this._prepareShadowConnectors()}},i._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var i=Ae(t._getInternalSymbol(),.5);t.setSymbol(i)}},i._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,i=this._dragStageLayer._getRenderer().resources,n=[];if(os._hasConnectors(t))for(var r=os._getConnectors(t),o=0,s=r.length;o<s;o++){var a=r[o],h=a.config(),u=a._getInternalSymbol();h.symbol=Ae(u,.5);var l=void 0;l=a.getConnectSource()===t?new a.constructor(e,a.getConnectTarget(),h):new a.constructor(a.getConnectSource(),e,h),n.push(l),a.getLayer()&&a.getLayer()._getRenderer()&&i.merge(a.getLayer()._getRenderer().resources)}this._shadowConnectors=n,n.push(e),this._dragStageLayer.bringToFront().addGeometry(n)},i._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer("_maptalks__internal_layer__drag_stage"),this._dragStageLayer||(this._dragStageLayer=new ls("_maptalks__internal_layer__drag_stage",{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var i=new In;i.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=i},i._startDrag=function(t){var e=this.target.getMap();if(e&&(!this.target._getParent()&&!this.isDragging())){var i=t.domEvent;i.touches&&i.touches.length>1||2===i.button||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),ai(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}},i._dragging=function(t){var e=this.target,i=e.getMap(),n=i._parseEvent(t.domEvent),r=n.domEvent;if(!(r.touches&&r.touches.length>1)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",n)),this.target._fireEvent("dragstart",this._startParam||n),void delete this._startParam;var o=this._shadow||e,s=o.options.dragOnAxis,a=o.options.dragOnScreenAxis,h=n.containerPoint,u=n.coordinate;this._lastPoint=this._lastPoint||h,this._lastCoord=this._lastCoord||u,a?("x"===s?h.y=this._lastPoint.y:"y"===s&&(h.x=this._lastPoint.x),u=i.containerPointToCoord(h)):u=this._correctCoord(u);var l=h.sub(this._lastPoint),c=u.sub(this._lastCoord);a||("x"===s?l.y=c.y=0:"y"===s&&(l.x=c.x=0)),this._lastPoint=h,this._lastCoord=u,o.translate(c),o===e||e.options.dragShadow||e.translate(c),n.coordOffset=c,n.pointOffset=l,o._fireEvent("dragging",n),o!==e&&e._fireEvent("dragging",n)}},i._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&hi(this.container,"mouseleave",this._endDrag,this),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var i=e.getMap();if(this.enabled()&&i){var n=i._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(n),this._moved&&e._fireEvent("dragend",n)}}},i.isDragging=function(){return!!this._isDragging},i._updateTargetAndRemoveShadow=function(t){if(this._shadow){var e=this.target,i=e.getMap();e.options.dragShadow||e.show();var n=this._shadow;if(n){if(e.options.dragShadow)if(e.getGeometries){var r=n.getGeometries(),o=e.getGeometries();r.forEach(function(t,e){o[e].setCoordinates(r[e].getCoordinates())})}else e.setCoordinates(n.getCoordinates());n._fireEvent("dragend",t),n.remove(),delete this._shadow}this._shadowConnectors&&(i.getLayer("_maptalks__internal_layer__drag_stage").removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&this._dragStageLayer.remove()}},i._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var i=this.target;if(!i.getMinAltitude())return t;var n=(i.getMinAltitude()+i.getMaxAltitude())/2;return e.locateByPoint(t,0,-n)},e}(Pi);Qr.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),Qr.addInitHook("addHandler","draggable",Oh),Qr.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),Qr.include({startEdit:function(t){return this.getMap()&&this.options.editable?(this.endEdit(),this._editor=new Eh(this,t),this._editor.start(),this.fire("editstart"),this):this},endEdit:function(){return this._editor&&(this._editor.stop(),delete this._editor,this.fire("editend")),this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),Qr.include({_onEvent:function(t,e){if(this.getMap()){var i=e||this._getEventTypeToFire(t);"contextmenu"===i&&this.listens("contextmenu")&&(Ue(t),$e(t));var n=this._getEventParams(t);this._fireEvent(i,n)}},_getEventTypeToFire:function(t){return t.type},_getEventParams:function(t){var e=this.getMap(),i={domEvent:t},n=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(n){var r=Xe(n,e._containerDOM);i.coordinate=e.containerPointToCoordinate(r),i.containerPoint=r,i.viewPoint=e.containerPointToViewPoint(r),i.pont2d=e._containerPointToPoint(r)}return i}}),Qr.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof ua?(this._infoWindow=t,this._infoWinOptions=f({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=f({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(this._infoWinOptions),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(this._infoWinOptions),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(t){return this._infoWindow=new ua(t),this._infoWindow.addTo(this),this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var Lh=new et(0,0),Dh=new et(0,0),Ih=new et(0,0),jh=new et(0,0),zh=function(t){function e(e){var i;return(i=t.call(this,e)||this).tilesInView={},i.tilesLoading={},i._parentTiles=[],i._childTiles=[],i.tileCache=new ui(e.options.maxCacheSize,i.deleteTile.bind(X(X(i)))),i}Y(e,t);var i=e.prototype;return i.getCurrentTileZoom=function(){return this._tileZoom},i.draw=function(){var t=this.getMap();if(this.isDrawable()){var e=this.prepareCanvas();if(!e||e.intersects(this.canvasExtent2D)){var i=this.layer.getTiles().tileGrids;if(i&&i.length){var n=i.reduce(function(t,e){return t+(e&&e.tiles&&e.tiles.length||0)},0);n>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*n+1);var r=0,o=!1,s={},a=[],h=[],u={},l=[],c={},f=[],d={},p={},g=this._markTiles(),m=this._getLoadLimit(),v=i.length;this._tileZoom=i[0].zoom;for(var _=0;_<v;_++)for(var y=i[_],x=y.tiles,w=this._generatePlaceHolder(y.zoom),b=0,C=x.length;b<C;b++){var P=x[b],M=P.id,T=!1;if(this._isLoadingTile(M))T=o=!0,this.tilesLoading[M].current=!0;else{var S=this._getCachedTile(M);if(S)S.image&&this.getTileOpacity(S.image)<1&&(T=o=!0),a.push(S);else if(T=o=!0,!(m&&r+g[0]>m)&&(!t.isInteracting()||t.isMoving()||t.isRotating()))r++,p[M]=P}if(T&&!s[M]){s[M]=1,w&&!d[M]&&(P.cache=!1,f.push({image:w,info:P}),d[M]=1);var A=this._findParentTile(P);if(A){var E=A.info.id;void 0===u[E]&&(u[E]=h.length,h.push(A))}else if(!h.length){var k=this._findChildTiles(P);k.length&&k.forEach(function(t){c[t.info.id]||(l.push(t),c[t.info.id]=1)})}}}h.length&&(l.length=0,this._childTiles.length=0),this._drawTiles(a,h,l,f),r?this.loadTileQueue(p):o||(t.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),this._retireTiles()}else this.completeRender()}else this.completeRender()}},i.isTileCachedOrLoading=function(t){return this.tilesLoading[t]||this.tilesInView[t]||this.tileCache.get(t)},i._drawTiles=function(t,e,i,n){var r=this;e.length&&(e.sort(function(t,e){return Math.abs(e.info.z-r._tileZoom)-Math.abs(t.info.z-r._tileZoom)}),this._parentTiles=e),i.length&&(this._childTiles=i);var o={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles};this.onDrawTileStart(o),this._parentTiles.forEach(function(t){return r._drawTileAndCache(t)}),this._childTiles.forEach(function(t){return r._drawTile(t.info,t.image)}),n.forEach(function(t){return r._drawTile(t.info,t.image)});var s=this.layer,a=this.getMap();if(!s.options.cascadeTiles||a.getPitch()<=a.options.cascadePitches[0])t.forEach(function(t){return r._drawTileAndCache(t)});else{this.writeZoomStencil();for(var h=!1,u=0,l=t.length;u<l;u++)t[u].info.z!==this._tileZoom?h?this.resumeZoomStencilTest():(this.startZoomStencilTest(),h=!0):h&&this.pauseZoomStencilTest(),this._drawTileAndCache(t[u]);this.endZoomStencilTest()}this.onDrawTileEnd(o)},i.writeZoomStencil=function(){},i.startZoomStencilTest=function(){},i.endZoomStencilTest=function(){},i.pauseZoomStencilTest=function(){},i.resumeZoomStencilTest=function(){},i.onDrawTileStart=function(){},i.onDrawTileEnd=function(){},i._drawTile=function(t,e){e&&this.drawTile(t,e)},i._drawTileAndCache=function(t){t.current=!0,this.tilesInView[t.info.id]=t,this._drawTile(t.info,t.image),this.tileCache.add(t.info.id,t)},i.drawOnInteracting=function(){this.draw()},i.needToRedraw=function(){var e=this.getMap();return e.getPitch()?t.prototype.needToRedraw.call(this):!(!e.isRotating()&&!e.isZooming())||(e.isMoving()?!!this.layer.options.forceRenderOnMoving:t.prototype.needToRedraw.call(this))},i.hitDetect=function(){return!1},i._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},i.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],t.prototype.clear.call(this)},i._isLoadingTile=function(t){return!!this.tilesLoading[t]},i.clipCanvas=function(e){return t.prototype.clipCanvas.call(this,e)},i._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var i=e.getContainerExtent(),n=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(i.ymin)*n,Math.ceil(i.getWidth())*n,Math.ceil(i.getHeight())*n),t.stroke(),t.clip(),!0},i.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e],n=this.loadTile(i);void 0===n.loadTime&&(this.tilesLoading[i.id]={image:n,current:!0,info:i})}},i.loadTile=function(t){var e=this.layer.getTileSize(t.layer),i=new Image;return i.width=e.width,i.height=e.height,i.onload=this.onTileLoad.bind(this,i,t),i.onerror=this.onTileError.bind(this,i,t),this.loadTileImage(i,t.url),i},i.loadTileImage=function(t,e){var i=this.layer.options.crossOrigin;return d(i)||(t.crossOrigin=i),nt(t,[e])},i.abortTileLoading=function(t){t&&(t.onload=Hh,t.onerror=Hh,t.src=Mt)},i.onTileLoad=function(t,e){if(this.layer){var i=e.id;if(this.tilesInView){var n={tile:e,tileImage:t};this.layer.fire("tileload",n),(t=n.tileImage).loadTime=c(),delete this.tilesLoading[i],this._addTileToCache(e,t),this.setToRedraw()}}},i.onTileError=function(t,e){if(this.layer){if(t.onerrorTick=t.onerrorTick||0,this.layer.options.tileRetryCount>t.onerrorTick)return t.onerrorTick++,void(t.src=e.url);if(t instanceof Image){var i=this.layer.options.errorUrl;if(i&&t.src!==i)return void(t.src=i);this.abortTileLoading(t,e)}t.loadTime=0,delete this.tilesLoading[e.id],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},i.drawTile=function(t,e){if(e&&this.getMap()){var i=t.extent2d,n=t.offset,r=Lh.set(i.xmin-n[0],i.ymax-n[1]),o=t.z,s=t.id,a=this.getMap(),h=a.getZoom(),u=this.context,l=a._pointToContainerPoint(r,o,0,Dh),c=a.getBearing(),f=c||h!==o,d=this.getTileOpacity(e),p=u.globalAlpha;d<1&&(u.globalAlpha=d,this.setToRedraw()),f||l._round();var g=l.x,m=l.y,v=t.extent2d.xmax-t.extent2d.xmin,_=t.extent2d.ymax-t.extent2d.ymin;if(f){if(u.save(),u.translate(g,m),c&&(u.rotate(-c*Math.PI/180),v+=.1,_+=.1),h!==o){var y=a._getResolution(o)/a._getResolution();u.scale(y,y)}g=m=0}if(pi.image(u,e,g,m,v,_),this.layer.options.debug){var x=this.layer.options.debugOutline;u.save(),u.strokeStyle=x,u.fillStyle=x,u.strokeWidth=10,u.font="20px monospace";var w=new et(g,m);pi.rectangle(u,w,{width:v,height:_},1,0),pi.fillText(u,this.getDebugInfo(s),w._add(10,20),x),pi.drawCross(u,g+v/2,m+_/2,2,x),u.restore()}f&&u.restore(),u.globalAlpha!==p&&(u.globalAlpha=p),this.setCanvasUpdated()}},i.getDebugInfo=function(t){var e=t.split("_"),i=e.length;return"x:"+e[i-2]+", y:"+e[i-3]+", z:"+e[i-1]},i._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer);if(!e.options.background)return[];for(var i=this.getMap(),n=[],r=e.getSpatialReference().getResolution(t.z),o=t.extent2d.getMin(),s=t.extent2d.getMax(),a=e._project(i._pointToPrjAtRes(o,r,Ih),Ih),h=e._project(i._pointToPrjAtRes(s,r,jh),jh),u=1;u<2;u++)this._findChildTilesAt(n,a,h,e,t.z+u);return n},i._findChildTilesAt=function(t,e,i,n,r){var o=n.options.zoomOffset,s=n.getId(),a=n.getSpatialReference().getResolution(r+o);if(a)for(var h,u,l=n._getTileConfig().getTileIndex(e,a),c=n._getTileConfig().getTileIndex(i,a),f=Math.min(l.idx,c.idx),d=Math.max(l.idx,c.idx),p=Math.min(l.idy,c.idy),g=Math.max(l.idy,c.idy),m=f;m<d;m++)for(var v=p;v<g;v++)h=n._getTileId(m,v,r+o,s),this.tileCache.has(h)&&(u=this.tileCache.getAndRemove(h),t.push(u),this.tileCache.add(h,u))},i._findParentTile=function(t){var e=this.getMap(),i=this._getLayerOfTile(t.layer);if(!i.options.background)return null;for(var n=i.getSpatialReference(),r=n.getZoomDirection(),o=i.options.zoomOffset,s=i.options.backgroundZoomDiff,a=n.getResolution(t.z),h=t.extent2d.getCenter(),u=i._project(e._pointToPrjAtRes(h,a)),l=1;l<=s;l++){var c=t.z-r*l,f=n.getResolution(c+o);if(f){var d=i._getTileConfig().getTileIndex(u,f),p=i._getTileId(d.x,d.y,c+o,t.layer);if(this.tileCache.has(p)){var g=this.tileCache.getAndRemove(p);return this.tileCache.add(p,g),g}}}return null},i._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},i._getCachedTile=function(t){var e=this.tilesInView,i=this.tileCache.getAndRemove(t);if(i){e[t]=i;var n=this.tilesLoading;if(n&&n[t]){n[t].current=!1;var r=n[t],o=r.image,s=r.info;this.abortTileLoading(o,s),delete n[t]}}else i=e[t];return i},i._addTileToCache=function(t,e){this.tilesInView[t.id]={image:e,current:!0,info:t}},i.getTileOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(c()-t.loadTime)/(1e3/60*10)):1},i.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,t.prototype.onRemove.call(this)},i._markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var i in this.tilesLoading)this.tilesLoading[i].current=!1,t++;if(this.tilesInView)for(var n in this.tilesInView)this.tilesInView[n].current=!1,e++;return[t,e]},i._retireTiles=function(t){for(var e in this.tilesLoading){var i=this.tilesLoading[e];!t&&i.current||(i.image&&this.abortTileLoading(i.image,i.info),this.deleteTile(i),delete this.tilesLoading[e])}for(var n in this.tilesInView){var r=this.tilesInView[n];r.current||(delete this.tilesInView[n],this.tileCache.has(n)||this.deleteTile(r))}},i.deleteTile=function(t){t&&t.image&&(t.image.onload=null,t.image.onerror=null)},i._generatePlaceHolder=function(t){var e=this.getMap(),i=this.layer.options.placeholder;if(!i||e.getPitch())return null;var n=this.layer.getTileSize(),r=e._getResolution(t)/e._getResolution(),o=this._tilePlaceHolder=this._tilePlaceHolder||pi.createCanvas(1,1,e.CanvasClass);return o.width=n.width*r,o.height=n.height*r,_(i)?i(o):function(t){var e=t.getContext("2d"),i=t.width,n=t.height,r=i/16,o=n/16;e.beginPath();for(var s=0;s<16;s++)e.moveTo(0,s*o),e.lineTo(i,s*o),e.moveTo(s*r,0),e.lineTo(s*r,n);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();for(var a=[[0,0],[i,0],[0,n],[i,n],[0,0],[0,n],[i,0],[i,n],[0,n/2],[i,n/2],[i/2,0],[i/2,n]],h=1;h<a.length;h+=2)e.moveTo(a[h-1][0],a[h-1][1]),e.lineTo(a[h][0],a[h][1]);e.lineWidth=4,e.stroke()}(o),o},e}(Dn);function Hh(){return!1}Ja.registerRenderer("canvas",zh);var Fh=new et(0,0),Nh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.isDrawable=function(){return!0},i.needToRedraw=function(){var e=this.getMap();return!(!this._gl()||e.getPitch()||!e.isZooming()||e.isMoving()||e.isRotating())||t.prototype.needToRedraw.call(this)},i.drawTile=function(e,i){var n=this.getMap();if(e&&n&&i){var r=e._glScale=e._glScale||n.getGLScale(e.z),o=e.extent2d.xmax-e.extent2d.xmin,s=e.extent2d.ymax-e.extent2d.ymin;if(!1!==e.cache&&this._bindGLBuffer(i,o,s),this._gl()){var a=e.extent2d,h=e.offset,u=Fh.set(a.xmin-h[0],e.extent2d.ymax-h[1]),l=u.x*r,c=u.y*r,f=this.getTileOpacity(i),d=null;this.layer.options.debug&&(d=this.getDebugInfo(e.id)),this.drawGLImage(i,l,c,o,s,r,f,d),f<1?this.setToRedraw():this.setCanvasUpdated()}else t.prototype.drawTile.call(this,e,i)}},i.writeZoomStencil=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE)},i.startZoomStencilTest=function(){var t=this.gl;t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilFunc(t.EQUAL,0,255)},i.endZoomStencilTest=function(){this.pauseZoomStencilTest()},i.pauseZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255)},i.resumeZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.EQUAL,0,255)},i._bindGLBuffer=function(t,e,i){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,i))},i.loadTileImage=function(t,e){var i=this.layer.options.crossOrigin;t.crossOrigin=null!==i?i:"",t.src=e},i.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},i.createContext=function(){t.prototype.createContext.call(this),this.createGLContext()},i.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return t.prototype.getCanvasImage.call(this);var e=t.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},i._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},i.deleteTile=function(e){t.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image),delete e.image},i.onRemove=function(){t.prototype.onRemove.call(this),this.removeGLCanvas()},e}(lh(zh));function Zh(t){var e=this.layer.getTileSize(),i=this.canvas.constructor,n=this.getMap(),r=n.getDevicePixelRatio(),o=pi.createCanvas(e.width*r,e.height*r,i);o.layer=this.layer;var s=this,a=new et(t.extent2d.xmin,t.extent2d.ymax),h=new cn(n.pointToCoordinate(a),n.pointToCoordinate(a.add(e.width,e.height)),n.getProjection());return this.layer.drawTile(o,{url:t.url,point:a,center:n.pointToCoordinate(a.add(e.width/2,e.height/2)),extent:h,z:t.z,x:t.x,y:t.y},function(e){e?s.onTileError(o,t):s.onTileLoad(o,t)}),o}Ja.registerRenderer("gl",Nh);var Gh=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.prototype.loadTile=function(){return Zh.apply(this,arguments)},e}(zh),Bh=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.prototype.loadTile=function(){return Zh.apply(this,arguments)},e}(Nh);th.registerRenderer("canvas",Gh),th.registerRenderer("gl",Bh);var Wh="undefined"!=typeof Int8Array?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[];!function(){function t(t,e,i){this.gl=t,this.quadVertices=e||Wh,this.attributes=["a_position",3,function(t){if(t instanceof Float32Array)return"FLOAT";if(t instanceof Int16Array)return"SHORT";if(t instanceof Uint16Array)return"UNSIGNED_SHORT";if(t instanceof Int8Array)return"BYTE";if(t instanceof Uint8Array||t instanceof Uint8ClampedArray)return"UNSIGNED_BYTE";return"FLOAT"}(e)],this.debug=i}var e=t.prototype;e.start=function(){var t=this.gl;t.enable(t.STENCIL_TEST),t.stencilMask(255),t.stencilOp(t.KEEP,t.REPLACE,t.REPLACE),t.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),nh(t,this.program,this.attributes),this.transformLoc||(this.transformLoc=t.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=t.getUniformLocation(this.program,"color")),this.debug||t.colorMask(!1,!1,!1,!1)},e.end=function(){var t=this.gl;t.depthMask(!0),this._restore(),this.debug||t.colorMask(!0,!0,!0,!0)},e.draw=function(t){var e=this.gl;e.uniformMatrix4fv(this.transformLoc,!1,t),e.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},e.remove=function(){var t=this.gl;return this.buffer&&t.deleteBuffer(this.buffer),this.program&&(t.deleteShader(this.program.fragmentShader),t.deleteShader(this.program.vertexShader),t.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},e.stencilMask=function(t){return this.gl.stencilMask(t),this},e.stencilFunc=function(t,e,i){return this.ref=e,this.gl.stencilFunc(t,e,i),this},e.stencilOp=function(t,e,i){return this.gl.stencilOp(t,e,i),this},e.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},e._save=function(){var t=this.gl;this._savedProgram=t.program},e._restore=function(){var t=this.gl;t.program=this._savedProgram,t.program&&t.useProgram(t.program)},e._createBuffer=function(){var t=this.gl;if(this.buffer=t.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.quadVertices,t.STATIC_DRAW)},e._createProgram=function(){var t=ih(this.gl,"\n    attribute vec3 a_position;\n    uniform mat4 transform;\n\n    void main()\n    {\n        gl_Position = transform * vec4(a_position, 1.0);\n    }\n","\n    precision mediump float;\n    uniform vec3 color;\n    void main()\n    {\n        gl_FragColor = vec4(color, 1.0);\n    }\n"),e=t.program,i=t.vertexShader,n=t.fragmentShader;e.vertexShader=i,e.fragmentShader=n,this.program=e}}();var Vh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.checkResources=function(){var t=this._geosToCheck;if(this._resourceChecked||t||(t=this.layer._geoList),!mt(t))return[];for(var e=[],i={},n=t.length-1;n>=0;n--){var r=t[n]._getExternalResources();if(r.length)if(this.resources)for(var o=0;o<r.length;o++){var s=r[o][0];this.resources.isResourceLoaded(r[o])||i[s]||(e.push(r[o]),i[s]=1)}else e.push.apply(e,r)}return this._resourceChecked=!0,delete this._geosToCheck,e},i.render=function(){return this.layer._sortGeometries(),t.prototype.render.apply(this,arguments)},i._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),at(this._geosToCheck,t))},i.onGeometryAdd=function(t){this._addGeoToCheckRes(t),$h(this)},i.onGeometryRemove=function(){$h(this)},i.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),$h(this)},i.onGeometryShapeChange=function(){$h(this)},i.onGeometryPositionChange=function(){$h(this)},i.onGeometryZIndexChange=function(){$h(this)},i.onGeometryShow=function(){$h(this)},i.onGeometryHide=function(){$h(this)},i.onGeometryPropertiesChange=function(){$h(this)},e}(Dn);function $h(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var Uh=new dn,Jh=[],qh=new dn,Yh=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.getImageData=function(){if(!this.layer.options.geometryEvents||!this._lastRenderTime||c()-this._lastRenderTime<32)return null;if(!this._imageData){var t=this.context.canvas,e=t.width,i=t.height;this._imageData=this.context.getImageData(0,0,e,i)}return this._imageData},i.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=c()},i.checkResources=function(){var e=this,i=t.prototype.checkResources.apply(this,arguments),n=this.layer.getStyle();return n&&(Array.isArray(n)||(n=[n]),n.forEach(function(t){for(var n=oe(t.symbol,!0),r=0,o=n.length;r<o;r++)e.resources.isResourceLoaded(n[r])||i.push(n[r])})),i},i.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableAltitude)||!(e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===ls)&&t.prototype.needToRedraw.call(this)},i.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},i.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},i.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),i=this.mapStateCache.resolution;(t.isZooming()&&t.options.seamlessZoom&&void 0!==this._drawnRes&&i>1.5*this._drawnRes&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._drawnRes=i),this._sortByDistanceToCamera(t.cameraPosition);for(var n=0,r=this._geosToDraw.length;n<r;n++){var o=this._geosToDraw[n];o._isCheck||o.isVisible()?(o._paint(this._displayExtent),this._geosToDraw[n]._cPoint=void 0,this._geosToDraw[n]._inCurrentView=void 0):(delete o._cPoint,delete o._inCurrentView)}this.clearImageData()}},i.show=function(){this.layer.forEach(function(t){t._repaint()}),t.prototype.show.apply(this,arguments)},i.forEachGeo=function(t,e){this.layer.forEach(t,e)},i.drawGeos=function(){this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._sortByDistanceToCamera(this.getMap().cameraPosition);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(),this._geosToDraw[t]._cPoint=void 0,this._geosToDraw[t]._inCurrentView=void 0;this.clearImageData()},i.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},i.checkGeo=function(t){if("Point"!==t.type||void 0===this._onlyHasPoint){if(t._isCheck=!1,t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),i=!0;if(t._inCurrentView)i=!0;else if(!1===t._inCurrentView)i=!1;else{var n=e.get2DExtent(this.resources,Uh);n&&n.intersects(this._displayExtent)||(i=!1)}i&&(e.hasPoint()&&(this._hasPoint=!0),t._isCheck=!0,this._geosToDraw.push(t))}}else t._inCurrentView&&(this._hasPoint=!0,t._isCheck=!0,this._geosToDraw.push(t))},i.onZoomEnd=function(){delete this.canvasExtent2D,t.prototype.onZoomEnd.apply(this,arguments)},i.onRemove=function(){this.forEachGeo(function(t){t.onHide()}),delete this._geosToDraw},i.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},i._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},i.identifyAtPoint=function(t,e){void 0===e&&(e={});var i=this._geosToDraw;return i?this.layer._hitGeos(i,t,e):[]},i._updateMapStateCache=function(){var t=this.getMap(),e=t._pointToContainerPoint(this.southWest)._add(0,-t.height),i=t.getResolution(),n=t.getPitch(),r=t.getBearing(),o=t.getGLScale(),s=t.getGLRes(),a=t.getContainerExtent(),h=t._get2DExtent(),u=t._get2DExtentAtRes(s);return this.mapStateCache={resolution:i,pitch:n,bearing:r,glScale:o,glRes:s,_2DExtent:h,glExtent:u,containerExtent:a,offset:e},this},i._batchConversionMarkers=function(t){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var e=[],i=[],n=[],r={},o=this.layer,s=o.options,a=o.getAltitude?o.getAltitude():0,h=o.isCanvasRender();this._onlyHasPoint=!0;for(var u=0,l=0,c=this.layer._geoList.length;l<c;l++){var f=this.layer._geoList[l];if("Point"===f.getType()){var d=f._painter;d||(d=f._getPainter());var p=d.getRenderPoints("center")[0][0],g=s.enableAltitude?f.getAltitude():a;void 0===r[g]&&(r[g]=d.getAltitude()),e[u]=p,n[u]=r[g],i[u]=f,u++}else this._onlyHasPoint=!1}if(0===u)return[];var m=this.getMap(),v=Et(e,"_pt");v=m._pointsAtResToContainerPoints(e,t,n,v);for(var _=m.getContainerExtent(),y=_.xmax,x=_.ymax,w=_.xmin,b=_.ymin,C={},P=0,M=i.length;P<M;P++){var T=i[P];if(T._cPoint=v[P],T._cPoint){var S=v[P],A=S.x,E=S.y;if(T._inCurrentView=A>=w&&E>=b&&A<=y&&E<=x,!T._inCurrentView){var k=T.getSymbolHash(),R=void 0;R=k?C[k]=C[k]||T._painter.getFixedExtent():T._painter.getFixedExtent(),qh.set(R.xmin,R.ymin,R.xmax,R.ymax),qh._add(v[P]),T._inCurrentView=qh.intersects(_)}T._inCurrentView&&(T.isVisible()&&h||(T._inCurrentView=!1),this._onlyHasPoint&&T._inCurrentView&&(this._hasPoint=!0,T._isCheck=!0,this._geosToDraw.push(T)))}else T._inCurrentView=!1}return v},i._sortByDistanceToCamera=function(t){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var e=this.getMap(),i=e.distanceToPoint(1e3,0,e.getGLScale()).x/1e3;this._geosToDraw.sort(function(e,n){var r=e.getType(),o=n.getType();if("Point"!==r||"Point"!==o)return 0;var s=e._painter,a=n._painter;if(!s||!a)return 0;var h=s.getRenderPoints("center")[0][0],u=a.getRenderPoints("center")[0][0],l=s.getAltitude()*i,c=a.getAltitude()*i;Ts(Jh,h.x,h.y,l);var f=Rs(Jh,t);return Ts(Jh,u.x,u.y,c),Rs(Jh,t)-f})}},i._constructorIsThis=function(){return this.constructor===e},e}(Vh);ls.registerRenderer("canvas",Yh);var Xh=function(t){function e(e){var i;return(i=t.call(this)||this).map=e,i._handlerQueue=[],i}Y(e,t);var i=e.prototype;return i.callInNextFrame=function(t){this._handlerQueue.push(t)},i.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]()},i.offsetPlatform=function(t,e){if(!this.map._panels.front)return this;if(!e&&0===t.x&&0===t.y)return this;var i=this.map._panels,n=this._frontCount=i.back.layerDOM.childElementCount,r=this._backCount=i.front.layerDOM.childElementCount,o=this._uiCount=i.front.uiDOM.childElementCount;if(n||r||o){var s=this.map.offsetPlatform();s=t?s.add(t)._round():s.round(),r&&qe(i.back,s),(n||o)&&qe(i.front,s)}return this},i.domChanged=function(){var t=this.map._panels;if(!t.front)return!1;var e=t.back.layerDOM.childElementCount;if(void 0===this._frontCount||this._frontCount!==e)return!0;var i=t.front.layerDOM.childElementCount;if(void 0===this._backCount||this._backCount!==i)return!0;var n=t.front.uiDOM.childElementCount;return void 0===this._uiCount||this._uiCount!==n},i.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new et(0,0);qe(this.map._panels.back,t),qe(this.map._panels.front,t)}},i.onZoomEnd=function(){this.resetContainer()},i.onLoad=function(){this._frameLoop()},e}(Mi),Kh=function(t){function e(e){var i;return(i=t.call(this,e)||this)._containerIsCanvas=!!e._containerDOM.getContext,i._thisVisibilitychange=i._onVisibilitychange.bind(X(X(i))),i._registerEvents(),i._loopTime=0,i}Y(e,t);var i=e.prototype;return i.load=function(){this.initContainer()},i.renderFrame=function(t){if(!this.map||!this.map.options.renderable)return!1;this._updateDomPosition(t),delete this._isViewChanged;var e=this.map;e._fireEvent("framestart"),this.updateMapDOM(),e.clearCollisionIndex();var i=this._getAllLayerToRender();return this.drawLayers(i,t),this.drawLayerCanvas(i)&&(this.drawTops(),this._drawCenterCross()),e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,!0},i.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},i.drawLayers=function(t,e){for(var i=this.map,n=i.isInteracting(),r=[],o=[],s=i.options.fpsOnInteracting||0,a=0===s?0:1e3/s,h=this.map.options.layerCanvasLimitOnInteracting,u=t.length,l=i.getBaseLayer(),c=0,f=0;f<u;f++){var d=t[f];if(d.isVisible()){var p=d.isCanvasRender();p&&r.push(d.getId());var g=d._getRenderer();if(g){var m=this._checkLayerRedraw(d);p&&g.isCanvasUpdated()&&(m||o.push(d.getId()),this.setLayerCanvasUpdated());var v=g.__zoomTransformMatrix;if(delete g.__zoomTransformMatrix,m){if(n&&p){if(h>0&&u-1-f>h&&d!==l){d._getRenderer().clearCanvas();continue}c+=this._drawCanvasLayerOnInteracting(d,c,a,e)}else n&&g.drawOnInteracting?(g.prepareRender&&g.prepareRender(),g.checkAndDraw?g.checkAndDraw(g.drawOnInteracting,this._eventParam,e):g.drawOnInteracting(this._eventParam,e)):(g.render(e),p&&v&&g.isLoadingResource()&&(g.__zoomTransformMatrix=v));p&&(o.push(d.getId()),this.setLayerCanvasUpdated())}else p&&n&&(i.isZooming()&&!i.getPitch()?(g.prepareRender(),g.__zoomTransformMatrix=this._zoomMatrix):(i.getPitch()||i.isRotating())&&g.clearCanvas())}}}var _=this._canvasIds||[],y=this._updatedIds||[];if(this._canvasIds=r,this._updatedIds=o,!this.isLayerCanvasUpdated()){_.join("---")===r.join("---")&&y.join("---")===o.join("---")||this.setLayerCanvasUpdated()}},i._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,i=t._getRenderer();return t.isCanvasRender()?i.testIfNeedRedraw():!(!i.needToRedraw||!i.needToRedraw())||(e.isInteracting()||this.isViewChanged())},i._drawCanvasLayerOnInteracting=function(t,e,i,n){var r=this.map,o=t._getRenderer(),s=o.getDrawTime(),a=0===i||i>0&&e+s<=i;if(o.mustRenderOnInteracting&&o.mustRenderOnInteracting())o.render(n);else{if(o.drawOnInteracting&&(t===r.getBaseLayer()||a||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return o.prepareRender(),o.prepareCanvas(),o.checkAndDraw?o.checkAndDraw(o.drawOnInteracting,this._eventParam,n):o.drawOnInteracting(this._eventParam,n),s;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&o.clearCanvas():(o.prepareRender(),o.__zoomTransformMatrix=this._zoomMatrix)}return o.drawOnInteracting&&!a&&o.onSkipDrawOnInteracting(this._eventParam,n),0},i._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach(function(e){var i=t.getLayer(e);if(i){var n=i._getRenderer();n&&n.isRenderComplete()&&i.fire("layerload")}})}},i.isLayerCanvasUpdated=function(){return this._canvasUpdated},i.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},i.drawLayerCanvas=function(t){var e=this.map;if(!e)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged())return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var i,n=e.isInteracting(),r=e.options.layerCanvasLimitOnInteracting,o=t.length,s=[],a=0;a<o;a++){if(t[a].isVisible()&&t[a].isCanvasRender())if(t[a]._getRenderer()){var h=this._getLayerImage(t[a]);h&&h.image&&(t[a]===e.getBaseLayer()?i=[t[a],h]:s.push([t[a],h]))}}var u=this.canvas.width,l=this.canvas.height;i&&(this._drawLayerCanvasImage(i[0],i[1],u,l),this._drawFog()),o=s.length;for(var c=n&&r>=0&&o>r?o-r:0;c<o;c++)this._drawLayerCanvasImage(s[c][0],s[c][1],u,l);return e._fireEvent("renderend",{context:this.context}),!0},i.setToRedraw=function(){for(var t=this._getAllLayerToRender(),e=0,i=t.length;e<i;e++){var n=t[e].getRenderer();n&&n.canvas&&n.setToRedraw&&n.setToRedraw()}},i.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",i=t.height+"px",n=this.map._panels;n.mapWrapper.style.width=e,n.mapWrapper.style.height=i,this._updateCanvasSize()}},i.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},i.toDataURL=function(t,e){return this.canvas?this.canvas.toDataURL(t,e):null},i.remove=function(){q.webgl&&"undefined"!=typeof document&&We(document,"visibilitychange",this._thisVisibilitychange),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},i.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){for(var i=e._getLayers(),n="default",r=e.options.hitDetectLimit||0,o=0,s=i.length-1;s>=0;s--){var a=i[s];if(!(!a.options.hitDetect||a.isEmpty&&a.isEmpty())){var h=a._getRenderer();if(h&&h.hitDetect&&(!h.isBlank||!h.isBlank())){if("default"!==a.options.cursor&&h.hitDetect(t)){n=a.options.cursor||"pointer";break}if(r>0&&++o>r)break}}}e._trySetCursor(n)}},i._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},i.initContainer=function(){var t=this.map._panels;function e(e,i,n,r){var o=Ne("div",i);return n&&(o.style.cssText=n),t[e]=o,r||Je(o),o}var i=this.map._containerDOM;if(!this._containerIsCanvas){i.innerHTML="";var n="position:absolute;top:0px;left:0px;",r=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),o=e("allLayers","maptalks-all-layers",n+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),s=e("backStatic","maptalks-back-static",n+"z-index:0;",!0),a=e("back","maptalks-back",n+"z-index:1;"),h=e("backLayer","maptalks-back-layer",n),u=e("canvasContainer","maptalks-canvas-layer",n+"border:none;z-index:2;"),l=e("frontStatic","maptalks-front-static",n+"z-index:3;",!0),c=e("front","maptalks-front",n+"z-index:4;",!0),f=e("frontLayer","maptalks-front-layer",n+"z-index:0;"),d=e("ui","maptalks-ui",n+"border:none;z-index:1;",!0),p=e("control","maptalks-control","z-index:1",!0);i.appendChild(r),o.appendChild(s),a.appendChild(h),a.layerDOM=h,o.appendChild(a),o.appendChild(u),c.appendChild(f),c.layerDOM=f,c.uiDOM=d,o.appendChild(l),o.appendChild(c),c.appendChild(d),r.appendChild(o),r.appendChild(p),this.createCanvas(),this.resetContainer();var g=this.map._getContainerDomSize();this.updateMapSize(g)}},i.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!Tt(t,e),this._isViewChanged},i._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||Tt(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},i.isSpatialReferenceChanged=function(){return this._spatialRefChanged},i._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},i._frameLoop=function(t){var e=this;this.map?(t=t||0,this._frameTimestamp=t,this._resizeCount=0,this.renderFrame(t),this._animationFrame=K(function(t){e._frameLoop(t)})):this._cancelFrameLoop()},i._cancelFrameLoop=function(){this._animationFrame&&Q(this._animationFrame)},i._drawLayerCanvasImage=function(t,e,i,n){var r=this.context,o=e.point.round(),s=this.map.getDevicePixelRatio();1!==s&&o._multi(s);var a=e.image,h=a.width,u=a.height;if(!(o.x+h<=0||o.y+u<=0)){var l=t.options.opacity;if(p(l)||(l=1),!(l<=0)){var c=e.opacity;if(p(c)||(c=1),!(c<=0)){var f=r.globalAlpha;l<1&&(r.globalAlpha*=l),c<1&&(r.globalAlpha*=c),t.options.cssFilter&&(r.filter=t.options.cssFilter);var d=t.getRenderer(),g=d.__zoomTransformMatrix,m=d.clipCanvas(this.context);g&&(r.save(),r.setTransform.apply(r,g)),r.drawImage(a,0,0,h,u,o.x,o.y,i,n),g&&r.restore(),m&&r.restore(),"none"!==r.filter&&(r.filter="none"),r.globalAlpha=f}}}},i._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,i=new et(this.canvas.width/2,this.canvas.height/2);_(t)?t(e,i):pi.drawCross(this.context,i.x,i.y,2,"#f00")}},i._drawContainerExtent=function(){var t=this.map.options.cascadePitches,e=this.map.height-this.map._getVisualHeight(t[0]),i=this.map.height-this.map._getVisualHeight(t[1]),n=this.map.getContainerExtent(),r=this.context;r.beginPath(),r.moveTo(0,n.ymin),r.lineTo(n.xmax,n.ymin),r.stroke(),r.beginPath(),r.moveTo(0,e),r.lineTo(n.xmax,e),r.stroke(),r.beginPath(),r.moveTo(0,i),r.lineTo(n.xmax,i),r.stroke()},i._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=t.getDevicePixelRatio(),i=this.context,n=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var o=n.ymin*e,s=Math.ceil(o-r),a=t.options.fogColor.join(),h=i.createLinearGradient(0,r,0,o+30),u=1-30/(s+30);h.addColorStop(0,"rgba("+a+", 0)"),h.addColorStop(.3,"rgba("+a+", 0.3)"),h.addColorStop(u,"rgba("+a+", 1)"),h.addColorStop(1,"rgba("+a+", 0)"),i.beginPath(),i.fillStyle=h,i.fillRect(0,r,Math.ceil(n.getWidth())*e,Math.ceil(s+30))}},i._getAllLayerToRender=function(){return this.map._getLayers()},i.clearCanvas=function(){this.canvas&&pi.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),i=this.canvas,n=t.getDevicePixelRatio();return(e.width*n!==i.width||e.height*n!==i.height)&&(i.height=n*e.height,i.width=n*e.width,this.topLayer.width=i.width,this.topLayer.height=i.height,i.style&&(i.style.width=e.width+"px",i.style.height=e.height+"px"),!0)},i.createCanvas=function(){this.topLayer=Ne("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=Ne("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},i._updateDomPosition=function(t){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(t-this._checkPositionTime)>=500&&(Ye(this.map._containerDOM),this._checkPositionTime=Math.min(t,this._checkPositionTime)),this},i._checkSize=function(){this.map&&this.map.checkSize()},i._setCheckSizeInterval=function(t){var e=this;q.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver(function(t){!e.map||e.map.isRemoved()?e._resizeObserver.disconnect():t.length&&(e._checkSize(t[0].contentRect),e._resizeCount=e._resizeCount||0,e.renderFrame((e._frameTimestamp||0)+ ++e._resizeCount/100))}),this._resizeObserver.observe(this.map._containerDOM))):(clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval(function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()},this._checkSizeInterval))},i._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!P&&"undefined"!=typeof window&&this._setCheckSizeInterval(e.options.checkSizeInterval),q.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",function(e){t._eventParam=e}),e.on("_zooming",function(i){e.getPitch()||(t._zoomMatrix=i.matrix.container),t._eventParam=i}),e.on("_zoomend",function(e){t._eventParam=e,delete t._zoomMatrix}),e.on("_spatialreferencechange",function(){t._spatialRefChanged=!0}),q.webgl&&"undefined"!=typeof document&&Be(document,"visibilitychange",this._thisVisibilitychange,this)},i._onMapMouseMove=function(t){var e=this,i=this.map;!i.isInteracting()&&i.options.hitDetect&&(this._hitDetectFrame&&Q(this._hitDetectFrame),this._hitDetectFrame=K(function(){e.hitDetect(t.containerPoint)}))},i._getCanvasLayers=function(){return this.map._getLayers(function(t){return t.isCanvasRender()})},i._onVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},i.addTopElement=function(t){this._tops||(this._tops=[]),this._tops.push(t)},i.removeTopElement=function(t){if(this._tops){var e=this._tops.indexOf(t);e>=0&&this._tops.splice(e,1)}},i.getTopElements=function(){return this._tops||[]},i.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var t=this.getTopElements(),e=!1,i=0;i<t.length;i++)t[i].render(this.topCtx)&&(e=!0);e&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},e}(Xh);co.registerRenderer("canvas",Kh),co.mergeOptions({fog:!1,fogColor:[233,233,233]});var Qh={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};Ro.include(Qh),Vo.include(Qh),Wo.include(Qh),Uo.include(Qh),$o.include({_getRenderPoints:function(t){var e=this.getMap(),i=e.getGLRes();if("vertex"===t){for(var n=this._trimRing(this.getShell()),r=[],o=0,s=n.length;o<s;o++)r.push(e.coordToPointAtRes(n[o],i));return[r,null]}return[[e.coordToPointAtRes(this.getCenter(),i)],null]}});var tu={_getRenderPoints:function(t){var e,i=this.getMap(),n=i.getGLRes(),r=null;if("point"===t)(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n))&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if("vertex"===t)if(r=[],(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n))&&e.length>0&&Array.isArray(e[0])){for(var o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)0===a?r.push([e[o][a],e[o][a+1]]):r.push([e[o][a-1],e[o][a]]);e=e[0].concat(e[1])}else for(var u=0,l=e.length;u<l;u++)0===u?r.push([e[u],e[u+1]]):r.push([e[u-1],e[u]]);else if("line"===t){e=[],r=[];var c=this._getPath2DPoints(this._getPrjCoordinates(),!1,n);if(c.length>0&&Array.isArray(c[0]))for(var f,d=1,p=c.length;d<p;d++){f=c[d],this instanceof Ao&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(f[0]);for(var g=1,m=f.length;g<m;g++)e.push(f[g].add(f[g-1])._multi(.5)),r.push([f[g-1],f[g]])}else{this instanceof Ao&&c.length>0&&!c[0].equals(c[c.length-1])&&c.push(c[0]);for(var v=1,_=c.length;v<_;v++)e.push(c[v].add(c[v-1])._multi(.5)),r.push([c[v-1],c[v]])}}else if("vertex-first"===t){var y=this._getPrjCoordinates();e=y.length?[i._prjToPointAtRes(y[0],n)]:[],r=y.length?[[i._prjToPointAtRes(y[0],n),i._prjToPointAtRes(y[1],n)]]:[]}else if("vertex-last"===t){var x=this._getPrjCoordinates(),w=x.length;e=w?[i._prjToPointAtRes(x[w-1],n)]:[];var b=w-1,C=w>1?w-2:w-1;r=w?[[i._prjToPointAtRes(x[C],n),i._prjToPointAtRes(x[b],n)]]:[]}else{var P=this._getProjection().project(this.getCenter());e=[i._prjToPointAtRes(P,n)]}return[e,r]}};Lo.include(tu),Ao.include(tu);var eu={within:!1,center:[0,0]};function iu(t){if(t&&t._containerBbox){eu.within=!1;var e=t._containerBbox,i=e.minx,n=e.miny,r=e.maxx,o=e.maxy,s=Math.abs(r-i),a=Math.abs(o-n);s<=1&&a<=1&&(eu.within=!0,eu.center[0]=(i+r)/2,eu.center[1]=(n+o)/2),delete t._containerBbox}else eu.within=!1;return eu}Qr.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var nu={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof Vo||this instanceof Uo},_paintAsPath:function(){var t=this.getMap();return this.getAltitude()>0||t.getPitch()||this instanceof Vo&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return Ao.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),i=t._prjToPointAtRes(e,t.getGLRes()),n=this._getRenderSize(i);return[i].concat(n)},_paintOn:function(){return this._paintAsPath()?pi.polygon.apply(pi,arguments):pi.ellipse.apply(pi,arguments)},_getRenderSize:function(t){var e=this.getMap(),i=e.getGLRes(),n=this._getPrjExtent(),r=e._prjToPointAtRes(n.getMin(),i),o=e._prjToPointAtRes(n.getMax(),i);return[Math.abs(o.x-r.x)/2,Math.abs(o.y-t.y),Math.abs(t.y-r.y)]}};Vo.include(nu),Wo.include(nu),$o.include({_getPaintParams:function(){var t=this.getMap(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t.getGLRes())]},_paintOn:pi.polygon}),Uo.include(nu,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return Ao.prototype._getPaintParams.call(this,!0);var t=this.getMap(),e=t._prjToPointAtRes(this._getPrjCoordinates(),t.getGLRes());return[e,this._getRenderSize(e)[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return pi.polygon.apply(pi,arguments);var t=this.getMap().getBearing(),e=arguments;return t&&(e[3]=e[3].slice(0),e[3][0]+=t,e[3][1]+=t),pi.sector.apply(pi,e)}}),So.include({_paintAsPath:function(){return!0}}),Lo.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,i,n,r){if(!t||!e||t.equals(e))return null;r||(r=0);var o,s=i*n[0],a=i*n[1]+r,h=s/2+r;(o=e.nextCtrlPoint||e.prevCtrlPoint?e.prevCtrlPoint?e.sub(new et(e.prevCtrlPoint)):e.sub(new et(e.nextCtrlPoint)):e.sub(t))._unit();var u=e.sub(o.multi(a));o._perp();var l=u.add(o.multi(h));return o._multi(-1),[l,e,u.add(o.multi(h)),l]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLRes())]},_paintOn:function(t,e,i,n,r){var o=iu(this._painter);o.within?pi.pixelRect(t,o.center,i,n):this.options.smoothness?pi.paintSmoothLine(t,e,i,this.options.smoothness,!1,this._animIdx,this._animTailRatio):pi.path(t,e,i,null,r),this._paintArrow(t,e,i)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,i){var n=this._getArrowStyle();if(!n||t.length<2)return[];for(var r=t.length>0&&Array.isArray(t[0])?t:[t],o=this._getArrowPlacement(),s=[],a=this.getMap(),h=a.coordToContainerPoint(this.getFirstCoordinate()),u=a.coordToContainerPoint(this.getLastCoordinate()),l=r.length-1;l>=0;l--){if("vertex-first"===o||"vertex-firstlast"===o&&r[l][0].closeTo(h,.01)){var c=this._getArrowShape(r[l][1],r[l][0],e,n,i);c&&s.push(c)}if("vertex-last"===o||"vertex-firstlast"===o&&r[l][r[l].length-1].closeTo(u,.01)){var f=this._getArrowShape(r[l][r[l].length-2],r[l][r[l].length-1],e,n,i);f&&s.push(f)}else"point"===o&&this._getArrowPoints(s,r[l],e,n,i)}return s},_getArrowPoints:function(t,e,i,n,r){for(var o=0,s=e.length-1;o<s;o++){var a=this._getArrowShape(e[o],e[o+1],i,n,r);a&&t.push(a)}},_paintArrow:function(t,e,i){var n=this._getInternalSymbol().lineWidth;(!p(n)||n<3)&&(n=3);var r=this._getArrows(e,n);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;o>=0;o--)t.fillStyle=t.strokeStyle,pi.polygon(t,r[o],i,i)}}}),Ao.include({_getPaintParams:function(t){var e=this.getMap().getGLRes(),i=this._getPrjShell(),n=this._getPath2DPoints(i,t,e),r=n.length>0&&Array.isArray(n[0]);r&&(n=[[n[0]],[n[1]]]);var o=this._getPrjHoles(),s=[];if(o&&o.length>0){for(var a=this._simplified,h=0;h<o.length;h++){var u=this._getPath2DPoints(o[h],t,e);Array.isArray(u)&&r?Array.isArray(u[0])?(n[0].push(u[0]),n[1].push(u[1])):n[0].push(u):s.push(u)}a&&(this._simplified=a)}return r||at(n=[n],s),[n]},_paintOn:function(t,e,i,n,r){var o=iu(this._painter);o.within?pi.pixelRect(t,o.center,i,n):pi.polygon(t,e,i,n,r,this.options.smoothness)}});var ru={};var ou,su="\n    var adapters = {};\n    onmessage = function (msg) {\n        msg = msg.data;\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    };\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            post(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n",au="\n    workerExports = null;\n";function hu(){if("undefined"==typeof window)return null;if(!ou){var t=function(){var t=su;for(var e in ru)t+="\n    workerExports = {};\n    ("+ru[e]+")(workerExports, self);\n    adapters['"+e+"'] = workerExports",t+="\n    workerExports.initialize && workerExports.initialize(self);\n        ";return t+=au}();ou=window.URL.createObjectURL(new Blob([t],{type:"text/javascript"})),ru=null}return ou}var uu,lu="undefined"!=typeof window?window.navigator.hardwareConcurrency||4:0,cu=Math.max(Math.floor(lu/2),1),fu=function(){function t(){this.active={},this.workerCount="undefined"!=typeof window?window.MAPTALKS_WORKER_COUNT||cu:0}var e=t.prototype;return e.acquire=function(t){if(!this.workers){this.workers=[];for(var e=hu(),i=0;i<this.workerCount;i++){var n=new Worker(e);n.id=i,this.workers.push(n)}}return this.active[t]=!0,this.workers.slice()},e.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},t}();var du=0,pu=[];!function(){function t(t){var e=this;this.workerKey=t,this.workerPool=(uu||(uu=new fu),uu),this.currentActor=0,this.actorId=ot(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach(function(t){t.addEventListener("message",e.receiveFn,!1)})}var e=t.prototype;e.isActive=function(){return!!this.workers},e.broadcast=function(t,e,i){var n=this;return i=i||function(){},function(t,e,i){t.length||i(null,[]);var n=t.length,r=new Array(t.length),o=null;t.forEach(function(t,s){e(t,function(t,e){t&&(o=t),r[s]=e,0==--n&&i(o,r)})})}(this.workers,function(i,r){n.send(t,e,r,i.id)},i),this},e.send=function(t,e,i,n){var r=i?this.actorId+":"+this.callbackID++:null;return i&&(this.callbacks[r]=i),this.post({data:t,callback:String(r)},e,n),this},e.receive=function(t){var e=this,i=t.data,n=i.callback,r=this.callbacks[n];delete this.callbacks[n],"<request>"===i.type?this.actorId===i.actorId&&this[i.command](i.params,function(t,n,r){var o={type:"<response>",callback:i.callback};t?o.error=t.message:o.data=n,e.post(o,r||pu,i.workerId)}):r&&i.error?r(i.error):r&&r(null,i.data)},e.remove=function(){var t=this;this.workers.forEach(function(e){e.removeEventListener("message",t.receiveFn,!1)}),this.workerPool.release(this.actorId),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},e.post=function(t,e,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),t.workerId=i,t.workerKey=this.workerKey,t.actorId=this.actorId,this.workers[i].postMessage(t,e||pu),i},e.getDedicatedWorker=function(){return du=(du+1)%this.workerPool.workerCount}}();co.VERSION="1.0.0-beta.7"}).call(e,i("W2nU"),i("DuR2"))}});
//# sourceMappingURL=vendor.7a7bf526f5efcc277e95.js.map